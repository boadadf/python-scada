{
 "modules": [
  { "name": "alarm" },
  { "name": "command" },
  { "name": "communication" },
  { "name": "datapoint" },
  { "name": "animation" },
  { "name": "tracking",
    "config": {
      "mode": "file",  
      "file_path": "flow_events.log"
    }
  }
],
  "dp_types": {
    "LEVEL":      { "type": "float", "min": 0, "max": 100, "default": 0.0 },
    "STATUS":     { "type": "enum", "values": ["OPENED", "CLOSED"], "default": "CLOSED" },
    "START_STOP":      { "type": "enum", "values": ["STARTED", "STOPPED"], "default": "STOPPED" },
    "START_STOP_CMD":      { "type": "enum", "values": ["START", "STOP"], "default": "STOP" },
    "PRESSURE":   { "type": "float", "min": 0, "max": 200, "default": 50.0 },
    "TEMPERATURE":{ "type": "float", "min": 100, "max": 150, "default": 120.0 }
  },
  "drivers": [
    {
      "name": "Server1",
      "driver_class": "TankTestDriver",
      "connection_info": { "server_name": "Server1" },
      "datapoints": [
        { "name": "TANK", "type": "LEVEL" },
        { "name": "PUMP", "type": "STATUS" },
        { "name": "DOOR", "type": "STATUS" },
        { "name": "TEST", "type": "START_STOP" }
      ],
      "command_datapoints": [
        { "name": "PUMP_CMD", "type": "STATUS" },
        { "name": "DOOR_CMD", "type": "STATUS" },
        { "name": "TEST_CMD", "type": "START_STOP_CMD" }
      ]
    },
    {
      "name": "Server2",
      "driver_class": "BoilerTestDriver",
      "connection_info": { "server_name": "Server2" },
      "datapoints": [
        { "name": "VALVE", "type": "STATUS" },
        { "name": "PRESSURE", "type": "PRESSURE" },
        { "name": "TEMPERATURE", "type": "TEMPERATURE" },
        { "name": "HEATER", "type": "STATUS" },
        { "name": "TEST", "type": "START_STOP" }
      ],
      "command_datapoints": [
        { "name": "VALVE_CMD", "type": "STATUS" },
        { "name": "HEATER_CMD", "type": "STATUS" },
        { "name": "TEST_CMD", "type": "START_STOP_CMD" }      
      ]
    }
  ],
  "rules": [
    {
      "rule_id": "close_valve_if_high",
      "on_condition": "Server2@PRESSURE > 100",
      "on_actions": [
        "send_command('Server2@VALVE', 0)",
        "raise_alarm()"
      ],
      "off_condition": "Server2@PRESSURE < 80",
      "off_actions": [
        "lower_alarm()"
      ]
    },
    {
      "rule_id": "pump_start_if_low_level",
      "on_condition": "float(Server1@TANK) < 10",
      "on_actions": [
        "send_command('Server1@PUMP', 'OPENED')",
        "raise_alarm()"
      ]
    },
    {
      "rule_id": "door_open_alarm",
      "on_condition": "Server1@DOOR == OPENED",
      "on_actions": [
        "raise_alarm()"
      ]
    },
    {
      "rule_id": "temperature_high_warning",
      "on_condition": "Server2@TEMPERATURE > 80",
      "on_actions": [
        "raise_alarm()"
      ]
    }
  ]
}