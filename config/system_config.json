{
  "animations": {
    "ALARM_SWITCHES": [
      {
        "attribute": "href",
        "default": "#",
        "expression": {
          "ACTIVE": "#alert",
          "FINISHED": "#",
          "INACTIVE": "#"
        },
        "quality": {
          "unknown": "#alert"
        },
        "revertAfter": 0,
        "triggerType": "alarm"
      }
    ],
    "LEFT_SWITCH_STRAIGHT": [
      {
        "attribute": "visibility",
        "expression": {
          "STRAIGHT": "visible",
          "TURN": "hidden"
        },
        "quality": {
          "unknown": "hidden"
        }
      }
    ],
    "LEFT_SWITCH_TURN": [
      {
        "attribute": "visibility",
        "expression": {
          "STRAIGHT": "hidden",
          "TURN": "visible"
        },
        "quality": {
          "unknown": "hidden"
        }
      }
    ],
    "RIGHT_SWITCH_STRAIGHT": [
      {
        "attribute": "visibility",
        "expression": {
          "STRAIGHT": "visible",
          "TURN": "hidden"
        },
        "quality": {
          "unknown": "hidden"
        }
      }
    ],
    "RIGHT_SWITCH_TURN": [
      {
        "attribute": "visibility",
        "expression": {
          "STRAIGHT": "hidden",
          "TURN": "visible"
        },
        "quality": {
          "unknown": "hidden"
        }
      }
    ],
    "SIGNAL_STRAIGHT": [
      {
        "attribute": "href",
        "expression": {
          "STRAIGHT": "#clear",
          "TURN": "#stop"
        },
        "quality": {
          "unknown": "none"
        }
      }
    ],
    "SIGNAL_TURN": [
      {
        "attribute": "href",
        "expression": {
          "STRAIGHT": "#stop",
          "TURN": "#clear"
        },
        "quality": {
          "unknown": "none"
        }
      }
    ],
    "SWITCH_CONTROL": [
      {
        "attribute": "fill",
        "default": "gray",
        "expression": {
          "STRAIGHT": "green",
          "TURN": "red"
        },
        "quality": {
          "unknown": "gray"
        }
      }
    ],
    "driver_connection": [
      {
        "attribute": "fill",
        "default": "gray",
        "duration": 0.5,
        "expression": {
          "OFFLINE": "red",
          "ONLINE": "green"
        },
        "quality": {
          "unknown": "gray"
        },
        "triggerType": "connection"
      }
    ],
    "fill_level": [
      {
        "attribute": "y",
        "expression": "390 - ((value/100) * 340)",
        "quality": {
          "unknown": 390
        }
      },
      {
        "attribute": "height",
        "expression": "(value/100) * 340",
        "quality": {
          "unknown": 0
        }
      }
    ],
    "level_text": [
      {
        "attribute": "text",
        "expression": "str(value)",
        "quality": {
          "unknown": "0.0"
        }
      }
    ],
    "toggle_opened_closed": [
      {
        "attribute": "fill",
        "expression": {
          "CLOSED": "red",
          "OPENED": "green"
        },
        "quality": {
          "unknown": "gray"
        }
      }
    ],
    "toggle_start_stop": [
      {
        "attribute": "fill",
        "expression": {
          "STARTED": "green",
          "STOPPED": "brown"
        },
        "quality": {
          "unknown": "gray"
        }
      }
    ]
  },
  "dp_types": {
    "LEVEL": {
      "default": 0,
      "max": 100,
      "min": 0,
      "type": "float"
    },
    "OPENED_CLOSED": {
      "default": "CLOSED",
      "type": "enum",
      "values": [
        "OPENED",
        "CLOSED"
      ]
    },
    "OPEN_CLOSE_CMD": {
      "default": "CLOSE",
      "type": "enum",
      "values": [
        "OPEN",
        "CLOSE",
        "TOGGLE"
      ]
    },
    "PRESSURE": {
      "default": 50,
      "max": 200,
      "min": 0,
      "type": "float"
    },
    "START_STOP": {
      "default": "STOPPED",
      "type": "enum",
      "values": [
        "STARTED",
        "STOPPED"
      ]
    },
    "START_STOP_CMD": {
      "default": "STOP",
      "type": "enum",
      "values": [
        "START",
        "STOP",
        "TOGGLE"
      ]
    },
    "SWITCH_CONTROL": {
      "default": "STRAIGHT",
      "max": 100,
      "min": 0,
      "type": "enum",
      "values": [
        "STRAIGHT",
        "TURN"
      ]
    },
    "SWITCH_CONTROL_CMD": {
      "default": "TOGGLE",
      "max": 100,
      "min": 0,
      "type": "enum",
      "values": [
        "TOGGLE"
      ]
    },
    "TEMPERATURE": {
      "default": 120,
      "max": 150,
      "min": 100,
      "type": "enum"
    }
  },
  "drivers": [
    {
      "command_datapoints": [
        {
          "name": "PUMP_CMD",
          "type": "OPEN_CLOSE_CMD"
        },
        {
          "name": "DOOR_CMD",
          "type": "OPEN_CLOSE_CMD"
        },
        {
          "name": "TEST_CMD",
          "type": "START_STOP_CMD"
        }
      ],
      "connection_info": {
        "server_name": "Server1"
      },
      "datapoints": [
        {
          "name": "TANK",
          "type": "LEVEL"
        },
        {
          "name": "PUMP",
          "type": "OPENED_CLOSED"
        },
        {
          "name": "DOOR",
          "type": "OPENED_CLOSED"
        },
        {
          "name": "TEST",
          "type": "START_STOP"
        }
      ],
      "driver_class": "TankTestDriver",
      "name": "Server1"
    },
    {
      "command_datapoints": [
        {
          "name": "VALVE_CMD",
          "type": "OPENED_CLOSED_CMD"
        },
        {
          "name": "HEATER_CMD",
          "type": "OPEN_CLOSE_CMD"
        },
        {
          "name": "TEST_CMD",
          "type": "START_STOP_CMD"
        }
      ],
      "connection_info": {
        "server_name": "Server2"
      },
      "datapoints": [
        {
          "name": "VALVE",
          "type": "OPENED_CLOSED"
        },
        {
          "name": "PRESSURE",
          "type": "PRESSURE"
        },
        {
          "name": "TEMPERATURE",
          "type": "TEMPERATURE"
        },
        {
          "name": "HEATER",
          "type": "OPENED_CLOSED"
        },
        {
          "name": "TEST",
          "type": "START_STOP"
        }
      ],
      "driver_class": "BoilerTestDriver",
      "name": "Server2"
    },
    {
      "command_datapoints": [
        {
          "name": "RIGHT_SWITCH_CONTROL_CMD",
          "type": "SWITCH_CONTROL_CMD"
        },
        {
          "name": "LEFT_SWITCH_CONTROL_CMD",
          "type": "SWITCH_CONTROL_CMD"
        }
      ],
      "connection_info": {
        "server_name": "TrainTestDriver"
      },
      "datapoints": [
        {
          "name": "RIGHT_SWITCH_CONTROL",
          "type": "SWITCH_CONTROL"
        },
        {
          "name": "LEFT_SWITCH_CONTROL",
          "type": "SWITCH_CONTROL"
        }
      ],
      "driver_class": "TrainTestDriver",
      "name": "TrainTestDriver"
    }
  ],
  "modules": [
    {
      "name": "alarm"
    },
    {
      "name": "command"
    },
    {
      "name": "communication"
    },
    {
      "name": "datapoint"
    },
    {
      "name": "animation"
    },
    {
      "name": "alert"
    },    
    {
      "name": "rule"
    }
  ],
  "rules": [
    {
      "off_actions": [
        "lower_alarm()"
      ],
      "off_condition": "Server2@PRESSURE < 80",
      "on_actions": [
        "send_command('Server2@VALVE', 0)",
        "raise_alarm()"
      ],
      "on_condition": "Server2@PRESSURE > 100",
      "rule_id": "close_valve_if_high"
    },
    {
      "on_actions": [
        "send_command('Server1@PUMP_CMD', 'OPEN')",
        "send_command('Server1@DOOR_CMD', 'CLOSE')",
        "raise_alarm()"
      ],
      "on_condition": "float(Server1@TANK) < 10",
      "rule_id": "pump_start_if_low_level"
    },
    {
      "on_actions": [
        "raise_alarm()"
      ],
      "on_condition": "Server1@DOOR == OPENED",
      "rule_id": "door_open_alarm"
    },
    {
      "on_actions": [
        "raise_alarm()"
      ],
      "on_condition": "Server2@TEMPERATURE > 80",
      "rule_id": "temperature_high_warning"
    },
    {
      "off_actions": [],
      "off_condition": "",
      "on_actions": [
        "raise_alarm()",
        "client_alert('Switches are in an invalid state!\\nSolve issue by setting right switch to TURN?', 'confirm_cancel', 'TrainTestDriver@RIGHT_SWITCH_CONTROL', 'TURN', 30)"
      ],
      "on_condition": "TrainTestDriver@RIGHT_SWITCH_CONTROL == 'STRAIGHT' and TrainTestDriver@LEFT_SWITCH_CONTROL == 'TURN'",
      "rule_id": "switch_error_straight"
    },
    {
      "off_actions": [],
      "off_condition": "",
      "on_actions": [
        "raise_alarm()",
        "client_alert('Switches are in an invalid state!\\nSolve issue by setting right switch to STRAIGHT?', 'confirm_cancel', 'TrainTestDriver@RIGHT_SWITCH_CONTROL', 'STRAIGHT', 30)"
      ],
      "on_condition": "TrainTestDriver@RIGHT_SWITCH_CONTROL == 'TURN' and TrainTestDriver@LEFT_SWITCH_CONTROL == 'STRAIGHT'",
      "rule_id": "switch_error_turn"
    }
  ]
}
