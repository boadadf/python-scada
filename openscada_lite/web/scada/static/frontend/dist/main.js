/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var s={},a=[],o=0;o<t.length;o++){var l=t[o],u=i.base?l[0]+i.base:l[0],c=s[u]||0,h="".concat(u," ").concat(c);s[u]=c+1;var d=n(h),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=r(f,i);i.byIndex=o,e.splice(o,0,{identifier:h,updater:p,references:1})}a.push(h)}return a}function r(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,r){var s=i(t=t||[],r=r||{});return function(t){t=t||[];for(var a=0;a<s.length;a++){var o=n(s[a]);e[o].references--}for(var l=i(t,r),u=0;u<s.length;u++){var c=n(s[u]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}s=l}}},81:(t,e,n)=>{"use strict";n.d(e,{A:()=>g});var i=n(601),r=n.n(i),s=n(314),a=n.n(s),o=n(417),l=n.n(o),u=new URL(n(363),n.b),c=new URL(n(426),n.b),h=new URL(n(927),n.b),d=a()(r()),f=l()(u),p=l()(c),m=l()(h);d.push([t.id,`/* required styles */\n\n.leaflet-pane,\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow,\n.leaflet-tile-container,\n.leaflet-pane > svg,\n.leaflet-pane > canvas,\n.leaflet-zoom-box,\n.leaflet-image-layer,\n.leaflet-layer {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\t}\n.leaflet-container {\n\toverflow: hidden;\n\t}\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t        user-select: none;\n\t  -webkit-user-drag: none;\n\t}\n/* Prevents IE11 from highlighting tiles in blue */\n.leaflet-tile::selection {\n\tbackground: transparent;\n}\n/* Safari renders non-retina tile on retina better with this, but Chrome is worse */\n.leaflet-safari .leaflet-tile {\n\timage-rendering: -webkit-optimize-contrast;\n\t}\n/* hack that prevents hw layers "stretching" when loading new tiles */\n.leaflet-safari .leaflet-tile-container {\n\twidth: 1600px;\n\theight: 1600px;\n\t-webkit-transform-origin: 0 0;\n\t}\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n\tdisplay: block;\n\t}\n/* .leaflet-container svg: reset svg max-width decleration shipped in Joomla! (joomla.org) 3.x */\n/* .leaflet-container img: map is broken in FF if you have max-width: 100% on tiles */\n.leaflet-container .leaflet-overlay-pane svg {\n\tmax-width: none !important;\n\tmax-height: none !important;\n\t}\n.leaflet-container .leaflet-marker-pane img,\n.leaflet-container .leaflet-shadow-pane img,\n.leaflet-container .leaflet-tile-pane img,\n.leaflet-container img.leaflet-image-layer,\n.leaflet-container .leaflet-tile {\n\tmax-width: none !important;\n\tmax-height: none !important;\n\twidth: auto;\n\tpadding: 0;\n\t}\n\n.leaflet-container img.leaflet-tile {\n\t/* See: https://bugs.chromium.org/p/chromium/issues/detail?id=600120 */\n\tmix-blend-mode: plus-lighter;\n}\n\n.leaflet-container.leaflet-touch-zoom {\n\t-ms-touch-action: pan-x pan-y;\n\ttouch-action: pan-x pan-y;\n\t}\n.leaflet-container.leaflet-touch-drag {\n\t-ms-touch-action: pinch-zoom;\n\t/* Fallback for FF which doesn't support pinch-zoom */\n\ttouch-action: none;\n\ttouch-action: pinch-zoom;\n}\n.leaflet-container.leaflet-touch-drag.leaflet-touch-zoom {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.leaflet-container {\n\t-webkit-tap-highlight-color: transparent;\n}\n.leaflet-container a {\n\t-webkit-tap-highlight-color: rgba(51, 181, 229, 0.4);\n}\n.leaflet-tile {\n\tfilter: inherit;\n\tvisibility: hidden;\n\t}\n.leaflet-tile-loaded {\n\tvisibility: inherit;\n\t}\n.leaflet-zoom-box {\n\twidth: 0;\n\theight: 0;\n\t-moz-box-sizing: border-box;\n\t     box-sizing: border-box;\n\tz-index: 800;\n\t}\n/* workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=888319 */\n.leaflet-overlay-pane svg {\n\t-moz-user-select: none;\n\t}\n\n.leaflet-pane         { z-index: 400; }\n\n.leaflet-tile-pane    { z-index: 200; }\n.leaflet-overlay-pane { z-index: 400; }\n.leaflet-shadow-pane  { z-index: 500; }\n.leaflet-marker-pane  { z-index: 600; }\n.leaflet-tooltip-pane   { z-index: 650; }\n.leaflet-popup-pane   { z-index: 700; }\n\n.leaflet-map-pane canvas { z-index: 100; }\n.leaflet-map-pane svg    { z-index: 200; }\n\n.leaflet-vml-shape {\n\twidth: 1px;\n\theight: 1px;\n\t}\n.lvml {\n\tbehavior: url(#default#VML);\n\tdisplay: inline-block;\n\tposition: absolute;\n\t}\n\n\n/* control positioning */\n\n.leaflet-control {\n\tposition: relative;\n\tz-index: 800;\n\tpointer-events: visiblePainted; /* IE 9-10 doesn't have auto */\n\tpointer-events: auto;\n\t}\n.leaflet-top,\n.leaflet-bottom {\n\tposition: absolute;\n\tz-index: 1000;\n\tpointer-events: none;\n\t}\n.leaflet-top {\n\ttop: 0;\n\t}\n.leaflet-right {\n\tright: 0;\n\t}\n.leaflet-bottom {\n\tbottom: 0;\n\t}\n.leaflet-left {\n\tleft: 0;\n\t}\n.leaflet-control {\n\tfloat: left;\n\tclear: both;\n\t}\n.leaflet-right .leaflet-control {\n\tfloat: right;\n\t}\n.leaflet-top .leaflet-control {\n\tmargin-top: 10px;\n\t}\n.leaflet-bottom .leaflet-control {\n\tmargin-bottom: 10px;\n\t}\n.leaflet-left .leaflet-control {\n\tmargin-left: 10px;\n\t}\n.leaflet-right .leaflet-control {\n\tmargin-right: 10px;\n\t}\n\n\n/* zoom and fade animations */\n\n.leaflet-fade-anim .leaflet-popup {\n\topacity: 0;\n\t-webkit-transition: opacity 0.2s linear;\n\t   -moz-transition: opacity 0.2s linear;\n\t        transition: opacity 0.2s linear;\n\t}\n.leaflet-fade-anim .leaflet-map-pane .leaflet-popup {\n\topacity: 1;\n\t}\n.leaflet-zoom-animated {\n\t-webkit-transform-origin: 0 0;\n\t    -ms-transform-origin: 0 0;\n\t        transform-origin: 0 0;\n\t}\nsvg.leaflet-zoom-animated {\n\twill-change: transform;\n}\n\n.leaflet-zoom-anim .leaflet-zoom-animated {\n\t-webkit-transition: -webkit-transform 0.25s cubic-bezier(0,0,0.25,1);\n\t   -moz-transition:    -moz-transform 0.25s cubic-bezier(0,0,0.25,1);\n\t        transition:         transform 0.25s cubic-bezier(0,0,0.25,1);\n\t}\n.leaflet-zoom-anim .leaflet-tile,\n.leaflet-pan-anim .leaflet-tile {\n\t-webkit-transition: none;\n\t   -moz-transition: none;\n\t        transition: none;\n\t}\n\n.leaflet-zoom-anim .leaflet-zoom-hide {\n\tvisibility: hidden;\n\t}\n\n\n/* cursors */\n\n.leaflet-interactive {\n\tcursor: pointer;\n\t}\n.leaflet-grab {\n\tcursor: -webkit-grab;\n\tcursor:    -moz-grab;\n\tcursor:         grab;\n\t}\n.leaflet-crosshair,\n.leaflet-crosshair .leaflet-interactive {\n\tcursor: crosshair;\n\t}\n.leaflet-popup-pane,\n.leaflet-control {\n\tcursor: auto;\n\t}\n.leaflet-dragging .leaflet-grab,\n.leaflet-dragging .leaflet-grab .leaflet-interactive,\n.leaflet-dragging .leaflet-marker-draggable {\n\tcursor: move;\n\tcursor: -webkit-grabbing;\n\tcursor:    -moz-grabbing;\n\tcursor:         grabbing;\n\t}\n\n/* marker & overlays interactivity */\n.leaflet-marker-icon,\n.leaflet-marker-shadow,\n.leaflet-image-layer,\n.leaflet-pane > svg path,\n.leaflet-tile-container {\n\tpointer-events: none;\n\t}\n\n.leaflet-marker-icon.leaflet-interactive,\n.leaflet-image-layer.leaflet-interactive,\n.leaflet-pane > svg path.leaflet-interactive,\nsvg.leaflet-image-layer.leaflet-interactive path {\n\tpointer-events: visiblePainted; /* IE 9-10 doesn't have auto */\n\tpointer-events: auto;\n\t}\n\n/* visual tweaks */\n\n.leaflet-container {\n\tbackground: #ddd;\n\toutline-offset: 1px;\n\t}\n.leaflet-container a {\n\tcolor: #0078A8;\n\t}\n.leaflet-zoom-box {\n\tborder: 2px dotted #38f;\n\tbackground: rgba(255,255,255,0.5);\n\t}\n\n\n/* general typography */\n.leaflet-container {\n\tfont-family: "Helvetica Neue", Arial, Helvetica, sans-serif;\n\tfont-size: 12px;\n\tfont-size: 0.75rem;\n\tline-height: 1.5;\n\t}\n\n\n/* general toolbar styles */\n\n.leaflet-bar {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.65);\n\tborder-radius: 4px;\n\t}\n.leaflet-bar a {\n\tbackground-color: #fff;\n\tborder-bottom: 1px solid #ccc;\n\twidth: 26px;\n\theight: 26px;\n\tline-height: 26px;\n\tdisplay: block;\n\ttext-align: center;\n\ttext-decoration: none;\n\tcolor: black;\n\t}\n.leaflet-bar a,\n.leaflet-control-layers-toggle {\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n\tdisplay: block;\n\t}\n.leaflet-bar a:hover,\n.leaflet-bar a:focus {\n\tbackground-color: #f4f4f4;\n\t}\n.leaflet-bar a:first-child {\n\tborder-top-left-radius: 4px;\n\tborder-top-right-radius: 4px;\n\t}\n.leaflet-bar a:last-child {\n\tborder-bottom-left-radius: 4px;\n\tborder-bottom-right-radius: 4px;\n\tborder-bottom: none;\n\t}\n.leaflet-bar a.leaflet-disabled {\n\tcursor: default;\n\tbackground-color: #f4f4f4;\n\tcolor: #bbb;\n\t}\n\n.leaflet-touch .leaflet-bar a {\n\twidth: 30px;\n\theight: 30px;\n\tline-height: 30px;\n\t}\n.leaflet-touch .leaflet-bar a:first-child {\n\tborder-top-left-radius: 2px;\n\tborder-top-right-radius: 2px;\n\t}\n.leaflet-touch .leaflet-bar a:last-child {\n\tborder-bottom-left-radius: 2px;\n\tborder-bottom-right-radius: 2px;\n\t}\n\n/* zoom control */\n\n.leaflet-control-zoom-in,\n.leaflet-control-zoom-out {\n\tfont: bold 18px 'Lucida Console', Monaco, monospace;\n\ttext-indent: 1px;\n\t}\n\n.leaflet-touch .leaflet-control-zoom-in, .leaflet-touch .leaflet-control-zoom-out  {\n\tfont-size: 22px;\n\t}\n\n\n/* layers control */\n\n.leaflet-control-layers {\n\tbox-shadow: 0 1px 5px rgba(0,0,0,0.4);\n\tbackground: #fff;\n\tborder-radius: 5px;\n\t}\n.leaflet-control-layers-toggle {\n\tbackground-image: url(${f});\n\twidth: 36px;\n\theight: 36px;\n\t}\n.leaflet-retina .leaflet-control-layers-toggle {\n\tbackground-image: url(${p});\n\tbackground-size: 26px 26px;\n\t}\n.leaflet-touch .leaflet-control-layers-toggle {\n\twidth: 44px;\n\theight: 44px;\n\t}\n.leaflet-control-layers .leaflet-control-layers-list,\n.leaflet-control-layers-expanded .leaflet-control-layers-toggle {\n\tdisplay: none;\n\t}\n.leaflet-control-layers-expanded .leaflet-control-layers-list {\n\tdisplay: block;\n\tposition: relative;\n\t}\n.leaflet-control-layers-expanded {\n\tpadding: 6px 10px 6px 6px;\n\tcolor: #333;\n\tbackground: #fff;\n\t}\n.leaflet-control-layers-scrollbar {\n\toverflow-y: scroll;\n\toverflow-x: hidden;\n\tpadding-right: 5px;\n\t}\n.leaflet-control-layers-selector {\n\tmargin-top: 2px;\n\tposition: relative;\n\ttop: 1px;\n\t}\n.leaflet-control-layers label {\n\tdisplay: block;\n\tfont-size: 13px;\n\tfont-size: 1.08333em;\n\t}\n.leaflet-control-layers-separator {\n\theight: 0;\n\tborder-top: 1px solid #ddd;\n\tmargin: 5px -10px 5px -6px;\n\t}\n\n/* Default icon URLs */\n.leaflet-default-icon-path { /* used only in path-guessing heuristic, see L.Icon.Default */\n\tbackground-image: url(${m});\n\t}\n\n\n/* attribution and scale controls */\n\n.leaflet-container .leaflet-control-attribution {\n\tbackground: #fff;\n\tbackground: rgba(255, 255, 255, 0.8);\n\tmargin: 0;\n\t}\n.leaflet-control-attribution,\n.leaflet-control-scale-line {\n\tpadding: 0 5px;\n\tcolor: #333;\n\tline-height: 1.4;\n\t}\n.leaflet-control-attribution a {\n\ttext-decoration: none;\n\t}\n.leaflet-control-attribution a:hover,\n.leaflet-control-attribution a:focus {\n\ttext-decoration: underline;\n\t}\n.leaflet-attribution-flag {\n\tdisplay: inline !important;\n\tvertical-align: baseline !important;\n\twidth: 1em;\n\theight: 0.6669em;\n\t}\n.leaflet-left .leaflet-control-scale {\n\tmargin-left: 5px;\n\t}\n.leaflet-bottom .leaflet-control-scale {\n\tmargin-bottom: 5px;\n\t}\n.leaflet-control-scale-line {\n\tborder: 2px solid #777;\n\tborder-top: none;\n\tline-height: 1.1;\n\tpadding: 2px 5px 1px;\n\twhite-space: nowrap;\n\t-moz-box-sizing: border-box;\n\t     box-sizing: border-box;\n\tbackground: rgba(255, 255, 255, 0.8);\n\ttext-shadow: 1px 1px #fff;\n\t}\n.leaflet-control-scale-line:not(:first-child) {\n\tborder-top: 2px solid #777;\n\tborder-bottom: none;\n\tmargin-top: -2px;\n\t}\n.leaflet-control-scale-line:not(:first-child):not(:last-child) {\n\tborder-bottom: 2px solid #777;\n\t}\n\n.leaflet-touch .leaflet-control-attribution,\n.leaflet-touch .leaflet-control-layers,\n.leaflet-touch .leaflet-bar {\n\tbox-shadow: none;\n\t}\n.leaflet-touch .leaflet-control-layers,\n.leaflet-touch .leaflet-bar {\n\tborder: 2px solid rgba(0,0,0,0.2);\n\tbackground-clip: padding-box;\n\t}\n\n\n/* popup */\n\n.leaflet-popup {\n\tposition: absolute;\n\ttext-align: center;\n\tmargin-bottom: 20px;\n\t}\n.leaflet-popup-content-wrapper {\n\tpadding: 1px;\n\ttext-align: left;\n\tborder-radius: 12px;\n\t}\n.leaflet-popup-content {\n\tmargin: 13px 24px 13px 20px;\n\tline-height: 1.3;\n\tfont-size: 13px;\n\tfont-size: 1.08333em;\n\tmin-height: 1px;\n\t}\n.leaflet-popup-content p {\n\tmargin: 17px 0;\n\tmargin: 1.3em 0;\n\t}\n.leaflet-popup-tip-container {\n\twidth: 40px;\n\theight: 20px;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-top: -1px;\n\tmargin-left: -20px;\n\toverflow: hidden;\n\tpointer-events: none;\n\t}\n.leaflet-popup-tip {\n\twidth: 17px;\n\theight: 17px;\n\tpadding: 1px;\n\n\tmargin: -10px auto 0;\n\tpointer-events: auto;\n\n\t-webkit-transform: rotate(45deg);\n\t   -moz-transform: rotate(45deg);\n\t    -ms-transform: rotate(45deg);\n\t        transform: rotate(45deg);\n\t}\n.leaflet-popup-content-wrapper,\n.leaflet-popup-tip {\n\tbackground: white;\n\tcolor: #333;\n\tbox-shadow: 0 3px 14px rgba(0,0,0,0.4);\n\t}\n.leaflet-container a.leaflet-popup-close-button {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\tborder: none;\n\ttext-align: center;\n\twidth: 24px;\n\theight: 24px;\n\tfont: 16px/24px Tahoma, Verdana, sans-serif;\n\tcolor: #757575;\n\ttext-decoration: none;\n\tbackground: transparent;\n\t}\n.leaflet-container a.leaflet-popup-close-button:hover,\n.leaflet-container a.leaflet-popup-close-button:focus {\n\tcolor: #585858;\n\t}\n.leaflet-popup-scrolled {\n\toverflow: auto;\n\t}\n\n.leaflet-oldie .leaflet-popup-content-wrapper {\n\t-ms-zoom: 1;\n\t}\n.leaflet-oldie .leaflet-popup-tip {\n\twidth: 24px;\n\tmargin: 0 auto;\n\n\t-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)";\n\tfilter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);\n\t}\n\n.leaflet-oldie .leaflet-control-zoom,\n.leaflet-oldie .leaflet-control-layers,\n.leaflet-oldie .leaflet-popup-content-wrapper,\n.leaflet-oldie .leaflet-popup-tip {\n\tborder: 1px solid #999;\n\t}\n\n\n/* div icon */\n\n.leaflet-div-icon {\n\tbackground: #fff;\n\tborder: 1px solid #666;\n\t}\n\n\n/* Tooltip */\n/* Base styles for the element that has a tooltip */\n.leaflet-tooltip {\n\tposition: absolute;\n\tpadding: 6px;\n\tbackground-color: #fff;\n\tborder: 1px solid #fff;\n\tborder-radius: 3px;\n\tcolor: #222;\n\twhite-space: nowrap;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\tpointer-events: none;\n\tbox-shadow: 0 1px 3px rgba(0,0,0,0.4);\n\t}\n.leaflet-tooltip.leaflet-interactive {\n\tcursor: pointer;\n\tpointer-events: auto;\n\t}\n.leaflet-tooltip-top:before,\n.leaflet-tooltip-bottom:before,\n.leaflet-tooltip-left:before,\n.leaflet-tooltip-right:before {\n\tposition: absolute;\n\tpointer-events: none;\n\tborder: 6px solid transparent;\n\tbackground: transparent;\n\tcontent: "";\n\t}\n\n/* Directions */\n\n.leaflet-tooltip-bottom {\n\tmargin-top: 6px;\n}\n.leaflet-tooltip-top {\n\tmargin-top: -6px;\n}\n.leaflet-tooltip-bottom:before,\n.leaflet-tooltip-top:before {\n\tleft: 50%;\n\tmargin-left: -6px;\n\t}\n.leaflet-tooltip-top:before {\n\tbottom: 0;\n\tmargin-bottom: -12px;\n\tborder-top-color: #fff;\n\t}\n.leaflet-tooltip-bottom:before {\n\ttop: 0;\n\tmargin-top: -12px;\n\tmargin-left: -6px;\n\tborder-bottom-color: #fff;\n\t}\n.leaflet-tooltip-left {\n\tmargin-left: -6px;\n}\n.leaflet-tooltip-right {\n\tmargin-left: 6px;\n}\n.leaflet-tooltip-left:before,\n.leaflet-tooltip-right:before {\n\ttop: 50%;\n\tmargin-top: -6px;\n\t}\n.leaflet-tooltip-left:before {\n\tright: 0;\n\tmargin-right: -12px;\n\tborder-left-color: #fff;\n\t}\n.leaflet-tooltip-right:before {\n\tleft: 0;\n\tmargin-left: -12px;\n\tborder-right-color: #fff;\n\t}\n\n/* Printing */\n\n@media print {\n\t/* Prevent printers from removing background-images of controls. */\n\t.leaflet-control {\n\t\t-webkit-print-color-adjust: exact;\n\t\tprint-color-adjust: exact;\n\t\t}\n\t}\n`,""]);const g=d},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},159:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},250:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});var i=n(601),r=n.n(i),s=n(314),a=n.n(s)()(r());a.push([t.id,"body, html, .osl-login-bg {\n  font-family: Arial, Helvetica, sans-serif;\n}\n\n.osl-login-bg {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.osl-login-form {\n  background: #fff;\n  border-radius: 12px;\n  box-shadow: 0 4px 24px rgba(0,0,0,0.10);\n  padding: 36px 32px;\n  min-width: 320px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.osl-login-title {\n  font-size: 32px;\n  font-weight: 700;\n  color: #2196f3;\n  margin-bottom: 8px;\n  letter-spacing: 1px;\n}\n.osl-login-subtitle {\n  font-size: 16px;\n  color: #555;\n  margin-bottom: 24px;\n  letter-spacing: 1px;\n}\n.osl-login-error {\n  color: #e53935;\n  margin-bottom: 12px;\n}\n.osl-login-input {\n  margin-bottom: 12px;\n  padding: 10px 14px;\n  border-radius: 6px;\n  border: 1px solid #bbb;\n  width: 100%;\n  font-size: 16px;\n  box-sizing: border-box;\n  min-width: 220px;\n}\n.osl-login-btn {\n  background: #2196f3;\n  color: #fff;\n  border: none;\n  border-radius: 6px;\n  padding: 10px 0;\n  width: 100%;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  box-shadow: 0 2px 8px rgba(33,150,243,0.10);\n  transition: background 0.2s;\n}\n.osl-login-btn:disabled {\n  background: #90caf9;\n  cursor: not-allowed;\n}",""]);const o=a},287:(t,e)=>{"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator,p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||p}function y(){}function _(t,e,n){this.props=t,this.context=e,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var b=_.prototype=new y;b.constructor=_,m(b,v.prototype),b.isPureReactComponent=!0;var E=Array.isArray,T=Object.prototype.hasOwnProperty,S={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function w(t,e,i){var r,s={},a=null,o=null;if(null!=e)for(r in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(a=""+e.key),e)T.call(e,r)&&!D.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(1===l)s.children=i;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];s.children=u}if(t&&t.defaultProps)for(r in l=t.defaultProps)void 0===s[r]&&(s[r]=l[r]);return{$$typeof:n,type:t,key:a,ref:o,props:s,_owner:S.current}}function L(t){return"object"==typeof t&&null!==t&&t.$$typeof===n}var k=/\/+/g;function A(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function x(t,e,r,s,a){var o=typeof t;"undefined"!==o&&"boolean"!==o||(t=null);var l=!1;if(null===t)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case n:case i:l=!0}}if(l)return a=a(l=t),t=""===s?"."+A(l,0):s,E(a)?(r="",null!=t&&(r=t.replace(k,"$&/")+"/"),x(a,e,r,"",function(t){return t})):null!=a&&(L(a)&&(a=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(a,r+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(k,"$&/")+"/")+t)),e.push(a)),1;if(l=0,s=""===s?".":s+":",E(t))for(var u=0;u<t.length;u++){var c=s+A(o=t[u],u);l+=x(o,e,r,c,a)}else if(c=function(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"==typeof c)for(t=c.call(t),u=0;!(o=t.next()).done;)l+=x(o=o.value,e,r,c=s+A(o,u++),a);else if("object"===o)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function C(t,e,n){if(null==t)return t;var i=[],r=0;return x(t,i,"","",function(t){return e.call(n,t,r++)}),i}function I(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var P={current:null},R={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function M(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:C,forEach:function(t,e,n){C(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return C(t,function(){e++}),e},toArray:function(t){return C(t,function(t){return t})||[]},only:function(t){if(!L(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=r,e.Profiler=a,e.PureComponent=_,e.StrictMode=s,e.Suspense=c,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.act=M,e.cloneElement=function(t,e,i){if(null==t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=m({},t.props),s=t.key,a=t.ref,o=t._owner;if(null!=e){if(void 0!==e.ref&&(a=e.ref,o=S.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(u in e)T.call(e,u)&&!D.hasOwnProperty(u)&&(r[u]=void 0===e[u]&&void 0!==l?l[u]:e[u])}var u=arguments.length-2;if(1===u)r.children=i;else if(1<u){l=Array(u);for(var c=0;c<u;c++)l[c]=arguments[c+2];r.children=l}return{$$typeof:n,type:t.type,key:s,ref:a,props:r,_owner:o}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:t},t.Consumer=t},e.createElement=w,e.createFactory=function(t){var e=w.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:u,render:t}},e.isValidElement=L,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:I}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=R.transition;R.transition={};try{t()}finally{R.transition=e}},e.unstable_act=M,e.useCallback=function(t,e){return P.current.useCallback(t,e)},e.useContext=function(t){return P.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return P.current.useDeferredValue(t)},e.useEffect=function(t,e){return P.current.useEffect(t,e)},e.useId=function(){return P.current.useId()},e.useImperativeHandle=function(t,e,n){return P.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return P.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return P.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return P.current.useMemo(t,e)},e.useReducer=function(t,e,n){return P.current.useReducer(t,e,n)},e.useRef=function(t){return P.current.useRef(t)},e.useState=function(t){return P.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return P.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return P.current.useTransition()},e.version="18.3.1"},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,i,r,s){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(a[l]=!0)}for(var u=0;u<t.length;u++){var c=[].concat(t[u]);i&&a[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),e.push(c))}},e}},338:(t,e,n)=>{"use strict";var i=n(961);e.H=i.createRoot,i.hydrateRoot},363:(t,e,n)=>{"use strict";t.exports=n.p+"416d91365b44e4b4f477.png"},417:t=>{"use strict";t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},426:(t,e,n)=>{"use strict";t.exports=n.p+"8f2c4d11474275fbc161.png"},463:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var i=n-1>>>1,r=t[i];if(!(0<s(r,e)))break t;t[i]=e,t[n]=r,n=i}}function i(t){return 0===t.length?null:t[0]}function r(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var i=0,r=t.length,a=r>>>1;i<a;){var o=2*(i+1)-1,l=t[o],u=o+1,c=t[u];if(0>s(l,n))u<r&&0>s(c,l)?(t[i]=c,t[u]=n,i=u):(t[i]=l,t[o]=n,i=o);else{if(!(u<r&&0>s(c,n)))break t;t[i]=c,t[u]=n,i=u}}}return e}function s(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var u=[],c=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"==typeof setTimeout?setTimeout:null,y="function"==typeof clearTimeout?clearTimeout:null,_="undefined"!=typeof setImmediate?setImmediate:null;function b(t){for(var e=i(c);null!==e;){if(null===e.callback)r(c);else{if(!(e.startTime<=t))break;r(c),e.sortIndex=e.expirationTime,n(u,e)}e=i(c)}}function E(t){if(g=!1,b(t),!m)if(null!==i(u))m=!0,R(T);else{var e=i(c);null!==e&&O(E,e.startTime-t)}}function T(t,n){m=!1,g&&(g=!1,y(L),L=-1),p=!0;var s=f;try{for(b(n),d=i(u);null!==d&&(!(d.expirationTime>n)||t&&!x());){var a=d.callback;if("function"==typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=n);n=e.unstable_now(),"function"==typeof o?d.callback=o:d===i(u)&&r(u),b(n)}else r(u);d=i(u)}if(null!==d)var l=!0;else{var h=i(c);null!==h&&O(E,h.startTime-n),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,D=!1,w=null,L=-1,k=5,A=-1;function x(){return!(e.unstable_now()-A<k)}function C(){if(null!==w){var t=e.unstable_now();A=t;var n=!0;try{n=w(!0,t)}finally{n?S():(D=!1,w=null)}}else D=!1}if("function"==typeof _)S=function(){_(C)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=C,S=function(){P.postMessage(null)}}else S=function(){v(C,0)};function R(t){w=t,D||(D=!0,S())}function O(t,n){L=v(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,R(T))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return i(u)},e.unstable_next=function(t){switch(f){case 1:case 2:case 3:var e=3;break;default:e=f}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_scheduleCallback=function(t,r,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,t){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return t={id:h++,callback:r,priorityLevel:t,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(t.sortIndex=s,n(c,t),null===i(u)&&t===i(c)&&(g?(y(L),L=-1):g=!0,O(E,s-a))):(t.sortIndex=o,n(u,t),m||p||(m=!0,R(T))),t},e.unstable_shouldYield=x,e.unstable_wrapCallback=function(t){var e=f;return function(){var n=f;f=e;try{return t.apply(this,arguments)}finally{f=n}}}},481:function(t,e){!function(t){"use strict";function e(t){var e,n,i,r;for(n=1,i=arguments.length;n<i;n++)for(e in r=arguments[n])t[e]=r[e];return t}var n=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function i(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var i=n.call(arguments,2);return function(){return t.apply(e,i.length?i.concat(n.call(arguments)):arguments)}}var r=0;function s(t){return"_leaflet_id"in t||(t._leaflet_id=++r),t._leaflet_id}function a(t,e,n){var i,r,s,a;return a=function(){i=!1,r&&(s.apply(n,r),r=!1)},s=function(){i?r=arguments:(t.apply(n,arguments),setTimeout(a,e),i=!0)},s}function o(t,e,n){var i=e[1],r=e[0],s=i-r;return t===i&&n?t:((t-r)%s+s)%s+r}function l(){return!1}function u(t,e){if(!1===e)return t;var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n}function c(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function h(t){return c(t).split(/\s+/)}function d(t,e){for(var i in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?n(t.options):{}),e)t.options[i]=e[i];return t.options}function f(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}var p=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(p,function(t,n){var i=e[n];if(void 0===i)throw new Error("No value provided for variable "+t);return"function"==typeof i&&(i=i(e)),i})}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function v(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var b=0;function E(t){var e=+new Date,n=Math.max(0,16-(e-b));return b=e+n,window.setTimeout(t,n)}var T=window.requestAnimationFrame||_("RequestAnimationFrame")||E,S=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function D(t,e,n){if(!n||T!==E)return T.call(window,i(t,e));t.call(e)}function w(t){t&&S.call(window,t)}var k={__proto__:null,extend:e,create:n,bind:i,get lastId(){return r},stamp:s,throttle:a,wrapNum:o,falseFn:l,formatNum:u,trim:c,splitWords:h,setOptions:d,getParamString:f,template:m,isArray:g,indexOf:v,emptyImageUrl:y,requestFn:T,cancelFn:S,requestAnimFrame:D,cancelAnimFrame:w};function A(){}A.extend=function(t){var i=function(){d(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},r=i.__super__=this.prototype,s=n(r);for(var a in s.constructor=i,i.prototype=s,this)Object.prototype.hasOwnProperty.call(this,a)&&"prototype"!==a&&"__super__"!==a&&(i[a]=this[a]);return t.statics&&e(i,t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=g(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),e.apply(null,[s].concat(t.includes))),e(s,t),delete s.statics,delete s.includes,s.options&&(s.options=r.options?n(r.options):{},e(s.options,t.options)),s._initHooks=[],s.callInitHooks=function(){if(!this._initHooksCalled){r.callInitHooks&&r.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=s._initHooks.length;t<e;t++)s._initHooks[t].call(this)}},i},A.include=function(t){var n=this.prototype.options;return e(this.prototype,t),t.options&&(this.prototype.options=n,this.mergeOptions(t.options)),this},A.mergeOptions=function(t){return e(this.prototype.options,t),this},A.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var x={on:function(t,e,n){if("object"==typeof t)for(var i in t)this._on(i,t[i],e);else for(var r=0,s=(t=h(t)).length;r<s;r++)this._on(t[r],e,n);return this},off:function(t,e,n){if(arguments.length)if("object"==typeof t)for(var i in t)this._off(i,t[i],e);else{t=h(t);for(var r=1===arguments.length,s=0,a=t.length;s<a;s++)r?this._off(t[s]):this._off(t[s],e,n)}else delete this._events;return this},_on:function(t,e,n,i){if("function"==typeof e){if(!1===this._listens(t,e,n)){n===this&&(n=void 0);var r={fn:e,ctx:n};i&&(r.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(r)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,n){var i,r,s;if(this._events&&(i=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var a=this._listens(t,e,n);if(!1!==a){var o=i[a];this._firingCount&&(o.fn=l,this._events[t]=i=i.slice()),i.splice(a,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(r=0,s=i.length;r<s;r++)i[r].fn=l;delete this._events[t]}},fire:function(t,n,i){if(!this.listens(t,i))return this;var r=e({},n,{type:t,target:this,sourceTarget:n&&n.sourceTarget||this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var a=0,o=s.length;a<o;a++){var l=s[a],u=l.fn;l.once&&this.off(t,u,l.ctx),u.call(l.ctx||this,r)}this._firingCount--}}return i&&this._propagateEvent(r),this},listens:function(t,e,n,i){"string"!=typeof t&&console.warn('"string" type argument expected');var r=e;"function"!=typeof e&&(i=!!e,r=void 0,n=void 0);var s=this._events&&this._events[t];if(s&&s.length&&!1!==this._listens(t,r,n))return!0;if(i)for(var a in this._eventParents)if(this._eventParents[a].listens(t,e,n,i))return!0;return!1},_listens:function(t,e,n){if(!this._events)return!1;var i=this._events[t]||[];if(!e)return!!i.length;n===this&&(n=void 0);for(var r=0,s=i.length;r<s;r++)if(i[r].fn===e&&i[r].ctx===n)return r;return!1},once:function(t,e,n){if("object"==typeof t)for(var i in t)this._on(i,t[i],e,!0);else for(var r=0,s=(t=h(t)).length;r<s;r++)this._on(t[r],e,n,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[s(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[s(t)],this},_propagateEvent:function(t){for(var n in this._eventParents)this._eventParents[n].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};x.addEventListener=x.on,x.removeEventListener=x.clearAllEventListeners=x.off,x.addOneTimeEventListener=x.once,x.fireEvent=x.fire,x.hasEventListeners=x.listens;var C=A.extend(x);function I(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var P=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function R(t,e,n){return t instanceof I?t:g(t)?new I(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new I(t.x,t.y):new I(t,e,n)}function O(t,e){if(t)for(var n=e?[t,e]:t,i=0,r=n.length;i<r;i++)this.extend(n[i])}function M(t,e){return!t||t instanceof O?t:new O(t,e)}function F(t,e){if(t)for(var n=e?[t,e]:t,i=0,r=n.length;i<r;i++)this.extend(n[i])}function N(t,e){return t instanceof F?t:new F(t,e)}function B(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function U(t,e,n){return t instanceof B?t:g(t)&&"object"!=typeof t[0]?3===t.length?new B(t[0],t[1],t[2]):2===t.length?new B(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new B(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new B(t,e,n)}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(t){return this.clone()._add(R(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(R(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new I(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new I(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=P(this.x),this.y=P(this.y),this},distanceTo:function(t){var e=(t=R(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=R(t)).x===this.x&&t.y===this.y},contains:function(t){return t=R(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},O.prototype={extend:function(t){var e,n;if(!t)return this;if(t instanceof I||"number"==typeof t[0]||"x"in t)e=n=R(t);else if(e=(t=M(t)).min,n=t.max,!e||!n)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=e.clone(),this.max=n.clone()),this},getCenter:function(t){return R((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return R(this.min.x,this.max.y)},getTopRight:function(){return R(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"==typeof t[0]||t instanceof I?R(t):M(t))instanceof O?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=M(t);var e=this.min,n=this.max,i=t.min,r=t.max,s=r.x>=e.x&&i.x<=n.x,a=r.y>=e.y&&i.y<=n.y;return s&&a},overlaps:function(t){t=M(t);var e=this.min,n=this.max,i=t.min,r=t.max,s=r.x>e.x&&i.x<n.x,a=r.y>e.y&&i.y<n.y;return s&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,n=this.max,i=Math.abs(e.x-n.x)*t,r=Math.abs(e.y-n.y)*t;return M(R(e.x-i,e.y-r),R(n.x+i,n.y+r))},equals:function(t){return!!t&&(t=M(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},F.prototype={extend:function(t){var e,n,i=this._southWest,r=this._northEast;if(t instanceof B)e=t,n=t;else{if(!(t instanceof F))return t?this.extend(U(t)||N(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return i||r?(i.lat=Math.min(e.lat,i.lat),i.lng=Math.min(e.lng,i.lng),r.lat=Math.max(n.lat,r.lat),r.lng=Math.max(n.lng,r.lng)):(this._southWest=new B(e.lat,e.lng),this._northEast=new B(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,i=Math.abs(e.lat-n.lat)*t,r=Math.abs(e.lng-n.lng)*t;return new F(new B(e.lat-i,e.lng-r),new B(n.lat+i,n.lng+r))},getCenter:function(){return new B((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new B(this.getNorth(),this.getWest())},getSouthEast:function(){return new B(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof B||"lat"in t?U(t):N(t);var e,n,i=this._southWest,r=this._northEast;return t instanceof F?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=i.lat&&n.lat<=r.lat&&e.lng>=i.lng&&n.lng<=r.lng},intersects:function(t){t=N(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),s=r.lat>=e.lat&&i.lat<=n.lat,a=r.lng>=e.lng&&i.lng<=n.lng;return s&&a},overlaps:function(t){t=N(t);var e=this._southWest,n=this._northEast,i=t.getSouthWest(),r=t.getNorthEast(),s=r.lat>e.lat&&i.lat<n.lat,a=r.lng>e.lng&&i.lng<n.lng;return s&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=N(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},B.prototype={equals:function(t,e){return!!t&&(t=U(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+u(this.lat,t)+", "+u(this.lng,t)+")"},distanceTo:function(t){return G.distance(this,U(t))},wrap:function(){return G.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return N([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new B(this.lat,this.lng,this.alt)}};var $,z={latLngToPoint:function(t,e){var n=this.projection.project(t),i=this.scale(e);return this.transformation._transform(n,i)},pointToLatLng:function(t,e){var n=this.scale(e),i=this.transformation.untransform(t,n);return this.projection.unproject(i)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t);return new O(this.transformation.transform(e.min,n),this.transformation.transform(e.max,n))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?o(t.lng,this.wrapLng,!0):t.lng;return new B(this.wrapLat?o(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),i=e.lat-n.lat,r=e.lng-n.lng;if(0===i&&0===r)return t;var s=t.getSouthWest(),a=t.getNorthEast();return new F(new B(s.lat-i,s.lng-r),new B(a.lat-i,a.lng-r))}},G=e({},z,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,i=t.lat*n,r=e.lat*n,s=Math.sin((e.lat-t.lat)*n/2),a=Math.sin((e.lng-t.lng)*n/2),o=s*s+Math.cos(i)*Math.cos(r)*a*a,l=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return this.R*l}}),j=6378137,H={R:j,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,i=Math.max(Math.min(n,t.lat),-n),r=Math.sin(i*e);return new I(this.R*t.lng*e,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new B((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:($=j*Math.PI,new O([-$,-$],[$,$]))};function V(t,e,n,i){if(g(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=n,this._d=i}function K(t,e,n,i){return new V(t,e,n,i)}V.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new I((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var W=e({},G,{code:"EPSG:3857",projection:H,transformation:function(){var t=.5/(Math.PI*H.R);return K(t,.5,-t,.5)}()}),Y=e({},W,{code:"EPSG:900913"});function Z(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function q(t,e){var n,i,r,s,a,o,l="";for(n=0,r=t.length;n<r;n++){for(i=0,s=(a=t[n]).length;i<s;i++)l+=(i?"L":"M")+(o=a[i]).x+" "+o.y;l+=e?Ot.svg?"z":"x":""}return l||"M0 0"}var X,Q=document.documentElement.style,J="ActiveXObject"in window,tt=J&&!document.addEventListener,et="msLaunchUri"in navigator&&!("documentMode"in document),nt=Rt("webkit"),it=Rt("android"),rt=Rt("android 2")||Rt("android 3"),st=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),at=it&&Rt("Google")&&st<537&&!("AudioNode"in window),ot=!!window.opera,lt=!et&&Rt("chrome"),ut=Rt("gecko")&&!nt&&!ot&&!J,ct=!lt&&Rt("safari"),ht=Rt("phantom"),dt="OTransition"in Q,ft=0===navigator.platform.indexOf("Win"),pt=J&&"transition"in Q,mt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!rt,gt="MozPerspective"in Q,vt=!window.L_DISABLE_3D&&(pt||mt||gt)&&!dt&&!ht,yt="undefined"!=typeof orientation||Rt("mobile"),_t=yt&&nt,bt=yt&&mt,Et=!window.PointerEvent&&window.MSPointerEvent,Tt=!(!window.PointerEvent&&!Et),St="ontouchstart"in window||!!window.TouchEvent,Dt=!window.L_NO_TOUCH&&(St||Tt),wt=yt&&ot,Lt=yt&&ut,kt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,At=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",l,e),window.removeEventListener("testPassiveEventSupport",l,e)}catch(t){}return t}(),xt=!!document.createElement("canvas").getContext,Ct=!(!document.createElementNS||!Z("svg").createSVGRect),It=!!Ct&&((X=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(X.firstChild&&X.firstChild.namespaceURI)),Pt=!Ct&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function Rt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Ot={ie:J,ielt9:tt,edge:et,webkit:nt,android:it,android23:rt,androidStock:at,opera:ot,chrome:lt,gecko:ut,safari:ct,phantom:ht,opera12:dt,win:ft,ie3d:pt,webkit3d:mt,gecko3d:gt,any3d:vt,mobile:yt,mobileWebkit:_t,mobileWebkit3d:bt,msPointer:Et,pointer:Tt,touch:Dt,touchNative:St,mobileOpera:wt,mobileGecko:Lt,retina:kt,passiveEvents:At,canvas:xt,svg:Ct,vml:Pt,inlineSvg:It,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Mt=Ot.msPointer?"MSPointerDown":"pointerdown",Ft=Ot.msPointer?"MSPointerMove":"pointermove",Nt=Ot.msPointer?"MSPointerUp":"pointerup",Bt=Ot.msPointer?"MSPointerCancel":"pointercancel",Ut={touchstart:Mt,touchmove:Ft,touchend:Nt,touchcancel:Bt},$t={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Ne(e),Wt(t,e)},touchmove:Wt,touchend:Wt,touchcancel:Wt},zt={},Gt=!1;function jt(t,e,n){return"touchstart"===e&&(Gt||(document.addEventListener(Mt,Ht,!0),document.addEventListener(Ft,Vt,!0),document.addEventListener(Nt,Kt,!0),document.addEventListener(Bt,Kt,!0),Gt=!0)),$t[e]?(n=$t[e].bind(this,n),t.addEventListener(Ut[e],n,!1),n):(console.warn("wrong event specified:",e),l)}function Ht(t){zt[t.pointerId]=t}function Vt(t){zt[t.pointerId]&&(zt[t.pointerId]=t)}function Kt(t){delete zt[t.pointerId]}function Wt(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in e.touches=[],zt)e.touches.push(zt[n]);e.changedTouches=[e],t(e)}}var Yt,Zt,qt,Xt,Qt,Jt=me(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),te=me(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ee="webkitTransition"===te||"OTransition"===te?te+"End":"transitionend";function ne(t){return"string"==typeof t?document.getElementById(t):t}function ie(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&document.defaultView){var i=document.defaultView.getComputedStyle(t,null);n=i?i[e]:null}return"auto"===n?null:n}function re(t,e,n){var i=document.createElement(t);return i.className=e||"",n&&n.appendChild(i),i}function se(t){var e=t.parentNode;e&&e.removeChild(t)}function ae(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function oe(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function le(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ue(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=fe(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function ce(t,e){if(void 0!==t.classList)for(var n=h(e),i=0,r=n.length;i<r;i++)t.classList.add(n[i]);else if(!ue(t,e)){var s=fe(t);de(t,(s?s+" ":"")+e)}}function he(t,e){void 0!==t.classList?t.classList.remove(e):de(t,c((" "+fe(t)+" ").replace(" "+e+" "," ")))}function de(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function fe(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function pe(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var n=!1,i="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(i)}catch(t){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+i+"(opacity="+e+")"}(t,e)}function me(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function ge(t,e,n){var i=e||new I(0,0);t.style[Jt]=(Ot.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}function ve(t,e){t._leaflet_pos=e,Ot.any3d?ge(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function ye(t){return t._leaflet_pos||new I(0,0)}if("onselectstart"in document)Yt=function(){ke(window,"selectstart",Ne)},Zt=function(){xe(window,"selectstart",Ne)};else{var _e=me(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Yt=function(){if(_e){var t=document.documentElement.style;qt=t[_e],t[_e]="none"}},Zt=function(){_e&&(document.documentElement.style[_e]=qt,qt=void 0)}}function be(){ke(window,"dragstart",Ne)}function Ee(){xe(window,"dragstart",Ne)}function Te(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Se(),Xt=t,Qt=t.style.outlineStyle,t.style.outlineStyle="none",ke(window,"keydown",Se))}function Se(){Xt&&(Xt.style.outlineStyle=Qt,Xt=void 0,Qt=void 0,xe(window,"keydown",Se))}function De(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function we(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Le={__proto__:null,TRANSFORM:Jt,TRANSITION:te,TRANSITION_END:ee,get:ne,getStyle:ie,create:re,remove:se,empty:ae,toFront:oe,toBack:le,hasClass:ue,addClass:ce,removeClass:he,setClass:de,getClass:fe,setOpacity:pe,testProp:me,setTransform:ge,setPosition:ve,getPosition:ye,get disableTextSelection(){return Yt},get enableTextSelection(){return Zt},disableImageDrag:be,enableImageDrag:Ee,preventOutline:Te,restoreOutline:Se,getSizedParentNode:De,getScale:we};function ke(t,e,n,i){if(e&&"object"==typeof e)for(var r in e)Pe(t,r,e[r],n);else for(var s=0,a=(e=h(e)).length;s<a;s++)Pe(t,e[s],n,i);return this}var Ae="_leaflet_events";function xe(t,e,n,i){if(1===arguments.length)Ce(t),delete t[Ae];else if(e&&"object"==typeof e)for(var r in e)Re(t,r,e[r],n);else if(e=h(e),2===arguments.length)Ce(t,function(t){return-1!==v(e,t)});else for(var s=0,a=e.length;s<a;s++)Re(t,e[s],n,i);return this}function Ce(t,e){for(var n in t[Ae]){var i=n.split(/\d/)[0];e&&!e(i)||Re(t,i,null,null,n)}}var Ie={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Pe(t,e,n,i){var r=e+s(n)+(i?"_"+s(i):"");if(t[Ae]&&t[Ae][r])return this;var a=function(e){return n.call(i||t,e||window.event)},o=a;!Ot.touchNative&&Ot.pointer&&0===e.indexOf("touch")?a=jt(t,e,a):Ot.touch&&"dblclick"===e?a=function(t,e){t.addEventListener("dblclick",e);var n,i=0;function r(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var r=Ue(t);if(!r.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||r.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var s=Date.now();s-i<=200?2===++n&&e(function(t){var e,n,i={};for(n in t)e=t[n],i[n]=e&&e.bind?e.bind(t):e;return t=i,i.type="dblclick",i.detail=2,i.isTrusted=!1,i._simulated=!0,i}(t)):n=1,i=s}}}else n=t.detail}return t.addEventListener("click",r),{dblclick:e,simDblclick:r}}(t,a):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(Ie[e]||e,a,!!Ot.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(a=function(e){e=e||window.event,je(t,e)&&o(e)},t.addEventListener(Ie[e],a,!1)):t.addEventListener(e,o,!1):t.attachEvent("on"+e,a),t[Ae]=t[Ae]||{},t[Ae][r]=a}function Re(t,e,n,i,r){r=r||e+s(n)+(i?"_"+s(i):"");var a=t[Ae]&&t[Ae][r];if(!a)return this;!Ot.touchNative&&Ot.pointer&&0===e.indexOf("touch")?function(t,e,n){Ut[e]?t.removeEventListener(Ut[e],n,!1):console.warn("wrong event specified:",e)}(t,e,a):Ot.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,a):"removeEventListener"in t?t.removeEventListener(Ie[e]||e,a,!1):t.detachEvent("on"+e,a),t[Ae][r]=null}function Oe(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Me(t){return Pe(t,"wheel",Oe),this}function Fe(t){return ke(t,"mousedown touchstart dblclick contextmenu",Oe),t._leaflet_disable_click=!0,this}function Ne(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Be(t){return Ne(t),Oe(t),this}function Ue(t){if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;)e.push(n),n=n.parentNode;return e}function $e(t,e){if(!e)return new I(t.clientX,t.clientY);var n=we(e),i=n.boundingClientRect;return new I((t.clientX-i.left)/n.x-e.clientLeft,(t.clientY-i.top)/n.y-e.clientTop)}var ze=Ot.linux&&Ot.chrome?window.devicePixelRatio:Ot.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ge(t){return Ot.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/ze:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function je(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(t){return!1}return n!==t}var He={__proto__:null,on:ke,off:xe,stopPropagation:Oe,disableScrollPropagation:Me,disableClickPropagation:Fe,preventDefault:Ne,stop:Be,getPropagationPath:Ue,getMousePosition:$e,getWheelDelta:Ge,isExternalTarget:je,addListener:ke,removeListener:xe},Ve=C.extend({run:function(t,e,n,i){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(i||.5,.2),this._startPos=ye(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=D(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),ve(this._el,n),this.fire("step")},_complete:function(){w(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Ke=C.extend({options:{crs:W,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=d(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(U(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=te&&Ot.any3d&&!Ot.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ke(this._proxy,ee,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,n,i){return n=void 0===n?this._zoom:this._limitZoom(n),t=this._limitCenter(U(t),n,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&!0!==i&&(void 0!==i.animate&&(i.zoom=e({animate:i.animate},i.zoom),i.pan=e({animate:i.animate,duration:i.duration},i.pan)),this._zoom!==n?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,n,i.zoom):this._tryAnimatedPan(t,i.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,n,i.pan&&i.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Ot.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Ot.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var i=this.getZoomScale(e),r=this.getSize().divideBy(2),s=(t instanceof I?t:this.latLngToContainerPoint(t)).subtract(r).multiplyBy(1-1/i),a=this.containerPointToLatLng(r.add(s));return this.setView(a,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():N(t);var n=R(e.paddingTopLeft||e.padding||[0,0]),i=R(e.paddingBottomRight||e.padding||[0,0]),r=this.getBoundsZoom(t,!1,n.add(i));if((r="number"==typeof e.maxZoom?Math.min(e.maxZoom,r):r)===1/0)return{center:t.getCenter(),zoom:r};var s=i.subtract(n).divideBy(2),a=this.project(t.getSouthWest(),r),o=this.project(t.getNorthEast(),r);return{center:this.unproject(a.add(o).divideBy(2).add(s),r),zoom:r}},fitBounds:function(t,e){if(!(t=N(t)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=R(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ve,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){ce(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!Ot.any3d)return this.setView(t,e,n);this._stop();var i=this.project(this.getCenter()),r=this.project(t),s=this.getSize(),a=this._zoom;t=U(t),e=void 0===e?a:e;var o=Math.max(s.x,s.y),l=o*this.getZoomScale(a,e),u=r.distanceTo(i)||1,c=1.42,h=2.0164;function d(t){var e=(l*l-o*o+(t?-1:1)*h*h*u*u)/(2*(t?l:o)*h*u),n=Math.sqrt(e*e+1)-e;return n<1e-9?-18:Math.log(n)}function f(t){return(Math.exp(t)-Math.exp(-t))/2}function p(t){return(Math.exp(t)+Math.exp(-t))/2}var m=d(0);function g(t){return o*(p(m)*(f(e=m+c*t)/p(e))-f(m))/h;var e}var v=Date.now(),y=(d(1)-m)/c,_=n.duration?1e3*n.duration:1e3*y*.8;return this._moveStart(!0,n.noMoveStart),function n(){var s=(Date.now()-v)/_,l=function(t){return 1-Math.pow(1-t,1.5)}(s)*y;s<=1?(this._flyToFrame=D(n,this),this._move(this.unproject(i.add(r.subtract(i).multiplyBy(g(l)/u)),a),this.getScaleZoom(o/function(t){return o*(p(m)/p(m+c*t))}(l),a),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=N(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),i=this._limitCenter(n,this._zoom,N(t));return n.equals(i)||this.panTo(i,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=R((e=e||{}).paddingTopLeft||e.padding||[0,0]),i=R(e.paddingBottomRight||e.padding||[0,0]),r=this.project(this.getCenter()),s=this.project(t),a=this.getPixelBounds(),o=M([a.min.add(n),a.max.subtract(i)]),l=o.getSize();if(!o.contains(s)){this._enforcingBounds=!0;var u=s.subtract(o.getCenter()),c=o.extend(s).getSize().subtract(l);r.x+=u.x<0?-c.x:c.x,r.y+=u.y<0?-c.y:c.y,this.panTo(this.unproject(r),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),s=n.divideBy(2).round(),a=r.divideBy(2).round(),o=s.subtract(a);return o.x||o.y?(t.animate&&t.pan?this.panBy(o):(t.pan&&this._rawPanBy(o),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,r,t):navigator.geolocation.getCurrentPosition(n,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new B(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),i=this._locateOptions;if(i.setView){var r=this.getBoundsZoom(n);this.setView(e,i.maxZoom?Math.min(r,i.maxZoom):r)}var s={latlng:e,bounds:n,timestamp:t.timestamp};for(var a in t.coords)"number"==typeof t.coords[a]&&(s[a]=t.coords[a]);this.fire("locationfound",s)}},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),se(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(w(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)se(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=re("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new F(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=N(t),n=R(n||[0,0]);var i=this.getZoom()||0,r=this.getMinZoom(),s=this.getMaxZoom(),a=t.getNorthWest(),o=t.getSouthEast(),l=this.getSize().subtract(n),u=M(this.project(o,i),this.project(a,i)).getSize(),c=Ot.any3d?this.options.zoomSnap:1,h=l.x/u.x,d=l.y/u.y,f=e?Math.max(h,d):Math.min(h,d);return i=this.getScaleZoom(f,i),c&&(i=Math.round(i/(c/100))*(c/100),i=e?Math.ceil(i/c)*c:Math.floor(i/c)*c),Math.max(r,Math.min(s,i))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new I(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new O(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var i=n.zoom(t*n.scale(e));return isNaN(i)?1/0:i},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(U(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(R(t),e)},layerPointToLatLng:function(t){var e=R(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(U(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(U(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(N(t))},distance:function(t,e){return this.options.crs.distance(U(t),U(e))},containerPointToLayerPoint:function(t){return R(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return R(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(R(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(U(t)))},mouseEventToContainerPoint:function(t){return $e(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=ne(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");ke(e,"scroll",this._onScroll,this),this._containerId=s(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ot.any3d,ce(t,"leaflet-container"+(Ot.touch?" leaflet-touch":"")+(Ot.retina?" leaflet-retina":"")+(Ot.ielt9?" leaflet-oldie":"")+(Ot.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=ie(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ve(this._mapPane,new I(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ce(t.markerPane,"leaflet-zoom-hide"),ce(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,n){ve(this._mapPane,new I(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var r=this._zoom!==e;this._moveStart(r,n)._move(t,e)._moveEnd(r),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n,i){void 0===e&&(e=this._zoom);var r=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),i?n&&n.pinch&&this.fire("zoom",n):((r||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return w(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ve(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[s(this._container)]=this;var e=t?xe:ke;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Ot.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){w(this._resizeRequest),this._resizeRequest=D(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,i=[],r="mouseout"===e||"mouseover"===e,a=t.target||t.srcElement,o=!1;a;){if((n=this._targets[s(a)])&&("click"===e||"preclick"===e)&&this._draggableMoved(n)){o=!0;break}if(n&&n.listens(e,!0)){if(r&&!je(a,t))break;if(i.push(n),r)break}if(a===this._container)break;a=a.parentNode}return i.length||o||r||!this.listens(e,!0)||(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var n=t.type;"mousedown"===n&&Te(e),this._fireDOMEvent(t,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,n,i){if("click"===t.type){var r=e({},t);r.type="preclick",this._fireDOMEvent(r,r.type,i)}var s=this._findEventTargets(t,n);if(i){for(var a=[],o=0;o<i.length;o++)i[o].listens(n,!0)&&a.push(i[o]);s=a.concat(s)}if(s.length){"contextmenu"===n&&Ne(t);var l=s[0],u={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var c=l.getLatLng&&(!l._radius||l._radius<=10);u.containerPoint=c?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(t),u.layerPoint=this.containerPointToLayerPoint(u.containerPoint),u.latlng=c?l.getLatLng():this.layerPointToLatLng(u.layerPoint)}for(o=0;o<s.length;o++)if(s[o].fire(n,u,!0),u.originalEvent._stopped||!1===s[o].options.bubblingMouseEvents&&-1!==v(this._mouseEvents,n))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return ye(this._mapPane)||new I(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(i)},_latLngBoundsToNewLayerBounds:function(t,e,n){var i=this._getNewPixelOrigin(n,e);return M([this.project(t.getSouthWest(),e)._subtract(i),this.project(t.getNorthWest(),e)._subtract(i),this.project(t.getSouthEast(),e)._subtract(i),this.project(t.getNorthEast(),e)._subtract(i)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var i=this.project(t,e),r=this.getSize().divideBy(2),s=new O(i.subtract(r),i.add(r)),a=this._getBoundsOffset(s,n,e);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?t:this.unproject(i.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),i=new O(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(i,e))},_getBoundsOffset:function(t,e,n){var i=M(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),r=i.min.subtract(t.min),s=i.max.subtract(t.max);return new I(this._rebound(r.x,-s.x),this._rebound(r.y,-s.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),i=Ot.any3d?this.options.zoomSnap:1;return i&&(t=Math.round(t/i)*i),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){he(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n)||(this.panBy(n,e),0))},_createAnimProxy:function(){var t=this._proxy=re("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=Jt,n=this._proxy.style[e];ge(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){se(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();ge(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var i=this.getZoomScale(e),r=this._getCenterOffset(t)._divideBy(1-1/i);return!(!0!==n.animate&&!this.getSize().contains(r)||(D(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(t,e,!0)},this),0))},_animateZoom:function(t,e,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,ce(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&he(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var We=A.extend({options:{position:"topright"},initialize:function(t){d(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),i=t._controlCorners[n];return ce(e,"leaflet-control"),-1!==n.indexOf("bottom")?i.insertBefore(e,i.firstChild):i.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(se(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Ye=function(t){return new We(t)};Ke.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=re("div",e+"control-container",this._container);function i(i,r){var s=e+i+" "+e+r;t[i+r]=re("div",s,n)}i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)se(this._controlCorners[t]);se(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Ze=We.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,i){return n<i?-1:i<n?1:0}},initialize:function(t,e,n){for(var i in d(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[i],i);for(i in e)this._addLayer(e[i],i,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return We.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(s(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){ce(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(ce(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):he(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return he(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=re("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Fe(e),Me(e);var i=this._section=re("section",t+"-list");n&&(this._map.on("click",this.collapse,this),ke(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var r=this._layersLink=re("a",t+"-toggle",e);r.href="#",r.title="Layers",r.setAttribute("role","button"),ke(r,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){Ne(t),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=re("div",t+"-base",i),this._separator=re("div",t+"-separator",i),this._overlaysList=re("div",t+"-overlays",i),e.appendChild(i)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&s(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ae(this._baseLayersList),ae(this._overlaysList),this._layerControlInputs=[];var t,e,n,i,r=0;for(n=0;n<this._layers.length;n++)i=this._layers[n],this._addItem(i),e=e||i.overlay,t=t||!i.overlay,r+=i.overlay?0:1;return this.options.hideSingleBase&&(t=t&&r>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(s(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",i=document.createElement("div");return i.innerHTML=n,i.firstChild},_addItem:function(t){var e,n=document.createElement("label"),i=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=i):e=this._createRadioElement("leaflet-base-layers_"+s(this),i),this._layerControlInputs.push(e),e.layerId=s(t.layer),ke(e,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+t.name;var a=document.createElement("span");return n.appendChild(a),a.appendChild(e),a.appendChild(r),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var t,e,n=this._layerControlInputs,i=[],r=[];this._handlingClick=!0;for(var s=n.length-1;s>=0;s--)t=n[s],e=this._getLayer(t.layerId).layer,t.checked?i.push(e):t.checked||r.push(e);for(s=0;s<r.length;s++)this._map.hasLayer(r[s])&&this._map.removeLayer(r[s]);for(s=0;s<i.length;s++)this._map.hasLayer(i[s])||this._map.addLayer(i[s]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,n=this._layerControlInputs,i=this._map.getZoom(),r=n.length-1;r>=0;r--)t=n[r],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&i<e.options.minZoom||void 0!==e.options.maxZoom&&i>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,ke(t,"click",Ne),this.expand();var e=this;setTimeout(function(){xe(t,"click",Ne),e._preventClick=!1})}}),qe=We.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=re("div",e+" leaflet-bar"),i=this.options;return this._zoomInButton=this._createButton(i.zoomInText,i.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(i.zoomOutText,i.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,i,r){var s=re("a",n,i);return s.innerHTML=t,s.href="#",s.title=e,s.setAttribute("role","button"),s.setAttribute("aria-label",e),Fe(s),ke(s,"click",Be),ke(s,"click",r,this),ke(s,"click",this._refocusOnMap,this),s},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";he(this._zoomInButton,e),he(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(ce(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(ce(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ke.mergeOptions({zoomControl:!0}),Ke.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new qe,this.addControl(this.zoomControl))});var Xe=We.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=re("div",e),i=this.options;return this._addScales(i,e+"-line",n),t.on(i.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=re("div",e,n)),t.imperial&&(this._iScale=re("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e,n,i,r=3.2808399*t;r>5280?(e=r/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" ft",i/r))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),Qe=We.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ot.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){d(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=re("div","leaflet-control-attribution"),Fe(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});Ke.mergeOptions({attributionControl:!0}),Ke.addInitHook(function(){this.options.attributionControl&&(new Qe).addTo(this)});We.Layers=Ze,We.Zoom=qe,We.Scale=Xe,We.Attribution=Qe,Ye.layers=function(t,e,n){return new Ze(t,e,n)},Ye.zoom=function(t){return new qe(t)},Ye.scale=function(t){return new Xe(t)},Ye.attribution=function(t){return new Qe(t)};var Je=A.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Je.addTo=function(t,e){return t.addHandler(e,this),this};var tn={Events:x},en=Ot.touch?"touchstart mousedown":"mousedown",nn=C.extend({options:{clickTolerance:3},initialize:function(t,e,n,i){d(this,i),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(ke(this._dragStartTarget,en,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(nn._dragging===this&&this.finishDrag(!0),xe(this._dragStartTarget,en,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ue(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)nn._dragging===this&&this.finishDrag();else if(!(nn._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(nn._dragging=this,this._preventOutline&&Te(this._element),be(),Yt(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,n=De(this._element);this._startPoint=new I(e.clientX,e.clientY),this._startPos=ye(this._element),this._parentScale=we(n);var i="mousedown"===t.type;ke(document,i?"mousemove":"touchmove",this._onMove,this),ke(document,i?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new I(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Ne(t),this._moved||(this.fire("dragstart"),this._moved=!0,ce(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ce(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ve(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){he(document.body,"leaflet-dragging"),this._lastTarget&&(he(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),xe(document,"mousemove touchmove",this._onMove,this),xe(document,"mouseup touchend touchcancel",this._onUp,this),Ee(),Zt();var e=this._moved&&this._moving;this._moving=!1,nn._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function rn(t,e,n){var i,r,s,a,o,l,u,c,h,d=[1,4,2,8];for(r=0,u=t.length;r<u;r++)t[r]._code=pn(t[r],e);for(a=0;a<4;a++){for(c=d[a],i=[],r=0,s=(u=t.length)-1;r<u;s=r++)o=t[r],l=t[s],o._code&c?l._code&c||((h=fn(l,o,c,e,n))._code=pn(h,e),i.push(h)):(l._code&c&&((h=fn(l,o,c,e,n))._code=pn(h,e),i.push(h)),i.push(o));t=i}return t}function sn(t,e){var n,i,r,s,a,o,l,u,c;if(!t||0===t.length)throw new Error("latlngs not passed");vn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var h=U([0,0]),d=N(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(h=an(t));var f=t.length,p=[];for(n=0;n<f;n++){var m=U(t[n]);p.push(e.project(U([m.lat-h.lat,m.lng-h.lng])))}for(o=l=u=0,n=0,i=f-1;n<f;i=n++)r=p[n],s=p[i],a=r.y*s.x-s.y*r.x,l+=(r.x+s.x)*a,u+=(r.y+s.y)*a,o+=3*a;c=0===o?p[0]:[l/o,u/o];var g=e.unproject(R(c));return U([g.lat+h.lat,g.lng+h.lng])}function an(t){for(var e=0,n=0,i=0,r=0;r<t.length;r++){var s=U(t[r]);e+=s.lat,n+=s.lng,i++}return U([e/i,n/i])}var on,ln={__proto__:null,clipPolygon:rn,polygonCenter:sn,centroid:an};function un(t,e){if(!e||!t.length)return t.slice();var n=e*e;return function(t,e){var n=t.length,i=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(n);i[0]=i[n-1]=1,hn(t,i,e,0,n-1);var r,s=[];for(r=0;r<n;r++)i[r]&&s.push(t[r]);return s}(t=function(t,e){for(var n=[t[0]],i=1,r=0,s=t.length;i<s;i++)mn(t[i],t[r])>e&&(n.push(t[i]),r=i);return r<s-1&&n.push(t[s-1]),n}(t,n),n)}function cn(t,e,n){return Math.sqrt(gn(t,e,n,!0))}function hn(t,e,n,i,r){var s,a,o,l=0;for(a=i+1;a<=r-1;a++)(o=gn(t[a],t[i],t[r],!0))>l&&(s=a,l=o);l>n&&(e[s]=1,hn(t,e,n,i,s),hn(t,e,n,s,r))}function dn(t,e,n,i,r){var s,a,o,l=i?on:pn(t,n),u=pn(e,n);for(on=u;;){if(!(l|u))return[t,e];if(l&u)return!1;o=pn(a=fn(t,e,s=l||u,n,r),n),s===l?(t=a,l=o):(e=a,u=o)}}function fn(t,e,n,i,r){var s,a,o=e.x-t.x,l=e.y-t.y,u=i.min,c=i.max;return 8&n?(s=t.x+o*(c.y-t.y)/l,a=c.y):4&n?(s=t.x+o*(u.y-t.y)/l,a=u.y):2&n?(s=c.x,a=t.y+l*(c.x-t.x)/o):1&n&&(s=u.x,a=t.y+l*(u.x-t.x)/o),new I(s,a,r)}function pn(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function mn(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function gn(t,e,n,i){var r,s=e.x,a=e.y,o=n.x-s,l=n.y-a,u=o*o+l*l;return u>0&&((r=((t.x-s)*o+(t.y-a)*l)/u)>1?(s=n.x,a=n.y):r>0&&(s+=o*r,a+=l*r)),o=t.x-s,l=t.y-a,i?o*o+l*l:new I(s,a)}function vn(t){return!g(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function yn(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),vn(t)}function _n(t,e){var n,i,r,s,a,o,l,u;if(!t||0===t.length)throw new Error("latlngs not passed");vn(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var c=U([0,0]),h=N(t);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(c=an(t));var d=t.length,f=[];for(n=0;n<d;n++){var p=U(t[n]);f.push(e.project(U([p.lat-c.lat,p.lng-c.lng])))}for(n=0,i=0;n<d-1;n++)i+=f[n].distanceTo(f[n+1])/2;if(0===i)u=f[0];else for(n=0,s=0;n<d-1;n++)if(a=f[n],o=f[n+1],(s+=r=a.distanceTo(o))>i){l=(s-i)/r,u=[o.x-l*(o.x-a.x),o.y-l*(o.y-a.y)];break}var m=e.unproject(R(u));return U([m.lat+c.lat,m.lng+c.lng])}var bn={__proto__:null,simplify:un,pointToSegmentDistance:cn,closestPointOnSegment:function(t,e,n){return gn(t,e,n)},clipSegment:dn,_getEdgeIntersection:fn,_getBitCode:pn,_sqClosestPointOnSegment:gn,isFlat:vn,_flat:yn,polylineCenter:_n},En={project:function(t){return new I(t.lng,t.lat)},unproject:function(t){return new B(t.y,t.x)},bounds:new O([-180,-90],[180,90])},Tn={R:6378137,R_MINOR:6356752.314245179,bounds:new O([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,i=t.lat*e,r=this.R_MINOR/n,s=Math.sqrt(1-r*r),a=s*Math.sin(i),o=Math.tan(Math.PI/4-i/2)/Math.pow((1-a)/(1+a),s/2);return i=-n*Math.log(Math.max(o,1e-10)),new I(t.lng*e*n,i)},unproject:function(t){for(var e,n=180/Math.PI,i=this.R,r=this.R_MINOR/i,s=Math.sqrt(1-r*r),a=Math.exp(-t.y/i),o=Math.PI/2-2*Math.atan(a),l=0,u=.1;l<15&&Math.abs(u)>1e-7;l++)e=s*Math.sin(o),e=Math.pow((1-e)/(1+e),s/2),o+=u=Math.PI/2-2*Math.atan(a*e)-o;return new B(o*n,t.x*n/i)}},Sn={__proto__:null,LonLat:En,Mercator:Tn,SphericalMercator:H},Dn=e({},G,{code:"EPSG:3395",projection:Tn,transformation:function(){var t=.5/(Math.PI*Tn.R);return K(t,.5,-t,.5)}()}),wn=e({},G,{code:"EPSG:4326",projection:En,transformation:K(1/180,1,-1/180,.5)}),Ln=e({},z,{projection:En,transformation:K(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,i=e.lat-t.lat;return Math.sqrt(n*n+i*i)},infinite:!0});z.Earth=G,z.EPSG3395=Dn,z.EPSG3857=W,z.EPSG900913=Y,z.EPSG4326=wn,z.Simple=Ln;var kn=C.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[s(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[s(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});Ke.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=s(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=s(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return s(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){for(var e=0,n=(t=t?g(t)?t:[t]:[]).length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[s(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=s(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var i in this._zoomBoundLayers){var r=this._zoomBoundLayers[i].options;t=void 0===r.minZoom?t:Math.min(t,r.minZoom),e=void 0===r.maxZoom?e:Math.max(e,r.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var An=kn.extend({initialize:function(t,e){var n,i;if(d(this,e),this._layers={},t)for(n=0,i=t.length;n<i;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,n,i=Array.prototype.slice.call(arguments,1);for(e in this._layers)(n=this._layers[e])[t]&&n[t].apply(n,i);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s(t)}}),xn=An.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),An.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),An.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new F;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),Cn=A.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){d(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(i,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),i},_setIconStyles:function(t,e){var n=this.options,i=n[e+"Size"];"number"==typeof i&&(i=[i,i]);var r=R(i),s=R("shadow"===e&&n.shadowAnchor||n.iconAnchor||r&&r.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),s&&(t.style.marginLeft=-s.x+"px",t.style.marginTop=-s.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Ot.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});var In=Cn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof In.imagePath&&(In.imagePath=this._detectIconPath()),(this.options.imagePath||In.imagePath)+Cn.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,n){var i=e.exec(t);return i&&i[n]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=re("div","leaflet-default-icon-path",document.body),e=ie(t,"background-image")||ie(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),Pn=Je.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new nn(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ce(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&he(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,i=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,s=ye(e._icon),a=n.getPixelBounds(),o=n.getPixelOrigin(),l=M(a.min._subtract(o).add(r),a.max._subtract(o).subtract(r));if(!l.contains(s)){var u=R((Math.max(l.max.x,s.x)-l.max.x)/(a.max.x-l.max.x)-(Math.min(l.min.x,s.x)-l.min.x)/(a.min.x-l.min.x),(Math.max(l.max.y,s.y)-l.max.y)/(a.max.y-l.max.y)-(Math.min(l.min.y,s.y)-l.min.y)/(a.min.y-l.min.y)).multiplyBy(i);n.panBy(u,{animate:!1}),this._draggable._newPos._add(u),this._draggable._startPos._add(u),ve(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=D(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(w(this._panRequest),this._panRequest=D(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,i=ye(e._icon),r=e._map.layerPointToLatLng(i);n&&ve(n,i),e._latlng=r,t.latlng=r,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){w(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Rn=kn.extend({options:{icon:new In,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){d(this,e),this._latlng=U(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),i=!1;n!==this._icon&&(this._icon&&this._removeIcon(),i=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),ce(n,e),t.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ke(n,"focus",this._panOnFocus,this);var r=t.icon.createShadow(this._shadow),s=!1;r!==this._shadow&&(this._removeShadow(),s=!0),r&&(ce(r,e),r.alt=""),this._shadow=r,t.opacity<1&&this._updateOpacity(),i&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&s&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xe(this._icon,"focus",this._panOnFocus,this),se(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&se(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ve(this._icon,t),this._shadow&&ve(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(ce(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Pn)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Pn(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&pe(this._icon,t),this._shadow&&pe(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,n=e.iconSize?R(e.iconSize):R(0,0),i=e.iconAnchor?R(e.iconAnchor):R(0,0);t.panInside(this._latlng,{paddingTopLeft:i,paddingBottomRight:n.subtract(i)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var On=kn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return d(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Mn=On.extend({options:{fill:!0,radius:10},initialize:function(t,e){d(this,e),this._latlng=U(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=U(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return On.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),i=[t+n,e+n];this._pxBounds=new O(this._point.subtract(i),this._point.add(i))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Fn=Mn.extend({initialize:function(t,n,i){if("number"==typeof n&&(n=e({},i,{radius:n})),d(this,n),this._latlng=U(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:On.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,i=n.options.crs;if(i.distance===G.distance){var r=Math.PI/180,s=this._mRadius/G.R/r,a=n.project([e+s,t]),o=n.project([e-s,t]),l=a.add(o).divideBy(2),u=n.unproject(l).lat,c=Math.acos((Math.cos(s*r)-Math.sin(e*r)*Math.sin(u*r))/(Math.cos(e*r)*Math.cos(u*r)))/r;(isNaN(c)||0===c)&&(c=s/Math.cos(Math.PI/180*e)),this._point=l.subtract(n.getPixelOrigin()),this._radius=isNaN(c)?0:l.x-n.project([u,t-c]).x,this._radiusY=l.y-a.y}else{var h=i.unproject(i.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}});var Nn=On.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){d(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,i=1/0,r=null,s=gn,a=0,o=this._parts.length;a<o;a++)for(var l=this._parts[a],u=1,c=l.length;u<c;u++){var h=s(t,e=l[u-1],n=l[u],!0);h<i&&(i=h,r=s(t,e,n))}return r&&(r.distance=Math.sqrt(i)),r},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return _n(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=U(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new F,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return vn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=vn(t),i=0,r=t.length;i<r;i++)n?(e[i]=U(t[i]),this._bounds.extend(e[i])):e[i]=this._convertLatLngs(t[i]);return e},_project:function(){var t=new O;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new I(t,t);this._rawPxBounds&&(this._pxBounds=new O([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,n){var i,r,s=t[0]instanceof B,a=t.length;if(s){for(r=[],i=0;i<a;i++)r[i]=this._map.latLngToLayerPoint(t[i]),n.extend(r[i]);e.push(r)}else for(i=0;i<a;i++)this._projectLatlngs(t[i],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,n,i,r,s,a,o,l=this._parts;for(e=0,i=0,r=this._rings.length;e<r;e++)for(n=0,s=(o=this._rings[e]).length;n<s-1;n++)(a=dn(o[n],o[n+1],t,n,!0))&&(l[i]=l[i]||[],l[i].push(a[0]),a[1]===o[n+1]&&n!==s-2||(l[i].push(a[1]),i++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,i=t.length;n<i;n++)t[n]=un(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,i,r,s,a,o,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,s=this._parts.length;n<s;n++)for(i=0,r=(a=(o=this._parts[n]).length)-1;i<a;r=i++)if((e||0!==i)&&cn(t,o[r],o[i])<=l)return!0;return!1}});Nn._flat=yn;var Bn=Nn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return sn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Nn.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof B&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){Nn.prototype._setLatLngs.call(this,t),vn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return vn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new I(e,e);if(t=new O(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var i,r=0,s=this._rings.length;r<s;r++)(i=rn(this._rings[r],t,!0)).length&&this._parts.push(i)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,n,i,r,s,a,o,l,u=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(r=0,o=this._parts.length;r<o;r++)for(s=0,a=(l=(e=this._parts[r]).length)-1;s<l;a=s++)n=e[s],i=e[a],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(u=!u);return u||Nn.prototype._containsPoint.call(this,t,!0)}});var Un=xn.extend({initialize:function(t,e){d(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,i,r=g(t)?t:t.features;if(r){for(e=0,n=r.length;e<n;e++)((i=r[e]).geometries||i.geometry||i.features||i.coordinates)&&this.addData(i);return this}var s=this.options;if(s.filter&&!s.filter(t))return this;var a=$n(t,s);return a?(a.feature=Wn(t),a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function $n(t,e){var n,i,r,s,a="Feature"===t.type?t.geometry:t,o=a?a.coordinates:null,l=[],u=e&&e.pointToLayer,c=e&&e.coordsToLatLng||Gn;if(!o&&!a)return null;switch(a.type){case"Point":return zn(u,t,n=c(o),e);case"MultiPoint":for(r=0,s=o.length;r<s;r++)n=c(o[r]),l.push(zn(u,t,n,e));return new xn(l);case"LineString":case"MultiLineString":return i=jn(o,"LineString"===a.type?0:1,c),new Nn(i,e);case"Polygon":case"MultiPolygon":return i=jn(o,"Polygon"===a.type?1:2,c),new Bn(i,e);case"GeometryCollection":for(r=0,s=a.geometries.length;r<s;r++){var h=$n({geometry:a.geometries[r],type:"Feature",properties:t.properties},e);h&&l.push(h)}return new xn(l);case"FeatureCollection":for(r=0,s=a.features.length;r<s;r++){var d=$n(a.features[r],e);d&&l.push(d)}return new xn(l);default:throw new Error("Invalid GeoJSON object.")}}function zn(t,e,n,i){return t?t(e,n):new Rn(n,i&&i.markersInheritOptions&&i)}function Gn(t){return new B(t[1],t[0],t[2])}function jn(t,e,n){for(var i,r=[],s=0,a=t.length;s<a;s++)i=e?jn(t[s],e-1,n):(n||Gn)(t[s]),r.push(i);return r}function Hn(t,e){return void 0!==(t=U(t)).alt?[u(t.lng,e),u(t.lat,e),u(t.alt,e)]:[u(t.lng,e),u(t.lat,e)]}function Vn(t,e,n,i){for(var r=[],s=0,a=t.length;s<a;s++)r.push(e?Vn(t[s],vn(t[s])?0:e-1,n,i):Hn(t[s],i));return!e&&n&&r.length>0&&r.push(r[0].slice()),r}function Kn(t,n){return t.feature?e({},t.feature,{geometry:n}):Wn(n)}function Wn(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Yn={toGeoJSON:function(t){return Kn(this,{type:"Point",coordinates:Hn(this.getLatLng(),t)})}};function Zn(t,e){return new Un(t,e)}Rn.include(Yn),Fn.include(Yn),Mn.include(Yn),Nn.include({toGeoJSON:function(t){var e=!vn(this._latlngs);return Kn(this,{type:(e?"Multi":"")+"LineString",coordinates:Vn(this._latlngs,e?1:0,!1,t)})}}),Bn.include({toGeoJSON:function(t){var e=!vn(this._latlngs),n=e&&!vn(this._latlngs[0]),i=Vn(this._latlngs,n?2:e?1:0,!0,t);return e||(i=[i]),Kn(this,{type:(n?"Multi":"")+"Polygon",coordinates:i})}}),An.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),Kn(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,i=[];return this.eachLayer(function(e){if(e.toGeoJSON){var r=e.toGeoJSON(t);if(n)i.push(r.geometry);else{var s=Wn(r);"FeatureCollection"===s.type?i.push.apply(i,s.features):i.push(s)}}}),n?Kn(this,{geometries:i,type:"GeometryCollection"}):{type:"FeatureCollection",features:i}}});var qn=Zn,Xn=kn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=N(e),d(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ce(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){se(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&oe(this._image),this},bringToBack:function(){return this._map&&le(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=N(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:re("img");ce(e,"leaflet-image-layer"),this._zoomAnimated&&ce(e,"leaflet-zoom-animated"),this.options.className&&ce(e,this.options.className),e.onselectstart=l,e.onmousemove=l,e.onload=i(this.fire,this,"load"),e.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ge(this._image,n,e)},_reset:function(){var t=this._image,e=new O(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();ve(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){pe(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Qn=Xn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:re("video");if(ce(e,"leaflet-image-layer"),this._zoomAnimated&&ce(e,"leaflet-zoom-animated"),this.options.className&&ce(e,this.options.className),e.onselectstart=l,e.onmousemove=l,e.onloadeddata=i(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),r=[],s=0;s<n.length;s++)r.push(n[s].src);this._url=n.length>0?r:[e.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var o=re("source");o.src=this._url[a],e.appendChild(o)}}}});var Jn=Xn.extend({_initImage:function(){var t=this._image=this._url;ce(t,"leaflet-image-layer"),this._zoomAnimated&&ce(t,"leaflet-zoom-animated"),this.options.className&&ce(t,this.options.className),t.onselectstart=l,t.onmousemove=l}});var ti=kn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof B||g(t))?(this._latlng=U(t),d(this,e)):(d(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&pe(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&pe(this._container,1),this.bringToFront(),this.options.interactive&&(ce(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(pe(this._container,0),this._removeTimeout=setTimeout(i(se,void 0,this._container),200)):se(this._container),this.options.interactive&&(he(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=U(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&oe(this._container),this},bringToBack:function(){return this._map&&le(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof xn){e=null;var n=this._source._layers;for(var i in n)if(n[i]._map){e=n[i];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=R(this.options.offset),n=this._getAnchor();this._zoomAnimated?ve(this._container,t.add(n)):e=e.add(t).add(n);var i=this._containerBottom=-e.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=i+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});Ke.include({_initOverlay:function(t,e,n,i){var r=e;return r instanceof t||(r=new t(i).setContent(e)),n&&r.setLatLng(n),r}}),kn.include({_initOverlay:function(t,e,n,i){var r=n;return r instanceof t?(d(r,i),r._source=this):(r=e&&!i?e:new t(i,this)).setContent(n),r}});var ei=ti.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,ti.prototype.openOn.call(this,t)},onAdd:function(t){ti.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof On||this._source.on("preclick",Oe))},onRemove:function(t){ti.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof On||this._source.off("preclick",Oe))},getEvents:function(){var t=ti.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=re("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=re("div",t+"-content-wrapper",e);if(this._contentNode=re("div",t+"-content",n),Fe(e),Me(this._contentNode),ke(e,"contextmenu",Oe),this._tipContainer=re("div",t+"-tip-container",e),this._tip=re("div",t+"-tip",this._tipContainer),this.options.closeButton){var i=this._closeButton=re("a",t+"-close-button",e);i.setAttribute("role","button"),i.setAttribute("aria-label","Close popup"),i.href="#close",i.innerHTML='<span aria-hidden="true">&#215;</span>',ke(i,"click",function(t){Ne(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var i=t.offsetHeight,r=this.options.maxHeight,s="leaflet-popup-scrolled";r&&i>r?(e.height=r+"px",ce(t,s)):he(t,s),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();ve(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(ie(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,i=this._containerWidth,r=new I(this._containerLeft,-n-this._containerBottom);r._add(ye(this._container));var s=t.layerPointToContainerPoint(r),a=R(this.options.autoPanPadding),o=R(this.options.autoPanPaddingTopLeft||a),l=R(this.options.autoPanPaddingBottomRight||a),u=t.getSize(),c=0,h=0;s.x+i+l.x>u.x&&(c=s.x+i-u.x+l.x),s.x-c-o.x<0&&(c=s.x-o.x),s.y+n+l.y>u.y&&(h=s.y+n-u.y+l.y),s.y-h-o.y<0&&(h=s.y-o.y),(c||h)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([c,h]))}},_getAnchor:function(){return R(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Ke.mergeOptions({closePopupOnClick:!0}),Ke.include({openPopup:function(t,e,n){return this._initOverlay(ei,t,e,n).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),kn.include({bindPopup:function(t,e){return this._popup=this._initOverlay(ei,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof xn||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Be(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof On?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var ni=ti.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){ti.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){ti.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=ti.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=re("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+s(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,i=this._map,r=this._container,s=i.latLngToContainerPoint(i.getCenter()),a=i.layerPointToContainerPoint(t),o=this.options.direction,l=r.offsetWidth,u=r.offsetHeight,c=R(this.options.offset),h=this._getAnchor();"top"===o?(e=l/2,n=u):"bottom"===o?(e=l/2,n=0):"center"===o?(e=l/2,n=u/2):"right"===o?(e=0,n=u/2):"left"===o?(e=l,n=u/2):a.x<s.x?(o="right",e=0,n=u/2):(o="left",e=l+2*(c.x+h.x),n=u/2),t=t.subtract(R(e,n,!0)).add(c).add(h),he(r,"leaflet-tooltip-right"),he(r,"leaflet-tooltip-left"),he(r,"leaflet-tooltip-top"),he(r,"leaflet-tooltip-bottom"),ce(r,"leaflet-tooltip-"+o),ve(r,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&pe(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return R(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Ke.include({openTooltip:function(t,e,n){return this._initOverlay(ni,t,e,n).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),kn.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ni,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof xn||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(ke(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),ke(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,i=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),i=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(i)}});var ii=Cn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ae(e),e.appendChild(n.html)):e.innerHTML=!1!==n.html?n.html:"",n.bgPos){var i=R(n.bgPos);e.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Cn.Default=In;var ri=kn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ot.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){d(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),se(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(oe(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(le(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=a(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof I?t:new I(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,i=-t(-1/0,1/0),r=0,s=n.length;r<s;r++)e=n[r].style.zIndex,n[r]!==this._container&&e&&(i=t(i,+e));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ot.ielt9){pe(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var i in this._tiles){var r=this._tiles[i];if(r.current&&r.loaded){var s=Math.min(1,(t-r.loaded)/200);pe(r.el,s),s<1?e=!0:(r.active?n=!0:this._onOpaqueTile(r),r.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(w(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=re("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(se(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var i=this._levels[t],r=this._map;return i||((i=this._levels[t]={}).el=re("div","leaflet-tile-container leaflet-zoom-animated",this._container),i.el.style.zIndex=e,i.origin=r.project(r.unproject(r.getPixelOrigin()),t).round(),i.zoom=t,this._setZoomTransform(i,r.getCenter(),r.getZoom()),i.el.offsetWidth,this._onCreateLevel(i)),this._level=i,i}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)se(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,i){var r=Math.floor(t/2),s=Math.floor(e/2),a=n-1,o=new I(+r,+s);o.z=+a;var l=this._tileCoordsToKey(o),u=this._tiles[l];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),a>i&&this._retainParent(r,s,a,i))},_retainChildren:function(t,e,n,i){for(var r=2*t;r<2*t+2;r++)for(var s=2*e;s<2*e+2;s++){var a=new I(r,s);a.z=n+1;var o=this._tileCoordsToKey(a),l=this._tiles[o];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),n+1<i&&this._retainChildren(r,s,n+1,i))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,i){var r=Math.round(e);r=void 0!==this.options.maxZoom&&r>this.options.maxZoom||void 0!==this.options.minZoom&&r<this.options.minZoom?void 0:this._clampZoom(r);var s=this.options.updateWhenZooming&&r!==this._tileZoom;i&&!s||(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==r&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var i=this._map.getZoomScale(n,t.zoom),r=t.origin.multiplyBy(i).subtract(this._map._getNewPixelOrigin(e,n)).round();Ot.any3d?ge(t.el,r,i):ve(t.el,r)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),i=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],i).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],i).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],i).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],i).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),i=e.getZoomScale(n,this._tileZoom),r=e.project(t,this._tileZoom).floor(),s=e.getSize().divideBy(2*i);return new O(r.subtract(s),r.add(s))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var i=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(i),s=r.getCenter(),a=[],o=this.options.keepBuffer,l=new O(r.getBottomLeft().subtract([o,-o]),r.getTopRight().add([o,-o]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var c=this._tiles[u].coords;c.z===this._tileZoom&&l.contains(new I(c.x,c.y))||(this._tiles[u].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(t,n);else{for(var h=r.min.y;h<=r.max.y;h++)for(var d=r.min.x;d<=r.max.x;d++){var f=new I(d,h);if(f.z=this._tileZoom,this._isValidTile(f)){var p=this._tiles[this._tileCoordsToKey(f)];p?p.current=!0:a.push(f)}}if(a.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(d=0;d<a.length;d++)this._addTile(a[d],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var i=this._tileCoordsToBounds(t);return N(this.options.bounds).overlaps(i)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),i=t.scaleBy(n),r=i.add(n);return[e.unproject(i,t.z),e.unproject(r,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new F(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new I(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(se(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){ce(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=l,t.onmousemove=l,Ot.ielt9&&this.options.opacity<1&&pe(t,this.options.opacity)},_addTile:function(t,e){var n=this._getTilePos(t),r=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),i(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&D(i(this._tileReady,this,t,null,s)),ve(s,n),this._tiles[r]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var r=this._tileCoordsToKey(t);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(pe(n.el,0),w(this._fadeFrame),this._fadeFrame=D(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(ce(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ot.ielt9||!this._map._fadeAnimated?D(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new I(this._wrapX?o(t.x,this._wrapX):t.x,this._wrapY?o(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new O(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});var si=ri.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=d(this,e)).detectRetina&&Ot.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return ke(n,"load",i(this._tileOnLoad,this,e,n)),ke(n,"error",i(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var n={r:Ot.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(n.y=i),n["-y"]=i}return m(this._url,e(n,this.options))},_tileOnLoad:function(t,e){Ot.ielt9?setTimeout(i(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var i=this.options.errorTileUrl;i&&e.getAttribute("src")!==i&&(e.src=i),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=l,e.onerror=l,!e.complete)){e.src=y;var n=this._tiles[t].coords;se(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:n})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",y),ri.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==y))return ri.prototype._tileReady.call(this,t,e,n)}});function ai(t,e){return new si(t,e)}var oi=si.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,n){this._url=t;var i=e({},this.defaultWmsParams);for(var r in n)r in this.options||(i[r]=n[r]);var s=(n=d(this,n)).detectRetina&&Ot.retina?2:1,a=this.getTileSize();i.width=a.x*s,i.height=a.y*s,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,si.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,i=M(n.project(e[0]),n.project(e[1])),r=i.min,s=i.max,a=(this._wmsVersion>=1.3&&this._crs===wn?[r.y,r.x,s.y,s.x]:[r.x,r.y,s.x,s.y]).join(","),o=si.prototype.getTileUrl.call(this,t);return o+f(this.wmsParams,o,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(t,n){return e(this.wmsParams,t),n||this.redraw(),this}});si.WMS=oi,ai.wms=function(t,e){return new oi(t,e)};var li=kn.extend({options:{padding:.1},initialize:function(t){d(this,t),s(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ce(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),i=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),s=i.multiplyBy(-n).add(r).subtract(this._map._getNewPixelOrigin(t,e));Ot.any3d?ge(this._container,s,n):ve(this._container,s)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new O(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ui=li.extend({options:{tolerance:0},getEvents:function(){var t=li.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){li.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ke(t,"mousemove",this._onMouseMove,this),ke(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ke(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){w(this._redrawRequest),delete this._ctx,se(this._container),xe(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){li.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),i=Ot.retina?2:1;ve(e,t.min),e.width=i*n.x,e.height=i*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",Ot.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){li.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[s(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,i=e.prev;n?n.prev=i:this._drawLast=i,i?i.next=n:this._drawFirst=n,delete t._order,delete this._layers[s(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,n,i=t.options.dashArray.split(/[, ]+/),r=[];for(n=0;n<i.length;n++){if(e=Number(i[n]),isNaN(e))return;r.push(e)}t.options._dashArray=r}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||D(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new O,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var i=this._drawFirst;i;i=i.next)t=i.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,i,r,s,a=t._parts,o=a.length,l=this._ctx;if(o){for(l.beginPath(),n=0;n<o;n++){for(i=0,r=a[n].length;i<r;i++)s=a[n][i],l[i?"lineTo":"moveTo"](s.x,s.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,i=Math.max(Math.round(t._radius),1),r=(Math.max(Math.round(t._radiusY),1)||i)/i;1!==r&&(n.save(),n.scale(1,r)),n.beginPath(),n.arc(e.x,e.y/r,i,0,2*Math.PI,!1),1!==r&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,i=this._map.mouseEventToLayerPoint(t),r=this._drawFirst;r;r=r.next)(e=r.layer).options.interactive&&e._containsPoint(i)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(n=e);this._fireEvent(!!n&&[n],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(he(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,r,s=this._drawFirst;s;s=s.next)(n=s.layer).options.interactive&&n._containsPoint(e)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(t),r&&(ce(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;n&&(n.prev=i,i?i.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,i=e.prev;i&&(i.next=n,n?n.prev=i:i&&(this._drawLast=i),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function ci(t){return Ot.canvas?new ui(t):null}var hi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),di={_initContainer:function(){this._container=re("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(li.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=hi("shape");ce(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=hi("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;se(e),t.removeInteractiveTarget(e),delete this._layers[s(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,i=t.options,r=t._container;r.stroked=!!i.stroke,r.filled=!!i.fill,i.stroke?(e||(e=t._stroke=hi("stroke")),r.appendChild(e),e.weight=i.weight+"px",e.color=i.color,e.opacity=i.opacity,i.dashArray?e.dashStyle=g(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=i.lineCap.replace("butt","flat"),e.joinstyle=i.lineJoin):e&&(r.removeChild(e),t._stroke=null),i.fill?(n||(n=t._fill=hi("fill")),r.appendChild(n),n.color=i.fillColor||i.color,n.opacity=i.fillOpacity):n&&(r.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),i=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+i+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){oe(t._container)},_bringToBack:function(t){le(t._container)}},fi=Ot.vml?hi:Z,pi=li.extend({_initContainer:function(){this._container=fi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){se(this._container),xe(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){li.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),ve(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=fi("path");t.options.className&&ce(e,t.options.className),t.options.interactive&&ce(e,"leaflet-interactive"),this._updateStyle(t),this._layers[s(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){se(t._path),t.removeInteractiveTarget(t._path),delete this._layers[s(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,q(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),i="a"+n+","+(Math.max(Math.round(t._radiusY),1)||n)+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+i+2*n+",0 "+i+2*-n+",0 ";this._setPath(t,r)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){oe(t._path)},_bringToBack:function(t){le(t._path)}});function mi(t){return Ot.svg||Ot.vml?new pi(t):null}Ot.vml&&pi.include(di),Ke.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&ci(t)||mi(t)}});var gi=Bn.extend({initialize:function(t,e){Bn.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=N(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});pi.create=fi,pi.pointsToPath=q,Un.geometryToLayer=$n,Un.coordsToLatLng=Gn,Un.coordsToLatLngs=jn,Un.latLngToCoords=Hn,Un.latLngsToCoords=Vn,Un.getFeature=Kn,Un.asFeature=Wn,Ke.mergeOptions({boxZoom:!0});var vi=Je.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ke(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){xe(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){se(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Yt(),be(),this._startPoint=this._map.mouseEventToContainerPoint(t),ke(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=re("div","leaflet-zoom-box",this._container),ce(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new O(this._point,this._startPoint),n=e.getSize();ve(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(se(this._box),he(this._container,"leaflet-crosshair")),Zt(),Ee(),xe(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var e=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ke.addInitHook("addHandler","boxZoom",vi),Ke.mergeOptions({doubleClickZoom:!0});var yi=Je.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),i=e.options.zoomDelta,r=t.originalEvent.shiftKey?n-i:n+i;"center"===e.options.doubleClickZoom?e.setZoom(r):e.setZoomAround(t.containerPoint,r)}});Ke.addInitHook("addHandler","doubleClickZoom",yi),Ke.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var _i=Je.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new nn(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}ce(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){he(this._map._container,"leaflet-grab"),he(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=N(this._map.options.maxBounds);this._offsetLimit=M(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,i=this._draggable._newPos.x,r=(i-e+n)%t+e-n,s=(i+e+n)%t-e-n,a=Math.abs(r+n)<Math.abs(s+n)?r:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,n=e.options,i=!n.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),i)e.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),s=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,o=r.multiplyBy(a/s),l=o.distanceTo([0,0]),u=Math.min(n.inertiaMaxSpeed,l),c=o.multiplyBy(u/l),h=u/(n.inertiaDeceleration*a),d=c.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),D(function(){e.panBy(d,{duration:h,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});Ke.addInitHook("addHandler","dragging",_i),Ke.mergeOptions({keyboard:!0,keyboardPanDelta:80});var bi=Je.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ke(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),xe(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,i=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(i,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,i=this._panKeys={},r=this.keyCodes;for(e=0,n=r.left.length;e<n;e++)i[r.left[e]]=[-1*t,0];for(e=0,n=r.right.length;e<n;e++)i[r.right[e]]=[t,0];for(e=0,n=r.down.length;e<n;e++)i[r.down[e]]=[0,t];for(e=0,n=r.up.length;e<n;e++)i[r.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,i=this._zoomKeys={},r=this.keyCodes;for(e=0,n=r.zoomIn.length;e<n;e++)i[r.zoomIn[e]]=t;for(e=0,n=r.zoomOut.length;e<n;e++)i[r.zoomOut[e]]=-t},_addHooks:function(){ke(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){xe(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,i=this._map;if(n in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(e=this._panKeys[n],t.shiftKey&&(e=R(e).multiplyBy(3)),i.options.maxBounds&&(e=i._limitOffset(R(e),i.options.maxBounds)),i.options.worldCopyJump){var r=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(e)));i.panTo(r)}else i.panBy(e)}else if(n in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!i._popup||!i._popup.options.closeOnEscapeKey)return;i.closePopup()}Be(t)}}});Ke.addInitHook("addHandler","keyboard",bi),Ke.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ei=Je.extend({addHooks:function(){ke(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){xe(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Ge(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Be(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var i=this._delta/(4*this._map.options.wheelPxPerZoomLevel),r=4*Math.log(2/(1+Math.exp(-Math.abs(i))))/Math.LN2,s=n?Math.ceil(r/n)*n:r,a=t._limitZoom(e+(this._delta>0?s:-s))-e;this._delta=0,this._startTime=null,a&&("center"===t.options.scrollWheelZoom?t.setZoom(e+a):t.setZoomAround(this._lastMousePos,e+a))}});Ke.addInitHook("addHandler","scrollWheelZoom",Ei);Ke.mergeOptions({tapHold:Ot.touchNative&&Ot.safari&&Ot.mobile,tapTolerance:15});var Ti=Je.extend({addHooks:function(){ke(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){xe(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new I(e.clientX,e.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(ke(document,"touchend",Ne),ke(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),600),ke(document,"touchend touchcancel contextmenu",this._cancel,this),ke(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){xe(document,"touchend",Ne),xe(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),xe(document,"touchend touchcancel contextmenu",this._cancel,this),xe(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new I(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var n=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});n._simulated=!0,e.target.dispatchEvent(n)}});Ke.addInitHook("addHandler","tapHold",Ti),Ke.mergeOptions({touchZoom:Ot.touch,bounceAtZoomLimits:!0});var Si=Je.extend({addHooks:function(){ce(this._map._container,"leaflet-touch-zoom"),ke(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){he(this._map._container,"leaflet-touch-zoom"),xe(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),i=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(i)._divideBy(2))),this._startDist=n.distanceTo(i),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ke(document,"touchmove",this._onTouchMove,this),ke(document,"touchend touchcancel",this._onTouchEnd,this),Ne(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]),s=n.distanceTo(r)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&s<1||this._zoom>e.getMaxZoom()&&s>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var a=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===s&&0===a.x&&0===a.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),w(this._animRequest);var o=i(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=D(o,this,!0),Ne(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,w(this._animRequest),xe(document,"touchmove",this._onTouchMove,this),xe(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Ke.addInitHook("addHandler","touchZoom",Si),Ke.BoxZoom=vi,Ke.DoubleClickZoom=yi,Ke.Drag=_i,Ke.Keyboard=bi,Ke.ScrollWheelZoom=Ei,Ke.TapHold=Ti,Ke.TouchZoom=Si,t.Bounds=O,t.Browser=Ot,t.CRS=z,t.Canvas=ui,t.Circle=Fn,t.CircleMarker=Mn,t.Class=A,t.Control=We,t.DivIcon=ii,t.DivOverlay=ti,t.DomEvent=He,t.DomUtil=Le,t.Draggable=nn,t.Evented=C,t.FeatureGroup=xn,t.GeoJSON=Un,t.GridLayer=ri,t.Handler=Je,t.Icon=Cn,t.ImageOverlay=Xn,t.LatLng=B,t.LatLngBounds=F,t.Layer=kn,t.LayerGroup=An,t.LineUtil=bn,t.Map=Ke,t.Marker=Rn,t.Mixin=tn,t.Path=On,t.Point=I,t.PolyUtil=ln,t.Polygon=Bn,t.Polyline=Nn,t.Popup=ei,t.PosAnimation=Ve,t.Projection=Sn,t.Rectangle=gi,t.Renderer=li,t.SVG=pi,t.SVGOverlay=Jn,t.TileLayer=si,t.Tooltip=ni,t.Transformation=V,t.Util=k,t.VideoOverlay=Qn,t.bind=i,t.bounds=M,t.canvas=ci,t.circle=function(t,e,n){return new Fn(t,e,n)},t.circleMarker=function(t,e){return new Mn(t,e)},t.control=Ye,t.divIcon=function(t){return new ii(t)},t.extend=e,t.featureGroup=function(t,e){return new xn(t,e)},t.geoJSON=Zn,t.geoJson=qn,t.gridLayer=function(t){return new ri(t)},t.icon=function(t){return new Cn(t)},t.imageOverlay=function(t,e,n){return new Xn(t,e,n)},t.latLng=U,t.latLngBounds=N,t.layerGroup=function(t,e){return new An(t,e)},t.map=function(t,e){return new Ke(t,e)},t.marker=function(t,e){return new Rn(t,e)},t.point=R,t.polygon=function(t,e){return new Bn(t,e)},t.polyline=function(t,e){return new Nn(t,e)},t.popup=function(t,e){return new ei(t,e)},t.rectangle=function(t,e){return new gi(t,e)},t.setOptions=d,t.stamp=s,t.svg=mi,t.svgOverlay=function(t,e,n){return new Jn(t,e,n)},t.tileLayer=ai,t.tooltip=function(t,e){return new ni(t,e)},t.transformation=K,t.version="1.9.4",t.videoOverlay=function(t,e,n){return new Qn(t,e,n)};var Di=window.L;t.noConflict=function(){return window.L=Di,this},window.L=t}(e)},540:(t,e,n)=>{"use strict";t.exports=n(287)},551:(t,e,n)=>{"use strict";var i=n(540),r=n(982);function s(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(t,e){u(t,e),u(t+"Capture",e)}function u(t,e){for(o[t]=e,t=0;t<e.length;t++)a.add(e[t])}var c=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(t,e,n,i,r,s,a){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){g[t]=new m(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];g[e]=new m(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){g[t]=new m(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){g[t]=new m(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){g[t]=new m(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){g[t]=new m(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){g[t]=new m(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){g[t]=new m(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){g[t]=new m(t,5,!1,t.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(t){return t[1].toUpperCase()}function _(t,e,n,i){var r=g.hasOwnProperty(e)?g[e]:null;(null!==r?0!==r.type:i||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,i){if(null==e||function(t,e,n,i){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,r,i)&&(n=null),i||null===r?function(t){return!!h.call(p,t)||!h.call(f,t)&&(d.test(t)?p[t]=!0:(f[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=null===n?3!==r.type&&"":n:(e=r.attributeName,i=r.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(v,y);g[e]=new m(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){g[t]=new m(t,1,!1,t.toLowerCase(),null,!0,!0)});var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),k=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function M(t){return null===t||"object"!=typeof t?null:"function"==typeof(t=O&&t[O]||t["@@iterator"])?t:null}var F,N=Object.assign;function B(t){if(void 0===F)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);F=e&&e[1]||""}return"\n"+F+t}var U=!1;function $(t,e){if(!t||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(t){var i=t}Reflect.construct(t,[],e)}else{try{e.call()}catch(t){i=t}t.call(e.prototype)}else{try{throw Error()}catch(t){i=t}t()}}catch(e){if(e&&i&&"string"==typeof e.stack){for(var r=e.stack.split("\n"),s=i.stack.split("\n"),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||r[a]!==s[o]){var l="\n"+r[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=a&&0<=o);break}}}finally{U=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?B(t):""}function z(t){switch(t.tag){case 5:return B(t.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return $(t.type,!1);case 11:return $(t.type.render,!1);case 1:return $(t.type,!0);default:return""}}function G(t){if(null==t)return null;if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case S:return"Fragment";case T:return"Portal";case w:return"Profiler";case D:return"StrictMode";case x:return"Suspense";case C:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case k:return(t.displayName||"Context")+".Consumer";case L:return(t._context.displayName||"Context")+".Provider";case A:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case I:return null!==(e=t.displayName||null)?e:G(t.type)||"Memo";case P:e=t._payload,t=t._init;try{return G(t(e))}catch(t){}}return null}function j(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(e);case 8:return e===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e}return null}function H(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function V(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function K(t){t._valueTracker||(t._valueTracker=function(t){var e=V(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(t){i=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(t){i=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function W(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=V(t)?t.checked?"true":"false":t.value),(t=i)!==n&&(e.setValue(t),!0)}function Y(t){if(void 0===(t=t||("undefined"!=typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Z(t,e){var n=e.checked;return N({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function q(t,e){var n=null==e.defaultValue?"":e.defaultValue,i=null!=e.checked?e.checked:e.defaultChecked;n=H(null!=e.value?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function X(t,e){null!=(e=e.checked)&&_(t,"checked",e,!1)}function Q(t,e){X(t,e);var n=H(e.value),i=e.type;if(null!=n)"number"===i?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===i||"reset"===i)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,H(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function J(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!("submit"!==i&&"reset"!==i||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&Y(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+H(n),e=null,r=0;r<t.length;r++){if(t[r].value===n)return t[r].selected=!0,void(i&&(t[r].defaultSelected=!0));null!==e||t[r].disabled||(e=t[r])}null!==e&&(e.selected=!0)}}function it(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(s(91));return N({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rt(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(s(92));if(et(n)){if(1<n.length)throw Error(s(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:H(n)}}function st(t,e){var n=H(e.value),i=H(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=i&&(t.defaultValue=""+i)}function at(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function ot(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?ot(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ut,ct,ht=(ct=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ut=ut||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ut.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,i){MSApp.execUnsafeLocalFunction(function(){return ct(t,e)})}:ct);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pt=["Webkit","ms","Moz","O"];function mt(t,e,n){return null==e||"boolean"==typeof e||""===e?"":n||"number"!=typeof e||0===e||ft.hasOwnProperty(t)&&ft[t]?(""+e).trim():e+"px"}function gt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=mt(n,e[n],i);"float"===n&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}Object.keys(ft).forEach(function(t){pt.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ft[e]=ft[t]})});var vt=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(t,e){if(e){if(vt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(s(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(s(60));if("object"!=typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=e.style&&"object"!=typeof e.style)throw Error(s(62))}}function _t(t,e){if(-1===t.indexOf("-"))return"string"==typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bt=null;function Et(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Tt=null,St=null,Dt=null;function wt(t){if(t=_r(t)){if("function"!=typeof Tt)throw Error(s(280));var e=t.stateNode;e&&(e=Er(e),Tt(t.stateNode,t.type,e))}}function Lt(t){St?Dt?Dt.push(t):Dt=[t]:St=t}function kt(){if(St){var t=St,e=Dt;if(Dt=St=null,wt(t),e)for(t=0;t<e.length;t++)wt(e[t])}}function At(t,e){return t(e)}function xt(){}var Ct=!1;function It(t,e,n){if(Ct)return t(e,n);Ct=!0;try{return At(t,e,n)}finally{Ct=!1,(null!==St||null!==Dt)&&(xt(),kt())}}function Pt(t,e){var n=t.stateNode;if(null===n)return null;var i=Er(n);if(null===i)return null;n=i[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!i;break t;default:t=!1}if(t)return null;if(n&&"function"!=typeof n)throw Error(s(231,e,typeof n));return n}var Rt=!1;if(c)try{var Ot={};Object.defineProperty(Ot,"passive",{get:function(){Rt=!0}}),window.addEventListener("test",Ot,Ot),window.removeEventListener("test",Ot,Ot)}catch(ct){Rt=!1}function Mt(t,e,n,i,r,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(t){this.onError(t)}}var Ft=!1,Nt=null,Bt=!1,Ut=null,$t={onError:function(t){Ft=!0,Nt=t}};function zt(t,e,n,i,r,s,a,o,l){Ft=!1,Nt=null,Mt.apply($t,arguments)}function Gt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{!!(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function jt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&null!==(t=t.alternate)&&(e=t.memoizedState),null!==e)return e.dehydrated}return null}function Ht(t){if(Gt(t)!==t)throw Error(s(188))}function Vt(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Gt(t)))throw Error(s(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Ht(r),t;if(a===i)return Ht(r),e;a=a.sibling}throw Error(s(188))}if(n.return!==i.return)n=r,i=a;else{for(var o=!1,l=r.child;l;){if(l===n){o=!0,n=r,i=a;break}if(l===i){o=!0,i=r,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,i=r;break}if(l===i){o=!0,i=a,n=r;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?t:e}(t))?Kt(t):null}function Kt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=Kt(t);if(null!==e)return e;t=t.sibling}return null}var Wt=r.unstable_scheduleCallback,Yt=r.unstable_cancelCallback,Zt=r.unstable_shouldYield,qt=r.unstable_requestPaint,Xt=r.unstable_now,Qt=r.unstable_getCurrentPriorityLevel,Jt=r.unstable_ImmediatePriority,te=r.unstable_UserBlockingPriority,ee=r.unstable_NormalPriority,ne=r.unstable_LowPriority,ie=r.unstable_IdlePriority,re=null,se=null,ae=Math.clz32?Math.clz32:function(t){return 0===(t>>>=0)?32:31-(oe(t)/le|0)|0},oe=Math.log,le=Math.LN2,ue=64,ce=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,a=268435455&n;if(0!==a){var o=a&~r;0!==o?i=he(o):0!==(s&=a)&&(i=he(s))}else 0!==(a=n&~r)?i=he(a):0!==s&&(i=he(s));if(0===i)return 0;if(0!==e&&e!==i&&0===(e&r)&&((r=i&-i)>=(s=e&-e)||16===r&&4194240&s))return e;if(4&i&&(i|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=i;0<e;)r=1<<(n=31-ae(e)),i|=t[n],e&=~r;return i}function fe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function pe(t){return 0!=(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function me(){var t=ue;return!(4194240&(ue<<=1))&&(ue=64),t}function ge(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ve(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-ae(e)]=n}function ye(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-ae(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var _e=0;function be(t){return 1<(t&=-t)?4<t?268435455&t?16:536870912:4:1}var Ee,Te,Se,De,we,Le=!1,ke=[],Ae=null,xe=null,Ce=null,Ie=new Map,Pe=new Map,Re=[],Oe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Me(t,e){switch(t){case"focusin":case"focusout":Ae=null;break;case"dragenter":case"dragleave":xe=null;break;case"mouseover":case"mouseout":Ce=null;break;case"pointerover":case"pointerout":Ie.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pe.delete(e.pointerId)}}function Fe(t,e,n,i,r,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},null!==e&&null!==(e=_r(e))&&Te(e),t):(t.eventSystemFlags|=i,e=t.targetContainers,null!==r&&-1===e.indexOf(r)&&e.push(r),t)}function Ne(t){var e=yr(t.target);if(null!==e){var n=Gt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=jt(n)))return t.blockedOn=e,void we(t.priority,function(){Se(n)})}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Be(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Ze(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=_r(n))&&Te(e),t.blockedOn=n,!1;var i=new(n=t.nativeEvent).constructor(n.type,n);bt=i,n.target.dispatchEvent(i),bt=null,e.shift()}return!0}function Ue(t,e,n){Be(t)&&n.delete(e)}function $e(){Le=!1,null!==Ae&&Be(Ae)&&(Ae=null),null!==xe&&Be(xe)&&(xe=null),null!==Ce&&Be(Ce)&&(Ce=null),Ie.forEach(Ue),Pe.forEach(Ue)}function ze(t,e){t.blockedOn===e&&(t.blockedOn=null,Le||(Le=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,$e)))}function Ge(t){function e(e){return ze(e,t)}if(0<ke.length){ze(ke[0],t);for(var n=1;n<ke.length;n++){var i=ke[n];i.blockedOn===t&&(i.blockedOn=null)}}for(null!==Ae&&ze(Ae,t),null!==xe&&ze(xe,t),null!==Ce&&ze(Ce,t),Ie.forEach(e),Pe.forEach(e),n=0;n<Re.length;n++)(i=Re[n]).blockedOn===t&&(i.blockedOn=null);for(;0<Re.length&&null===(n=Re[0]).blockedOn;)Ne(n),null===n.blockedOn&&Re.shift()}var je=b.ReactCurrentBatchConfig,He=!0;function Ve(t,e,n,i){var r=_e,s=je.transition;je.transition=null;try{_e=1,We(t,e,n,i)}finally{_e=r,je.transition=s}}function Ke(t,e,n,i){var r=_e,s=je.transition;je.transition=null;try{_e=4,We(t,e,n,i)}finally{_e=r,je.transition=s}}function We(t,e,n,i){if(He){var r=Ze(t,e,n,i);if(null===r)Hi(t,e,i,Ye,n),Me(t,i);else if(function(t,e,n,i,r){switch(e){case"focusin":return Ae=Fe(Ae,t,e,n,i,r),!0;case"dragenter":return xe=Fe(xe,t,e,n,i,r),!0;case"mouseover":return Ce=Fe(Ce,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Ie.set(s,Fe(Ie.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Pe.set(s,Fe(Pe.get(s)||null,t,e,n,i,r)),!0}return!1}(r,t,e,n,i))i.stopPropagation();else if(Me(t,i),4&e&&-1<Oe.indexOf(t)){for(;null!==r;){var s=_r(r);if(null!==s&&Ee(s),null===(s=Ze(t,e,n,i))&&Hi(t,e,i,Ye,n),s===r)break;r=s}null!==r&&i.stopPropagation()}else Hi(t,e,i,null,n)}}var Ye=null;function Ze(t,e,n,i){if(Ye=null,null!==(t=yr(t=Et(i))))if(null===(e=Gt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=jt(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ye=t,null}function qe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qt()){case Jt:return 1;case te:return 4;case ee:case ne:return 16;case ie:return 536870912;default:return 16}default:return 16}}var Xe=null,Qe=null,Je=null;function tn(){if(Je)return Je;var t,e,n=Qe,i=n.length,r="value"in Xe?Xe.value:Xe.textContent,s=r.length;for(t=0;t<i&&n[t]===r[t];t++);var a=i-t;for(e=1;e<=a&&n[i-e]===r[s-e];e++);return Je=r.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function sn(t){function e(e,n,i,r,s){for(var a in this._reactName=e,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(a)&&(e=t[a],this[a]=e?e(r):r[a]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return N(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!=typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!=typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var an,on,ln,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=sn(un),hn=N({},un,{view:0,detail:0}),dn=sn(hn),fn=N({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ln&&(ln&&"mousemove"===t.type?(an=t.screenX-ln.screenX,on=t.screenY-ln.screenY):on=an=0,ln=t),an)},movementY:function(t){return"movementY"in t?t.movementY:on}}),pn=sn(fn),mn=sn(N({},fn,{dataTransfer:0})),gn=sn(N({},hn,{relatedTarget:0})),vn=sn(N({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=N({},un,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),_n=sn(yn),bn=sn(N({},un,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Sn[t])&&!!e[t]}function wn(){return Dn}var Ln=N({},hn,{key:function(t){if(t.key){var e=En[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?Tn[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),kn=sn(Ln),An=sn(N({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=sn(N({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wn})),Cn=sn(N({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=N({},fn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(In),Rn=[9,13,27,32],On=c&&"CompositionEvent"in window,Mn=null;c&&"documentMode"in document&&(Mn=document.documentMode);var Fn=c&&"TextEvent"in window&&!Mn,Nn=c&&(!On||Mn&&8<Mn&&11>=Mn),Bn=String.fromCharCode(32),Un=!1;function $n(t,e){switch(t){case"keyup":return-1!==Rn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(t){return"object"==typeof(t=t.detail)&&"data"in t?t.data:null}var Gn=!1,jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!jn[t.type]:"textarea"===e}function Vn(t,e,n,i){Lt(i),0<(e=Ki(e,"onChange")).length&&(n=new cn("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Kn=null,Wn=null;function Yn(t){Bi(t,0)}function Zn(t){if(W(br(t)))return t}function qn(t,e){if("change"===t)return e}var Xn=!1;if(c){var Qn;if(c){var Jn="oninput"in document;if(!Jn){var ti=document.createElement("div");ti.setAttribute("oninput","return;"),Jn="function"==typeof ti.oninput}Qn=Jn}else Qn=!1;Xn=Qn&&(!document.documentMode||9<document.documentMode)}function ei(){Kn&&(Kn.detachEvent("onpropertychange",ni),Wn=Kn=null)}function ni(t){if("value"===t.propertyName&&Zn(Wn)){var e=[];Vn(e,Wn,t,Et(t)),It(Yn,e)}}function ii(t,e,n){"focusin"===t?(ei(),Wn=n,(Kn=e).attachEvent("onpropertychange",ni)):"focusout"===t&&ei()}function ri(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Zn(Wn)}function si(t,e){if("click"===t)return Zn(e)}function ai(t,e){if("input"===t||"change"===t)return Zn(e)}var oi="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e};function li(t,e){if(oi(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!h.call(e,r)||!oi(t[r],e[r]))return!1}return!0}function ui(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ci(t,e){var n,i=ui(t);for(t=0;i;){if(3===i.nodeType){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=ui(i)}}function hi(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hi(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function di(){for(var t=window,e=Y();e instanceof t.HTMLIFrameElement;){try{var n="string"==typeof e.contentWindow.location.href}catch(t){n=!1}if(!n)break;e=Y((t=e.contentWindow).document)}return e}function fi(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function pi(t){var e=di(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hi(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(e=i.start,void 0===(t=i.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=void 0===i.end?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=ci(n,s);var a=ci(n,i);r&&a&&(1!==t.rangeCount||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&((e=e.createRange()).setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mi=c&&"documentMode"in document&&11>=document.documentMode,gi=null,vi=null,yi=null,_i=!1;function bi(t,e,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_i||null==gi||gi!==Y(i)||(i="selectionStart"in(i=gi)&&fi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yi&&li(yi,i)||(yi=i,0<(i=Ki(vi,"onSelect")).length&&(e=new cn("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=gi)))}function Ei(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ti={animationend:Ei("Animation","AnimationEnd"),animationiteration:Ei("Animation","AnimationIteration"),animationstart:Ei("Animation","AnimationStart"),transitionend:Ei("Transition","TransitionEnd")},Si={},Di={};function wi(t){if(Si[t])return Si[t];if(!Ti[t])return t;var e,n=Ti[t];for(e in n)if(n.hasOwnProperty(e)&&e in Di)return Si[t]=n[e];return t}c&&(Di=document.createElement("div").style,"AnimationEvent"in window||(delete Ti.animationend.animation,delete Ti.animationiteration.animation,delete Ti.animationstart.animation),"TransitionEvent"in window||delete Ti.transitionend.transition);var Li=wi("animationend"),ki=wi("animationiteration"),Ai=wi("animationstart"),xi=wi("transitionend"),Ci=new Map,Ii="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(t,e){Ci.set(t,e),l(e,[t])}for(var Ri=0;Ri<Ii.length;Ri++){var Oi=Ii[Ri];Pi(Oi.toLowerCase(),"on"+(Oi[0].toUpperCase()+Oi.slice(1)))}Pi(Li,"onAnimationEnd"),Pi(ki,"onAnimationIteration"),Pi(Ai,"onAnimationStart"),Pi("dblclick","onDoubleClick"),Pi("focusin","onFocus"),Pi("focusout","onBlur"),Pi(xi,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mi));function Ni(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,i,r,a,o,l,u){if(zt.apply(this,arguments),Ft){if(!Ft)throw Error(s(198));var c=Nt;Ft=!1,Nt=null,Bt||(Bt=!0,Ut=c)}}(i,e,void 0,t),t.currentTarget=null}function Bi(t,e){e=!!(4&e);for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;t:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&r.isPropagationStopped())break t;Ni(r,o,u),s=l}else for(a=0;a<i.length;a++){if(l=(o=i[a]).instance,u=o.currentTarget,o=o.listener,l!==s&&r.isPropagationStopped())break t;Ni(r,o,u),s=l}}}if(Bt)throw t=Ut,Bt=!1,Ut=null,t}function Ui(t,e){var n=e[mr];void 0===n&&(n=e[mr]=new Set);var i=t+"__bubble";n.has(i)||(ji(e,t,2,!1),n.add(i))}function $i(t,e,n){var i=0;e&&(i|=4),ji(n,t,i,e)}var zi="_reactListening"+Math.random().toString(36).slice(2);function Gi(t){if(!t[zi]){t[zi]=!0,a.forEach(function(e){"selectionchange"!==e&&(Fi.has(e)||$i(e,!1,t),$i(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[zi]||(e[zi]=!0,$i("selectionchange",!1,e))}}function ji(t,e,n,i){switch(qe(e)){case 1:var r=Ve;break;case 4:r=Ke;break;default:r=We}n=r.bind(null,e,n,t),r=void 0,!Rt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(r=!0),i?void 0!==r?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):void 0!==r?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Hi(t,e,n,i,r){var s=i;if(!(1&e||2&e||null===i))t:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===a)for(a=i.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;a=a.return}for(;null!==o;){if(null===(a=yr(o)))return;if(5===(l=a.tag)||6===l){i=s=a;continue t}o=o.parentNode}}i=i.return}It(function(){var i=s,r=Et(n),a=[];t:{var o=Ci.get(t);if(void 0!==o){var l=cn,u=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":l=kn;break;case"focusin":u="focus",l=gn;break;case"focusout":u="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=xn;break;case Li:case ki:case Ai:l=vn;break;case xi:l=Cn;break;case"scroll":l=dn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var c=!!(4&e),h=!c&&"scroll"===t,d=c?null!==o?o+"Capture":null:o;c=[];for(var f,p=i;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&null!=(m=Pt(p,d))&&c.push(Vi(p,m,f))),h)break;p=p.return}0<c.length&&(o=new l(o,u,null,n,r),a.push({event:o,listeners:c}))}}if(!(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(o="mouseover"===t||"pointerover"===t)||n===bt||!(u=n.relatedTarget||n.fromElement)||!yr(u)&&!u[pr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(u=(u=n.relatedTarget||n.toElement)?yr(u):null)&&(u!==(h=Gt(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=i),l!==u)){if(c=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==t&&"pointerover"!==t||(c=An,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:br(l),f=null==u?o:br(u),(o=new c(m,p+"leave",l,n,r)).target=h,o.relatedTarget=f,m=null,yr(r)===i&&((c=new c(d,p+"enter",u,n,r)).target=f,c.relatedTarget=h,m=c),h=m,l&&u)t:{for(d=u,p=0,f=c=l;f;f=Wi(f))p++;for(f=0,m=d;m;m=Wi(m))f++;for(;0<p-f;)c=Wi(c),p--;for(;0<f-p;)d=Wi(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break t;c=Wi(c),d=Wi(d)}c=null}else c=null;null!==l&&Yi(a,o,l,c,!1),null!==u&&null!==h&&Yi(a,h,u,c,!0)}if("select"===(l=(o=i?br(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=qn;else if(Hn(o))if(Xn)g=ai;else{g=ri;var v=ii}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=si);switch(g&&(g=g(t,i))?Vn(a,g,n,r):(v&&v(t,o,i),"focusout"===t&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&tt(o,"number",o.value)),v=i?br(i):window,t){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(gi=v,vi=i,yi=null);break;case"focusout":yi=vi=gi=null;break;case"mousedown":_i=!0;break;case"contextmenu":case"mouseup":case"dragend":_i=!1,bi(a,n,r);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":bi(a,n,r)}var y;if(On)t:{switch(t){case"compositionstart":var _="onCompositionStart";break t;case"compositionend":_="onCompositionEnd";break t;case"compositionupdate":_="onCompositionUpdate";break t}_=void 0}else Gn?$n(t,n)&&(_="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(_="onCompositionStart");_&&(Nn&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Gn&&(y=tn()):(Qe="value"in(Xe=r)?Xe.value:Xe.textContent,Gn=!0)),0<(v=Ki(i,_)).length&&(_=new bn(_,t,null,n,r),a.push({event:_,listeners:v}),(y||null!==(y=zn(n)))&&(_.data=y))),(y=Fn?function(t,e){switch(t){case"compositionend":return zn(e);case"keypress":return 32!==e.which?null:(Un=!0,Bn);case"textInput":return(t=e.data)===Bn&&Un?null:t;default:return null}}(t,n):function(t,e){if(Gn)return"compositionend"===t||!On&&$n(t,e)?(t=tn(),Je=Qe=Xe=null,Gn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Nn&&"ko"!==e.locale?null:e.data}}(t,n))&&0<(i=Ki(i,"onBeforeInput")).length&&(r=new bn("onBeforeInput","beforeinput",null,n,r),a.push({event:r,listeners:i}),r.data=y)}Bi(a,e)})}function Vi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ki(t,e){for(var n=e+"Capture",i=[];null!==t;){var r=t,s=r.stateNode;5===r.tag&&null!==s&&(r=s,null!=(s=Pt(t,n))&&i.unshift(Vi(t,s,r)),null!=(s=Pt(t,e))&&i.push(Vi(t,s,r))),t=t.return}return i}function Wi(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Yi(t,e,n,i,r){for(var s=e._reactName,a=[];null!==n&&n!==i;){var o=n,l=o.alternate,u=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==u&&(o=u,r?null!=(l=Pt(n,s))&&a.unshift(Vi(n,l,o)):r||null!=(l=Pt(n,s))&&a.push(Vi(n,l,o))),n=n.return}0!==a.length&&t.push({event:e,listeners:a})}var Zi=/\r\n?/g,qi=/\u0000|\uFFFD/g;function Xi(t){return("string"==typeof t?t:""+t).replace(Zi,"\n").replace(qi,"")}function Qi(t,e,n){if(e=Xi(e),Xi(t)!==e&&n)throw Error(s(425))}function Ji(){}var tr=null,er=null;function nr(t,e){return"textarea"===t||"noscript"===t||"string"==typeof e.children||"number"==typeof e.children||"object"==typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ir="function"==typeof setTimeout?setTimeout:void 0,rr="function"==typeof clearTimeout?clearTimeout:void 0,sr="function"==typeof Promise?Promise:void 0,ar="function"==typeof queueMicrotask?queueMicrotask:void 0!==sr?function(t){return sr.resolve(null).then(t).catch(or)}:ir;function or(t){setTimeout(function(){throw t})}function lr(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return t.removeChild(r),void Ge(e);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);Ge(e)}function ur(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function cr(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var hr=Math.random().toString(36).slice(2),dr="__reactFiber$"+hr,fr="__reactProps$"+hr,pr="__reactContainer$"+hr,mr="__reactEvents$"+hr,gr="__reactListeners$"+hr,vr="__reactHandles$"+hr;function yr(t){var e=t[dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[pr]||n[dr]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=cr(t);null!==t;){if(n=t[dr])return n;t=cr(t)}return e}n=(t=n).parentNode}return null}function _r(t){return!(t=t[dr]||t[pr])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function br(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(s(33))}function Er(t){return t[fr]||null}var Tr=[],Sr=-1;function Dr(t){return{current:t}}function wr(t){0>Sr||(t.current=Tr[Sr],Tr[Sr]=null,Sr--)}function Lr(t,e){Sr++,Tr[Sr]=t.current,t.current=e}var kr={},Ar=Dr(kr),xr=Dr(!1),Cr=kr;function Ir(t,e){var n=t.type.contextTypes;if(!n)return kr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r,s={};for(r in n)s[r]=e[r];return i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Pr(t){return null!=t.childContextTypes}function Rr(){wr(xr),wr(Ar)}function Or(t,e,n){if(Ar.current!==kr)throw Error(s(168));Lr(Ar,e),Lr(xr,n)}function Mr(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(s(108,j(t)||"Unknown",r));return N({},n,i)}function Fr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||kr,Cr=Ar.current,Lr(Ar,t),Lr(xr,xr.current),!0}function Nr(t,e,n){var i=t.stateNode;if(!i)throw Error(s(169));n?(t=Mr(t,e,Cr),i.__reactInternalMemoizedMergedChildContext=t,wr(xr),wr(Ar),Lr(Ar,t)):wr(xr),Lr(xr,n)}var Br=null,Ur=!1,$r=!1;function zr(t){null===Br?Br=[t]:Br.push(t)}function Gr(){if(!$r&&null!==Br){$r=!0;var t=0,e=_e;try{var n=Br;for(_e=1;t<n.length;t++){var i=n[t];do{i=i(!0)}while(null!==i)}Br=null,Ur=!1}catch(e){throw null!==Br&&(Br=Br.slice(t+1)),Wt(Jt,Gr),e}finally{_e=e,$r=!1}}return null}var jr=[],Hr=0,Vr=null,Kr=0,Wr=[],Yr=0,Zr=null,qr=1,Xr="";function Qr(t,e){jr[Hr++]=Kr,jr[Hr++]=Vr,Vr=t,Kr=e}function Jr(t,e,n){Wr[Yr++]=qr,Wr[Yr++]=Xr,Wr[Yr++]=Zr,Zr=t;var i=qr;t=Xr;var r=32-ae(i)-1;i&=~(1<<r),n+=1;var s=32-ae(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,qr=1<<32-ae(e)+r|n<<r|i,Xr=s+t}else qr=1<<s|n<<r|i,Xr=t}function ts(t){null!==t.return&&(Qr(t,1),Jr(t,1,0))}function es(t){for(;t===Vr;)Vr=jr[--Hr],jr[Hr]=null,Kr=jr[--Hr],jr[Hr]=null;for(;t===Zr;)Zr=Wr[--Yr],Wr[Yr]=null,Xr=Wr[--Yr],Wr[Yr]=null,qr=Wr[--Yr],Wr[Yr]=null}var ns=null,is=null,rs=!1,ss=null;function as(t,e){var n=Iu(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function os(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,ns=t,is=ur(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,ns=t,is=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Zr?{id:qr,overflow:Xr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=Iu(18,null,null,0)).stateNode=e,n.return=t,t.child=n,ns=t,is=null,!0);default:return!1}}function ls(t){return!(!(1&t.mode)||128&t.flags)}function us(t){if(rs){var e=is;if(e){var n=e;if(!os(t,e)){if(ls(t))throw Error(s(418));e=ur(n.nextSibling);var i=ns;e&&os(t,e)?as(i,n):(t.flags=-4097&t.flags|2,rs=!1,ns=t)}}else{if(ls(t))throw Error(s(418));t.flags=-4097&t.flags|2,rs=!1,ns=t}}}function cs(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;ns=t}function hs(t){if(t!==ns)return!1;if(!rs)return cs(t),rs=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!nr(t.type,t.memoizedProps)),e&&(e=is)){if(ls(t))throw ds(),Error(s(418));for(;e;)as(t,e),e=ur(e.nextSibling)}if(cs(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){is=ur(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}is=null}}else is=ns?ur(t.stateNode.nextSibling):null;return!0}function ds(){for(var t=is;t;)t=ur(t.nextSibling)}function fs(){is=ns=null,rs=!1}function ps(t){null===ss?ss=[t]:ss.push(t)}var ms=b.ReactCurrentBatchConfig;function gs(t,e,n){if(null!==(t=n.ref)&&"function"!=typeof t&&"object"!=typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,t));var r=i,a=""+t;return null!==e&&null!==e.ref&&"function"==typeof e.ref&&e.ref._stringRef===a?e.ref:(e=function(t){var e=r.refs;null===t?delete e[a]:e[a]=t},e._stringRef=a,e)}if("string"!=typeof t)throw Error(s(284));if(!n._owner)throw Error(s(290,t))}return t}function vs(t,e){throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ys(t){return(0,t._init)(t._payload)}function _s(t){function e(e,n){if(t){var i=e.deletions;null===i?(e.deletions=[n],e.flags|=16):i.push(n)}}function n(n,i){if(!t)return null;for(;null!==i;)e(n,i),i=i.sibling;return null}function i(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function r(t,e){return(t=Ru(t,e)).index=0,t.sibling=null,t}function a(e,n,i){return e.index=i,t?null!==(i=e.alternate)?(i=i.index)<n?(e.flags|=2,n):i:(e.flags|=2,n):(e.flags|=1048576,n)}function o(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,n,i){return null===e||6!==e.tag?((e=Nu(n,t.mode,i)).return=t,e):((e=r(e,n)).return=t,e)}function u(t,e,n,i){var s=n.type;return s===S?h(t,e,n.props.children,i,n.key):null!==e&&(e.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===P&&ys(s)===e.type)?((i=r(e,n.props)).ref=gs(t,e,n),i.return=t,i):((i=Ou(n.type,n.key,n.props,null,t.mode,i)).ref=gs(t,e,n),i.return=t,i)}function c(t,e,n,i){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Bu(n,t.mode,i)).return=t,e):((e=r(e,n.children||[])).return=t,e)}function h(t,e,n,i,s){return null===e||7!==e.tag?((e=Mu(n,t.mode,i,s)).return=t,e):((e=r(e,n)).return=t,e)}function d(t,e,n){if("string"==typeof e&&""!==e||"number"==typeof e)return(e=Nu(""+e,t.mode,n)).return=t,e;if("object"==typeof e&&null!==e){switch(e.$$typeof){case E:return(n=Ou(e.type,e.key,e.props,null,t.mode,n)).ref=gs(t,null,e),n.return=t,n;case T:return(e=Bu(e,t.mode,n)).return=t,e;case P:return d(t,(0,e._init)(e._payload),n)}if(et(e)||M(e))return(e=Mu(e,t.mode,n,null)).return=t,e;vs(t,e)}return null}function f(t,e,n,i){var r=null!==e?e.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:l(t,e,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case E:return n.key===r?u(t,e,n,i):null;case T:return n.key===r?c(t,e,n,i):null;case P:return f(t,e,(r=n._init)(n._payload),i)}if(et(n)||M(n))return null!==r?null:h(t,e,n,i,null);vs(t,n)}return null}function p(t,e,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return l(e,t=t.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case E:return u(e,t=t.get(null===i.key?n:i.key)||null,i,r);case T:return c(e,t=t.get(null===i.key?n:i.key)||null,i,r);case P:return p(t,e,n,(0,i._init)(i._payload),r)}if(et(i)||M(i))return h(e,t=t.get(n)||null,i,r,null);vs(e,i)}return null}function m(r,s,o,l){for(var u=null,c=null,h=s,m=s=0,g=null;null!==h&&m<o.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=f(r,h,o[m],l);if(null===v){null===h&&(h=g);break}t&&h&&null===v.alternate&&e(r,h),s=a(v,s,m),null===c?u=v:c.sibling=v,c=v,h=g}if(m===o.length)return n(r,h),rs&&Qr(r,m),u;if(null===h){for(;m<o.length;m++)null!==(h=d(r,o[m],l))&&(s=a(h,s,m),null===c?u=h:c.sibling=h,c=h);return rs&&Qr(r,m),u}for(h=i(r,h);m<o.length;m++)null!==(g=p(h,r,m,o[m],l))&&(t&&null!==g.alternate&&h.delete(null===g.key?m:g.key),s=a(g,s,m),null===c?u=g:c.sibling=g,c=g);return t&&h.forEach(function(t){return e(r,t)}),rs&&Qr(r,m),u}function g(r,o,l,u){var c=M(l);if("function"!=typeof c)throw Error(s(150));if(null==(l=c.call(l)))throw Error(s(151));for(var h=c=null,m=o,g=o=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var _=f(r,m,y.value,u);if(null===_){null===m&&(m=v);break}t&&m&&null===_.alternate&&e(r,m),o=a(_,o,g),null===h?c=_:h.sibling=_,h=_,m=v}if(y.done)return n(r,m),rs&&Qr(r,g),c;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(r,y.value,u))&&(o=a(y,o,g),null===h?c=y:h.sibling=y,h=y);return rs&&Qr(r,g),c}for(m=i(r,m);!y.done;g++,y=l.next())null!==(y=p(m,r,g,y.value,u))&&(t&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=a(y,o,g),null===h?c=y:h.sibling=y,h=y);return t&&m.forEach(function(t){return e(r,t)}),rs&&Qr(r,g),c}return function t(i,s,a,l){if("object"==typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case E:t:{for(var u=a.key,c=s;null!==c;){if(c.key===u){if((u=a.type)===S){if(7===c.tag){n(i,c.sibling),(s=r(c,a.props.children)).return=i,i=s;break t}}else if(c.elementType===u||"object"==typeof u&&null!==u&&u.$$typeof===P&&ys(u)===c.type){n(i,c.sibling),(s=r(c,a.props)).ref=gs(i,c,a),s.return=i,i=s;break t}n(i,c);break}e(i,c),c=c.sibling}a.type===S?((s=Mu(a.props.children,i.mode,l,a.key)).return=i,i=s):((l=Ou(a.type,a.key,a.props,null,i.mode,l)).ref=gs(i,s,a),l.return=i,i=l)}return o(i);case T:t:{for(c=a.key;null!==s;){if(s.key===c){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(i,s.sibling),(s=r(s,a.children||[])).return=i,i=s;break t}n(i,s);break}e(i,s),s=s.sibling}(s=Bu(a,i.mode,l)).return=i,i=s}return o(i);case P:return t(i,s,(c=a._init)(a._payload),l)}if(et(a))return m(i,s,a,l);if(M(a))return g(i,s,a,l);vs(i,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==s&&6===s.tag?(n(i,s.sibling),(s=r(s,a)).return=i,i=s):(n(i,s),(s=Nu(a,i.mode,l)).return=i,i=s),o(i)):n(i,s)}}var bs=_s(!0),Es=_s(!1),Ts=Dr(null),Ss=null,Ds=null,ws=null;function Ls(){ws=Ds=Ss=null}function ks(t){var e=Ts.current;wr(Ts),t._currentValue=e}function As(t,e,n){for(;null!==t;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==i&&(i.childLanes|=e)):null!==i&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function xs(t,e){Ss=t,ws=Ds=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(_o=!0),t.firstContext=null)}function Cs(t){var e=t._currentValue;if(ws!==t)if(t={context:t,memoizedValue:e,next:null},null===Ds){if(null===Ss)throw Error(s(308));Ds=t,Ss.dependencies={lanes:0,firstContext:t}}else Ds=Ds.next=t;return e}var Is=null;function Ps(t){null===Is?Is=[t]:Is.push(t)}function Rs(t,e,n,i){var r=e.interleaved;return null===r?(n.next=n,Ps(e)):(n.next=r.next,r.next=n),e.interleaved=n,Os(t,i)}function Os(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var Ms=!1;function Fs(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ns(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Bs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Us(t,e,n){var i=t.updateQueue;if(null===i)return null;if(i=i.shared,2&Al){var r=i.pending;return null===r?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Os(t,n)}return null===(r=i.interleaved)?(e.next=e,Ps(i)):(e.next=r.next,r.next=e),i.interleaved=e,Os(t,n)}function $s(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,4194240&n)){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ye(t,n)}}function zs(t,e){var n=t.updateQueue,i=t.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?r=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?r=s=e:s=s.next=e}else r=s=e;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Gs(t,e,n,i){var r=t.updateQueue;Ms=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,u=l.next;l.next=null,null===a?s=u:a.next=u,a=l;var c=t.alternate;null!==c&&(o=(c=c.updateQueue).lastBaseUpdate)!==a&&(null===o?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l)}if(null!==s){var h=r.baseState;for(a=0,c=u=l=null,o=s;;){var d=o.lane,f=o.eventTime;if((i&d)===d){null!==c&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var p=t,m=o;switch(d=e,f=n,m.tag){case 1:if("function"==typeof(p=m.payload)){h=p.call(f,h,d);break t}h=p;break t;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(d="function"==typeof(p=m.payload)?p.call(f,h,d):p))break t;h=N({},h,d);break t;case 2:Ms=!0}}null!==o.callback&&0!==o.lane&&(t.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(u=c=f,l=h):c=c.next=f,a|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===c&&(l=h),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(e=r.shared.interleaved)){r=e;do{a|=r.lane,r=r.next}while(r!==e)}else null===s&&(r.shared.lanes=0);Fl|=a,t.lanes=a,t.memoizedState=h}}function js(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(s(191,r));r.call(i)}}}var Hs={},Vs=Dr(Hs),Ks=Dr(Hs),Ws=Dr(Hs);function Ys(t){if(t===Hs)throw Error(s(174));return t}function Zs(t,e){switch(Lr(Ws,e),Lr(Ks,t),Lr(Vs,Hs),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}wr(Vs),Lr(Vs,e)}function qs(){wr(Vs),wr(Ks),wr(Ws)}function Xs(t){Ys(Ws.current);var e=Ys(Vs.current),n=lt(e,t.type);e!==n&&(Lr(Ks,t),Lr(Vs,n))}function Qs(t){Ks.current===t&&(wr(Vs),wr(Ks))}var Js=Dr(0);function ta(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(128&e.flags)return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ea=[];function na(){for(var t=0;t<ea.length;t++)ea[t]._workInProgressVersionPrimary=null;ea.length=0}var ia=b.ReactCurrentDispatcher,ra=b.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ua=!1,ca=!1,ha=0,da=0;function fa(){throw Error(s(321))}function pa(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!oi(t[n],e[n]))return!1;return!0}function ma(t,e,n,i,r,a){if(sa=a,aa=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ia.current=null===t||null===t.memoizedState?Qa:Ja,t=n(i,r),ca){a=0;do{if(ca=!1,ha=0,25<=a)throw Error(s(301));a+=1,la=oa=null,e.updateQueue=null,ia.current=to,t=n(i,r)}while(ca)}if(ia.current=Xa,e=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ua=!1,e)throw Error(s(300));return t}function ga(){var t=0!==ha;return ha=0,t}function va(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=t:la=la.next=t,la}function ya(){if(null===oa){var t=aa.alternate;t=null!==t?t.memoizedState:null}else t=oa.next;var e=null===la?aa.memoizedState:la.next;if(null!==e)la=e,oa=t;else{if(null===t)throw Error(s(310));t={memoizedState:(oa=t).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=t:la=la.next=t}return la}function _a(t,e){return"function"==typeof e?e(t):e}function ba(t){var e=ya(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=oa,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var o=r.next;r.next=a.next,a.next=o}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var l=o=null,u=null,c=a;do{var h=c.lane;if((sa&h)===h)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:h,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=d,o=i):u=u.next=d,aa.lanes|=h,Fl|=h}c=c.next}while(null!==c&&c!==a);null===u?o=i:u.next=l,oi(i,e.memoizedState)||(_o=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=u,n.lastRenderedState=i}if(null!==(t=n.interleaved)){r=t;do{a=r.lane,aa.lanes|=a,Fl|=a,r=r.next}while(r!==t)}else null===r&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ea(t){var e=ya(),n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{a=t(a,o.action),o=o.next}while(o!==r);oi(a,e.memoizedState)||(_o=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function Ta(){}function Sa(t,e){var n=aa,i=ya(),r=e(),a=!oi(i.memoizedState,r);if(a&&(i.memoizedState=r,_o=!0),i=i.queue,Ma(La.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Ca(9,wa.bind(null,n,i,r,e),void 0,null),null===xl)throw Error(s(349));30&sa||Da(n,e,r)}return r}function Da(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=aa.updateQueue)?(e={lastEffect:null,stores:null},aa.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function wa(t,e,n,i){e.value=n,e.getSnapshot=i,ka(e)&&Aa(t)}function La(t,e,n){return n(function(){ka(e)&&Aa(t)})}function ka(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!oi(t,n)}catch(t){return!0}}function Aa(t){var e=Os(t,1);null!==e&&nu(e,t,1,-1)}function xa(t){var e=va();return"function"==typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_a,lastRenderedState:t},e.queue=t,t=t.dispatch=Wa.bind(null,aa,t),[e.memoizedState,t]}function Ca(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},null===(e=aa.updateQueue)?(e={lastEffect:null,stores:null},aa.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Ia(){return ya().memoizedState}function Pa(t,e,n,i){var r=va();aa.flags|=t,r.memoizedState=Ca(1|e,n,void 0,void 0===i?null:i)}function Ra(t,e,n,i){var r=ya();i=void 0===i?null:i;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==i&&pa(i,a.deps))return void(r.memoizedState=Ca(e,n,s,i))}aa.flags|=t,r.memoizedState=Ca(1|e,n,s,i)}function Oa(t,e){return Pa(8390656,8,t,e)}function Ma(t,e){return Ra(2048,8,t,e)}function Fa(t,e){return Ra(4,2,t,e)}function Na(t,e){return Ra(4,4,t,e)}function Ba(t,e){return"function"==typeof e?(t=t(),e(t),function(){e(null)}):null!=e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Ua(t,e,n){return n=null!=n?n.concat([t]):null,Ra(4,4,Ba.bind(null,e,t),n)}function $a(){}function za(t,e){var n=ya();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&pa(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Ga(t,e){var n=ya();e=void 0===e?null:e;var i=n.memoizedState;return null!==i&&null!==e&&pa(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function ja(t,e,n){return 21&sa?(oi(n,e)||(n=me(),aa.lanes|=n,Fl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,_o=!0),t.memoizedState=n)}function Ha(t,e){var n=_e;_e=0!==n&&4>n?n:4,t(!0);var i=ra.transition;ra.transition={};try{t(!1),e()}finally{_e=n,ra.transition=i}}function Va(){return ya().memoizedState}function Ka(t,e,n){var i=eu(t);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Ya(t)?Za(e,n):null!==(n=Rs(t,e,n,i))&&(nu(n,t,i,tu()),qa(n,e,i))}function Wa(t,e,n){var i=eu(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ya(t))Za(e,r);else{var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var a=e.lastRenderedState,o=s(a,n);if(r.hasEagerState=!0,r.eagerState=o,oi(o,a)){var l=e.interleaved;return null===l?(r.next=r,Ps(e)):(r.next=l.next,l.next=r),void(e.interleaved=r)}}catch(t){}null!==(n=Rs(t,e,r,i))&&(nu(n,t,i,r=tu()),qa(n,e,i))}}function Ya(t){var e=t.alternate;return t===aa||null!==e&&e===aa}function Za(t,e){ca=ua=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function qa(t,e,n){if(4194240&n){var i=e.lanes;n|=i&=t.pendingLanes,e.lanes=n,ye(t,n)}}var Xa={readContext:Cs,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Qa={readContext:Cs,useCallback:function(t,e){return va().memoizedState=[t,void 0===e?null:e],t},useContext:Cs,useEffect:Oa,useImperativeHandle:function(t,e,n){return n=null!=n?n.concat([t]):null,Pa(4194308,4,Ba.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Pa(4194308,4,t,e)},useInsertionEffect:function(t,e){return Pa(4,2,t,e)},useMemo:function(t,e){var n=va();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=va();return e=void 0!==n?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Ka.bind(null,aa,t),[i.memoizedState,t]},useRef:function(t){return t={current:t},va().memoizedState=t},useState:xa,useDebugValue:$a,useDeferredValue:function(t){return va().memoizedState=t},useTransition:function(){var t=xa(!1),e=t[0];return t=Ha.bind(null,t[1]),va().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=aa,r=va();if(rs){if(void 0===n)throw Error(s(407));n=n()}else{if(n=e(),null===xl)throw Error(s(349));30&sa||Da(i,e,n)}r.memoizedState=n;var a={value:n,getSnapshot:e};return r.queue=a,Oa(La.bind(null,i,a,t),[t]),i.flags|=2048,Ca(9,wa.bind(null,i,a,n,e),void 0,null),n},useId:function(){var t=va(),e=xl.identifierPrefix;if(rs){var n=Xr;e=":"+e+"R"+(n=(qr&~(1<<32-ae(qr)-1)).toString(32)+n),0<(n=ha++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=da++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ja={readContext:Cs,useCallback:za,useContext:Cs,useEffect:Ma,useImperativeHandle:Ua,useInsertionEffect:Fa,useLayoutEffect:Na,useMemo:Ga,useReducer:ba,useRef:Ia,useState:function(){return ba(_a)},useDebugValue:$a,useDeferredValue:function(t){return ja(ya(),oa.memoizedState,t)},useTransition:function(){return[ba(_a)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:Sa,useId:Va,unstable_isNewReconciler:!1},to={readContext:Cs,useCallback:za,useContext:Cs,useEffect:Ma,useImperativeHandle:Ua,useInsertionEffect:Fa,useLayoutEffect:Na,useMemo:Ga,useReducer:Ea,useRef:Ia,useState:function(){return Ea(_a)},useDebugValue:$a,useDeferredValue:function(t){var e=ya();return null===oa?e.memoizedState=t:ja(e,oa.memoizedState,t)},useTransition:function(){return[Ea(_a)[0],ya().memoizedState]},useMutableSource:Ta,useSyncExternalStore:Sa,useId:Va,unstable_isNewReconciler:!1};function eo(t,e){if(t&&t.defaultProps){for(var n in e=N({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}function no(t,e,n,i){n=null==(n=n(i,e=t.memoizedState))?e:N({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var io={isMounted:function(t){return!!(t=t._reactInternals)&&Gt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=tu(),r=eu(t),s=Bs(i,r);s.payload=e,null!=n&&(s.callback=n),null!==(e=Us(t,s,r))&&(nu(e,t,r,i),$s(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=tu(),r=eu(t),s=Bs(i,r);s.tag=1,s.payload=e,null!=n&&(s.callback=n),null!==(e=Us(t,s,r))&&(nu(e,t,r,i),$s(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=tu(),i=eu(t),r=Bs(n,i);r.tag=2,null!=e&&(r.callback=e),null!==(e=Us(t,r,i))&&(nu(e,t,i,n),$s(e,t,i))}};function ro(t,e,n,i,r,s,a){return"function"==typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(i,s,a):!(e.prototype&&e.prototype.isPureReactComponent&&li(n,i)&&li(r,s))}function so(t,e,n){var i=!1,r=kr,s=e.contextType;return"object"==typeof s&&null!==s?s=Cs(s):(r=Pr(e)?Cr:Ar.current,s=(i=null!=(i=e.contextTypes))?Ir(t,r):kr),e=new e(n,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=io,t.stateNode=e,e._reactInternals=t,i&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function ao(t,e,n,i){t=e.state,"function"==typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,i),"function"==typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&io.enqueueReplaceState(e,e.state,null)}function oo(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Fs(t);var s=e.contextType;"object"==typeof s&&null!==s?r.context=Cs(s):(s=Pr(e)?Cr:Ar.current,r.context=Ir(t,s)),r.state=t.memoizedState,"function"==typeof(s=e.getDerivedStateFromProps)&&(no(t,e,s,n),r.state=t.memoizedState),"function"==typeof e.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(e=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),e!==r.state&&io.enqueueReplaceState(r,r.state,null),Gs(t,n,r,i),r.state=t.memoizedState),"function"==typeof r.componentDidMount&&(t.flags|=4194308)}function lo(t,e){try{var n="",i=e;do{n+=z(i),i=i.return}while(i);var r=n}catch(t){r="\nError generating stack: "+t.message+"\n"+t.stack}return{value:t,source:e,stack:r,digest:null}}function uo(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function co(t,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var ho="function"==typeof WeakMap?WeakMap:Map;function fo(t,e,n){(n=Bs(-1,n)).tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Hl||(Hl=!0,Vl=i),co(0,e)},n}function po(t,e,n){(n=Bs(-1,n)).tag=3;var i=t.type.getDerivedStateFromError;if("function"==typeof i){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){co(0,e)}}var s=t.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){co(0,e),"function"!=typeof i&&(null===Kl?Kl=new Set([this]):Kl.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function mo(t,e,n){var i=t.pingCache;if(null===i){i=t.pingCache=new ho;var r=new Set;i.set(e,r)}else void 0===(r=i.get(e))&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=wu.bind(null,t,e,n),e.then(t,t))}function go(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function vo(t,e,n,i,r){return 1&t.mode?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Bs(-1,1)).tag=2,Us(n,e,1))),n.lanes|=1),t)}var yo=b.ReactCurrentOwner,_o=!1;function bo(t,e,n,i){e.child=null===t?Es(e,null,n,i):bs(e,t.child,n,i)}function Eo(t,e,n,i,r){n=n.render;var s=e.ref;return xs(e,r),i=ma(t,e,n,i,s,r),n=ga(),null===t||_o?(rs&&n&&ts(e),e.flags|=1,bo(t,e,i,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ho(t,e,r))}function To(t,e,n,i,r){if(null===t){var s=n.type;return"function"!=typeof s||Pu(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Ou(n.type,null,i,e,e.mode,r)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,So(t,e,s,i,r))}if(s=t.child,0===(t.lanes&r)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:li)(a,i)&&t.ref===e.ref)return Ho(t,e,r)}return e.flags|=1,(t=Ru(s,i)).ref=e.ref,t.return=e,e.child=t}function So(t,e,n,i,r){if(null!==t){var s=t.memoizedProps;if(li(s,i)&&t.ref===e.ref){if(_o=!1,e.pendingProps=i=s,0===(t.lanes&r))return e.lanes=t.lanes,Ho(t,e,r);131072&t.flags&&(_o=!0)}}return Lo(t,e,n,i,r)}function Do(t,e,n){var i=e.pendingProps,r=i.children,s=null!==t?t.memoizedState:null;if("hidden"===i.mode)if(1&e.mode){if(!(1073741824&n))return t=null!==s?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Lr(Rl,Pl),Pl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==s?s.baseLanes:n,Lr(Rl,Pl),Pl|=i}else e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lr(Rl,Pl),Pl|=n;else null!==s?(i=s.baseLanes|n,e.memoizedState=null):i=n,Lr(Rl,Pl),Pl|=i;return bo(t,e,r,n),e.child}function wo(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Lo(t,e,n,i,r){var s=Pr(n)?Cr:Ar.current;return s=Ir(e,s),xs(e,r),n=ma(t,e,n,i,s,r),i=ga(),null===t||_o?(rs&&i&&ts(e),e.flags|=1,bo(t,e,n,r),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ho(t,e,r))}function ko(t,e,n,i,r){if(Pr(n)){var s=!0;Fr(e)}else s=!1;if(xs(e,r),null===e.stateNode)jo(t,e),so(e,n,i),oo(e,n,i,r),i=!0;else if(null===t){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=n.contextType;u="object"==typeof u&&null!==u?Cs(u):Ir(e,u=Pr(n)?Cr:Ar.current);var c=n.getDerivedStateFromProps,h="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;h||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==i||l!==u)&&ao(e,a,i,u),Ms=!1;var d=e.memoizedState;a.state=d,Gs(e,i,a,r),l=e.memoizedState,o!==i||d!==l||xr.current||Ms?("function"==typeof c&&(no(e,n,c,i),l=e.memoizedState),(o=Ms||ro(e,n,o,i,d,l,u))?(h||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(e.flags|=4194308)):("function"==typeof a.componentDidMount&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=u,i=o):("function"==typeof a.componentDidMount&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,Ns(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:eo(e.type,o),a.props=u,h=e.pendingProps,d=a.context,l="object"==typeof(l=n.contextType)&&null!==l?Cs(l):Ir(e,l=Pr(n)?Cr:Ar.current);var f=n.getDerivedStateFromProps;(c="function"==typeof f||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==h||d!==l)&&ao(e,a,i,l),Ms=!1,d=e.memoizedState,a.state=d,Gs(e,i,a,r);var p=e.memoizedState;o!==h||d!==p||xr.current||Ms?("function"==typeof f&&(no(e,n,f,i),p=e.memoizedState),(u=Ms||ro(e,n,u,i,d,p,l)||!1)?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(i,p,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,p,l)),"function"==typeof a.componentDidUpdate&&(e.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),a.props=i,a.state=p,a.context=l,i=u):("function"!=typeof a.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),i=!1)}return Ao(t,e,n,i,s,r)}function Ao(t,e,n,i,r,s){wo(t,e);var a=!!(128&e.flags);if(!i&&!a)return r&&Nr(e,n,!1),Ho(t,e,s);i=e.stateNode,yo.current=e;var o=a&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return e.flags|=1,null!==t&&a?(e.child=bs(e,t.child,null,s),e.child=bs(e,null,o,s)):bo(t,e,o,s),e.memoizedState=i.state,r&&Nr(e,n,!0),e.child}function xo(t){var e=t.stateNode;e.pendingContext?Or(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Or(0,e.context,!1),Zs(t,e.containerInfo)}function Co(t,e,n,i,r){return fs(),ps(r),e.flags|=256,bo(t,e,n,i),e.child}var Io,Po,Ro,Oo,Mo={dehydrated:null,treeContext:null,retryLane:0};function Fo(t){return{baseLanes:t,cachePool:null,transitions:null}}function No(t,e,n){var i,r=e.pendingProps,a=Js.current,o=!1,l=!!(128&e.flags);if((i=l)||(i=(null===t||null!==t.memoizedState)&&!!(2&a)),i?(o=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(a|=1),Lr(Js,1&a),null===t)return us(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(1&e.mode?"$!"===t.data?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,o?(r=e.mode,o=e.child,l={mode:"hidden",children:l},1&r||null===o?o=Fu(l,r,0,null):(o.childLanes=0,o.pendingProps=l),t=Mu(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Fo(n),e.memoizedState=Mo,t):Bo(e,l));if(null!==(a=t.memoizedState)&&null!==(i=a.dehydrated))return function(t,e,n,i,r,a,o){if(n)return 256&e.flags?(e.flags&=-257,Uo(t,e,o,i=uo(Error(s(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(a=i.fallback,r=e.mode,i=Fu({mode:"visible",children:i.children},r,0,null),(a=Mu(a,r,o,null)).flags|=2,i.return=e,a.return=e,i.sibling=a,e.child=i,1&e.mode&&bs(e,t.child,null,o),e.child.memoizedState=Fo(o),e.memoizedState=Mo,a);if(!(1&e.mode))return Uo(t,e,o,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var l=i.dgst;return i=l,Uo(t,e,o,i=uo(a=Error(s(419)),i,void 0))}if(l=0!==(o&t.childLanes),_o||l){if(null!==(i=xl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|o))?0:r)&&r!==a.retryLane&&(a.retryLane=r,Os(t,r),nu(i,t,r,-1))}return mu(),Uo(t,e,o,i=uo(Error(s(421))))}return"$?"===r.data?(e.flags|=128,e.child=t.child,e=ku.bind(null,t),r._reactRetry=e,null):(t=a.treeContext,is=ur(r.nextSibling),ns=e,rs=!0,ss=null,null!==t&&(Wr[Yr++]=qr,Wr[Yr++]=Xr,Wr[Yr++]=Zr,qr=t.id,Xr=t.overflow,Zr=e),(e=Bo(e,i.children)).flags|=4096,e)}(t,e,l,r,i,a,n);if(o){o=r.fallback,l=e.mode,i=(a=t.child).sibling;var u={mode:"hidden",children:r.children};return 1&l||e.child===a?(r=Ru(a,u)).subtreeFlags=14680064&a.subtreeFlags:((r=e.child).childLanes=0,r.pendingProps=u,e.deletions=null),null!==i?o=Ru(i,o):(o=Mu(o,l,n,null)).flags|=2,o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,l=null===(l=t.child.memoizedState)?Fo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=t.childLanes&~n,e.memoizedState=Mo,r}return t=(o=t.child).sibling,r=Ru(o,{mode:"visible",children:r.children}),!(1&e.mode)&&(r.lanes=n),r.return=e,r.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Bo(t,e){return(e=Fu({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Uo(t,e,n,i){return null!==i&&ps(i),bs(e,t.child,null,n),(t=Bo(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function $o(t,e,n){t.lanes|=e;var i=t.alternate;null!==i&&(i.lanes|=e),As(t.return,e,n)}function zo(t,e,n,i,r){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function Go(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(bo(t,e,i.children,n),2&(i=Js.current))i=1&i|2,e.flags|=128;else{if(null!==t&&128&t.flags)t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&$o(t,n,e);else if(19===t.tag)$o(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Lr(Js,i),1&e.mode)switch(r){case"forwards":for(n=e.child,r=null;null!==n;)null!==(t=n.alternate)&&null===ta(t)&&(r=n),n=n.sibling;null===(n=r)?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),zo(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;null!==r;){if(null!==(t=r.alternate)&&null===ta(t)){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}zo(e,!0,n,null,s);break;case"together":zo(e,!1,null,null,void 0);break;default:e.memoizedState=null}else e.memoizedState=null;return e.child}function jo(t,e){!(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ho(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Fl|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(n=Ru(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Ru(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Vo(t,e){if(!rs)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?e||null===t.tail?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ko(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=t,r=r.sibling;else for(r=t.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Wo(t,e,n){var i=e.pendingProps;switch(es(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ko(e),null;case 1:case 17:return Pr(e.type)&&Rr(),Ko(e),null;case 3:return i=e.stateNode,qs(),wr(xr),wr(Ar),na(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==t&&null!==t.child||(hs(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&!(256&e.flags)||(e.flags|=1024,null!==ss&&(au(ss),ss=null))),Po(t,e),Ko(e),null;case 5:Qs(e);var r=Ys(Ws.current);if(n=e.type,null!==t&&null!=e.stateNode)Ro(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(null===e.stateNode)throw Error(s(166));return Ko(e),null}if(t=Ys(Vs.current),hs(e)){i=e.stateNode,n=e.type;var a=e.memoizedProps;switch(i[dr]=e,i[fr]=a,t=!!(1&e.mode),n){case"dialog":Ui("cancel",i),Ui("close",i);break;case"iframe":case"object":case"embed":Ui("load",i);break;case"video":case"audio":for(r=0;r<Mi.length;r++)Ui(Mi[r],i);break;case"source":Ui("error",i);break;case"img":case"image":case"link":Ui("error",i),Ui("load",i);break;case"details":Ui("toggle",i);break;case"input":q(i,a),Ui("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Ui("invalid",i);break;case"textarea":rt(i,a),Ui("invalid",i)}for(var l in yt(n,a),r=null,a)if(a.hasOwnProperty(l)){var u=a[l];"children"===l?"string"==typeof u?i.textContent!==u&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,u,t),r=["children",u]):"number"==typeof u&&i.textContent!==""+u&&(!0!==a.suppressHydrationWarning&&Qi(i.textContent,u,t),r=["children",""+u]):o.hasOwnProperty(l)&&null!=u&&"onScroll"===l&&Ui("scroll",i)}switch(n){case"input":K(i),J(i,a,!0);break;case"textarea":K(i),at(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=Ji)}i=r,e.updateQueue=i,null!==i&&(e.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=ot(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"==typeof i.is?t=l.createElement(n,{is:i.is}):(t=l.createElement(n),"select"===n&&(l=t,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):t=l.createElementNS(t,n),t[dr]=e,t[fr]=i,Io(t,e,!1,!1),e.stateNode=t;t:{switch(l=_t(n,i),n){case"dialog":Ui("cancel",t),Ui("close",t),r=i;break;case"iframe":case"object":case"embed":Ui("load",t),r=i;break;case"video":case"audio":for(r=0;r<Mi.length;r++)Ui(Mi[r],t);r=i;break;case"source":Ui("error",t),r=i;break;case"img":case"image":case"link":Ui("error",t),Ui("load",t),r=i;break;case"details":Ui("toggle",t),r=i;break;case"input":q(t,i),r=Z(t,i),Ui("invalid",t);break;case"option":default:r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=N({},i,{value:void 0}),Ui("invalid",t);break;case"textarea":rt(t,i),r=it(t,i),Ui("invalid",t)}for(a in yt(n,r),u=r)if(u.hasOwnProperty(a)){var c=u[a];"style"===a?gt(t,c):"dangerouslySetInnerHTML"===a?null!=(c=c?c.__html:void 0)&&ht(t,c):"children"===a?"string"==typeof c?("textarea"!==n||""!==c)&&dt(t,c):"number"==typeof c&&dt(t,""+c):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=c&&"onScroll"===a&&Ui("scroll",t):null!=c&&_(t,a,c,l))}switch(n){case"input":K(t),J(t,i,!1);break;case"textarea":K(t),at(t);break;case"option":null!=i.value&&t.setAttribute("value",""+H(i.value));break;case"select":t.multiple=!!i.multiple,null!=(a=i.value)?nt(t,!!i.multiple,a,!1):null!=i.defaultValue&&nt(t,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(t.onclick=Ji)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break t;case"img":i=!0;break t;default:i=!1}}i&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Ko(e),null;case 6:if(t&&null!=e.stateNode)Oo(t,e,t.memoizedProps,i);else{if("string"!=typeof i&&null===e.stateNode)throw Error(s(166));if(n=Ys(Ws.current),Ys(Vs.current),hs(e)){if(i=e.stateNode,n=e.memoizedProps,i[dr]=e,(a=i.nodeValue!==n)&&null!==(t=ns))switch(t.tag){case 3:Qi(i.nodeValue,n,!!(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Qi(i.nodeValue,n,!!(1&t.mode))}a&&(e.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[dr]=e,e.stateNode=i}return Ko(e),null;case 13:if(wr(Js),i=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(rs&&null!==is&&1&e.mode&&!(128&e.flags))ds(),fs(),e.flags|=98560,a=!1;else if(a=hs(e),null!==i&&null!==i.dehydrated){if(null===t){if(!a)throw Error(s(318));if(!(a=null!==(a=e.memoizedState)?a.dehydrated:null))throw Error(s(317));a[dr]=e}else fs(),!(128&e.flags)&&(e.memoizedState=null),e.flags|=4;Ko(e),a=!1}else null!==ss&&(au(ss),ss=null),a=!0;if(!a)return 65536&e.flags?e:null}return 128&e.flags?(e.lanes=n,e):((i=null!==i)!=(null!==t&&null!==t.memoizedState)&&i&&(e.child.flags|=8192,1&e.mode&&(null===t||1&Js.current?0===Ol&&(Ol=3):mu())),null!==e.updateQueue&&(e.flags|=4),Ko(e),null);case 4:return qs(),Po(t,e),null===t&&Gi(e.stateNode.containerInfo),Ko(e),null;case 10:return ks(e.type._context),Ko(e),null;case 19:if(wr(Js),null===(a=e.memoizedState))return Ko(e),null;if(i=!!(128&e.flags),null===(l=a.rendering))if(i)Vo(a,!1);else{if(0!==Ol||null!==t&&128&t.flags)for(t=e.child;null!==t;){if(null!==(l=ta(t))){for(e.flags|=128,Vo(a,!1),null!==(i=l.updateQueue)&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;null!==n;)t=i,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,t=l.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Lr(Js,1&Js.current|2),e.child}t=t.sibling}null!==a.tail&&Xt()>Gl&&(e.flags|=128,i=!0,Vo(a,!1),e.lanes=4194304)}else{if(!i)if(null!==(t=ta(l))){if(e.flags|=128,i=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Vo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!rs)return Ko(e),null}else 2*Xt()-a.renderingStartTime>Gl&&1073741824!==n&&(e.flags|=128,i=!0,Vo(a,!1),e.lanes=4194304);a.isBackwards?(l.sibling=e.child,e.child=l):(null!==(n=a.last)?n.sibling=l:e.child=l,a.last=l)}return null!==a.tail?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Xt(),e.sibling=null,n=Js.current,Lr(Js,i?1&n|2:1&n),e):(Ko(e),null);case 22:case 23:return hu(),i=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==i&&(e.flags|=8192),i&&1&e.mode?!!(1073741824&Pl)&&(Ko(e),6&e.subtreeFlags&&(e.flags|=8192)):Ko(e),null;case 24:case 25:return null}throw Error(s(156,e.tag))}function Yo(t,e){switch(es(e),e.tag){case 1:return Pr(e.type)&&Rr(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return qs(),wr(xr),wr(Ar),na(),65536&(t=e.flags)&&!(128&t)?(e.flags=-65537&t|128,e):null;case 5:return Qs(e),null;case 13:if(wr(Js),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));fs()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return wr(Js),null;case 4:return qs(),null;case 10:return ks(e.type._context),null;case 22:case 23:return hu(),null;default:return null}}Io=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Ro=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Ys(Vs.current);var s,a=null;switch(n){case"input":r=Z(t,r),i=Z(t,i),a=[];break;case"select":r=N({},r,{value:void 0}),i=N({},i,{value:void 0}),a=[];break;case"textarea":r=it(t,r),i=it(t,i),a=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(t.onclick=Ji)}for(c in yt(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var l=r[c];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(o.hasOwnProperty(c)?a||(a=[]):(a=a||[]).push(c,null));for(c in i){var u=i[c];if(l=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&u!==l&&(null!=u||null!=l))if("style"===c)if(l){for(s in l)!l.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in u)u.hasOwnProperty(s)&&l[s]!==u[s]&&(n||(n={}),n[s]=u[s])}else n||(a||(a=[]),a.push(c,n)),n=u;else"dangerouslySetInnerHTML"===c?(u=u?u.__html:void 0,l=l?l.__html:void 0,null!=u&&l!==u&&(a=a||[]).push(c,u)):"children"===c?"string"!=typeof u&&"number"!=typeof u||(a=a||[]).push(c,""+u):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(o.hasOwnProperty(c)?(null!=u&&"onScroll"===c&&Ui("scroll",t),a||l===u||(a=[])):(a=a||[]).push(c,u))}n&&(a=a||[]).push("style",n);var c=a;(e.updateQueue=c)&&(e.flags|=4)}},Oo=function(t,e,n,i){n!==i&&(e.flags|=4)};var Zo=!1,qo=!1,Xo="function"==typeof WeakSet?WeakSet:Set,Qo=null;function Jo(t,e){var n=t.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Du(t,e,n)}else n.current=null}function tl(t,e,n){try{n()}catch(n){Du(t,e,n)}}var el=!1;function nl(t,e,n){var i=e.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,void 0!==s&&tl(e,n,s)}r=r.next}while(r!==i)}}function il(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function rl(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"==typeof e?e(t):e.current=t}}function sl(t){var e=t.alternate;null!==e&&(t.alternate=null,sl(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(e=t.stateNode)&&(delete e[dr],delete e[fr],delete e[mr],delete e[gr],delete e[vr]),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function al(t){return 5===t.tag||3===t.tag||4===t.tag}function ol(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||al(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ll(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!=(n=n._reactRootContainer)||null!==e.onclick||(e.onclick=Ji));else if(4!==i&&null!==(t=t.child))for(ll(t,e,n),t=t.sibling;null!==t;)ll(t,e,n),t=t.sibling}function ul(t,e,n){var i=t.tag;if(5===i||6===i)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==i&&null!==(t=t.child))for(ul(t,e,n),t=t.sibling;null!==t;)ul(t,e,n),t=t.sibling}var cl=null,hl=!1;function dl(t,e,n){for(n=n.child;null!==n;)fl(t,e,n),n=n.sibling}function fl(t,e,n){if(se&&"function"==typeof se.onCommitFiberUnmount)try{se.onCommitFiberUnmount(re,n)}catch(t){}switch(n.tag){case 5:qo||Jo(n,e);case 6:var i=cl,r=hl;cl=null,dl(t,e,n),hl=r,null!==(cl=i)&&(hl?(t=cl,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):cl.removeChild(n.stateNode));break;case 18:null!==cl&&(hl?(t=cl,n=n.stateNode,8===t.nodeType?lr(t.parentNode,n):1===t.nodeType&&lr(t,n),Ge(t)):lr(cl,n.stateNode));break;case 4:i=cl,r=hl,cl=n.stateNode.containerInfo,hl=!0,dl(t,e,n),cl=i,hl=r;break;case 0:case 11:case 14:case 15:if(!qo&&null!==(i=n.updateQueue)&&null!==(i=i.lastEffect)){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,void 0!==a&&(2&s||4&s)&&tl(n,e,a),r=r.next}while(r!==i)}dl(t,e,n);break;case 1:if(!qo&&(Jo(n,e),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(t){Du(n,e,t)}dl(t,e,n);break;case 21:dl(t,e,n);break;case 22:1&n.mode?(qo=(i=qo)||null!==n.memoizedState,dl(t,e,n),qo=i):dl(t,e,n);break;default:dl(t,e,n)}}function pl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Xo),e.forEach(function(e){var i=Au.bind(null,t,e);n.has(e)||(n.add(e),e.then(i,i))})}}function ml(t,e){var n=e.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=t,o=e,l=o;t:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,hl=!1;break t;case 3:case 4:cl=l.stateNode.containerInfo,hl=!0;break t}l=l.return}if(null===cl)throw Error(s(160));fl(a,o,r),cl=null,hl=!1;var u=r.alternate;null!==u&&(u.return=null),r.return=null}catch(t){Du(r,e,t)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)gl(e,t),e=e.sibling}function gl(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ml(e,t),vl(t),4&i){try{nl(3,t,t.return),il(3,t)}catch(e){Du(t,t.return,e)}try{nl(5,t,t.return)}catch(e){Du(t,t.return,e)}}break;case 1:ml(e,t),vl(t),512&i&&null!==n&&Jo(n,n.return);break;case 5:if(ml(e,t),vl(t),512&i&&null!==n&&Jo(n,n.return),32&t.flags){var r=t.stateNode;try{dt(r,"")}catch(e){Du(t,t.return,e)}}if(4&i&&null!=(r=t.stateNode)){var a=t.memoizedProps,o=null!==n?n.memoizedProps:a,l=t.type,u=t.updateQueue;if(t.updateQueue=null,null!==u)try{"input"===l&&"radio"===a.type&&null!=a.name&&X(r,a),_t(l,o);var c=_t(l,a);for(o=0;o<u.length;o+=2){var h=u[o],d=u[o+1];"style"===h?gt(r,d):"dangerouslySetInnerHTML"===h?ht(r,d):"children"===h?dt(r,d):_(r,h,d,c)}switch(l){case"input":Q(r,a);break;case"textarea":st(r,a);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?nt(r,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?nt(r,!!a.multiple,a.defaultValue,!0):nt(r,!!a.multiple,a.multiple?[]:"",!1))}r[fr]=a}catch(e){Du(t,t.return,e)}}break;case 6:if(ml(e,t),vl(t),4&i){if(null===t.stateNode)throw Error(s(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(e){Du(t,t.return,e)}}break;case 3:if(ml(e,t),vl(t),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Ge(e.containerInfo)}catch(e){Du(t,t.return,e)}break;case 4:default:ml(e,t),vl(t);break;case 13:ml(e,t),vl(t),8192&(r=t.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(zl=Xt())),4&i&&pl(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(qo=(c=qo)||h,ml(e,t),qo=c):ml(e,t),vl(t),8192&i){if(c=null!==t.memoizedState,(t.stateNode.isHidden=c)&&!h&&1&t.mode)for(Qo=t,h=t.child;null!==h;){for(d=Qo=h;null!==Qo;){switch(p=(f=Qo).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:Jo(f,f.return);var m=f.stateNode;if("function"==typeof m.componentWillUnmount){i=f,n=f.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(t){Du(i,n,t)}}break;case 5:Jo(f,f.return);break;case 22:if(null!==f.memoizedState){El(d);continue}}null!==p?(p.return=f,Qo=p):El(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{r=d.stateNode,c?"function"==typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=null!=(u=d.memoizedProps.style)&&u.hasOwnProperty("display")?u.display:null,l.style.display=mt("display",o))}catch(e){Du(t,t.return,e)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(e){Du(t,t.return,e)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(e,t),vl(t),4&i&&pl(t);case 21:}}function vl(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(al(n)){var i=n;break t}n=n.return}throw Error(s(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(dt(r,""),i.flags&=-33),ul(t,ol(t),r);break;case 3:case 4:var a=i.stateNode.containerInfo;ll(t,ol(t),a);break;default:throw Error(s(161))}}catch(e){Du(t,t.return,e)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function yl(t,e,n){Qo=t,_l(t,e,n)}function _l(t,e,n){for(var i=!!(1&t.mode);null!==Qo;){var r=Qo,s=r.child;if(22===r.tag&&i){var a=null!==r.memoizedState||Zo;if(!a){var o=r.alternate,l=null!==o&&null!==o.memoizedState||qo;o=Zo;var u=qo;if(Zo=a,(qo=l)&&!u)for(Qo=r;null!==Qo;)l=(a=Qo).child,22===a.tag&&null!==a.memoizedState?Tl(r):null!==l?(l.return=a,Qo=l):Tl(r);for(;null!==s;)Qo=s,_l(s,e,n),s=s.sibling;Qo=r,Zo=o,qo=u}bl(t)}else 8772&r.subtreeFlags&&null!==s?(s.return=r,Qo=s):bl(t)}}function bl(t){for(;null!==Qo;){var e=Qo;if(8772&e.flags){var n=e.alternate;try{if(8772&e.flags)switch(e.tag){case 0:case 11:case 15:qo||il(5,e);break;case 1:var i=e.stateNode;if(4&e.flags&&!qo)if(null===n)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:eo(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;null!==a&&js(e,a,i);break;case 3:var o=e.updateQueue;if(null!==o){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}js(e,o,n)}break;case 5:var l=e.stateNode;if(null===n&&4&e.flags){n=l;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var c=e.alternate;if(null!==c){var h=c.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ge(d)}}}break;default:throw Error(s(163))}qo||512&e.flags&&rl(e)}catch(t){Du(e,e.return,t)}}if(e===t){Qo=null;break}if(null!==(n=e.sibling)){n.return=e.return,Qo=n;break}Qo=e.return}}function El(t){for(;null!==Qo;){var e=Qo;if(e===t){Qo=null;break}var n=e.sibling;if(null!==n){n.return=e.return,Qo=n;break}Qo=e.return}}function Tl(t){for(;null!==Qo;){var e=Qo;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{il(4,e)}catch(t){Du(e,n,t)}break;case 1:var i=e.stateNode;if("function"==typeof i.componentDidMount){var r=e.return;try{i.componentDidMount()}catch(t){Du(e,r,t)}}var s=e.return;try{rl(e)}catch(t){Du(e,s,t)}break;case 5:var a=e.return;try{rl(e)}catch(t){Du(e,a,t)}}}catch(t){Du(e,e.return,t)}if(e===t){Qo=null;break}var o=e.sibling;if(null!==o){o.return=e.return,Qo=o;break}Qo=e.return}}var Sl,Dl=Math.ceil,wl=b.ReactCurrentDispatcher,Ll=b.ReactCurrentOwner,kl=b.ReactCurrentBatchConfig,Al=0,xl=null,Cl=null,Il=0,Pl=0,Rl=Dr(0),Ol=0,Ml=null,Fl=0,Nl=0,Bl=0,Ul=null,$l=null,zl=0,Gl=1/0,jl=null,Hl=!1,Vl=null,Kl=null,Wl=!1,Yl=null,Zl=0,ql=0,Xl=null,Ql=-1,Jl=0;function tu(){return 6&Al?Xt():-1!==Ql?Ql:Ql=Xt()}function eu(t){return 1&t.mode?2&Al&&0!==Il?Il&-Il:null!==ms.transition?(0===Jl&&(Jl=me()),Jl):0!==(t=_e)?t:t=void 0===(t=window.event)?16:qe(t.type):1}function nu(t,e,n,i){if(50<ql)throw ql=0,Xl=null,Error(s(185));ve(t,n,i),2&Al&&t===xl||(t===xl&&(!(2&Al)&&(Nl|=n),4===Ol&&ou(t,Il)),iu(t,i),1===n&&0===Al&&!(1&e.mode)&&(Gl=Xt()+500,Ur&&Gr()))}function iu(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-ae(s),o=1<<a,l=r[a];-1===l?0!==(o&n)&&0===(o&i)||(r[a]=fe(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}}(t,e);var i=de(t,t===xl?Il:0);if(0===i)null!==n&&Yt(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(null!=n&&Yt(n),1===e)0===t.tag?function(t){Ur=!0,zr(t)}(lu.bind(null,t)):zr(lu.bind(null,t)),ar(function(){!(6&Al)&&Gr()}),n=null;else{switch(be(i)){case 1:n=Jt;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=ie}n=xu(n,ru.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ru(t,e){if(Ql=-1,Jl=0,6&Al)throw Error(s(327));var n=t.callbackNode;if(Tu()&&t.callbackNode!==n)return null;var i=de(t,t===xl?Il:0);if(0===i)return null;if(30&i||0!==(i&t.expiredLanes)||e)e=gu(t,i);else{e=i;var r=Al;Al|=2;var a=pu();for(xl===t&&Il===e||(jl=null,Gl=Xt()+500,du(t,e));;)try{yu();break}catch(e){fu(t,e)}Ls(),wl.current=a,Al=r,null!==Cl?e=0:(xl=null,Il=0,e=Ol)}if(0!==e){if(2===e&&0!==(r=pe(t))&&(i=r,e=su(t,r)),1===e)throw n=Ml,du(t,0),ou(t,i),iu(t,Xt()),n;if(6===e)ou(t,i);else{if(r=t.current.alternate,!(30&i||function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!oi(s(),r))return!1}catch(t){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(r)||(e=gu(t,i),2===e&&(a=pe(t),0!==a&&(i=a,e=su(t,a))),1!==e)))throw n=Ml,du(t,0),ou(t,i),iu(t,Xt()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(s(345));case 2:case 5:Eu(t,$l,jl);break;case 3:if(ou(t,i),(130023424&i)===i&&10<(e=zl+500-Xt())){if(0!==de(t,0))break;if(((r=t.suspendedLanes)&i)!==i){tu(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=ir(Eu.bind(null,t,$l,jl),e);break}Eu(t,$l,jl);break;case 4:if(ou(t,i),(4194240&i)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-ae(i);a=1<<o,(o=e[o])>r&&(r=o),i&=~a}if(i=r,10<(i=(120>(i=Xt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Dl(i/1960))-i)){t.timeoutHandle=ir(Eu.bind(null,t,$l,jl),i);break}Eu(t,$l,jl);break;default:throw Error(s(329))}}}return iu(t,Xt()),t.callbackNode===n?ru.bind(null,t):null}function su(t,e){var n=Ul;return t.current.memoizedState.isDehydrated&&(du(t,e).flags|=256),2!==(t=gu(t,e))&&(e=$l,$l=n,null!==e&&au(e)),t}function au(t){null===$l?$l=t:$l.push.apply($l,t)}function ou(t,e){for(e&=~Bl,e&=~Nl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ae(e),i=1<<n;t[n]=-1,e&=~i}}function lu(t){if(6&Al)throw Error(s(327));Tu();var e=de(t,0);if(!(1&e))return iu(t,Xt()),null;var n=gu(t,e);if(0!==t.tag&&2===n){var i=pe(t);0!==i&&(e=i,n=su(t,i))}if(1===n)throw n=Ml,du(t,0),ou(t,e),iu(t,Xt()),n;if(6===n)throw Error(s(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Eu(t,$l,jl),iu(t,Xt()),null}function uu(t,e){var n=Al;Al|=1;try{return t(e)}finally{0===(Al=n)&&(Gl=Xt()+500,Ur&&Gr())}}function cu(t){null!==Yl&&0===Yl.tag&&!(6&Al)&&Tu();var e=Al;Al|=1;var n=kl.transition,i=_e;try{if(kl.transition=null,_e=1,t)return t()}finally{_e=i,kl.transition=n,!(6&(Al=e))&&Gr()}}function hu(){Pl=Rl.current,wr(Rl)}function du(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,rr(n)),null!==Cl)for(n=Cl.return;null!==n;){var i=n;switch(es(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Rr();break;case 3:qs(),wr(xr),wr(Ar),na();break;case 5:Qs(i);break;case 4:qs();break;case 13:case 19:wr(Js);break;case 10:ks(i.type._context);break;case 22:case 23:hu()}n=n.return}if(xl=t,Cl=t=Ru(t.current,null),Il=Pl=e,Ol=0,Ml=null,Bl=Nl=Fl=0,$l=Ul=null,null!==Is){for(e=0;e<Is.length;e++)if(null!==(i=(n=Is[e]).interleaved)){n.interleaved=null;var r=i.next,s=n.pending;if(null!==s){var a=s.next;s.next=r,i.next=a}n.pending=i}Is=null}return t}function fu(t,e){for(;;){var n=Cl;try{if(Ls(),ia.current=Xa,ua){for(var i=aa.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ua=!1}if(sa=0,la=oa=aa=null,ca=!1,ha=0,Ll.current=null,null===n||null===n.return){Ol=1,Ml=e,Cl=null;break}t:{var a=t,o=n.return,l=n,u=e;if(e=Il,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,h=l,d=h.tag;if(!(1&h.mode||0!==d&&11!==d&&15!==d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=go(o);if(null!==p){p.flags&=-257,vo(p,o,l,0,e),1&p.mode&&mo(a,c,e),u=c;var m=(e=p).updateQueue;if(null===m){var g=new Set;g.add(u),e.updateQueue=g}else m.add(u);break t}if(!(1&e)){mo(a,c,e),mu();break t}u=Error(s(426))}else if(rs&&1&l.mode){var v=go(o);if(null!==v){!(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,e),ps(lo(u,l));break t}}a=u=lo(u,l),4!==Ol&&(Ol=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e,zs(a,fo(0,u,e));break t;case 1:l=u;var y=a.type,_=a.stateNode;if(!(128&a.flags||"function"!=typeof y.getDerivedStateFromError&&(null===_||"function"!=typeof _.componentDidCatch||null!==Kl&&Kl.has(_)))){a.flags|=65536,e&=-e,a.lanes|=e,zs(a,po(a,l,e));break t}}a=a.return}while(null!==a)}bu(n)}catch(t){e=t,Cl===n&&null!==n&&(Cl=n=n.return);continue}break}}function pu(){var t=wl.current;return wl.current=Xa,null===t?Xa:t}function mu(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===xl||!(268435455&Fl)&&!(268435455&Nl)||ou(xl,Il)}function gu(t,e){var n=Al;Al|=2;var i=pu();for(xl===t&&Il===e||(jl=null,du(t,e));;)try{vu();break}catch(e){fu(t,e)}if(Ls(),Al=n,wl.current=i,null!==Cl)throw Error(s(261));return xl=null,Il=0,Ol}function vu(){for(;null!==Cl;)_u(Cl)}function yu(){for(;null!==Cl&&!Zt();)_u(Cl)}function _u(t){var e=Sl(t.alternate,t,Pl);t.memoizedProps=t.pendingProps,null===e?bu(t):Cl=e,Ll.current=null}function bu(t){var e=t;do{var n=e.alternate;if(t=e.return,32768&e.flags){if(null!==(n=Yo(n,e)))return n.flags&=32767,void(Cl=n);if(null===t)return Ol=6,void(Cl=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}else if(null!==(n=Wo(n,e,Pl)))return void(Cl=n);if(null!==(e=e.sibling))return void(Cl=e);Cl=e=t}while(null!==e);0===Ol&&(Ol=5)}function Eu(t,e,n){var i=_e,r=kl.transition;try{kl.transition=null,_e=1,function(t,e,n,i){do{Tu()}while(null!==Yl);if(6&Al)throw Error(s(327));n=t.finishedWork;var r=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(s(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-ae(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}(t,a),t===xl&&(Cl=xl=null,Il=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||Wl||(Wl=!0,xu(ee,function(){return Tu(),null})),a=!!(15990&n.flags),15990&n.subtreeFlags||a){a=kl.transition,kl.transition=null;var o=_e;_e=1;var l=Al;Al|=4,Ll.current=null,function(t,e){if(tr=He,fi(t=di())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var i=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(t){n=null;break t}var o=0,l=-1,u=-1,c=0,h=0,d=t,f=null;e:for(;;){for(var p;d!==n||0!==r&&3!==d.nodeType||(l=o+r),d!==a||0!==i&&3!==d.nodeType||(u=o+i),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===t)break e;if(f===n&&++c===r&&(l=o),f===a&&++h===i&&(u=o),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===u?null:{start:l,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(er={focusedElem:t,selectionRange:n},He=!1,Qo=e;null!==Qo;)if(t=(e=Qo).child,1028&e.subtreeFlags&&null!==t)t.return=e,Qo=t;else for(;null!==Qo;){e=Qo;try{var m=e.alternate;if(1024&e.flags)switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=e.stateNode,_=y.getSnapshotBeforeUpdate(e.elementType===e.type?g:eo(e.type,g),v);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=e.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(t){Du(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,Qo=t;break}Qo=e.return}m=el,el=!1}(t,n),gl(n,t),pi(er),He=!!tr,er=tr=null,t.current=n,yl(n,t,r),qt(),Al=l,_e=o,kl.transition=a}else t.current=n;if(Wl&&(Wl=!1,Yl=t,Zl=r),0===(a=t.pendingLanes)&&(Kl=null),function(t){if(se&&"function"==typeof se.onCommitFiberRoot)try{se.onCommitFiberRoot(re,t,void 0,!(128&~t.current.flags))}catch(t){}}(n.stateNode),iu(t,Xt()),null!==e)for(i=t.onRecoverableError,n=0;n<e.length;n++)i((r=e[n]).value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,t=Vl,Vl=null,t;!!(1&Zl)&&0!==t.tag&&Tu(),1&(a=t.pendingLanes)?t===Xl?ql++:(ql=0,Xl=t):ql=0,Gr()}(t,e,n,i)}finally{kl.transition=r,_e=i}return null}function Tu(){if(null!==Yl){var t=be(Zl),e=kl.transition,n=_e;try{if(kl.transition=null,_e=16>t?16:t,null===Yl)var i=!1;else{if(t=Yl,Yl=null,Zl=0,6&Al)throw Error(s(331));var r=Al;for(Al|=4,Qo=t.current;null!==Qo;){var a=Qo,o=a.child;if(16&Qo.flags){var l=a.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(Qo=c;null!==Qo;){var h=Qo;switch(h.tag){case 0:case 11:case 15:nl(8,h,a)}var d=h.child;if(null!==d)d.return=h,Qo=d;else for(;null!==Qo;){var f=(h=Qo).sibling,p=h.return;if(sl(h),h===c){Qo=null;break}if(null!==f){f.return=p,Qo=f;break}Qo=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Qo=a}}if(2064&a.subtreeFlags&&null!==o)o.return=a,Qo=o;else t:for(;null!==Qo;){if(2048&(a=Qo).flags)switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Qo=y;break t}Qo=a.return}}var _=t.current;for(Qo=_;null!==Qo;){var b=(o=Qo).child;if(2064&o.subtreeFlags&&null!==b)b.return=o,Qo=b;else t:for(o=_;null!==Qo;){if(2048&(l=Qo).flags)try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(t){Du(l,l.return,t)}if(l===o){Qo=null;break t}var E=l.sibling;if(null!==E){E.return=l.return,Qo=E;break t}Qo=l.return}}if(Al=r,Gr(),se&&"function"==typeof se.onPostCommitFiberRoot)try{se.onPostCommitFiberRoot(re,t)}catch(t){}i=!0}return i}finally{_e=n,kl.transition=e}}return!1}function Su(t,e,n){t=Us(t,e=fo(0,e=lo(n,e),1),1),e=tu(),null!==t&&(ve(t,1,e),iu(t,e))}function Du(t,e,n){if(3===t.tag)Su(t,t,n);else for(;null!==e;){if(3===e.tag){Su(e,t,n);break}if(1===e.tag){var i=e.stateNode;if("function"==typeof e.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Kl||!Kl.has(i))){e=Us(e,t=po(e,t=lo(n,t),1),1),t=tu(),null!==e&&(ve(e,1,t),iu(e,t));break}}e=e.return}}function wu(t,e,n){var i=t.pingCache;null!==i&&i.delete(e),e=tu(),t.pingedLanes|=t.suspendedLanes&n,xl===t&&(Il&n)===n&&(4===Ol||3===Ol&&(130023424&Il)===Il&&500>Xt()-zl?du(t,0):Bl|=n),iu(t,e)}function Lu(t,e){0===e&&(1&t.mode?(e=ce,!(130023424&(ce<<=1))&&(ce=4194304)):e=1);var n=tu();null!==(t=Os(t,e))&&(ve(t,e,n),iu(t,n))}function ku(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Lu(t,n)}function Au(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(s(314))}null!==i&&i.delete(e),Lu(t,n)}function xu(t,e){return Wt(t,e)}function Cu(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Iu(t,e,n,i){return new Cu(t,e,n,i)}function Pu(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Ru(t,e){var n=t.alternate;return null===n?((n=Iu(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ou(t,e,n,i,r,a){var o=2;if(i=t,"function"==typeof t)Pu(t)&&(o=1);else if("string"==typeof t)o=5;else t:switch(t){case S:return Mu(n.children,r,a,e);case D:o=8,r|=8;break;case w:return(t=Iu(12,n,e,2|r)).elementType=w,t.lanes=a,t;case x:return(t=Iu(13,n,e,r)).elementType=x,t.lanes=a,t;case C:return(t=Iu(19,n,e,r)).elementType=C,t.lanes=a,t;case R:return Fu(n,r,a,e);default:if("object"==typeof t&&null!==t)switch(t.$$typeof){case L:o=10;break t;case k:o=9;break t;case A:o=11;break t;case I:o=14;break t;case P:o=16,i=null;break t}throw Error(s(130,null==t?t:typeof t,""))}return(e=Iu(o,n,e,r)).elementType=t,e.type=i,e.lanes=a,e}function Mu(t,e,n,i){return(t=Iu(7,t,i,e)).lanes=n,t}function Fu(t,e,n,i){return(t=Iu(22,t,i,e)).elementType=R,t.lanes=n,t.stateNode={isHidden:!1},t}function Nu(t,e,n){return(t=Iu(6,t,null,e)).lanes=n,t}function Bu(t,e,n){return(e=Iu(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Uu(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ge(0),this.expirationTimes=ge(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ge(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function $u(t,e,n,i,r,s,a,o,l){return t=new Uu(t,e,n,o,l),1===e?(e=1,!0===s&&(e|=8)):e=0,s=Iu(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fs(s),t}function zu(t){if(!t)return kr;t:{if(Gt(t=t._reactInternals)!==t||1!==t.tag)throw Error(s(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Pr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(s(171))}if(1===t.tag){var n=t.type;if(Pr(n))return Mr(t,n,e)}return e}function Gu(t,e,n,i,r,s,a,o,l){return(t=$u(n,i,!0,t,0,s,0,o,l)).context=zu(null),n=t.current,(s=Bs(i=tu(),r=eu(n))).callback=null!=e?e:null,Us(n,s,r),t.current.lanes=r,ve(t,r,i),iu(t,i),t}function ju(t,e,n,i){var r=e.current,s=tu(),a=eu(r);return n=zu(n),null===e.context?e.context=n:e.pendingContext=n,(e=Bs(s,a)).payload={element:t},null!==(i=void 0===i?null:i)&&(e.callback=i),null!==(t=Us(r,e,a))&&(nu(t,r,a,s),$s(t,r,a)),a}function Hu(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Vu(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function Ku(t,e){Vu(t,e),(t=t.alternate)&&Vu(t,e)}Sl=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||xr.current)_o=!0;else{if(0===(t.lanes&n)&&!(128&e.flags))return _o=!1,function(t,e,n){switch(e.tag){case 3:xo(e),fs();break;case 5:Xs(e);break;case 1:Pr(e.type)&&Fr(e);break;case 4:Zs(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Lr(Ts,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=e.memoizedState))return null!==i.dehydrated?(Lr(Js,1&Js.current),e.flags|=128,null):0!==(n&e.child.childLanes)?No(t,e,n):(Lr(Js,1&Js.current),null!==(t=Ho(t,e,n))?t.sibling:null);Lr(Js,1&Js.current);break;case 19:if(i=0!==(n&e.childLanes),128&t.flags){if(i)return Go(t,e,n);e.flags|=128}if(null!==(r=e.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Lr(Js,Js.current),i)break;return null;case 22:case 23:return e.lanes=0,Do(t,e,n)}return Ho(t,e,n)}(t,e,n);_o=!!(131072&t.flags)}else _o=!1,rs&&1048576&e.flags&&Jr(e,Kr,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;jo(t,e),t=e.pendingProps;var r=Ir(e,Ar.current);xs(e,n),r=ma(null,e,i,t,r,n);var a=ga();return e.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Pr(i)?(a=!0,Fr(e)):a=!1,e.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Fs(e),r.updater=io,e.stateNode=r,r._reactInternals=e,oo(e,i,t,n),e=Ao(null,e,i,!0,a,n)):(e.tag=0,rs&&a&&ts(e),bo(null,e,r,n),e=e.child),e;case 16:i=e.elementType;t:{switch(jo(t,e),t=e.pendingProps,i=(r=i._init)(i._payload),e.type=i,r=e.tag=function(t){if("function"==typeof t)return Pu(t)?1:0;if(null!=t){if((t=t.$$typeof)===A)return 11;if(t===I)return 14}return 2}(i),t=eo(i,t),r){case 0:e=Lo(null,e,i,t,n);break t;case 1:e=ko(null,e,i,t,n);break t;case 11:e=Eo(null,e,i,t,n);break t;case 14:e=To(null,e,i,eo(i.type,t),n);break t}throw Error(s(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,Lo(t,e,i,r=e.elementType===i?r:eo(i,r),n);case 1:return i=e.type,r=e.pendingProps,ko(t,e,i,r=e.elementType===i?r:eo(i,r),n);case 3:t:{if(xo(e),null===t)throw Error(s(387));i=e.pendingProps,r=(a=e.memoizedState).element,Ns(t,e),Gs(e,i,null,n);var o=e.memoizedState;if(i=o.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,256&e.flags){e=Co(t,e,i,n,r=lo(Error(s(423)),e));break t}if(i!==r){e=Co(t,e,i,n,r=lo(Error(s(424)),e));break t}for(is=ur(e.stateNode.containerInfo.firstChild),ns=e,rs=!0,ss=null,n=Es(e,null,i,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fs(),i===r){e=Ho(t,e,n);break t}bo(t,e,i,n)}e=e.child}return e;case 5:return Xs(e),null===t&&us(e),i=e.type,r=e.pendingProps,a=null!==t?t.memoizedProps:null,o=r.children,nr(i,r)?o=null:null!==a&&nr(i,a)&&(e.flags|=32),wo(t,e),bo(t,e,o,n),e.child;case 6:return null===t&&us(e),null;case 13:return No(t,e,n);case 4:return Zs(e,e.stateNode.containerInfo),i=e.pendingProps,null===t?e.child=bs(e,null,i,n):bo(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,Eo(t,e,i,r=e.elementType===i?r:eo(i,r),n);case 7:return bo(t,e,e.pendingProps,n),e.child;case 8:case 12:return bo(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,o=r.value,Lr(Ts,i._currentValue),i._currentValue=o,null!==a)if(oi(a.value,o)){if(a.children===r.children&&!xr.current){e=Ho(t,e,n);break t}}else for(null!==(a=e.child)&&(a.return=e);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var u=l.firstContext;null!==u;){if(u.context===i){if(1===a.tag){(u=Bs(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var h=(c=c.shared).pending;null===h?u.next=u:(u.next=h.next,h.next=u),c.pending=u}}a.lanes|=n,null!==(u=a.alternate)&&(u.lanes|=n),As(a.return,n,e),l.lanes|=n;break}u=u.next}}else if(10===a.tag)o=a.type===e.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),As(o,n,e),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===e){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,xs(e,n),i=i(r=Cs(r)),e.flags|=1,bo(t,e,i,n),e.child;case 14:return r=eo(i=e.type,e.pendingProps),To(t,e,i,r=eo(i.type,r),n);case 15:return So(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:eo(i,r),jo(t,e),e.tag=1,Pr(i)?(t=!0,Fr(e)):t=!1,xs(e,n),so(e,i,r),oo(e,i,r,n),Ao(null,e,i,!0,t,n);case 19:return Go(t,e,n);case 22:return Do(t,e,n)}throw Error(s(156,e.tag))};var Wu="function"==typeof reportError?reportError:function(t){console.error(t)};function Yu(t){this._internalRoot=t}function Zu(t){this._internalRoot=t}function qu(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Xu(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Qu(){}function Ju(t,e,n,i,r){var s=n._reactRootContainer;if(s){var a=s;if("function"==typeof r){var o=r;r=function(){var t=Hu(a);o.call(t)}}ju(e,a,t,r)}else a=function(t,e,n,i,r){if(r){if("function"==typeof i){var s=i;i=function(){var t=Hu(a);s.call(t)}}var a=Gu(e,i,t,0,null,!1,0,"",Qu);return t._reactRootContainer=a,t[pr]=a.current,Gi(8===t.nodeType?t.parentNode:t),cu(),a}for(;r=t.lastChild;)t.removeChild(r);if("function"==typeof i){var o=i;i=function(){var t=Hu(l);o.call(t)}}var l=$u(t,0,!1,null,0,!1,0,"",Qu);return t._reactRootContainer=l,t[pr]=l.current,Gi(8===t.nodeType?t.parentNode:t),cu(function(){ju(e,l,n,i)}),l}(n,e,t,r,i);return Hu(a)}Zu.prototype.render=Yu.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));ju(t,e,null,null)},Zu.prototype.unmount=Yu.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;cu(function(){ju(null,t,null,null)}),e[pr]=null}},Zu.prototype.unstable_scheduleHydration=function(t){if(t){var e=De();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Re.length&&0!==e&&e<Re[n].priority;n++);Re.splice(n,0,t),0===n&&Ne(t)}},Ee=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(ye(e,1|n),iu(e,Xt()),!(6&Al)&&(Gl=Xt()+500,Gr()))}break;case 13:cu(function(){var e=Os(t,1);if(null!==e){var n=tu();nu(e,t,1,n)}}),Ku(t,1)}},Te=function(t){if(13===t.tag){var e=Os(t,134217728);null!==e&&nu(e,t,134217728,tu()),Ku(t,134217728)}},Se=function(t){if(13===t.tag){var e=eu(t),n=Os(t,e);null!==n&&nu(n,t,e,tu()),Ku(t,e)}},De=function(){return _e},we=function(t,e){var n=_e;try{return _e=t,e()}finally{_e=n}},Tt=function(t,e,n){switch(e){case"input":if(Q(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Er(i);if(!r)throw Error(s(90));W(i),Q(i,r)}}}break;case"textarea":st(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},At=uu,xt=cu;var tc={usingClientEntryPoint:!1,Events:[_r,br,Er,Lt,kt,uu]},ec={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nc={bundleType:ec.bundleType,version:ec.version,rendererPackageName:ec.rendererPackageName,rendererConfig:ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Vt(t))?null:t.stateNode},findFiberByHostInstance:ec.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ic.isDisabled&&ic.supportsFiber)try{re=ic.inject(nc),se=ic}catch(ct){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tc,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!qu(e))throw Error(s(200));return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==i?null:""+i,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!qu(t))throw Error(s(299));var n=!1,i="",r=Wu;return null!=e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(r=e.onRecoverableError)),e=$u(t,1,!1,null,0,n,0,i,r),t[pr]=e.current,Gi(8===t.nodeType?t.parentNode:t),new Yu(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"==typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return null===(t=Vt(e))?null:t.stateNode},e.flushSync=function(t){return cu(t)},e.hydrate=function(t,e,n){if(!Xu(e))throw Error(s(200));return Ju(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!qu(t))throw Error(s(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",o=Wu;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),e=Gu(e,null,t,1,null!=n?n:null,r,0,a,o),t[pr]=e.current,Gi(t),i)for(t=0;t<i.length;t++)r=(r=(n=i[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Zu(e)},e.render=function(t,e,n){if(!Xu(e))throw Error(s(200));return Ju(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Xu(t))throw Error(s(40));return!!t._reactRootContainer&&(cu(function(){Ju(null,null,t,!1,function(){t._reactRootContainer=null,t[pr]=null})}),!0)},e.unstable_batchedUpdates=uu,e.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Xu(n))throw Error(s(200));if(null==t||void 0===t._reactInternals)throw Error(s(38));return Ju(t,e,n,!1,i)},e.version="18.3.1-next-f1338f8080-20240426"},601:t=>{"use strict";t.exports=function(t){return t[1]}},626:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});var i=n(601),r=n.n(i),s=n(314),a=n.n(s)()(r());a.push([t.id,'body {\n    font-family: Arial, sans-serif;\n    margin: 0;\n    padding: 0;\n    background: #f7f7fa;\n}\n\n.tabs {\n    display: flex;\n    border-bottom: 2px solid #888;\n    background: #e9e9f3;\n    padding: 0.5em 2em 0 2em;\n}\n\n.tab-btn {\n    padding: 0.7em 2em;\n    cursor: pointer;\n    border: none;\n    background: #e9e9f3;\n    margin-right: 2px;\n    border-radius: 8px 8px 0 0;\n    font-size: 1.1em;\n    color: #444;\n    transition: background 0.2s;\n}\n\n.tab-btn.active {\n    background: #fff;\n    border-bottom: 2px solid #fff;\n    color: #222;\n    font-weight: bold;\n}\n\n.tab-content {\n    display: none;\n    background: #fff;\n    padding: 0;\n}\n.tab-content.active {\n    display: block;\n}\n\niframe {\n    width: 100%;\n    height: calc(100vh - 70px);\n    border: none;\n    background: #fff;\n}\n\nh2, h1 {\n    margin-top: 1em;\n    margin-bottom: 1em;\n    color: #333;\n}\n\n/* Make all main tables fill the browser width */\ntable,\n#datapoints-table,\n#commands-table,\n#tracking-table {\n    width: 100%;\n    border-collapse: collapse;\n    background: #fff;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.04);\n    margin-bottom: 1em;\n    font-size: 1em;\n    table-layout: fixed; /* keeps columns consistent */\n}\n\n.table-container {\n    width: 100%;\n    overflow-x: auto;\n}\n\ntr {\n    width: 100vw !important;\n    display: table-row;\n}\n\n/* Ensure table cells stretch and wrap nicely */\nth, td {\n    border: 1px solid #d0d0e0;\n    padding: 0.7em;\n    text-align: left;\n    color: #444;\n    overflow-wrap: break-word;\n    width: auto;\n    min-width: 0;\n    max-width: none;\n    box-sizing: border-box;\n}\n\nthead {\n    background: #e9e9f3;\n}\n\ntr:nth-child(even) {\n    background: #f3f3fa;\n}\n\ntr:hover {\n    background: #e0e0f7;\n}\n\nbutton {\n    padding: 0.3em 1em;\n    border-radius: 5px;\n    border: none;\n    background: #5c7cfa;\n    color: #fff;\n    font-weight: bold;\n    cursor: pointer;\n    transition: background 0.2s;\n}\n\nbutton:disabled {\n    background: #ccc;\n    color: #888;\n    cursor: not-allowed;\n}\n\nbutton:hover:not(:disabled) {\n    background: #3b5bdb;\n}\n\ninput[type="text"] {\n    width: 90px;\n    padding: 0.3em;\n    border-radius: 4px;\n    border: 1px solid #bbb;\n    background: #f7f7fa;\n    font-size: 1em;\n}\n\n.driver-list {\n    max-width: 900px;\n    margin: 2em auto;\n    background: #fff;\n    border-radius: 12px;\n    box-shadow: 0 4px 24px rgba(60,80,180,0.08);\n    padding: 2em;\n    width: 100%;\n}\n\n.driver-row {\n    display: flex;\n    align-items: center;\n    padding: 1em 0.5em;\n    border-bottom: 1px solid #e0e0f7;\n    transition: background 0.2s;\n    width: 100%;\n    box-sizing: border-box;\n}\n\n.driver-row:last-child {\n    border-bottom: none;\n}\n\n.driver-row:hover {\n    background: #f3f3fa;\n}\n\n.status-indicator {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    border-radius: 50%;\n    margin-right: 1em;\n    border: 2px solid #bbb;\n}\n\n.status-online {\n    background: #4ad991;\n    border-color: #4ad991;\n}\n\n.status-offline {\n    background: #e05252;\n    border-color: #e05252;\n}\n\n.driver-name {\n    font-weight: bold;\n    color: #2c2c4c;\n    margin-right: 1em;\n    font-size: 1.1em;\n    min-width: 120px;\n}\n\n.driver-actions {\n    margin-left: auto;\n    display: flex;\n    gap: 0.5em;\n}\n\n.driver-status-text {\n    margin-right: 2em;\n    font-size: 1em;\n    color: #555;\n}\n\n/* Login styles */\n.osl-login-bg {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n}\n\n.osl-login-form {\n  background: #fff;\n  border-radius: 12px;\n  box-shadow: 0 4px 24px rgba(0,0,0,0.10);\n  padding: 36px 32px;\n  min-width: 320px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.osl-login-title {\n  font-size: 32px;\n  font-weight: 700;\n  color: #2196f3;\n  margin-bottom: 8px;\n  letter-spacing: 1px;\n}\n\n.osl-login-subtitle {\n  font-size: 16px;\n  color: #555;\n  margin-bottom: 24px;\n  letter-spacing: 1px;\n}\n\n.osl-login-error {\n  color: #e53935;\n  margin-bottom: 12px;\n}\n\n.osl-login-input {\n  margin-bottom: 12px;\n  padding: 10px 14px;\n  border-radius: 6px;\n  border: 1px solid #bbb;\n  width: 100%;\n  font-size: 16px;\n  box-sizing: border-box;\n  min-width: 220px;\n}\n\n.osl-login-input[type="text"],\n.osl-login-input[type="password"] {\n  width: 100%;\n  min-width: 220px;\n  box-sizing: border-box;\n  margin-bottom: 12px;\n  padding: 10px 14px;\n  border-radius: 6px;\n  border: 1px solid #bbb;\n  font-size: 16px;\n}\n\n.osl-login-btn {\n  background: #2196f3;\n  color: #fff;\n  border: none;\n  border-radius: 6px;\n  padding: 10px 0;\n  width: 100%;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  box-shadow: 0 2px 8px rgba(33,150,243,0.10);\n  transition: background 0.2s;\n}\n\n.osl-login-btn:disabled {\n  background: #90caf9;\n  cursor: not-allowed;\n}\n\n/* Top menu styles */\n.osl-topmenu {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 8px 12px;\n  border-bottom: 1px solid #ddd;\n  background: #f7f7f7;\n  position: relative;\n}\n\n.osl-topmenu-title {\n  font-weight: bold;\n  font-size: 18px;\n  letter-spacing: 1px;\n  color: #222;\n}\n\n.osl-topmenu-operations {\n  position: relative;\n}\n\n.osl-topmenu-operations-btn {\n  background: none;\n  border: none;\n  font-weight: bold;\n  font-size: 16px;\n  color: #111;\n  cursor: pointer;\n  padding: 4px 12px;\n}\n\n.osl-topmenu-dropdown {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  background: #fff;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n  z-index: 10;\n  min-width: 140px;\n}\n\n.osl-topmenu-dropdown-item {\n  padding: 8px 16px;\n  cursor: pointer;\n}\n\n.osl-topmenu-dropdown-item:hover {\n  background: #f0f0f0;\n}\n\n/* Editors bar on login */\n.osl-login-editors {\n  position: absolute;\n  top: 24px;\n  right: 36px;\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  z-index: 2;\n}\n\n.osl-login-editors-label {\n  font-weight: bold;\n  color: #222;\n  margin-right: 4px;\n}\n\n.osl-login-editors-link {\n  color: #1976d2;\n  text-decoration: underline;\n  font-weight: 500;\n  cursor: pointer;\n  transition: color 0.2s;\n}\n\n.osl-login-editors-link:hover {\n  color: #0d47a1;\n}\n\n/* in App.css or similar */\n.popup-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,0.4);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 10000;\n}\n\n.popup-overlay:empty {\n  display: none;\n  pointer-events: none;\n}\n\n.popup {\n  background: white;\n  padding: 1.5rem;\n  border-radius: 8px;\n  box-shadow: 0 0 12px rgba(0,0,0,0.3);\n}\n\n.leaflet-container {\n  height: calc(100vh - 120px) !important;\n  width: 100% !important;\n  border-radius: 8px;\n}\n\n.main-view {\n  display: grid;\n  grid-template-rows: 50% 50%;\n  height: calc(100vh - 100px);\n}\n\n.map-section, .image-section {\n  border: 1px solid #ccc;\n  overflow: hidden;\n}',""]);const o=a},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},927:(t,e,n)=>{"use strict";t.exports=n.p+"2b3e1faf89f94a483539.png"},961:(t,e,n)=>{"use strict";!function t(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(t){console.error(t)}}(),t.exports=n(551)},982:(t,e,n)=>{"use strict";t.exports=n(463)}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={id:i,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!t||!/^http(s?):/.test(t));)t=i[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document&&document.baseURI||self.location.href,n.nc=void 0,(()=>{"use strict";var t=n(540),e=n(338),i=n(72),r=n.n(i),s=n(825),a=n.n(s),o=n(659),l=n.n(o),u=n(56),c=n.n(u),h=n(159),d=n.n(h),f=n(113),p=n.n(f),m=n(626),g={};function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}g.styleTagTransform=p(),g.setAttributes=c(),g.insert=l().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=d(),r()(m.A,g),m.A&&m.A.locals&&m.A.locals;var _=(0,t.createContext)();function b(e){var n=e.children,i=v((0,t.useState)(function(){return localStorage.getItem("jwt_token")}),2),r=i[0],s=i[1],a=v((0,t.useState)(null),2),o=a[0],l=a[1];return t.createElement(_.Provider,{value:{token:r,user:o,login:function(t,e){s(t),l(e),localStorage.setItem("jwt_token",t)},logout:function(){s(null),l(null),localStorage.removeItem("jwt_token")},isAuthenticated:!!r}},n)}function E(){return(0,t.useContext)(_)}var T=n(250),S={};function D(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return w(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(w(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,w(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,w(h,"constructor",u),w(u,"constructor",l),l.displayName="GeneratorFunction",w(u,r,"GeneratorFunction"),w(h),w(h,r,"Generator"),w(h,i,function(){return this}),w(h,"toString",function(){return"[object Generator]"}),(D=function(){return{w:s,m:d}})()}function w(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}w=function(t,e,n,i){function s(e,n){w(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},w(t,e,n,i)}function L(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return A(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}S.styleTagTransform=p(),S.setAttributes=c(),S.insert=l().bind(null,"head"),S.domAPI=a(),S.insertStyleElement=d(),r()(T.A,S),T.A&&T.A.locals&&T.A.locals;var x=[{href:"/scada",label:"SCADA"},{href:"/security-editor",label:"Security Config"},{href:"/config-editor",label:"System Config"}];function C(e){var n,i=e.onLoginSuccess,r=e.loginEndpoint,s=void 0===r?"/security/login":r,a=e.redirectPath,o=void 0===a?"/":a,l=E().login,u=k((0,t.useState)(""),2),c=u[0],h=u[1],d=k((0,t.useState)(""),2),f=d[0],p=d[1],m=k((0,t.useState)(""),2),g=m[0],v=m[1],y=k((0,t.useState)(!1),2),_=y[0],b=y[1],T=(n=window.location.pathname).startsWith("/scada")?x.filter(function(t){return"/scada"!==t.href}):n.startsWith("/security-editor")?x.filter(function(t){return"/security-editor"!==t.href}):n.startsWith("/config-editor")?x.filter(function(t){return"/config-editor"!==t.href}):x,S=function(t){return t.startsWith("/scada")?"SCADA App":t.startsWith("/security-editor")?"Security configuration App":t.startsWith("/config-editor")?"System configuration App":"Open Scada Lite"}(window.location.pathname),w=function(t){return t.startsWith("/scada")?"scada":t.startsWith("/security-editor")?"security_editor":t.startsWith("/config-editor")?"config_editor":"unknown"}(window.location.pathname);function A(){var t;return t=D().m(function t(e){var n,r;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return e.preventDefault(),v(""),b(!0),t.p=1,t.n=2,fetch("".concat(s,"?app=").concat(w),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,password:f})});case 2:if((n=t.v).ok){t.n=3;break}throw new Error("Login failed");case 3:return t.n=4,n.json();case 4:r=t.v,l(r.token,r.user),b(!1),i?i():window.location.href=o,t.n=6;break;case 5:t.p=5,t.v,v("Invalid credentials"),b(!1);case 6:return t.a(2)}},t,null,[[1,5]])}),A=function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){L(s,i,r,a,o,"next",t)}function o(t){L(s,i,r,a,o,"throw",t)}a(void 0)})},A.apply(this,arguments)}return t.createElement("div",{className:"osl-login-bg"},t.createElement("div",{style:{position:"fixed",top:18,right:32,zIndex:100,display:"flex",gap:18,fontSize:15,fontWeight:500}},T.map(function(e){return t.createElement("a",{key:e.href,href:e.href,style:{color:"#333",textDecoration:"none",padding:"2px 10px",borderRadius:4,transition:"background 0.2s",background:"rgba(33,33,33,0.07)"},onMouseOver:function(t){return t.currentTarget.style.background="#eee"},onMouseOut:function(t){return t.currentTarget.style.background="rgba(33,33,33,0.07)"}},e.label)})),t.createElement("div",{className:"osl-login-box",style:{position:"relative"}},t.createElement("form",{className:"osl-login-form",onSubmit:function(t){return A.apply(this,arguments)}},t.createElement("div",{className:"osl-login-title"},"OSL"),t.createElement("div",{className:"osl-login-subtitle"},S),g&&t.createElement("div",{className:"osl-login-error"},g),t.createElement("input",{type:"text",placeholder:"Username",autoFocus:!0,value:c,onChange:function(t){return h(t.target.value)},className:"osl-login-input"}),t.createElement("input",{type:"password",placeholder:"Password",value:f,onChange:function(t){return p(t.target.value)},className:"osl-login-input"}),t.createElement("button",{type:"submit",disabled:_,className:"osl-login-btn"},_?"Signing in...":"Sign in"))))}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function P(){var e,n,i=(e=(0,t.useState)(!1),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(t,e){if(t){if("string"==typeof t)return I(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=i[0],s=i[1],a=(0,t.useRef)(),o=E().logout;return(0,t.useEffect)(function(){function t(t){a.current&&!a.current.contains(t.target)&&s(!1)}return r&&document.addEventListener("mousedown",t),function(){return document.removeEventListener("mousedown",t)}},[r]),t.createElement("div",{className:"osl-topmenu"},t.createElement("div",{className:"osl-topmenu-title"},"OSL Open Scada Lite"),t.createElement("div",{ref:a,className:"osl-topmenu-operations"},t.createElement("button",{className:"osl-topmenu-operations-btn",onClick:function(){return s(function(t){return!t})}},"Operations "),r&&t.createElement("div",{className:"osl-topmenu-dropdown"},t.createElement("div",{className:"osl-topmenu-dropdown-item",onClick:function(){s(!1),o(),window.location.href="/scada/login"}},"Logout"),t.createElement("div",{className:"osl-topmenu-dropdown-item",onClick:function(){s(!1),alert("OSL (Open Scada Lite)\nVersion 0.1.0\n 2025 Daniel&Hector Fernandez")}},"About"))))}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var M,F,N,B,U,$,z,G,j,H,V,K,W,Y,Z,q,X,Q={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},J={duration:.5,overwrite:!1,delay:0},tt=1e8,et=1e-8,nt=2*Math.PI,it=nt/4,rt=0,st=Math.sqrt,at=Math.cos,ot=Math.sin,lt=function(t){return"string"==typeof t},ut=function(t){return"function"==typeof t},ct=function(t){return"number"==typeof t},ht=function(t){return void 0===t},dt=function(t){return"object"==typeof t},ft=function(t){return!1!==t},pt=function(){return"undefined"!=typeof window},mt=function(t){return ut(t)||lt(t)},gt="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},vt=Array.isArray,yt=/(?:-?\.?\d|\.)+/gi,_t=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,bt=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Et=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Tt=/[+-]=-?[.\d]+/,St=/[^,'"\[\]\s]+/gi,Dt=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,wt={},Lt={},kt=function(t){return(Lt=ie(t,wt))&&ri},At=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},xt=function(t,e){return!e&&console.warn(t)},Ct=function(t,e){return t&&(wt[t]=e)&&Lt&&(Lt[t]=e)||wt},It=function(){return 0},Pt={suppressEvents:!0,isStart:!0,kill:!1},Rt={suppressEvents:!0,kill:!1},Ot={suppressEvents:!0},Mt={},Ft=[],Nt={},Bt={},Ut={},$t=30,zt=[],Gt="",jt=function(t){var e,n,i=t[0];if(dt(i)||ut(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=zt.length;n--&&!zt[n].targetTest(i););e=zt[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new yn(t[n],e)))||t.splice(n,1);return t},Ht=function(t){return t._gsap||jt(Oe(t))[0]._gsap},Vt=function(t,e,n){return(n=t[e])&&ut(n)?t[e]():ht(n)&&t.getAttribute&&t.getAttribute(e)||n},Kt=function(t,e){return(t=t.split(",")).forEach(e)||t},Wt=function(t){return Math.round(1e5*t)/1e5||0},Yt=function(t){return Math.round(1e7*t)/1e7||0},Zt=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+i:"-"===n?t-i:"*"===n?t*i:t/i},qt=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},Xt=function(){var t,e,n=Ft.length,i=Ft.slice(0);for(Nt={},Ft.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Qt=function(t){return!!(t._initted||t._startAt||t.add)},Jt=function(t,e,n,i){Ft.length&&!F&&Xt(),t.render(e,n,i||!!(F&&e<0&&Qt(t))),Ft.length&&!F&&Xt()},te=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(St).length<2?e:lt(t)?t.trim():t},ee=function(t){return t},ne=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},ie=function(t,e){for(var n in e)t[n]=e[n];return t},re=function t(e,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=dt(n[i])?t(e[i]||(e[i]={}),n[i]):n[i]);return e},se=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},ae=function(t){var e,n=t.parent||B,i=t.keyframes?(e=vt(t.keyframes),function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}):ne;if(ft(t.inherit))for(;n;)i(t,n.vars.defaults),n=n.parent||n._dp;return t},oe=function(t,e,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var s,a=t[i];if(r)for(s=e[r];a&&a[r]>s;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=a,e.parent=e._dp=t,e},le=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},ue=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},ce=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},he=function(t,e,n,i){return t._startAt&&(F?t._startAt.revert(Rt):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},de=function t(e){return!e||e._ts&&t(e.parent)},fe=function(t){return t._repeat?pe(t._tTime,t=t.duration()+t._rDelay)*t:0},pe=function(t,e){var n=Math.floor(t=Yt(t/e));return t&&n===t?n-1:n},me=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},ge=function(t){return t._end=Yt(t._start+(t._tDur/Math.abs(t._ts||t._rts||et)||0))},ve=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=Yt(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),ge(t),n._dirty||ce(n,t)),t},ye=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=me(t.rawTime(),e),(!e._dur||Ce(0,e.totalDuration(),n)-e._tTime>et)&&e.render(n,!0)),ce(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},_e=function(t,e,n,i){return e.parent&&ue(e),e._start=Yt((ct(n)?n:n||t!==B?ke(t,n,e):t._time)+e._delay),e._end=Yt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),oe(t,e,"_first","_last",t._sort?"_start":0),Se(e)||(t._recent=e),i||ye(t,e),t._ts<0&&ve(t,t._tTime),t},be=function(t,e){return(wt.ScrollTrigger||At("scrollTrigger",e))&&wt.ScrollTrigger.create(e,t)},Ee=function(t,e,n,i,r){return Ln(t,e,r),t._initted?!n&&t._pt&&!F&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&j!==sn.frame?(Ft.push(t),t._lazy=[r,i],1):void 0:1},Te=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},Se=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},De=function(t,e,n,i){var r=t._repeat,s=Yt(e)||0,a=t._tTime/t._tDur;return a&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:Yt(s*(r+1)+t._rDelay*r):s,a>0&&!i&&ve(t,t._tTime=t._tDur*a),t.parent&&ge(t),n||ce(t.parent,t),t},we=function(t){return t instanceof bn?ce(t):De(t,t._dur)},Le={_start:0,endTime:It,totalDuration:It},ke=function t(e,n,i){var r,s,a,o=e.labels,l=e._recent||Le,u=e.duration()>=tt?l.endTime(!1):e._dur;return lt(n)&&(isNaN(n)||n in o)?(s=n.charAt(0),a="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(r<0?l:i).totalDuration()/100:1)):r<0?(n in o||(o[n]=u),o[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),a&&i&&(s=s/100*(vt(i)?i[0]:i).totalDuration()),r>1?t(e,n.substr(0,r-1),i)+s:u+s)):null==n?u:+n},Ae=function(t,e,n){var i,r,s=ct(e[1]),a=(s?2:1)+(t<2?0:1),o=e[a];if(s&&(o.duration=e[1]),o.parent=n,t){for(i=o,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=ft(r.vars.inherit)&&r.parent;o.immediateRender=ft(i.immediateRender),t<2?o.runBackwards=1:o.startAt=e[a-1]}return new In(e[0],o,e[a+1])},xe=function(t,e){return t||0===t?e(t):e},Ce=function(t,e,n){return n<t?t:n>e?e:n},Ie=function(t,e){return lt(t)&&(e=Dt.exec(t))?e[1]:""},Pe=[].slice,Re=function(t,e){return t&&dt(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&dt(t[0]))&&!t.nodeType&&t!==U},Oe=function(t,e,n){return N&&!e&&N.selector?N.selector(t):!lt(t)||n||!$&&an()?vt(t)?function(t,e,n){return void 0===n&&(n=[]),t.forEach(function(t){var i;return lt(t)&&!e||Re(t,1)?(i=n).push.apply(i,Oe(t)):n.push(t)})||n}(t,n):Re(t)?Pe.call(t,0):t?[t]:[]:Pe.call((e||z).querySelectorAll(t),0)},Me=function(t){return t=Oe(t)[0]||xt("Invalid scope")||{},function(e){var n=t.current||t.nativeElement||t;return Oe(e,n.querySelectorAll?n:n===t?xt("Invalid scope")||z.createElement("div"):t)}},Fe=function(t){return t.sort(function(){return.5-Math.random()})},Ne=function(t){if(ut(t))return t;var e=dt(t)?t:{each:t},n=fn(e.ease),i=e.from||0,r=parseFloat(e.base)||0,s={},a=i>0&&i<1,o=isNaN(i)||a,l=e.axis,u=i,c=i;return lt(i)?u=c={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(u=i[0],c=i[1]),function(t,a,h){var d,f,p,m,g,v,y,_,b,E=(h||e).length,T=s[E];if(!T){if(!(b="auto"===e.grid?0:(e.grid||[1,tt])[1])){for(y=-tt;y<(y=h[b++].getBoundingClientRect().left)&&b<E;);b<E&&b--}for(T=s[E]=[],d=o?Math.min(b,E)*u-.5:i%b,f=b===tt?0:o?E*c/b-.5:i/b|0,y=0,_=tt,v=0;v<E;v++)p=v%b-d,m=f-(v/b|0),T[v]=g=l?Math.abs("y"===l?m:p):st(p*p+m*m),g>y&&(y=g),g<_&&(_=g);"random"===i&&Fe(T),T.max=y-_,T.min=_,T.v=E=(parseFloat(e.amount)||parseFloat(e.each)*(b>E?E-1:l?"y"===l?E/b:b:Math.max(b,E/b))||0)*("edges"===i?-1:1),T.b=E<0?r-E:r,T.u=Ie(e.amount||e.each)||0,n=n&&E<0?hn(n):n}return E=(T[t]-T.min)/T.max||0,Yt(T.b+(n?n(E):E)*T.v)+T.u}},Be=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=Yt(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(ct(n)?0:Ie(n))}},Ue=function(t,e){var n,i,r=vt(t);return!r&&dt(t)&&(n=r=t.radius||tt,t.values?(t=Oe(t.values),(i=!ct(t[0]))&&(n*=n)):t=Be(t.increment)),xe(e,r?ut(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,s,a=parseFloat(i?e.x:e),o=parseFloat(i?e.y:0),l=tt,u=0,c=t.length;c--;)(r=i?(r=t[c].x-a)*r+(s=t[c].y-o)*s:Math.abs(t[c]-a))<l&&(l=r,u=c);return u=!n||l<=n?t[u]:e,i||u===e||ct(e)?u:u+Ie(e)}:Be(t))},$e=function(t,e,n,i){return xe(vt(t)?!e:!0===n?!!(n=0):!i,function(){return vt(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i})},ze=function(t,e,n){return xe(n,function(n){return t[~~e(n)]})},Ge=function(t){for(var e,n,i,r,s=0,a="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?St:yt),a+=t.substr(s,e-s)+$e(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return a+t.substr(s,t.length-s)},je=function(t,e,n,i,r){var s=e-t,a=i-n;return xe(r,function(e){return n+((e-t)/s*a||0)})},He=function(t,e,n){var i,r,s,a=t.labels,o=tt;for(i in a)(r=a[i]-e)<0==!!n&&r&&o>(r=Math.abs(r))&&(s=i,o=r);return s},Ve=function(t,e,n){var i,r,s,a=t.vars,o=a[e],l=N,u=t._ctx;if(o)return i=a[e+"Params"],r=a.callbackScope||t,n&&Ft.length&&Xt(),u&&(N=u),s=i?o.apply(r,i):o.call(r),N=l,s},Ke=function(t){return ue(t),t.scrollTrigger&&t.scrollTrigger.kill(!!F),t.progress()<1&&Ve(t,"onInterrupt"),t},We=[],Ye=function(t){if(t)if(t=!t.name&&t.default||t,pt()||t.headless){var e=t.name,n=ut(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:It,render:$n,add:Dn,kill:Gn,modifier:zn,rawVars:0},s={targetTest:0,get:0,getSetter:Fn,aliases:{},register:0};if(an(),t!==i){if(Bt[e])return;ne(i,ne(se(t,r),s)),ie(i.prototype,ie(r,se(t,s))),Bt[i.prop=e]=i,t.targetTest&&(zt.push(i),Mt[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}Ct(e,i),t.register&&t.register(ri,i,Vn)}else We.push(t)},Ze=255,qe={aqua:[0,Ze,Ze],lime:[0,Ze,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ze],navy:[0,0,128],white:[Ze,Ze,Ze],olive:[128,128,0],yellow:[Ze,Ze,0],orange:[Ze,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ze,0,0],pink:[Ze,192,203],cyan:[0,Ze,Ze],transparent:[Ze,Ze,Ze,0]},Xe=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*Ze+.5|0},Qe=function(t,e,n){var i,r,s,a,o,l,u,c,h,d,f=t?ct(t)?[t>>16,t>>8&Ze,t&Ze]:0:qe.black;if(!f){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),qe[t])f=qe[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),r=t.charAt(2),s=t.charAt(3),t="#"+i+i+r+r+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(f=parseInt(t.substr(1,6),16))>>16,f>>8&Ze,f&Ze,parseInt(t.substr(7),16)/255];f=[(t=parseInt(t.substr(1),16))>>16,t>>8&Ze,t&Ze]}else if("hsl"===t.substr(0,3))if(f=d=t.match(yt),e){if(~t.indexOf("="))return f=t.match(_t),n&&f.length<4&&(f[3]=1),f}else a=+f[0]%360/360,o=+f[1]/100,i=2*(l=+f[2]/100)-(r=l<=.5?l*(o+1):l+o-l*o),f.length>3&&(f[3]*=1),f[0]=Xe(a+1/3,i,r),f[1]=Xe(a,i,r),f[2]=Xe(a-1/3,i,r);else f=t.match(yt)||qe.transparent;f=f.map(Number)}return e&&!d&&(i=f[0]/Ze,r=f[1]/Ze,s=f[2]/Ze,l=((u=Math.max(i,r,s))+(c=Math.min(i,r,s)))/2,u===c?a=o=0:(h=u-c,o=l>.5?h/(2-u-c):h/(u+c),a=u===i?(r-s)/h+(r<s?6:0):u===r?(s-i)/h+2:(i-r)/h+4,a*=60),f[0]=~~(a+.5),f[1]=~~(100*o+.5),f[2]=~~(100*l+.5)),n&&f.length<4&&(f[3]=1),f},Je=function(t){var e=[],n=[],i=-1;return t.split(en).forEach(function(t){var r=t.match(bt)||[];e.push.apply(e,r),n.push(i+=r.length+1)}),e.c=n,e},tn=function(t,e,n){var i,r,s,a,o="",l=(t+o).match(en),u=e?"hsla(":"rgba(",c=0;if(!l)return t;if(l=l.map(function(t){return(t=Qe(t,e,1))&&u+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"}),n&&(s=Je(t),(i=n.c).join(o)!==s.c.join(o)))for(a=(r=t.replace(en,"1").split(bt)).length-1;c<a;c++)o+=r[c]+(~i.indexOf(c)?l.shift()||u+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(a=(r=t.split(en)).length-1;c<a;c++)o+=r[c]+l[c];return o+r[a]},en=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in qe)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),nn=/hsl[a]?\(/,rn=function(t){var e,n=t.join(" ");if(en.lastIndex=0,en.test(n))return e=nn.test(n),t[1]=tn(t[1],e),t[0]=tn(t[0],e,Je(t[1])),!0},sn=function(){var t,e,n,i,r,s,a=Date.now,o=500,l=33,u=a(),c=u,h=1e3/240,d=h,f=[],p=function n(p){var m,g,v,y,_=a()-c,b=!0===p;if((_>o||_<0)&&(u+=_-l),((m=(v=(c+=_)-u)-d)>0||b)&&(y=++i.frame,r=v-1e3*i.time,i.time=v/=1e3,d+=m+(m>=h?4:h-m),g=1),b||(t=e(n)),g)for(s=0;s<f.length;s++)f[s](v,r,y,p)};return i={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(t){return r/(1e3/(t||60))},wake:function(){G&&(!$&&pt()&&(U=$=window,z=U.document||{},wt.gsap=ri,(U.gsapVersions||(U.gsapVersions=[])).push(ri.version),kt(Lt||U.GreenSockGlobals||!U.gsap&&U||{}),We.forEach(Ye)),n="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,t&&i.sleep(),e=n||function(t){return setTimeout(t,d-1e3*i.time+1|0)},V=1,p(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(t),V=0,e=It},lagSmoothing:function(t,e){o=t||1/0,l=Math.min(e||33,o)},fps:function(t){h=1e3/(t||240),d=1e3*i.time+h},add:function(t,e,n){var r=e?function(e,n,s,a){t(e,n,s,a),i.remove(r)}:t;return i.remove(t),f[n?"unshift":"push"](r),an(),r},remove:function(t,e){~(e=f.indexOf(t))&&f.splice(e,1)&&s>=e&&s--},_listeners:f}}(),an=function(){return!V&&sn.wake()},on={},ln=/^[\d.\-M][\d.\-,\s]/,un=/["']/g,cn=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),a=s[0],o=1,l=s.length;o<l;o++)n=s[o],e=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[a]=isNaN(i)?i.replace(un,"").trim():+i,a=n.substr(e+1).trim();return r},hn=function(t){return function(e){return 1-t(1-e)}},dn=function t(e,n){for(var i,r=e._first;r;)r instanceof bn?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},fn=function(t,e){return t&&(ut(t)?t:on[t]||function(t){var e,n,i,r,s=(t+"").split("("),a=on[s[0]];return a&&s.length>1&&a.config?a.config.apply(null,~t.indexOf("{")?[cn(s[1])]:(e=t,n=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",n),e.substring(n,~r&&r<i?e.indexOf(")",i+1):i)).split(",").map(te)):on._CE&&ln.test(t)?on._CE("",t):a}(t))||e},pn=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return Kt(t,function(t){for(var e in on[t]=wt[t]=s,on[r=t.toLowerCase()]=n,s)on[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=on[t+"."+e]=s[e]}),s},mn=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},gn=function t(e,n,i){var r=n>=1?n:1,s=(i||(e?.3:.45))/(n<1?n:1),a=s/nt*(Math.asin(1/r)||0),o=function(t){return 1===t?1:r*Math.pow(2,-10*t)*ot((t-a)*s)+1},l="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:mn(o);return s=nt/s,l.config=function(n,i){return t(e,n,i)},l},vn=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:mn(i);return r.config=function(n){return t(e,n)},r};Kt("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var n=e<5?e+1:e;pn(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},function(t){return 1-Math.pow(1-t,n)},function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2})}),on.Linear.easeNone=on.none=on.Linear.easeIn,pn("Elastic",gn("in"),gn("out"),gn()),K=7.5625,Z=2*(Y=1/(W=2.75)),q=2.5*Y,pn("Bounce",function(t){return 1-X(1-t)},X=function(t){return t<Y?K*t*t:t<Z?K*Math.pow(t-1.5/W,2)+.75:t<q?K*(t-=2.25/W)*t+.9375:K*Math.pow(t-2.625/W,2)+.984375}),pn("Expo",function(t){return Math.pow(2,10*(t-1))*t+t*t*t*t*t*t*(1-t)}),pn("Circ",function(t){return-(st(1-t*t)-1)}),pn("Sine",function(t){return 1===t?1:1-at(t*it)}),pn("Back",vn("in"),vn("out"),vn()),on.SteppedEase=on.steps=wt.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*Ce(0,.99999999,t)|0)+r)*n}}},J.ease=on["quad.out"],Kt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return Gt+=t+","+t+"Params,"});var yn=function(t,e){this.id=rt++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:Vt,this.set=e?e.getSetter:Fn},_n=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,De(this,+t.duration,1,1),this.data=t.data,N&&(this._ctx=N,N.data.push(this)),V||sn.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,De(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(an(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(ve(this,t),!n._dp||n.parent||ye(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&_e(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===et||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Jt(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+fe(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+fe(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?pe(this._tTime,n)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var n=this.parent&&this._ts?me(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(Ce(-Math.abs(this._delay),this.totalDuration(),n),!1!==e),ge(this),function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(an(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==et&&(this._tTime-=et)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&_e(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(ft(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?me(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=Ot);var e=F;return F=t,Qt(this)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),F=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,we(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,we(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(ke(this,t),ft(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,ft(e)),this._dur||(this._zTime=-1e-8),this},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-et))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise(function(n){var i=ut(t)?t:ee,r=function(){var t=e.then;e.then=null,ut(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r})},e.kill=function(){Ke(this)},t}();ne(_n.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var bn=function(t){function e(e,n){var i;return void 0===e&&(e={}),(i=t.call(this,e)||this).labels={},i.smoothChildTiming=!!e.smoothChildTiming,i.autoRemoveChildren=!!e.autoRemoveChildren,i._sort=ft(e.sortChildren),B&&_e(e.parent||B,R(i),n),e.reversed&&i.reverse(),e.paused&&i.paused(!0),e.scrollTrigger&&be(R(i),e.scrollTrigger),i}O(e,t);var n=e.prototype;return n.to=function(t,e,n){return Ae(0,arguments,this),this},n.from=function(t,e,n){return Ae(1,arguments,this),this},n.fromTo=function(t,e,n,i){return Ae(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,ae(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new In(t,e,ke(this,n),1),this},n.call=function(t,e,n){return _e(this,In.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,i,r,s,a){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=a,n.parent=this,new In(t,n,ke(this,r)),this},n.staggerFrom=function(t,e,n,i,r,s,a){return n.runBackwards=1,ae(n).immediateRender=ft(n.immediateRender),this.staggerTo(t,e,n,i,r,s,a)},n.staggerFromTo=function(t,e,n,i,r,s,a,o){return i.startAt=n,ae(i).immediateRender=ft(i.immediateRender),this.staggerTo(t,e,i,r,s,a,o)},n.render=function(t,e,n){var i,r,s,a,o,l,u,c,h,d,f,p,m=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=t<=0?0:Yt(t),_=this._zTime<0!=t<0&&(this._initted||!v);if(this!==B&&y>g&&t>=0&&(y=g),y!==this._tTime||n||_){if(m!==this._time&&v&&(y+=this._time-m,t+=this._time-m),i=y,h=this._start,l=!(c=this._ts),_&&(v||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(f=this._yoyo,o=v+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(i=Yt(y%o),y===g?(a=this._repeat,i=v):((a=~~(d=Yt(y/o)))&&a===d&&(i=v,a--),i>v&&(i=v)),d=pe(this._tTime,o),!m&&this._tTime&&d!==a&&this._tTime-d*o-this._dur<=0&&(d=a),f&&1&a&&(i=v-i,p=1),a!==d&&!this._lock){var b=f&&1&d,E=b===(f&&1&a);if(a<d&&(b=!b),m=b?0:y%v?v:y,this._lock=1,this.render(m||(p?0:Yt(a*o)),e,!v)._lock=0,this._tTime=y,!e&&this.parent&&Ve(this,"onRepeat"),this.vars.repeatRefresh&&!p&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,E&&(this._lock=2,m=b?v:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!p&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;dn(this,p)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(u=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,Yt(m),Yt(i)),u&&(y-=i-(i=u._start))),this._tTime=y,this._time=i,this._act=!c,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&y&&!e&&!d&&(Ve(this,"onStart"),this._tTime!==y))return this;if(i>=m&&t>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&u!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!l){u=0,s&&(y+=this._zTime=-1e-8);break}}r=s}else{r=this._last;for(var T=t<0?t:i;r;){if(s=r._prev,(r._act||T<=r._end)&&r._ts&&u!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(T-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(T-r._start)*r._ts,e,n||F&&Qt(r)),i!==this._time||!this._ts&&!l){u=0,s&&(y+=this._zTime=T?-1e-8:et);break}}r=s}}if(u&&!e&&(this.pause(),u.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=h,ge(this),this.render(t,e,n);this._onUpdate&&!e&&Ve(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&m)&&(h!==this._start&&Math.abs(c)===Math.abs(this._ts)||this._lock||((t||!v)&&(y===g&&this._ts>0||!y&&this._ts<0)&&ue(this,1),e||t<0&&!m||!y&&!m&&g||(Ve(this,y===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(ct(e)||(e=ke(this,e,t)),!(t instanceof _n)){if(vt(t))return t.forEach(function(t){return n.add(t,e)}),this;if(lt(t))return this.addLabel(t,e);if(!ut(t))return this;t=In.delayedCall(0,t)}return this!==t?_e(this,t,e):this},n.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-tt);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof In?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return lt(t)?this.removeLabel(t):ut(t)?this.killTweensOf(t):(t.parent===this&&le(this,t),t===this._recent&&(this._recent=this._last),ce(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Yt(sn.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=ke(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var i=In.delayedCall(0,e||It,n);return i.data="isPause",this._hasPause=1,_e(this,i,ke(this,t))},n.removePause=function(t){var e=this._first;for(t=ke(this,t);e;)e._start===t&&"isPause"===e.data&&ue(e),e=e._next},n.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)En!==i[r]&&i[r].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,i=[],r=Oe(t),s=this._first,a=ct(e);s;)s instanceof In?qt(s._targets,r)&&(a?(!En||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(t,e){e=e||{};var n,i=this,r=ke(i,t),s=e,a=s.startAt,o=s.onStart,l=s.onStartParams,u=s.immediateRender,c=In.to(i,ne({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale())||et,onStart:function(){if(i.pause(),!n){var t=e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale());c._dur!==t&&De(c,t,0,1).render(c._time,!0,!0),n=1}o&&o.apply(c,l||[])}},e));return u?c.render(0):c},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,ne({startAt:{time:ke(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),He(this,ke(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),He(this,ke(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+et)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return ce(this)},n.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),ce(this)},n.totalDuration=function(t){var e,n,i,r=0,s=this,a=s._last,o=tt;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&s._sort&&a._ts&&!s._lock?(s._lock=1,_e(s,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),o=0),a._end>r&&a._ts&&(r=a._end),a=e;De(s,s===B&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(B._ts&&(Jt(B,me(t,B)),j=sn.frame),sn.frame>=$t){$t+=Q.autoSleep||120;var e=B._first;if((!e||!e._ts)&&Q.autoSleep&&sn._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||sn.sleep()}}},e}(_n);ne(bn.prototype,{_lock:0,_hasPause:0,_forcing:0});var En,Tn,Sn=function(t,e,n,i,r,s,a){var o,l,u,c,h,d,f,p,m=new Vn(this._pt,t,e,0,1,Un,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(f=~(i+="").indexOf("random("))&&(i=Ge(i)),s&&(s(p=[n,i],t,e),n=p[0],i=p[1]),l=n.match(Et)||[];o=Et.exec(i);)c=o[0],h=i.substring(g,o.index),u?u=(u+1)%5:"rgba("===h.substr(-5)&&(u=1),c!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:h||1===v?h:",",s:d,c:"="===c.charAt(1)?Zt(d,c)-d:parseFloat(c)-d,m:u&&u<4?Math.round:0},g=Et.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=a,(Tt.test(i)||f)&&(m.e=0),this._pt=m,m},Dn=function(t,e,n,i,r,s,a,o,l,u){ut(i)&&(i=i(r||0,t,s));var c,h=t[e],d="get"!==n?n:ut(h)?l?t[e.indexOf("set")||!ut(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():h,f=ut(h)?l?On:Rn:Pn;if(lt(i)&&(~i.indexOf("random(")&&(i=Ge(i)),"="===i.charAt(1)&&((c=Zt(d,i)+(Ie(d)||0))||0===c)&&(i=c)),!u||d!==i||Tn)return isNaN(d*i)||""===i?(!h&&!(e in t)&&At(e,i),Sn.call(this,t,e,d,i,f,o||Q.stringFilter,l)):(c=new Vn(this._pt,t,e,+d||0,i-(d||0),"boolean"==typeof h?Bn:Nn,0,f),l&&(c.fp=l),a&&c.modifier(a,this,t),this._pt=c)},wn=function(t,e,n,i,r,s){var a,o,l,u;if(Bt[t]&&!1!==(a=new Bt[t]).init(r,a.rawVars?e[t]:function(t,e,n,i,r){if(ut(t)&&(t=An(t,r,e,n,i)),!dt(t)||t.style&&t.nodeType||vt(t)||gt(t))return lt(t)?An(t,r,e,n,i):t;var s,a={};for(s in t)a[s]=An(t[s],r,e,n,i);return a}(e[t],i,r,s,n),n,i,s)&&(n._pt=o=new Vn(n._pt,r,t,0,1,a.render,a,0,a.priority),n!==H))for(l=n._ptLookup[n._targets.indexOf(r)],u=a._props.length;u--;)l[a._props[u]]=o;return a},Ln=function t(e,n,i){var r,s,a,o,l,u,c,h,d,f,p,m,g,v=e.vars,y=v.ease,_=v.startAt,b=v.immediateRender,E=v.lazy,T=v.onUpdate,S=v.runBackwards,D=v.yoyoEase,w=v.keyframes,L=v.autoRevert,k=e._dur,A=e._startAt,x=e._targets,C=e.parent,I=C&&"nested"===C.data?C.vars.targets:x,P="auto"===e._overwrite&&!M,R=e.timeline;if(R&&(!w||!y)&&(y="none"),e._ease=fn(y,J.ease),e._yEase=D?hn(fn(!0===D?y:D,J.ease)):0,D&&e._yoyo&&!e._repeat&&(D=e._yEase,e._yEase=e._ease,e._ease=D),e._from=!R&&!!v.runBackwards,!R||w&&!v.stagger){if(m=(h=x[0]?Ht(x[0]).harness:0)&&v[h.prop],r=se(v,Mt),A&&(A._zTime<0&&A.progress(1),n<0&&S&&b&&!L?A.render(-1,!0):A.revert(S&&k?Rt:Pt),A._lazy=0),_){if(ue(e._startAt=In.set(x,ne({data:"isStart",overwrite:!1,parent:C,immediateRender:!0,lazy:!A&&ft(E),startAt:null,delay:0,onUpdate:T&&function(){return Ve(e,"onUpdate")},stagger:0},_))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(F||!b&&!L)&&e._startAt.revert(Rt),b&&k&&n<=0&&i<=0)return void(n&&(e._zTime=n))}else if(S&&k&&!A)if(n&&(b=!1),a=ne({overwrite:!1,data:"isFromStart",lazy:b&&!A&&ft(E),immediateRender:b,stagger:0,parent:C},r),m&&(a[h.prop]=m),ue(e._startAt=In.set(x,a)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(F?e._startAt.revert(Rt):e._startAt.render(-1,!0)),e._zTime=n,b){if(!n)return}else t(e._startAt,et,et);for(e._pt=e._ptCache=0,E=k&&ft(E)||E&&!k,s=0;s<x.length;s++){if(c=(l=x[s])._gsap||jt(x)[s]._gsap,e._ptLookup[s]=f={},Nt[c.id]&&Ft.length&&Xt(),p=I===x?s:I.indexOf(l),h&&!1!==(d=new h).init(l,m||r,e,p,I)&&(e._pt=o=new Vn(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(t){f[t]=o}),d.priority&&(u=1)),!h||m)for(a in r)Bt[a]&&(d=wn(a,r,e,p,l,I))?d.priority&&(u=1):f[a]=o=Dn.call(e,l,a,"get",r[a],p,I,0,v.stringFilter);e._op&&e._op[s]&&e.kill(l,e._op[s]),P&&e._pt&&(En=e,B.killTweensOf(l,f,e.globalTime(n)),g=!e.parent,En=0),e._pt&&E&&(Nt[c.id]=1)}u&&Hn(e),e._onInit&&e._onInit(e)}e._onUpdate=T,e._initted=(!e._op||e._pt)&&!g,w&&n<=0&&R.render(tt,!0,!0)},kn=function(t,e,n,i){var r,s,a=e.ease||i||"power1.inOut";if(vt(e))s=n[t]||(n[t]=[]),e.forEach(function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:a})});else for(r in e)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(t),v:e[r],e:a})},An=function(t,e,n,i,r){return ut(t)?t.call(e,n,i,r):lt(t)&&~t.indexOf("random(")?Ge(t):t},xn=Gt+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Cn={};Kt(xn+",id,stagger,delay,duration,paused,scrollTrigger",function(t){return Cn[t]=1});var In=function(t){function e(e,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,o,l,u,c,h,d,f,p=(s=t.call(this,r?n:ae(n))||this).vars,m=p.duration,g=p.delay,v=p.immediateRender,y=p.stagger,_=p.overwrite,b=p.keyframes,E=p.defaults,T=p.scrollTrigger,S=p.yoyoEase,D=n.parent||B,w=(vt(e)||gt(e)?ct(e[0]):"length"in n)?[e]:Oe(e);if(s._targets=w.length?jt(w):xt("GSAP target "+e+" not found. https://gsap.com",!Q.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=_,b||y||mt(m)||mt(g)){if(n=s.vars,(a=s.timeline=new bn({data:"nested",defaults:E||{},targets:D&&"nested"===D.data?D.vars.targets:w})).kill(),a.parent=a._dp=R(s),a._start=0,y||mt(m)||mt(g)){if(u=w.length,d=y&&Ne(y),dt(y))for(c in y)~xn.indexOf(c)&&(f||(f={}),f[c]=y[c]);for(o=0;o<u;o++)(l=se(n,Cn)).stagger=0,S&&(l.yoyoEase=S),f&&ie(l,f),h=w[o],l.duration=+An(m,R(s),o,h,w),l.delay=(+An(g,R(s),o,h,w)||0)-s._delay,!y&&1===u&&l.delay&&(s._delay=g=l.delay,s._start+=g,l.delay=0),a.to(h,l,d?d(o,h,w):0),a._ease=on.none;a.duration()?m=g=0:s.timeline=0}else if(b){ae(ne(a.vars.defaults,{ease:"none"})),a._ease=fn(b.ease||n.ease||"none");var L,k,A,x=0;if(vt(b))b.forEach(function(t){return a.to(w,t,">")}),a.duration();else{for(c in l={},b)"ease"===c||"easeEach"===c||kn(c,b[c],l,b.easeEach);for(c in l)for(L=l[c].sort(function(t,e){return t.t-e.t}),x=0,o=0;o<L.length;o++)(A={ease:(k=L[o]).e,duration:(k.t-(o?L[o-1].t:0))/100*m})[c]=k.v,a.to(w,A,x),x+=A.duration;a.duration()<m&&a.to({},{duration:m-a.duration()})}}m||s.duration(m=a.duration())}else s.timeline=0;return!0!==_||M||(En=R(s),B.killTweensOf(w),En=0),_e(D,R(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(v||!m&&!b&&s._start===Yt(D._time)&&ft(v)&&de(R(s))&&"nested"!==D.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-g)||0)),T&&be(R(s),T),s}O(e,t);var n=e.prototype;return n.render=function(t,e,n){var i,r,s,a,o,l,u,c,h,d=this._time,f=this._tDur,p=this._dur,m=t<0,g=t>f-et&&!m?f:t<et?0:t;if(p){if(g!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m||this._lazy){if(i=g,c=this.timeline,this._repeat){if(a=p+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*a+t,e,n);if(i=Yt(g%a),g===f?(s=this._repeat,i=p):(s=~~(o=Yt(g/a)))&&s===o?(i=p,s--):i>p&&(i=p),(l=this._yoyo&&1&s)&&(h=this._yEase,i=p-i),o=pe(this._tTime,a),i===d&&!n&&this._initted&&s===o)return this._tTime=g,this;s!==o&&(c&&this._yEase&&dn(c,l),this.vars.repeatRefresh&&!l&&!this._lock&&i!==a&&this._initted&&(this._lock=n=1,this.render(Yt(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(Ee(this,m?t:i,n,e,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==o))return this;if(p!==this._dur)return this.render(t,e,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(h||this._ease)(i/p),this._from&&(this.ratio=u=1-u),!d&&g&&!e&&!o&&(Ve(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(u,r.d),r=r._next;c&&c.render(t<0?t:c._dur*c._ease(i/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&he(this,t,0,n),Ve(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!e&&this.parent&&Ve(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&he(this,t,0,!0),(t||!p)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&ue(this,1),e||m&&!d||!(g||d||l)||(Ve(this,g===f?"onComplete":"onReverseComplete",!0),this._prom&&!(g<f&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var r,s,a,o=t.ratio,l=e<0||!e&&(!t._start&&Te(t)&&(t._initted||!Se(t))||(t._ts<0||t._dp._ts<0)&&!Se(t))?0:1,u=t._rDelay,c=0;if(u&&t._repeat&&(c=Ce(0,t._tDur,e),s=pe(c,u),t._yoyo&&1&s&&(l=1-l),s!==pe(t._tTime,u)&&(o=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==o||F||i||t._zTime===et||!e&&t._zTime){if(!t._initted&&Ee(t,e,i,n,c))return;for(a=t._zTime,t._zTime=e||(n?et:0),n||(n=e&&!a),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=c,r=t._pt;r;)r.r(l,r.d),r=r._next;e<0&&he(t,e,0,!0),t._onUpdate&&!n&&Ve(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&Ve(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&ue(t,1),n||F||(Ve(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},n.resetTo=function(t,e,n,i,r){V||sn.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||Ln(this,s),function(t,e,n,i,r,s,a,o){var l,u,c,h,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],c=t._ptLookup,h=t._targets.length;h--;){if((l=c[h][e])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return Tn=1,t.vars[e]="+=0",Ln(t,a),Tn=0,o?xt(e+" not eligible for reset"):1;d.push(l)}for(h=d.length;h--;)(l=(u=d[h])._pt||u).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,u.e&&(u.e=Wt(n)+Ie(u.e)),u.b&&(u.b=l.s+Ie(u.b))}(this,t,e,n,i,this._ease(s/this._dur),s,r)?this.resetTo(t,e,n,i,1):(ve(this,0),this.parent||oe(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?Ke(this):this.scrollTrigger&&this.scrollTrigger.kill(!!F),this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,En&&!0!==En.vars.overwrite)._first||Ke(this),this.parent&&n!==this.timeline.totalDuration()&&De(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,a,o,l,u,c=this._targets,h=t?Oe(t):c,d=this._ptLookup,f=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(c,h))return"all"===e&&(this._pt=0),Ke(this);for(i=this._op=this._op||[],"all"!==e&&(lt(e)&&(o={},Kt(e,function(t){return o[t]=1}),e=o),e=function(t,e){var n,i,r,s,a=t[0]?Ht(t[0]).harness:0,o=a&&a.aliases;if(!o)return e;for(i in n=ie({},e),o)if(i in n)for(r=(s=o[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(c,e)),u=c.length;u--;)if(~h.indexOf(c[u]))for(o in r=d[u],"all"===e?(i[u]=e,a=r,s={}):(s=i[u]=i[u]||{},a=e),a)(l=r&&r[o])&&("kill"in l.d&&!0!==l.d.kill(o)||le(this,l,"_pt"),delete r[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&f&&Ke(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return Ae(1,arguments)},e.delayedCall=function(t,n,i,r){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},e.fromTo=function(t,e,n){return Ae(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return B.killTweensOf(t,e,n)},e}(_n);ne(In.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Kt("staggerTo,staggerFrom,staggerFromTo",function(t){In[t]=function(){var e=new bn,n=Pe.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}});var Pn=function(t,e,n){return t[e]=n},Rn=function(t,e,n){return t[e](n)},On=function(t,e,n,i){return t[e](i.fp,n)},Mn=function(t,e,n){return t.setAttribute(e,n)},Fn=function(t,e){return ut(t[e])?Rn:ht(t[e])&&t.setAttribute?Mn:Pn},Nn=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},Bn=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},Un=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},$n=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},zn=function(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r},Gn=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?le(this,i,"_pt"):i.dep||(e=1),i=n;return!e},jn=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},Hn=function(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i},Vn=function(){function t(t,e,n,i,r,s,a,o,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||Nn,this.d=a||this,this.set=o||Pn,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=jn,this.m=t,this.mt=n,this.tween=e},t}();Kt(Gt+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return Mt[t]=1}),wt.TweenMax=wt.TweenLite=In,wt.TimelineLite=wt.TimelineMax=bn,B=new bn({sortChildren:!1,defaults:J,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Q.stringFilter=rn;var Kn=[],Wn={},Yn=[],Zn=0,qn=0,Xn=function(t){return(Wn[t]||Yn).map(function(t){return t()})},Qn=function(){var t=Date.now(),e=[];t-Zn>2&&(Xn("matchMediaInit"),Kn.forEach(function(t){var n,i,r,s,a=t.queries,o=t.conditions;for(i in a)(n=U.matchMedia(a[i]).matches)&&(r=1),n!==o[i]&&(o[i]=n,s=1);s&&(t.revert(),r&&e.push(t))}),Xn("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(e){return t.add(null,e)})}),Zn=t,Xn("matchMedia"))},Jn=function(){function t(t,e){this.selector=e&&Me(e),this.data=[],this._r=[],this.isReverted=!1,this.id=qn++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){ut(t)&&(n=e,e=t,t=ut);var i=this,r=function(){var t,r=N,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=Me(n)),N=i,t=e.apply(i,arguments),ut(t)&&i._r.push(t),N=r,i.selector=s,i.isReverted=!1,t};return i.last=r,t===ut?r(i,function(t){return i.add(null,t)}):t?i[t]=r:r},e.ignore=function(t){var e=N;N=null,t(this),N=e},e.getTweens=function(){var e=[];return this.data.forEach(function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof In&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)}),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t?function(){for(var e,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(e=n.data[r]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach(function(t){return i.splice(i.indexOf(t),1)}));for(i.map(function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t}}).sort(function(t,e){return e.g-t.g||-1/0}).forEach(function(e){return e.t.revert(t)}),r=n.data.length;r--;)(e=n.data[r])instanceof bn?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof In)&&e.revert&&e.revert(t);n._r.forEach(function(e){return e(t,n)}),n.isReverted=!0}():this.data.forEach(function(t){return t.kill&&t.kill()}),this.clear(),e)for(var i=Kn.length;i--;)Kn[i].id===this.id&&Kn.splice(i,1)},e.revert=function(t){this.kill(t||{})},t}(),ti=function(){function t(t){this.contexts=[],this.scope=t,N&&N.data.push(this)}var e=t.prototype;return e.add=function(t,e,n){dt(t)||(t={matches:t});var i,r,s,a=new Jn(0,n||this.scope),o=a.conditions={};for(r in N&&!a.selector&&(a.selector=N.selector),this.contexts.push(a),e=a.add("onMatch",e),a.queries=t,t)"all"===r?s=1:(i=U.matchMedia(t[r]))&&(Kn.indexOf(a)<0&&Kn.push(a),(o[r]=i.matches)&&(s=1),i.addListener?i.addListener(Qn):i.addEventListener("change",Qn));return s&&e(a,function(t){return a.add(null,t)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(e){return e.kill(t,!0)})},t}(),ei={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(t){return Ye(t)})},timeline:function(t){return new bn(t)},getTweensOf:function(t,e){return B.getTweensOf(t,e)},getProperty:function(t,e,n,i){lt(t)&&(t=Oe(t)[0]);var r=Ht(t||{}).get,s=n?ee:te;return"native"===n&&(n=""),t?e?s((Bt[e]&&Bt[e].get||r)(t,e,n,i)):function(e,n,i){return s((Bt[e]&&Bt[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=Oe(t)).length>1){var i=t.map(function(t){return ri.quickSetter(t,e,n)}),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var s=Bt[e],a=Ht(t),o=a.harness&&(a.harness.aliases||{})[e]||e,l=s?function(e){var i=new s;H._pt=0,i.init(t,n?e+n:e,H,0,[t]),i.render(1,i),H._pt&&$n(1,H)}:a.set(t,o);return s?l:function(e){return l(t,o,n?e+n:e,a,1)}},quickTo:function(t,e,n){var i,r=ri.to(t,ne(((i={})[e]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),s=function(t,n,i){return r.resetTo(e,t,n,i)};return s.tween=r,s},isTweening:function(t){return B.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=fn(t.ease,J.ease)),re(J,t||{})},config:function(t){return re(Q,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach(function(t){return t&&!Bt[t]&&!wt[t]&&xt(e+" effect requires "+t+" plugin.")}),Ut[e]=function(t,e,i){return n(Oe(t),ne(e||{},r),i)},s&&(bn.prototype[e]=function(t,n,i){return this.add(Ut[e](t,dt(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){on[t]=fn(e)},parseEase:function(t,e){return arguments.length?fn(t,e):on},getById:function(t){return B.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new bn(t);for(r.smoothChildTiming=ft(t.smoothChildTiming),B.remove(r),r._dp=0,r._time=r._tTime=B._time,n=B._first;n;)i=n._next,!e&&!n._dur&&n instanceof In&&n.vars.onComplete===n._targets[0]||_e(r,n,n._start-n._delay),n=i;return _e(B,r,0),r},context:function(t,e){return t?new Jn(t,e):N},matchMedia:function(t){return new ti(t)},matchMediaRefresh:function(){return Kn.forEach(function(t){var e,n,i=t.conditions;for(n in i)i[n]&&(i[n]=!1,e=1);e&&t.revert()})||Qn()},addEventListener:function(t,e){var n=Wn[t]||(Wn[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=Wn[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:function t(e,n,i){var r=n-e;return vt(e)?ze(e,t(0,e.length),n):xe(i,function(t){return(r+(t-e)%r)%r+e})},wrapYoyo:function t(e,n,i){var r=n-e,s=2*r;return vt(e)?ze(e,t(0,e.length-1),n):xe(i,function(t){return e+((t=(s+(t-e)%s)%s||0)>r?s-t:t)})},distribute:Ne,random:$e,snap:Ue,normalize:function(t,e,n){return je(t,e,0,1,n)},getUnit:Ie,clamp:function(t,e,n){return xe(n,function(n){return Ce(t,e,n)})},splitColor:Qe,toArray:Oe,selector:Me,mapRange:je,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return e(t)},t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||Ie(n))}},interpolate:function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var a,o,l,u,c,h=lt(e),d={};if(!0===i&&(r=1)&&(i=null),h)e={p:e},n={p:n};else if(vt(e)&&!vt(n)){for(l=[],u=e.length,c=u-2,o=1;o<u;o++)l.push(t(e[o-1],e[o]));u--,s=function(t){t*=u;var e=Math.min(c,~~t);return l[e](t-e)},i=n}else r||(e=ie(vt(e)?[]:{},e));if(!l){for(a in n)Dn.call(d,e,a,"get",n[a]);s=function(t){return $n(t,d)||(h?e.p:e)}}}return xe(i,s)},shuffle:Fe},install:kt,effects:Ut,ticker:sn,updateRoot:bn.updateRoot,plugins:Bt,globalTimeline:B,core:{PropTween:Vn,globals:Ct,Tween:In,Timeline:bn,Animation:_n,getCache:Ht,_removeLinkedListItem:le,reverting:function(){return F},context:function(t){return t&&N&&(N.data.push(t),t._ctx=N),N},suppressOverwrites:function(t){return M=t}}};Kt("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return ei[t]=In[t]}),sn.add(bn.updateRoot),H=ei.to({},{duration:0});var ni=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},ii=function(t,e){return{name:t,headless:1,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(lt(n)&&(i={},Kt(n,function(t){return i[t]=1}),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=ni(r,n)),r&&r.modifier&&r.modifier(e[n],t,s[i],n))}(t,n)}}}},ri=ei.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,a,o;for(s in this.tween=n,e)o=t.getAttribute(s)||"",(a=this.add(t,"setAttribute",(o||0)+"",e[s],i,r,0,0,s)).op=s,a.b=o,this._props.push(s)},render:function(t,e){for(var n=e._pt;n;)F?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",headless:1,init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},ii("roundProps",Be),ii("modifiers"),ii("snap",Ue))||ei;In.version=bn.version=ri.version="3.13.0",G=1,pt()&&an(),on.Power0,on.Power1,on.Power2,on.Power3,on.Power4,on.Linear,on.Quad,on.Cubic,on.Quart,on.Quint,on.Strong,on.Elastic,on.Back,on.SteppedEase,on.Bounce,on.Sine,on.Expo,on.Circ;var si,ai,oi,li,ui,ci,hi,di,fi={},pi=180/Math.PI,mi=Math.PI/180,gi=Math.atan2,vi=/([A-Z])/g,yi=/(left|right|width|margin|padding|x)/i,_i=/[\s,\(]\S/,bi={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Ei=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Ti=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Si=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},Di=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},wi=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},Li=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},ki=function(t,e,n){return t.style[e]=n},Ai=function(t,e,n){return t.style.setProperty(e,n)},xi=function(t,e,n){return t._gsap[e]=n},Ci=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},Ii=function(t,e,n,i,r){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},Pi=function(t,e,n,i,r){var s=t._gsap;s[e]=n,s.renderTransform(r,s)},Ri="transform",Oi=Ri+"Origin",Mi=function t(e,n){var i=this,r=this.target,s=r.style,a=r._gsap;if(e in fi&&s){if(this.tfm=this.tfm||{},"transform"===e)return bi.transform.split(",").forEach(function(e){return t.call(i,e,n)});if(~(e=bi[e]||e).indexOf(",")?e.split(",").forEach(function(t){return i.tfm[t]=Ji(r,t)}):this.tfm[e]=a.x?a[e]:Ji(r,e),e===Oi&&(this.tfm.zOrigin=a.zOrigin),this.props.indexOf(Ri)>=0)return;a.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(Oi,n,"")),e=Ri}(s||n)&&this.props.push(e,n,s[e])},Fi=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},Ni=function(){var t,e,n=this.props,i=this.target,r=i.style,s=i._gsap;for(t=0;t<n.length;t+=3)n[t+1]?2===n[t+1]?i[n[t]](n[t+2]):i[n[t]]=n[t+2]:n[t+2]?r[n[t]]=n[t+2]:r.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(vi,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(t=hi())&&t.isStart||r[Ri]||(Fi(r),s.zOrigin&&r[Oi]&&(r[Oi]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},Bi=function(t,e){var n={target:t,props:[],revert:Ni,save:Mi};return t._gsap||ri.core.getCache(t),e&&t.style&&t.nodeType&&e.split(",").forEach(function(t){return n.save(t)}),n},Ui=function(t,e){var n=ai.createElementNS?ai.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):ai.createElement(t);return n&&n.style?n:ai.createElement(t)},$i=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(vi,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,Gi(n)||n,1)||""},zi="O,Moz,ms,Ms,Webkit".split(","),Gi=function(t,e,n){var i=(e||ui).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(zi[r]+t in i););return r<0?null:(3===r?"ms":r>=0?zi[r]:"")+t},ji=function(){"undefined"!=typeof window&&window.document&&(si=window,ai=si.document,oi=ai.documentElement,ui=Ui("div")||{style:{}},Ui("div"),Ri=Gi(Ri),Oi=Ri+"Origin",ui.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",di=!!Gi("perspective"),hi=ri.core.reverting,li=1)},Hi=function(t){var e,n=t.ownerSVGElement,i=Ui("svg",n&&n.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=t.cloneNode(!0);r.style.display="block",i.appendChild(r),oi.appendChild(i);try{e=r.getBBox()}catch(t){}return i.removeChild(r),oi.removeChild(i),e},Vi=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},Ki=function(t){var e,n;try{e=t.getBBox()}catch(i){e=Hi(t),n=1}return e&&(e.width||e.height)||n||(e=Hi(t)),!e||e.width||e.x||e.y?e:{x:+Vi(t,["x","cx","x1"])||0,y:+Vi(t,["y","cy","y1"])||0,width:0,height:0}},Wi=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!Ki(t))},Yi=function(t,e){if(e){var n,i=t.style;e in fi&&e!==Oi&&(e=Ri),i.removeProperty?("ms"!==(n=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),i.removeProperty("--"===n?e:e.replace(vi,"-$1").toLowerCase())):i.removeAttribute(e)}},Zi=function(t,e,n,i,r,s){var a=new Vn(t._pt,e,n,0,1,s?Li:wi);return t._pt=a,a.b=i,a.e=r,t._props.push(n),a},qi={deg:1,rad:1,turn:1},Xi={grid:1,flex:1},Qi=function t(e,n,i,r){var s,a,o,l,u=parseFloat(i)||0,c=(i+"").trim().substr((u+"").length)||"px",h=ui.style,d=yi.test(n),f="svg"===e.tagName.toLowerCase(),p=(f?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===r,v="%"===r;if(r===c||!u||qi[r]||qi[c])return u;if("px"!==c&&!g&&(u=t(e,n,i,"px")),l=e.getCTM&&Wi(e),(v||"%"===c)&&(fi[n]||~n.indexOf("adius")))return s=l?e.getBBox()[d?"width":"height"]:e[p],Wt(v?u/s*m:u/100*s);if(h[d?"width":"height"]=m+(g?c:r),a="rem"!==r&&~n.indexOf("adius")||"em"===r&&e.appendChild&&!f?e:e.parentNode,l&&(a=(e.ownerSVGElement||{}).parentNode),a&&a!==ai&&a.appendChild||(a=ai.body),(o=a._gsap)&&v&&o.width&&d&&o.time===sn.time&&!o.uncache)return Wt(u/o.width*m);if(!v||"height"!==n&&"width"!==n)(v||"%"===c)&&!Xi[$i(a,"display")]&&(h.position=$i(e,"position")),a===e&&(h.position="static"),a.appendChild(ui),s=ui[p],a.removeChild(ui),h.position="absolute";else{var y=e.style[n];e.style[n]=m+r,s=e[p],y?e.style[n]=y:Yi(e,n)}return d&&v&&((o=Ht(a)).time=sn.time,o.width=a[p]),Wt(g?s*u/m:s&&u?m/s*u:0)},Ji=function(t,e,n,i){var r;return li||ji(),e in bi&&"transform"!==e&&~(e=bi[e]).indexOf(",")&&(e=e.split(",")[0]),fi[e]&&"transform"!==e?(r=hr(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:dr($i(t,Oi))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=rr[e]&&rr[e](t,e,n)||$i(t,e)||Vt(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?Qi(t,e,r,n)+n:r},tr=function(t,e,n,i){if(!n||"none"===n){var r=Gi(e,t,1),s=r&&$i(t,r,1);s&&s!==n?(e=r,n=s):"borderColor"===e&&(n=$i(t,"borderTopColor"))}var a,o,l,u,c,h,d,f,p,m,g,v=new Vn(this._pt,t.style,e,0,1,Un),y=0,_=0;if(v.b=n,v.e=i,n+="","var(--"===(i+="").substring(0,6)&&(i=$i(t,i.substring(4,i.indexOf(")")))),"auto"===i&&(h=t.style[e],t.style[e]=i,i=$i(t,e)||i,h?t.style[e]=h:Yi(t,e)),rn(a=[n,i]),i=a[1],l=(n=a[0]).match(bt)||[],(i.match(bt)||[]).length){for(;o=bt.exec(i);)d=o[0],p=i.substring(y,o.index),c?c=(c+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(c=1),d!==(h=l[_++]||"")&&(u=parseFloat(h)||0,g=h.substr((u+"").length),"="===d.charAt(1)&&(d=Zt(u,d)+g),f=parseFloat(d),m=d.substr((f+"").length),y=bt.lastIndex-m.length,m||(m=m||Q.units[e]||g,y===i.length&&(i+=m,v.e+=m)),g!==m&&(u=Qi(t,e,h,m)||0),v._pt={_next:v._pt,p:p||1===_?p:",",s:u,c:f-u,m:c&&c<4||"zIndex"===e?Math.round:0});v.c=y<i.length?i.substring(y,i.length):""}else v.r="display"===e&&"none"===i?Li:wi;return Tt.test(i)&&(v.e=0),this._pt=v,v},er={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},nr=function(t){var e=t.split(" "),n=e[0],i=e[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==i&&"right"!==i||(t=n,n=i,i=t),e[0]=er[n]||n,e[1]=er[i]||i,e.join(" ")},ir=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,a=s.style,o=e.u,l=s._gsap;if("all"===o||!0===o)a.cssText="",i=1;else for(r=(o=o.split(",")).length;--r>-1;)n=o[r],fi[n]&&(i=1,n="transformOrigin"===n?Oi:Ri),Yi(s,n);i&&(Yi(s,Ri),l&&(l.svg&&s.removeAttribute("transform"),a.scale=a.rotate=a.translate="none",hr(s,1),l.uncache=1,Fi(a)))}},rr={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var s=t._pt=new Vn(t._pt,e,n,0,0,ir);return s.u=i,s.pr=-10,s.tween=r,t._props.push(n),1}}},sr=[1,0,0,1,0,0],ar={},or=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},lr=function(t){var e=$i(t,Ri);return or(e)?sr:e.substr(7).match(_t).map(Wt)},ur=function(t,e){var n,i,r,s,a=t._gsap||Ht(t),o=t.style,l=lr(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?sr:l:(l!==sr||t.offsetParent||t===oi||a.svg||(r=o.display,o.display="block",(n=t.parentNode)&&(t.offsetParent||t.getBoundingClientRect().width)||(s=1,i=t.nextElementSibling,oi.appendChild(t)),l=lr(t),r?o.display=r:Yi(t,"display"),s&&(i?n.insertBefore(t,i):n?n.appendChild(t):oi.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},cr=function(t,e,n,i,r,s){var a,o,l,u=t._gsap,c=r||ur(t,!0),h=u.xOrigin||0,d=u.yOrigin||0,f=u.xOffset||0,p=u.yOffset||0,m=c[0],g=c[1],v=c[2],y=c[3],_=c[4],b=c[5],E=e.split(" "),T=parseFloat(E[0])||0,S=parseFloat(E[1])||0;n?c!==sr&&(o=m*y-g*v)&&(l=T*(-g/o)+S*(m/o)-(m*b-g*_)/o,T=T*(y/o)+S*(-v/o)+(v*b-y*_)/o,S=l):(T=(a=Ki(t)).x+(~E[0].indexOf("%")?T/100*a.width:T),S=a.y+(~(E[1]||E[0]).indexOf("%")?S/100*a.height:S)),i||!1!==i&&u.smooth?(_=T-h,b=S-d,u.xOffset=f+(_*m+b*v)-_,u.yOffset=p+(_*g+b*y)-b):u.xOffset=u.yOffset=0,u.xOrigin=T,u.yOrigin=S,u.smooth=!!i,u.origin=e,u.originIsAbsolute=!!n,t.style[Oi]="0px 0px",s&&(Zi(s,u,"xOrigin",h,T),Zi(s,u,"yOrigin",d,S),Zi(s,u,"xOffset",f,u.xOffset),Zi(s,u,"yOffset",p,u.yOffset)),t.setAttribute("data-svg-origin",T+" "+S)},hr=function(t,e){var n=t._gsap||new yn(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,a,o,l,u,c,h,d,f,p,m,g,v,y,_,b,E,T,S,D,w,L,k,A,x,C,I,P,R,O,M=t.style,F=n.scaleX<0,N="px",B="deg",U=getComputedStyle(t),$=$i(t,Oi)||"0";return i=r=s=l=u=c=h=d=f=0,a=o=1,n.svg=!(!t.getCTM||!Wi(t)),U.translate&&("none"===U.translate&&"none"===U.scale&&"none"===U.rotate||(M[Ri]=("none"!==U.translate?"translate3d("+(U.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==U.rotate?"rotate("+U.rotate+") ":"")+("none"!==U.scale?"scale("+U.scale.split(" ").join(",")+") ":"")+("none"!==U[Ri]?U[Ri]:"")),M.scale=M.rotate=M.translate="none"),g=ur(t,n.svg),n.svg&&(n.uncache?(k=t.getBBox(),$=n.xOrigin-k.x+"px "+(n.yOrigin-k.y)+"px",L=""):L=!e&&t.getAttribute("data-svg-origin"),cr(t,L||$,!!L||n.originIsAbsolute,!1!==n.smooth,g)),p=n.xOrigin||0,m=n.yOrigin||0,g!==sr&&(b=g[0],E=g[1],T=g[2],S=g[3],i=D=g[4],r=w=g[5],6===g.length?(a=Math.sqrt(b*b+E*E),o=Math.sqrt(S*S+T*T),l=b||E?gi(E,b)*pi:0,(h=T||S?gi(T,S)*pi+l:0)&&(o*=Math.abs(Math.cos(h*mi))),n.svg&&(i-=p-(p*b+m*T),r-=m-(p*E+m*S))):(O=g[6],P=g[7],x=g[8],C=g[9],I=g[10],R=g[11],i=g[12],r=g[13],s=g[14],u=(v=gi(O,I))*pi,v&&(L=D*(y=Math.cos(-v))+x*(_=Math.sin(-v)),k=w*y+C*_,A=O*y+I*_,x=D*-_+x*y,C=w*-_+C*y,I=O*-_+I*y,R=P*-_+R*y,D=L,w=k,O=A),c=(v=gi(-T,I))*pi,v&&(y=Math.cos(-v),R=S*(_=Math.sin(-v))+R*y,b=L=b*y-x*_,E=k=E*y-C*_,T=A=T*y-I*_),l=(v=gi(E,b))*pi,v&&(L=b*(y=Math.cos(v))+E*(_=Math.sin(v)),k=D*y+w*_,E=E*y-b*_,w=w*y-D*_,b=L,D=k),u&&Math.abs(u)+Math.abs(l)>359.9&&(u=l=0,c=180-c),a=Wt(Math.sqrt(b*b+E*E+T*T)),o=Wt(Math.sqrt(w*w+O*O)),v=gi(D,w),h=Math.abs(v)>2e-4?v*pi:0,f=R?1/(R<0?-R:R):0),n.svg&&(L=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!or($i(t,Ri)),L&&t.setAttribute("transform",L))),Math.abs(h)>90&&Math.abs(h)<270&&(F?(a*=-1,h+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,h+=h<=0?180:-180)),e=e||n.uncache,n.x=i-((n.xPercent=i&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+N,n.y=r-((n.yPercent=r&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+N,n.z=s+N,n.scaleX=Wt(a),n.scaleY=Wt(o),n.rotation=Wt(l)+B,n.rotationX=Wt(u)+B,n.rotationY=Wt(c)+B,n.skewX=h+B,n.skewY=d+B,n.transformPerspective=f+N,(n.zOrigin=parseFloat($.split(" ")[2])||!e&&n.zOrigin||0)&&(M[Oi]=dr($)),n.xOffset=n.yOffset=0,n.force3D=Q.force3D,n.renderTransform=n.svg?_r:di?yr:pr,n.uncache=0,n},dr=function(t){return(t=t.split(" "))[0]+" "+t[1]},fr=function(t,e,n){var i=Ie(e);return Wt(parseFloat(e)+parseFloat(Qi(t,"x",n+"px",i)))+i},pr=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,yr(t,e)},mr="0deg",gr="0px",vr=") ",yr=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,o=n.z,l=n.rotation,u=n.rotationY,c=n.rotationX,h=n.skewX,d=n.skewY,f=n.scaleX,p=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,_="",b="auto"===g&&t&&1!==t||!0===g;if(y&&(c!==mr||u!==mr)){var E,T=parseFloat(u)*mi,S=Math.sin(T),D=Math.cos(T);T=parseFloat(c)*mi,E=Math.cos(T),s=fr(v,s,S*E*-y),a=fr(v,a,-Math.sin(T)*-y),o=fr(v,o,D*E*-y+y)}m!==gr&&(_+="perspective("+m+vr),(i||r)&&(_+="translate("+i+"%, "+r+"%) "),(b||s!==gr||a!==gr||o!==gr)&&(_+=o!==gr||b?"translate3d("+s+", "+a+", "+o+") ":"translate("+s+", "+a+vr),l!==mr&&(_+="rotate("+l+vr),u!==mr&&(_+="rotateY("+u+vr),c!==mr&&(_+="rotateX("+c+vr),h===mr&&d===mr||(_+="skew("+h+", "+d+vr),1===f&&1===p||(_+="scale("+f+", "+p+vr),v.style[Ri]=_||"translate(0, 0)"},_r=function(t,e){var n,i,r,s,a,o=e||this,l=o.xPercent,u=o.yPercent,c=o.x,h=o.y,d=o.rotation,f=o.skewX,p=o.skewY,m=o.scaleX,g=o.scaleY,v=o.target,y=o.xOrigin,_=o.yOrigin,b=o.xOffset,E=o.yOffset,T=o.forceCSS,S=parseFloat(c),D=parseFloat(h);d=parseFloat(d),f=parseFloat(f),(p=parseFloat(p))&&(f+=p=parseFloat(p),d+=p),d||f?(d*=mi,f*=mi,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-f)*-g,s=Math.cos(d-f)*g,f&&(p*=mi,a=Math.tan(f-p),r*=a=Math.sqrt(1+a*a),s*=a,p&&(a=Math.tan(p),n*=a=Math.sqrt(1+a*a),i*=a)),n=Wt(n),i=Wt(i),r=Wt(r),s=Wt(s)):(n=m,s=g,i=r=0),(S&&!~(c+"").indexOf("px")||D&&!~(h+"").indexOf("px"))&&(S=Qi(v,"x",c,"px"),D=Qi(v,"y",h,"px")),(y||_||b||E)&&(S=Wt(S+y-(y*n+_*r)+b),D=Wt(D+_-(y*i+_*s)+E)),(l||u)&&(a=v.getBBox(),S=Wt(S+l/100*a.width),D=Wt(D+u/100*a.height)),a="matrix("+n+","+i+","+r+","+s+","+S+","+D+")",v.setAttribute("transform",a),T&&(v.style[Ri]=a)},br=function(t,e,n,i,r){var s,a,o=360,l=lt(r),u=parseFloat(r)*(l&&~r.indexOf("rad")?pi:1)-i,c=i+u+"deg";return l&&("short"===(s=r.split("_")[1])&&(u%=o)!==u%180&&(u+=u<0?o:-360),"cw"===s&&u<0?u=(u+36e9)%o-~~(u/o)*o:"ccw"===s&&u>0&&(u=(u-36e9)%o-~~(u/o)*o)),t._pt=a=new Vn(t._pt,e,n,i,u,Ti),a.e=c,a.u="deg",t._props.push(n),a},Er=function(t,e){for(var n in e)t[n]=e[n];return t},Tr=function(t,e,n){var i,r,s,a,o,l,u,c=Er({},n._gsap),h=n.style;for(r in c.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),h[Ri]=e,i=hr(n,1),Yi(n,Ri),n.setAttribute("transform",s)):(s=getComputedStyle(n)[Ri],h[Ri]=e,i=hr(n,1),h[Ri]=s),fi)(s=c[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=Ie(s)!==(u=Ie(a))?Qi(n,r,s,u):parseFloat(s),l=parseFloat(a),t._pt=new Vn(t._pt,i,r,o,l-o,Ei),t._pt.u=u||0,t._props.push(r));Er(i,c)};Kt("padding,margin,Width,Radius",function(t,e){var n="Top",i="Right",r="Bottom",s="Left",a=(e<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map(function(n){return e<2?t+n:"border"+n+t});rr[e>1?"border"+t:t]=function(t,e,n,i,r){var s,o;if(arguments.length<4)return s=a.map(function(e){return Ji(t,e,n)}),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(i+"").split(" "),o={},a.forEach(function(t,e){return o[t]=s[e]=s[e]||s[(e-1)/2|0]}),t.init(e,o,r)}});var Sr,Dr,wr={name:"css",register:ji,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,a,o,l,u,c,h,d,f,p,m,g,v,y,_,b,E=this._props,T=t.style,S=n.vars.startAt;for(h in li||ji(),this.styles=this.styles||Bi(t),b=this.styles.props,this.tween=n,e)if("autoRound"!==h&&(a=e[h],!Bt[h]||!wn(h,e,n,i,t,r)))if(u=typeof a,c=rr[h],"function"===u&&(u=typeof(a=a.call(n,i,t,r))),"string"===u&&~a.indexOf("random(")&&(a=Ge(a)),c)c(this,t,h,a,n)&&(_=1);else if("--"===h.substr(0,2))s=(getComputedStyle(t).getPropertyValue(h)+"").trim(),a+="",en.lastIndex=0,en.test(s)||(d=Ie(s),f=Ie(a)),f?d!==f&&(s=Qi(t,h,s,f)+f):d&&(a+=d),this.add(T,"setProperty",s,a,i,r,0,0,h),E.push(h),b.push(h,0,T[h]);else if("undefined"!==u){if(S&&h in S?(s="function"==typeof S[h]?S[h].call(n,i,t,r):S[h],lt(s)&&~s.indexOf("random(")&&(s=Ge(s)),Ie(s+"")||"auto"===s||(s+=Q.units[h]||Ie(Ji(t,h))||""),"="===(s+"").charAt(1)&&(s=Ji(t,h))):s=Ji(t,h),l=parseFloat(s),(p="string"===u&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),o=parseFloat(a),h in bi&&("autoAlpha"===h&&(1===l&&"hidden"===Ji(t,"visibility")&&o&&(l=0),b.push("visibility",0,T.visibility),Zi(this,T,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==h&&"transform"!==h&&~(h=bi[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in fi)if(this.styles.save(h),"string"===u&&"var(--"===a.substring(0,6)&&(a=$i(t,a.substring(4,a.indexOf(")"))),o=parseFloat(a)),g||((v=t._gsap).renderTransform&&!e.parseTransform||hr(t,e.parseTransform),y=!1!==e.smoothOrigin&&v.smooth,(g=this._pt=new Vn(this._pt,T,Ri,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===h)this._pt=new Vn(this._pt,v,"scaleY",v.scaleY,(p?Zt(v.scaleY,p+o):o)-v.scaleY||0,Ei),this._pt.u=0,E.push("scaleY",h),h+="X";else{if("transformOrigin"===h){b.push(Oi,0,T[Oi]),a=nr(a),v.svg?cr(t,a,0,y,0,this):((f=parseFloat(a.split(" ")[2])||0)!==v.zOrigin&&Zi(this,v,"zOrigin",v.zOrigin,f),Zi(this,T,h,dr(s),dr(a)));continue}if("svgOrigin"===h){cr(t,a,1,y,0,this);continue}if(h in ar){br(this,v,h,l,p?Zt(l,p+a):a);continue}if("smoothOrigin"===h){Zi(this,v,"smooth",v.smooth,a);continue}if("force3D"===h){v[h]=a;continue}if("transform"===h){Tr(this,a,t);continue}}else h in T||(h=Gi(h)||h);if(m||(o||0===o)&&(l||0===l)&&!_i.test(a)&&h in T)o||(o=0),(d=(s+"").substr((l+"").length))!==(f=Ie(a)||(h in Q.units?Q.units[h]:d))&&(l=Qi(t,h,s,f)),this._pt=new Vn(this._pt,m?v:T,h,l,(p?Zt(l,p+o):o)-l,m||"px"!==f&&"zIndex"!==h||!1===e.autoRound?Ei:Di),this._pt.u=f||0,d!==f&&"%"!==f&&(this._pt.b=s,this._pt.r=Si);else if(h in T)tr.call(this,t,h,s,p?p+a:a);else if(h in t)this.add(t,h,s||t[h],p?p+a:a,i,r);else if("parseTransform"!==h){At(h,a);continue}m||(h in T?b.push(h,0,T[h]):"function"==typeof t[h]?b.push(h,2,t[h]()):b.push(h,1,s||t[h])),E.push(h)}_&&Hn(this)},render:function(t,e){if(e.tween._time||!hi())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:Ji,aliases:bi,getSetter:function(t,e,n){var i=bi[e];return i&&i.indexOf(",")<0&&(e=i),e in fi&&e!==Oi&&(t._gsap.x||Ji(t,"x"))?n&&ci===n?"scale"===e?Ci:xi:(ci=n||{})&&("scale"===e?Ii:Pi):t.style&&!ht(t.style[e])?ki:~e.indexOf("-")?Ai:Fn(t,e)},core:{_removeProperty:Yi,_getMatrix:ur}};ri.utils.checkPrefix=Gi,ri.core.getStyleSaver=Bi,Dr=Kt("x,y,z,scale,scaleX,scaleY,xPercent,yPercent"+","+(Sr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(t){fi[t]=1}),Kt(Sr,function(t){Q.units[t]="deg",ar[t]=1}),bi[Dr[13]]="x,y,z,scale,scaleX,scaleY,xPercent,yPercent,"+Sr,Kt("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(t){var e=t.split(":");bi[e[1]]=Dr[e[0]]}),Kt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){Q.units[t]="px"}),ri.registerPlugin(wr);var Lr=ri.registerPlugin(wr)||ri,kr=(Lr.core.Tween,/(?:^\s+|\s+$)/g),Ar=/([\uD800-\uDBFF][\uDC00-\uDFFF](?:[\u200D\uFE0F][\uD800-\uDBFF][\uDC00-\uDFFF]){2,}|\uD83D\uDC69(?:\u200D(?:(?:\uD83D\uDC69\u200D)?\uD83D\uDC67|(?:\uD83D\uDC69\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2642\u2640]\uFE0F|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDD27\uDCBC\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC6F\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3C-\uDD3E\uDDD6-\uDDDF])\u200D[\u2640\u2642]\uFE0F|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\u26F9|\uD83C[\uDFCC\uDFCB]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])\uFE0F|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC69\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708]))\uFE0F|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83D\uDC69\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69]))|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]))|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D(?:(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F)/;function xr(t,e,n,i,r){for(var s,a=t.firstChild,o=[];a;)3===a.nodeType?(s=(a.nodeValue+"").replace(/^\n+/g,""),i||(s=s.replace(/\s+/g," ")),o.push.apply(o,Cr(s,e,n,i,r))):"br"===(a.nodeName+"").toLowerCase()?o[o.length-1]+="<br>":o.push(a.outerHTML),a=a.nextSibling;if(!r)for(s=o.length;s--;)"&"===o[s]&&o.splice(s,1,"&amp;");return o}function Cr(t,e,n,i,r){if(t+="",n&&(t=t.trim?t.trim():t.replace(kr,"")),e&&""!==e)return t.replace(/>/g,"&gt;").replace(/</g,"&lt;").split(e);for(var s,a,o=[],l=t.length,u=0;u<l;u++)((a=t.charAt(u)).charCodeAt(0)>=55296&&a.charCodeAt(0)<=56319||t.charCodeAt(u+1)>=65024&&t.charCodeAt(u+1)<=65039)&&(s=((t.substr(u,12).split(Ar)||[])[1]||"").length||2,a=t.substr(u,s),o.emoji=1,u+=s-1),o.push(r?a:">"===a?"&gt;":"<"===a?"&lt;":!i||" "!==a||" "!==t.charAt(u-1)&&" "!==t.charAt(u+1)?a:"&nbsp;");return o}var Ir,Pr,Rr={version:"3.13.0",name:"text",init:function(t,e,n){"object"!=typeof e&&(e={value:e});var i,r,s,a,o,l,u,c,h=t.nodeName.toUpperCase(),d=this,f=e,p=f.newClass,m=f.oldClass,g=f.preserveSpaces,v=f.rtl,y=d.delimiter=e.delimiter||"",_=d.fillChar=e.fillChar||(e.padSpace?"&nbsp;":"");if(d.svg=t.getBBox&&("TEXT"===h||"TSPAN"===h),!("innerHTML"in t)&&!d.svg)return!1;if(d.target=t,"value"in e){for(s=xr(t,y,!1,g,d.svg),Pr||(Pr=document.createElement("div")),Pr.innerHTML=e.value,r=xr(Pr,y,!1,g,d.svg),d.from=n._from,!d.from&&!v||v&&d.from||(h=s,s=r,r=h),d.hasClass=!(!p&&!m),d.newClass=v?m:p,d.oldClass=v?p:m,i=(h=s.length-r.length)<0?s:r,h<0&&(h=-h);--h>-1;)i.push(_);if("diff"===e.type){for(a=0,o=[],l=[],u="",h=0;h<r.length;h++)(c=r[h])===s[h]?u+=c:(o[a]=u+c,l[a++]=u+s[h],u="");r=o,s=l,u&&(r.push(u),s.push(u))}e.speed&&n.duration(Math.min(.05/e.speed*i.length,e.maxDuration||9999)),d.rtl=v,d.original=s,d.text=r,d._props.push("text")}else d.text=d.original=[""]},render:function(t,e){t>1?t=1:t<0&&(t=0),e.from&&(t=1-t);var n,i,r,s=e.text,a=e.hasClass,o=e.newClass,l=e.oldClass,u=e.delimiter,c=e.target,h=e.fillChar,d=e.original,f=e.rtl,p=s.length,m=(f?1-t:t)*p+.5|0;a&&t?(i=l&&m!==p,r=((n=o&&m)?"<span class='"+o+"'>":"")+s.slice(0,m).join(u)+(n?"</span>":"")+(i?"<span class='"+l+"'>":"")+u+d.slice(m).join(u)+(i?"</span>":"")):r=s.slice(0,m).join(u)+u+d.slice(m).join(u),e.svg?c.textContent=r:c.innerHTML="&nbsp;"===h&&~r.indexOf("  ")?r.split("  ").join("&nbsp;&nbsp;"):r}};function Or(t){return Or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Or(t)}function Mr(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Fr(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Fr(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Fr(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Fr(h,"constructor",u),Fr(u,"constructor",l),l.displayName="GeneratorFunction",Fr(u,r,"GeneratorFunction"),Fr(h),Fr(h,r,"Generator"),Fr(h,i,function(){return this}),Fr(h,"toString",function(){return"[object Generator]"}),(Mr=function(){return{w:s,m:d}})()}function Fr(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Fr=function(t,e,n,i){function s(e,n){Fr(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Fr(t,e,n,i)}function Nr(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function Br(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Ur(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Br(Object(n),!0).forEach(function(e){$r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Br(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function $r(t,e,n){return(e=function(t){var e=function(t){if("object"!=Or(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Or(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Gr(e,n,i){var r,s,a=(r=(0,t.useState)({}),s=2,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(r,s)||function(t,e){if(t){if("string"==typeof t)return zr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zr(t,e):void 0}}(r,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=a[0],l=a[1],u=(0,t.useRef)(null);return(0,t.useEffect)(function(){var t;function r(){t=window.io(),u.current=t,t.on("connect",function(){t.emit("".concat(e,"_subscribe_live_feed"))}),t.on("".concat(e,"_initial_state"),function(t){var e=Array.isArray(t)?t:t?[t]:[],n={};e.forEach(function(t){var e=i(t);e&&(n[e]=t)}),l(n)}),t.on("".concat(e,"_").concat(n.toLowerCase()),function(t){var e=Array.isArray(t)?t:[t];l(function(t){var n=Ur({},t);return e.forEach(function(t){var e=i(t);e&&(n[e]=t)}),n})})}if(window.io)return r(),function(){var t;return null===(t=u.current)||void 0===t?void 0:t.disconnect()};var s=document.createElement("script");return s.src="https://cdn.socket.io/4.7.5/socket.io.min.js",s.onload=r,document.body.appendChild(s),function(){u.current&&u.current.disconnect(),document.body.removeChild(s)}},[e,n,i]),[o,l]}function jr(t,e,n){return Hr.apply(this,arguments)}function Hr(){return Hr=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){Nr(s,i,r,a,o,"next",t)}function o(t){Nr(s,i,r,a,o,"throw",t)}a(void 0)})}}(Mr().m(function t(e,n,i){var r,s,a,o,l,u,c=arguments;return Mr().w(function(t){for(;;)switch(t.p=t.n){case 0:return r=c.length>3&&void 0!==c[3]?c[3]:{},s="/".concat(e,"_send_").concat(n),a=Ur({"Content-Type":"application/json","X-User":localStorage.getItem("username")||""},r),t.n=1,fetch(s,{method:"POST",headers:a,body:JSON.stringify(i)});case 1:if((o=t.v).ok){t.n=6;break}return l="Unknown error",t.p=2,t.n=3,o.json();case 3:u=t.v,l=u.reason||JSON.stringify(u),t.n=5;break;case 4:t.p=4,t.v;case 5:throw new Error(l);case 6:return t.a(2,o.json())}},t,null,[[2,4]])})),Hr.apply(this,arguments)}function Vr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Kr(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Kr(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Wr(t){return(t.svg_name||"")+"_"+(t.element_id||"")}function Yr(e){var n=e.selectedSvgProp,i=e.onSvgChange,r=Vr((0,t.useState)([]),2),s=r[0],a=r[1],o=Vr((0,t.useState)(n||""),2),l=o[0],u=o[1],c=Vr((0,t.useState)(""),2),h=c[0],d=c[1],f=Vr((0,t.useState)(""),2),p=f[0],m=f[1],g=(0,t.useRef)(null);(0,t.useEffect)(function(){n&&n!==l&&u(n)},[n]),(0,t.useEffect)(function(){i&&i(l)},[l,i]),(0,t.useEffect)(function(){fetch("/animation_svgs").then(function(t){return t.json()}).then(function(t){a(t),!l&&t.length>0&&u(t[0])}).catch(function(t){return console.error("Failed to load SVG list:",t)})},[]),(0,t.useEffect)(function(){if(l){fetch("/svg/".concat(l)).then(function(t){return t.text()}).then(function(t){return d(t)}).catch(function(t){return console.error("Failed to load SVG:",t)});var t=l.replace(/\.svg$/i,".txt");fetch("/svg/".concat(t)).then(function(t){return t.ok?t.text():Promise.reject("No explanation file")}).then(function(t){return m(t.trim()||"No explanation available.")}).catch(function(t){m("No explanation available."),console.error("Failed to load SVG explanation:",t)})}},[l]);var v=Vr(Gr("animation","animationupdatemsg",Wr),1)[0];return(0,t.useEffect)(function(){if(h){var t=g.current;t&&Object.values(v).forEach(function(e){if(e&&e.svg_name===l){var n=t.querySelector("#".concat(e.element_id));if(n&&e.config){var i={duration:e.config.duration||.5};e.config.attr&&(i.attr=e.config.attr),e.config.text&&(i.text=e.config.text);try{Lr.to(n,i)}catch(t){console.warn("Animation error:",t)}}}})}},[v,h,l]),(0,t.useEffect)(function(){var t=g.current;if(t)return t.addEventListener("click",e),function(){return t.removeEventListener("click",e)};function e(t){var e=t.target;if(e){if(e.hasAttribute("command-datapoint")){var n=e.getAttribute("command-datapoint"),i=e.getAttribute("command-value")||"";window.confirm('Send command "'.concat(n,'" with value "').concat(i,'"?'))&&jr("command","sendcommandmsg",{command_id:"cmd_"+Math.random().toString(36).slice(2),datapoint_identifier:n,value:i}).then(function(t){return window.alert((null==t?void 0:t.reason)||"Command sent!")}).catch(function(t){return window.alert("Error sending command: "+t.message)})}if(e.hasAttribute("command-communication")){var r=e.getAttribute("command-communication"),s=e.getAttribute("command-value")||"";window.confirm('Send driver command "'.concat(r,'" = "').concat(s,'"?'))&&jr("communication","driverconnectcommand",{driver_name:r,status:s}).then(function(t){return window.alert((null==t?void 0:t.reason)||"Command sent!")}).catch(function(t){return window.alert("Error sending driver command: "+t.message)})}}}},[h]),t.createElement("div",null,t.createElement("h2",null,"Animated SVGs"),t.createElement("select",{value:l||"",onChange:function(t){return u(t.target.value)},style:{marginBottom:8}},s.map(function(e){return t.createElement("option",{key:e,value:e},e)})),t.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:24}},t.createElement("div",{id:"svgContainer",ref:g,dangerouslySetInnerHTML:{__html:h},style:{minHeight:300,border:"1px solid #ccc",background:"#fafafa",borderRadius:6,padding:8}}),t.createElement("div",{style:{minWidth:250,maxWidth:400}},t.createElement("h3",null,"Explanation"),t.createElement("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"}},p||"No explanation available."))))}Rr.splitInnerHTML=xr,Rr.emojiSafeSplit=Cr,Rr.getText=function t(e){var n=e.nodeType,i="";if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=t(e)}else if(3===n||4===n)return e.nodeValue;return i},(Ir||"undefined"!=typeof window&&(Ir=window.gsap)&&Ir.registerPlugin&&Ir)&&Ir.registerPlugin(Rr),Lr.registerPlugin(Rr);const Zr=(0,t.createContext)(null),qr=Zr.Provider;function Xr(){const e=(0,t.useContext)(Zr);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var Qr=n(481),Jr=n.n(Qr);function ts(){return ts=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ts.apply(this,arguments)}function es({bounds:e,boundsOptions:n,center:i,children:r,className:s,id:a,placeholder:o,style:l,whenReady:u,zoom:c,...h},d){const[f]=(0,t.useState)({className:s,id:a,style:l}),[p,m]=(0,t.useState)(null);(0,t.useImperativeHandle)(d,()=>p?.map??null,[p]);const g=(0,t.useCallback)(t=>{if(null!==t&&null===p){const r=new Qr.Map(t,h);null!=i&&null!=c?r.setView(i,c):null!=e&&r.fitBounds(e,n),null!=u&&r.whenReady(u),m(function(t){return Object.freeze({__version:1,map:t})}(r))}},[]);(0,t.useEffect)(()=>()=>{p?.map.remove()},[p]);const v=p?t.createElement(qr,{value:p},r):o??null;return t.createElement("div",ts({},f,{ref:g}),v)}const ns=(0,t.forwardRef)(es);var is=n(961);function rs(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function ss(e,n){return null==n?function(n,i){const r=(0,t.useRef)();return r.current||(r.current=e(n,i)),r}:function(i,r){const s=(0,t.useRef)();s.current||(s.current=e(i,r));const a=(0,t.useRef)(i),{instance:o}=s.current;return(0,t.useEffect)(function(){a.current!==i&&(n(o,i,a.current),a.current=i)},[o,i,r]),s}}function as(e,n){const i=(0,t.useRef)(n);(0,t.useEffect)(function(){n!==i.current&&null!=e.attributionControl&&(null!=i.current&&e.attributionControl.removeAttribution(i.current),null!=n&&e.attributionControl.addAttribution(n)),i.current=n},[e,n])}function os(e,n){const i=(0,t.useRef)();(0,t.useEffect)(function(){return null!=n&&e.instance.on(n),i.current=n,function(){null!=i.current&&e.instance.off(i.current),i.current=null}},[e,n])}function ls(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function us(e){return function(n){const i=Xr(),r=e(ls(n,i),i);return as(i.map,n.attribution),os(r.current,n.eventHandlers),function(e,n){(0,t.useEffect)(function(){return(n.layerContainer??n.map).addLayer(e.instance),function(){n.layerContainer?.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}(r.current,i),r}}const cs=(hs=function({url:t,...e},n){return rs(new Qr.TileLayer(t,ls(e,n)),n)},function(e){function n(n,i){const{instance:r}=e(n).current;return(0,t.useImperativeHandle)(i,()=>r),null}return(0,t.forwardRef)(n)}(us(ss(hs,function(t,e,n){!function(t,e,n){const{opacity:i,zIndex:r}=e;null!=i&&i!==n.opacity&&t.setOpacity(i),null!=r&&r!==n.zIndex&&t.setZIndex(r)}(t,e,n);const{url:i}=e;null!=i&&i!==n.url&&t.setUrl(i)}))));var hs;const ds=function(e){function n(n,i){const{instance:r,context:s}=e(n).current;return(0,t.useImperativeHandle)(i,()=>r),null==n.children?null:t.createElement(qr,{value:s},n.children)}return(0,t.forwardRef)(n)}(us(ss(function({position:t,...e},n){const i=new Qr.Marker(t,e);return rs(i,(r=n,s={overlayContainer:i},Object.freeze({...r,...s})));var r,s},function(t,e,n){e.position!==n.position&&t.setLatLng(e.position),null!=e.icon&&e.icon!==n.icon&&t.setIcon(e.icon),null!=e.zIndexOffset&&e.zIndexOffset!==n.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),null!=e.opacity&&e.opacity!==n.opacity&&t.setOpacity(e.opacity),null!=t.dragging&&e.draggable!==n.draggable&&(!0===e.draggable?t.dragging.enable():t.dragging.disable())}))),fs=function(){const e=function(t,e){return function(n,i){const r=Xr(),s=t(ls(n,r),r);return as(r.map,n.attribution),os(s.current,n.eventHandlers),e(s.current,r,n,i),s}}(ss(function(t,e){return rs(new Qr.Popup(t,e.overlayContainer),e)}),function(e,n,{position:i},r){(0,t.useEffect)(function(){const{instance:t}=e;function s(e){e.popup===t&&(t.update(),r(!0))}function a(e){e.popup===t&&r(!1)}return n.map.on({popupopen:s,popupclose:a}),null==n.overlayContainer?(null!=i&&t.setLatLng(i),t.openOn(n.map)):n.overlayContainer.bindPopup(t),function(){n.map.off({popupopen:s,popupclose:a}),n.overlayContainer?.unbindPopup(),n.map.removeLayer(t)}},[e,n,r,i])});return function(e){function n(n,i){const[r,s]=(0,t.useState)(!1),{instance:a}=e(n,s).current;(0,t.useImperativeHandle)(i,()=>a),(0,t.useEffect)(function(){r&&a.update()},[a,r,n.children]);const o=a._contentNode;return o?(0,is.createPortal)(n.children,o):null}return(0,t.forwardRef)(n)}(e)}();var ps=n(81),ms={};function gs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function vs(e){var n=e.active,i=Xr().map;return(0,t.useEffect)(function(){n&&i&&setTimeout(function(){return i.invalidateSize()},300)},[n,i]),null}function ys(e){var n,i,r=e.active,s=e.onMarkerClick,a=(0,t.useRef)({}),o=(0,t.useCallback)(function(t){return t.id+"_"+t.latitude+"_"+t.longitude},[]),l=(n=Gr("gis","gisupdatemsg",o),i=1,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(n,i)||function(t,e){if(t){if("string"==typeof t)return gs(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gs(t,e):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0];return(0,t.useEffect)(function(){if(s&&l&&Object.values(l).length>0){var t=Object.values(l).find(function(t){return t.navigation});t&&s(t.navigation)}},[l,s]),t.createElement("div",{style:{height:"calc(100vh - 120px)",width:"100%",background:"#f0f0f0",borderRadius:"8px",overflow:"hidden"}},t.createElement(ns,{center:[47.4233,8.3064],zoom:16,style:{height:"100%",width:"100%"}},t.createElement(cs,{attribution:' <a href="https://www.swisstopo.admin.ch/">swisstopo</a> & OpenStreetMap',url:"https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.pixelkarte-farbe/default/current/3857/{z}/{x}/{y}.jpeg"}),t.createElement(vs,{active:r}),Object.values(l).map(function(e){var n=o(e),i=e.icon?new(Jr().Icon)({iconUrl:e.icon,iconSize:[50,50],iconAnchor:[25,50]}):new(Jr().Icon.Default);return t.createElement(ds,{key:n,position:[e.latitude,e.longitude],icon:i,ref:function(t){a.current[n]=t}},t.createElement(fs,null,t.createElement("div",null,t.createElement("strong",null,e.label||e.id),t.createElement("br",null),"Lat: ",e.latitude.toFixed(4)," ",t.createElement("br",null),"Lon: ",e.longitude.toFixed(4)," ",t.createElement("br",null),e.navigation&&s&&t.createElement("button",{style:{marginTop:"4px"},onClick:function(){s(e.navigation);var t=a.current[n];t&&t.closePopup&&t.closePopup()}},"Go to ",e.navigation.split("/").pop()))))})))}function _s(t){return _s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_s(t)}function bs(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Es(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Es(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Es(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Es(h,"constructor",u),Es(u,"constructor",l),l.displayName="GeneratorFunction",Es(u,r,"GeneratorFunction"),Es(h),Es(h,r,"Generator"),Es(h,i,function(){return this}),Es(h,"toString",function(){return"[object Generator]"}),(bs=function(){return{w:s,m:d}})()}function Es(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Es=function(t,e,n,i){function s(e,n){Es(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Es(t,e,n,i)}function Ts(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Ss(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ts(Object(n),!0).forEach(function(e){Ds(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ts(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Ds(t,e,n){return(e=function(t){var e=function(t){if("object"!=_s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_s(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ws(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function Ls(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function ks(t){return t.datapoint_identifier}function As(){var e,n,i=(e=Gr("datapoint","tagupdatemsg",ks),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Ls(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ls(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=i[0],s=i[1];function a(t,e){return o.apply(this,arguments)}function o(){return o=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){ws(s,i,r,a,o,"next",t)}function o(t){ws(s,i,r,a,o,"throw",t)}a(void 0)})}}(bs().m(function t(e,n){var i;return bs().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,jr("datapoint","rawtagupdatemsg",{datapoint_identifier:e,value:n,quality:"good"});case 1:t.n=3;break;case 2:t.p=2,i=t.v,window.alert("Update failed: "+i.message);case 3:return t.a(2)}},t,null,[[0,2]])})),o.apply(this,arguments)}return t.createElement("div",null,t.createElement("h2",null,"Tag List"),t.createElement("table",{id:"tag-table"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"Tag"),t.createElement("th",null,"Value"),t.createElement("th",null,"Quality"),t.createElement("th",null,"Timestamp"),t.createElement("th",null,"Action"))),t.createElement("tbody",null,Object.values(r).map(function(e){var n,i,r=void 0===e.value||null===e.value?"":e.value,o=null!==(n=e.quality)&&void 0!==n?n:"None",l=null!==(i=e.timestamp)&&void 0!==i?i:"None";return t.createElement("tr",{key:e.datapoint_identifier},t.createElement("td",null,e.datapoint_identifier),t.createElement("td",null,t.createElement("input",{type:"text",value:r,onChange:function(t){var n=t.target.value;s(function(t){return Ss(Ss({},t),{},Ds({},e.datapoint_identifier,Ss(Ss({},t[e.datapoint_identifier]),{},{value:n})))})},onKeyDown:function(t){"Enter"===t.key&&a(e.datapoint_identifier,t.target.value)}})),t.createElement("td",{className:"quality"},o),t.createElement("td",{className:"timestamp"},l),t.createElement("td",null,t.createElement("button",{onClick:function(){var t;return a(e.datapoint_identifier,null!==(t=e.value)&&void 0!==t?t:"")}},"Update")))}))))}function xs(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Cs(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Cs(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Cs(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Cs(h,"constructor",u),Cs(u,"constructor",l),l.displayName="GeneratorFunction",Cs(u,r,"GeneratorFunction"),Cs(h),Cs(h,r,"Generator"),Cs(h,i,function(){return this}),Cs(h,"toString",function(){return"[object Generator]"}),(xs=function(){return{w:s,m:d}})()}function Cs(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Cs=function(t,e,n,i){function s(e,n){Cs(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Cs(t,e,n,i)}function Is(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function Ps(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Rs(t){return t.driver_name}function Os(){var e,n,i=(e=Gr("communication","driverconnectstatus",Rs),n=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Ps(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ps(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],r=Object.values(i);function s(t,e){return a.apply(this,arguments)}function a(){return a=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){Is(s,i,r,a,o,"next",t)}function o(t){Is(s,i,r,a,o,"throw",t)}a(void 0)})}}(xs().m(function t(e,n){var i;return xs().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,jr("communication","driverconnectcommand",{driver_name:e,status:n});case 1:t.n=3;break;case 2:t.p=2,i=t.v,window.alert("Failed to send driver status update: "+i.message);case 3:return t.a(2)}},t,null,[[0,2]])})),a.apply(this,arguments)}return t.createElement("div",null,t.createElement("h2",null,"Driver Communications"),t.createElement("div",{className:"driver-list"},r.map(function(e){var n=e.driver_name,i=e.status,r="online"===i||"connect"===i;return t.createElement("div",{className:"driver-row",key:n,style:{display:"flex",alignItems:"center",gap:12,marginBottom:8}},t.createElement("span",{className:"status-indicator",style:{display:"inline-block",width:12,height:12,borderRadius:"50%",background:r?"green":"gray"}}),t.createElement("span",{className:"driver-name",style:{minWidth:100,fontWeight:500}},n),t.createElement("span",null,r?"Online":"Offline"),t.createElement("span",{className:"driver-actions",style:{marginLeft:"auto"}},t.createElement("button",{onClick:function(){return s(n,"connect")},disabled:r},"Set Online"),t.createElement("button",{onClick:function(){return s(n,"disconnect")},disabled:!r,style:{marginLeft:4}},"Set Offline")))})))}function Ms(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Fs(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Fs(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Fs(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Fs(h,"constructor",u),Fs(u,"constructor",l),l.displayName="GeneratorFunction",Fs(u,r,"GeneratorFunction"),Fs(h),Fs(h,r,"Generator"),Fs(h,i,function(){return this}),Fs(h,"toString",function(){return"[object Generator]"}),(Ms=function(){return{w:s,m:d}})()}function Fs(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Fs=function(t,e,n,i){function s(e,n){Fs(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Fs(t,e,n,i)}function Ns(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function Bs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Us(t){return t||"None"}function $s(t){return $s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$s(t)}function zs(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Gs(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Gs(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Gs(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Gs(h,"constructor",u),Gs(u,"constructor",l),l.displayName="GeneratorFunction",Gs(u,r,"GeneratorFunction"),Gs(h),Gs(h,r,"Generator"),Gs(h,i,function(){return this}),Gs(h,"toString",function(){return"[object Generator]"}),(zs=function(){return{w:s,m:d}})()}function Gs(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Gs=function(t,e,n,i){function s(e,n){Gs(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Gs(t,e,n,i)}function js(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Hs(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?js(Object(n),!0).forEach(function(e){Vs(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):js(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Vs(t,e,n){return(e=function(t){var e=function(t){if("object"!=$s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=$s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==$s(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ks(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function Ws(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Ys(t){return t.datapoint_identifier}function Zs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return qs(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qs(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qs(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Xs(t){return(t.track_id||"")+"_"+(t.timestamp||"")+"_"+(t.event_type||"")}function Qs(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function s(n,i,r,s){var l=i&&i.prototype instanceof o?i:o,u=Object.create(l.prototype);return Js(u,"_invoke",function(n,i,r){var s,o,l,u=0,c=r||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,o=0,l=t,d.n=n,a}};function f(n,i){for(o=n,l=i,e=0;!h&&u&&!r&&e<c.length;e++){var r,s=c[e],f=d.p,p=s[2];n>3?(r=p===i)&&(l=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=t):s[0]<=f&&((r=n<2&&f<s[1])?(o=0,d.v=i,d.n=s[1]):f<p&&(r=n<3||s[0]>i||i>p)&&(s[4]=n,s[5]=i,d.n=p,o=0))}if(r||n>1)return a;throw h=!0,i}return function(r,c,p){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,p),o=c,l=p;(e=o<2?t:l)||!h;){s||(o?o<3?(o>1&&(d.n=-1),f(o,l)):d.n=l:d.v=l);try{if(u=2,s){if(o||(r="next"),e=s[r]){if(!(e=e.call(s,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=s.return)&&e.call(s),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=t}else if((e=(h=d.n<0)?l:n.call(i,d))!==a)break}catch(e){s=t,o=1,l=e}finally{u=1}}return{value:e,done:h}}}(n,r,s),!0),u}var a={};function o(){}function l(){}function u(){}e=Object.getPrototypeOf;var c=[][i]?e(e([][i]())):(Js(e={},i,function(){return this}),e),h=u.prototype=o.prototype=Object.create(c);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Js(t,r,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=u,Js(h,"constructor",u),Js(u,"constructor",l),l.displayName="GeneratorFunction",Js(u,r,"GeneratorFunction"),Js(h),Js(h,r,"Generator"),Js(h,i,function(){return this}),Js(h,"toString",function(){return"[object Generator]"}),(Qs=function(){return{w:s,m:d}})()}function Js(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Js=function(t,e,n,i){function s(e,n){Js(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},Js(t,e,n,i)}function ta(t,e,n,i,r,s,a){try{var o=t[s](a),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,r)}function ea(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}ms.styleTagTransform=p(),ms.setAttributes=c(),ms.insert=l().bind(null,"head"),ms.domAPI=a(),ms.insertStyleElement=d(),r()(ps.A,ms),ps.A&&ps.A.locals&&ps.A.locals,delete Jr().Icon.Default.prototype._getIconUrl,Jr().Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});var na=(0,t.createContext)(),ia=function(e){var n,i,r=e.children,s=(n=Gr("alert","clientalertmsg",(0,t.useCallback)(function(t){return t.track_id},[])),i=1,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(n,i)||function(t,e){if(t){if("string"==typeof t)return ea(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ea(t,e):void 0}}(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],a=Object.values(s).find(function(t){return t&&t.show}),o=function(){var t=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){ta(s,i,r,a,o,"next",t)}function o(t){ta(s,i,r,a,o,"throw",t)}a(void 0)})}}(Qs().m(function t(e,n){var i;return Qs().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,jr("alert","clientalertfeedbackmsg",{track_id:e,feedback:n});case 1:t.n=3;break;case 2:t.p=2,i=t.v,window.alert("Failed to send alert feedback: "+i.message);case 3:return t.a(2)}},t,null,[[0,2]])}));return function(e,n){return t.apply(this,arguments)}}();return t.createElement(na.Provider,{value:{alert:a,sendFeedback:o}},r)};const ra=function(){var e=(0,t.useContext)(na),n=e.alert,i=e.sendFeedback;if(!n)return null;var r=n.message,s=n.alert_type,a=n.track_id,o=function(t){i(a,t)};return t.createElement("div",{className:"popup-overlay"},t.createElement("div",{className:"popup"},t.createElement("p",null,r),"accept"===s&&t.createElement("button",{onClick:function(){return o("accept")}},"Accept"),"confirm_cancel"===s&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:function(){return o("confirm")}},"Confirm"),t.createElement("button",{onClick:function(){return o("cancel")}},"Cancel"))))},sa=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},aa=Number.isSafeInteger||function(t){return"number"==typeof t&&Math.abs(t)<=oa},oa=Number.MAX_SAFE_INTEGER||9007199254740991;let la=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),ua=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",t.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",t.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.ASSET_LIST_LOAD_ERROR="assetListLoadError",t.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",t.ASSET_LIST_PARSING_ERROR="assetListParsingError",t.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.ATTACH_MEDIA_ERROR="attachMediaError",t.UNKNOWN="unknown",t}({}),ca=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.MEDIA_ENDED="hlsMediaEnded",t.STALL_RESOLVED="hlsStallResolved",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFERED_TO_END="hlsBufferedToEnd",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t.ASSET_LIST_LOADING="hlsAssetListLoading",t.ASSET_LIST_LOADED="hlsAssetListLoaded",t.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",t.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",t.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",t.INTERSTITIAL_STARTED="hlsInterstitialStarted",t.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",t.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",t.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",t.INTERSTITIAL_ENDED="hlsInterstitialEnded",t.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",t.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",t.EVENT_CUE_ENTER="hlsEventCueEnter",t}({});var ha="manifest",da="level",fa="audioTrack",pa="subtitleTrack",ma="main",ga="audio",va="subtitle";class ya{constructor(t,e=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}sample(t,e){const n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class _a{constructor(t,e,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ya(t),this.fast_=new ya(e),this.defaultTTFB_=i,this.ttfb_=new ya(t)}update(t,e){const{slow_:n,fast_:i,ttfb_:r}=this;n.halfLife!==t&&(this.slow_=new ya(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.fast_=new ya(e,i.getEstimate(),i.getTotalWeight())),r.halfLife!==t&&(this.ttfb_=new ya(t,r.getEstimate(),r.getTotalWeight()))}sample(t,e){const n=(t=Math.max(t,this.minDelayMs_))/1e3,i=8*e/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(t){const e=t/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(n,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function ba(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ea(){return Ea=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Ea.apply(null,arguments)}function Ta(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function Sa(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ta(Object(n),!0).forEach(function(e){ba(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ta(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}class Da{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${t}]:`;this.trace=wa,this.debug=e.debug.bind(null,n),this.log=e.log.bind(null,n),this.warn=e.warn.bind(null,n),this.info=e.info.bind(null,n),this.error=e.error.bind(null,n)}}const wa=function(){},La={trace:wa,debug:wa,log:wa,warn:wa,info:wa,error:wa};function ka(){return Ea({},La)}function Aa(t,e,n){return e[t]?e[t].bind(e):function(t,e){const n=self.console[t];return n?n.bind(self.console,`${e?"["+e+"] ":""}[${t}] >`):wa}(t,n)}const xa=ka(),Ca=xa;function Ia(t=!0){if("undefined"!=typeof self)return(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Pa(t,e){const n=Object.keys(t),i=Object.keys(e),r=n.length,s=i.length;return!r||!s||r===s&&!n.some(t=>-1===i.indexOf(t))}function Ra(t,e=!1){if("undefined"!=typeof TextDecoder){const n=new TextDecoder("utf-8").decode(t);if(e){const t=n.indexOf("\0");return-1!==t?n.substring(0,t):n}return n.replace(/\0/g,"")}const n=t.length;let i,r,s,a="",o=0;for(;o<n;){if(i=t[o++],0===i&&e)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:r=t[o++],a+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=t[o++],s=t[o++],a+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&s)}}return a}function Oa(t){let e="";for(let n=0;n<t.length;n++){let i=t[n].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function Ma(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Fa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Na,Ba,Ua,$a,za,Ga,ja={exports:{}},Ha=(Na||(Na=1,Ba=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,Ua=/^(?=([^\/?#]*))\1([^]*)$/,$a=/(?:\/|^)\.(?=\/)/g,za=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,ja.exports=Ga={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=Ga.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=Ga.normalizePath(i.path),Ga.buildURLFromParts(i)}var r=Ga.parseURL(e);if(!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return n.alwaysNormalize?(r.path=Ga.normalizePath(r.path),Ga.buildURLFromParts(r)):e;var s=Ga.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var a=Ua.exec(s.path);s.netLoc=a[1],s.path=a[2]}s.netLoc&&!s.path&&(s.path="/");var o={scheme:s.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment};if(!r.netLoc&&(o.netLoc=s.netLoc,"/"!==r.path[0]))if(r.path){var l=s.path,u=l.substring(0,l.lastIndexOf("/")+1)+r.path;o.path=Ga.normalizePath(u)}else o.path=s.path,r.params||(o.params=s.params,r.query||(o.query=s.query));return null===o.path&&(o.path=n.alwaysNormalize?Ga.normalizePath(r.path):r.path),Ga.buildURLFromParts(o)},parseURL:function(t){var e=Ba.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace($a,"");t.length!==(t=t.replace(za,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}}),ja.exports);class Va{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ka="audio",Wa="video",Ya="audiovideo";class Za{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof t&&(t={url:t}),this.base=t,function(t,e){const n=Ja(t,e);n&&(n.enumerable=!0,Object.defineProperty(t,e,n))}(this,"stats")}setByteRange(t,e){const n=t.split("@",2);let i;i=1===n.length?(null==e?void 0:e.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[Ka]:null,[Wa]:null,[Ya]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Va),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Ha.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Ka]=null,t[Wa]=null,t[Ya]=null}}function qa(t){return"initSegment"!==t.sn}class Xa extends Za{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(sa(t)&&sa(e))return e-t}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){var t;const{levelkeys:e}=this;if(!e||e.NONE)return null;if(e.identity)this._decryptdata||(this._decryptdata=e.identity.getDecryptData(this.sn));else if(null==(t=this._decryptdata)||!t.keyId){const t=Object.keys(e);if(1===t.length){const n=this._decryptdata=e[t[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,e))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const t=sa(this.duration)?this.duration:0;return this.programDateTime+1e3*t}get encrypted(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var e;const t=Object.keys(this.levelkeys),n=t.length;if(n>1||1===n&&null!=(e=this.levelkeys[t[0]])&&e.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){sa(t)?this._programDateTime=t:this._programDateTime=this.rawProgramDateTime=null}get ref(){return qa(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){const e=this.levelkeys;if(e){var n;const i=e[t];!i||null!=(n=this._decryptdata)&&n.keyId||(this._decryptdata=i.getDecryptData(this.sn,e))}}abortRequests(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()}setElementaryStreamInfo(t,e,n,i,r,s=!1){const{elementaryStreams:a}=this,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[t]={startPTS:e,endPTS:n,startDTS:i,endDTS:r,partial:s}}}class Qa extends Za{constructor(t,e,n,i,r){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=i;const s=t.enumeratedString("BYTERANGE");s&&this.setByteRange(s,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function Ja(t,e){const n=Object.getPrototypeOf(t);if(n){return Object.getOwnPropertyDescriptor(n,e)||Ja(n,e)}}const to=Math.pow(2,32)-1,eo=[].push,no={video:1,audio:2,id3:3,text:4};function io(t){return String.fromCharCode.apply(null,t)}function ro(t,e){const n=t[e]<<8|t[e+1];return n<0?65536+n:n}function so(t,e){const n=oo(t,e);return n<0?4294967296+n:n}function ao(t,e){let n=so(t,e);return n*=Math.pow(2,32),n+=so(t,e+4),n}function oo(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function lo(t,e){const n=[];if(!e.length)return n;const i=t.byteLength;for(let r=0;r<i;){const s=so(t,r),a=s>1?r+s:i;if(io(t.subarray(r+4,r+8))===e[0])if(1===e.length)n.push(t.subarray(r+8,a));else{const i=lo(t.subarray(r+8,a),e.slice(1));i.length&&eo.apply(n,i)}r=a}return n}function uo(t){const e=[],n=t[0];let i=8;const r=so(t,i);i+=4;let s=0,a=0;0===n?(s=so(t,i),a=so(t,i+4),i+=8):(s=ao(t,i),a=ao(t,i+8),i+=16),i+=2;let o=t.length+a;const l=ro(t,i);i+=2;for(let n=0;n<l;n++){let n=i;const s=so(t,n);n+=4;const a=2147483647&s;if(1==(2147483648&s)>>>31)return Ca.warn("SIDX has hierarchical references (not supported)"),null;const l=so(t,n);n+=4,e.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/r,start:o,end:o+a-1}}),o+=a,n+=4,i=n}return{earliestPresentationTime:s,timescale:r,version:n,referencesCount:l,references:e}}function co(t){const e=[],n=lo(t,["moov","trak"]);for(let t=0;t<n.length;t++){const i=n[t],r=lo(i,["tkhd"])[0];if(r){let t=r[0];const n=so(r,0===t?12:20),s=lo(i,["mdia","mdhd"])[0];if(s){t=s[0];const r=so(s,0===t?12:20),a=lo(i,["mdia","hdlr"])[0];if(a){const t=io(a.subarray(8,12)),s={soun:Ka,vide:Wa}[t],o=ho(lo(i,["mdia","minf","stbl","stsd"])[0]);s?(e[n]={timescale:r,type:s,stsd:o},e[s]=Sa({timescale:r,id:n},o)):e[n]={timescale:r,type:t,stsd:o}}}}}return lo(t,["moov","mvex","trex"]).forEach(t=>{const n=so(t,4),i=e[n];i&&(i.default={duration:so(t,12),flags:so(t,20)})}),e}function ho(t){const e=t.subarray(8),n=e.subarray(86),i=io(e.subarray(4,8));let r,s=i;const a="enca"===i||"encv"===i;if(a){const t=lo(e,[i])[0];lo(t.subarray("enca"===i?28:78),["sinf"]).forEach(t=>{const e=lo(t,["schm"])[0];if(e){const n=io(e.subarray(4,8));if("cbcs"===n||"cenc"===n){const e=lo(t,["frma"])[0];e&&(s=io(e))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const t=lo(n,["avcC"])[0];t&&t.length>3&&(s+="."+mo(t[1])+mo(t[2])+mo(t[3]),r=fo("avc1"===o?"dva1":"dvav",n));break}case"mp4a":{const t=lo(e,[i])[0],n=lo(t.subarray(28),["esds"])[0];if(n&&n.length>7){let t=4;if(3!==n[t++])break;t=po(n,t),t+=2;const e=n[t++];if(128&e&&(t+=2),64&e&&(t+=n[t++]),4!==n[t++])break;t=po(n,t);const i=n[t++];if(64!==i)break;if(s+="."+mo(i),t+=12,5!==n[t++])break;t=po(n,t);const r=n[t++];let a=(248&r)>>3;31===a&&(a+=1+((7&r)<<3)+((224&n[t])>>5)),s+="."+a}break}case"hvc1":case"hev1":{const t=lo(n,["hvcC"])[0];if(t&&t.length>12){const e=t[1],n=["","A","B","C"][e>>6],i=31&e,r=so(t,2),a=(32&e)>>5?"H":"L",o=t[12],l=t.subarray(6,12);s+="."+n+i,s+="."+function(t){let e=0;for(let n=0;n<32;n++)e|=(t>>n&1)<<31-n;return e>>>0}(r).toString(16).toUpperCase(),s+="."+a+o;let u="";for(let t=l.length;t--;){const e=l[t];(e||u)&&(u="."+e.toString(16).toUpperCase()+u)}s+=u}r=fo("hev1"==o?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":s=fo(s,n)||s;break;case"vp09":{const t=lo(n,["vpcC"])[0];if(t&&t.length>6){const e=t[4],n=t[5],i=t[6]>>4&15;s+="."+go(e)+"."+go(n)+"."+go(i)}break}case"av01":{const t=lo(n,["av1C"])[0];if(t&&t.length>2){const e=t[1]>>>5,i=31&t[1],a=t[2]>>>7?"H":"M",o=(64&t[2])>>6,l=(32&t[2])>>5,u=2===e&&o?l?12:10:o?10:8,c=(16&t[2])>>4,h=(8&t[2])>>3,d=(4&t[2])>>2,f=3&t[2],p=1,m=1,g=1,v=0;s+="."+e+"."+go(i)+a+"."+go(u)+"."+c+"."+h+d+f+"."+go(p)+"."+go(m)+"."+go(g)+"."+v,r=fo("dav1",n)}break}}return{codec:s,encrypted:a,supplemental:r}}function fo(t,e){const n=lo(e,["dvvC"]),i=n.length?n[0]:lo(e,["dvcC"])[0];if(i){const e=i[2]>>1&127,n=i[2]<<5&32|i[3]>>3&31;return t+"."+go(e)+"."+go(n)}}function po(t,e){const n=e+5;for(;128&t[e++]&&e<n;);return e}function mo(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function go(t){return(t<10?"0":"")+t}function vo(t,e){lo(t,["moov","trak"]).forEach(t=>{const n=lo(t,["mdia","minf","stbl","stsd"])[0];if(!n)return;const i=n.subarray(8);let r=lo(i,["enca"]);const s=r.length>0;s||(r=lo(i,["encv"])),r.forEach(t=>{lo(s?t.subarray(28):t.subarray(78),["sinf"]).forEach(t=>{const n=yo(t);n&&e(n,s)})})})}function yo(t){const e=lo(t,["schm"])[0];if(e){const n=io(e.subarray(4,8));if("cbcs"===n||"cenc"===n){const e=lo(t,["schi","tenc"])[0];if(e)return e}}}function _o(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function bo(t,e){const n=[],i=e.samples,r=e.timescale,s=e.id;let a=!1;return lo(i,["moof"]).map(o=>{const l=o.byteOffset-8;lo(o,["traf"]).map(o=>{const u=lo(o,["tfdt"]).map(t=>{const e=t[0];let n=so(t,4);return 1===e&&(n*=Math.pow(2,32),n+=so(t,8)),n/r})[0];return void 0!==u&&(t=u),lo(o,["tfhd"]).map(u=>{const c=so(u,4),h=16777215&so(u,0);let d=0;const f=!!(16&h);let p=0;const m=!!(32&h);let g=8;c===s&&(!!(1&h)&&(g+=8),!!(2&h)&&(g+=4),!!(8&h)&&(d=so(u,g),g+=4),f&&(p=so(u,g),g+=4),m&&(g+=4),"video"===e.type&&(a=Eo(e.codec)),lo(o,["trun"]).map(s=>{const o=s[0],u=16777215&so(s,0),c=!!(1&u);let h=0;const f=!!(4&u),m=!!(256&u);let g=0;const v=!!(512&u);let y=0;const _=!!(1024&u),b=!!(2048&u);let E=0;const T=so(s,4);let S=8;c&&(h=so(s,S),S+=4),f&&(S+=4);let D=h+l;for(let l=0;l<T;l++){if(m?(g=so(s,S),S+=4):g=d,v?(y=so(s,S),S+=4):y=p,_&&(S+=4),b&&(E=0===o?so(s,S):oo(s,S),S+=4),e.type===Wa){let e=0;for(;e<y;){const s=so(i,D);D+=4,To(a,i[D])&&So(i.subarray(D,D+s),a?2:1,t+E/r,n),D+=s,e+=s+4}}t+=g/r}}))})})}),n}function Eo(t){if(!t)return!1;const e=t.substring(0,4);return"hvc1"===e||"hev1"===e||"dvh1"===e||"dvhe"===e}function To(t,e){if(t){const t=e>>1&63;return 39===t||40===t}return 6==(31&e)}function So(t,e,n,i){const r=Do(t);let s=0;s+=e;let a=0,o=0,l=0;for(;s<r.length;){a=0;do{if(s>=r.length)break;l=r[s++],a+=l}while(255===l);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(255===l);const t=r.length-s;let e=s;if(o<t)s+=o;else if(o>t){Ca.error(`Malformed SEI payload. ${o} is too small, only ${t} bytes left to parse.`);break}if(4===a){if(181===r[e++]){const t=ro(r,e);if(e+=2,49===t){const t=so(r,e);if(e+=4,1195456820===t){const t=r[e++];if(3===t){const s=r[e++],o=64&s,l=o?2+3*(31&s):0,u=new Uint8Array(l);if(o){u[0]=s;for(let t=1;t<l;t++)u[t]=r[e++]}i.push({type:t,payloadType:a,pts:n,bytes:u})}}}}}else if(5===a&&o>16){const t=[];for(let n=0;n<16;n++){const i=r[e++].toString(16);t.push(1==i.length?"0"+i:i),3!==n&&5!==n&&7!==n&&9!==n||t.push("-")}const s=o-16,l=new Uint8Array(s);for(let t=0;t<s;t++)l[t]=r[e++];i.push({payloadType:a,pts:n,uuid:t.join(""),userData:Ra(l),userDataBytes:l})}}}function Do(t){const e=t.byteLength,n=[];let i=1;for(;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return t;const r=e-n.length,s=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),s[i]=t[a];return s}function wo(t){const e=t.getUint32(0),n=t.byteOffset,i=t.byteLength;if(i<e)return{offset:n,size:i};if(1886614376!==t.getUint32(4))return{offset:n,size:e};const r=t.getUint32(8)>>>24;if(0!==r&&1!==r)return{offset:n,size:e};const s=t.buffer,a=Oa(new Uint8Array(s,n+12,16));let o=null,l=null,u=0;if(0===r)u=28;else{const r=t.getUint32(28);if(!r||i<32+16*r)return{offset:n,size:e};o=[];for(let t=0;t<r;t++)o.push(new Uint8Array(s,n+32+16*t,16));u=32+16*r}if(!u)return{offset:n,size:e};const c=t.getUint32(u);return e-32<c?{offset:n,size:e}:(l=new Uint8Array(s,n+u+4,c),{version:r,systemId:a,kids:o,data:l,offset:n,size:e})}const Lo=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ko={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Ao(t,e){const n=ko[e];return!!n&&!!n[t.slice(0,4)]}function xo(t,e,n=!0){return!t.split(",").some(t=>!Co(t,e,n))}function Co(t,e,n=!0){var i;const r=Ia(n);return null!=(i=null==r?void 0:r.isTypeSupported(Io(t,e)))&&i}function Io(t,e){return`${e}/mp4;codecs=${t}`}function Po(t){if(t){const e=t.substring(0,4);return ko.video[e]}return 2}function Ro(t){const e=Lo();return t.split(",").reduce((t,n)=>{const i=e&&Eo(n)?9:ko.video[n];return i?(2*i+t)/(t?3:2):(ko.audio[n]+t)/(t?2:1)},0)}const Oo={},Mo=/flac|opus|mp4a\.40\.34/i;function Fo(t,e=!0){return t.replace(Mo,t=>function(t,e=!0){if(Oo[t])return Oo[t];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t];for(let r=0;r<n.length;r++){var i;if(Co(n[r],"audio",e))return Oo[t]=n[r],n[r];if("mp3"===n[r]&&null!=(i=Ia(e))&&i.isTypeSupported("audio/mpeg"))return""}return t}(t.toLowerCase(),e))}function No(t,e){if(t&&(t.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(t))&&(Bo(t,"audio")||Bo(t,"video")))return t;if(e){const n=e.split(",");if(n.length>1){if(t)for(let e=n.length;e--;)if(n[e].substring(0,4)===t.substring(0,4))return n[e];return n[0]}}return e||t}function Bo(t,e){return Ao(t,e)&&Co(t,e)}function Uo(t){if(t.startsWith("av01.")){const e=t.split("."),n=["0","111","01","01","01","0"];for(let t=e.length;t>4&&t<10;t++)e[t]=n[t-4];return e.join(".")}return t}function $o(t){const e=Ia(t)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function zo(t){return t.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Go={supported:!1,smooth:!1,powerEfficient:!1},jo={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Ho(t,e){return{supported:!1,configurations:e,decodingInfoResults:[Go],error:t}}function Vo(t,e,n,i,r,s){const a=t.videoCodec,o=t.audioCodec?t.audioGroups:null,l=null==s?void 0:s.audioCodec,u=null==s?void 0:s.channels,c=u?parseInt(u):l?1/0:2;let h=null;if(null!=o&&o.length)try{h=1===o.length&&o[0]?e.groups[o[0]].channels:o.reduce((t,n)=>{if(n){const i=e.groups[n];if(!i)throw new Error(`Audio track group ${n} not found`);Object.keys(i.channels).forEach(e=>{t[e]=(t[e]||0)+i.channels[e]})}return t},{2:0})}catch(t){return!0}return void 0!==a&&(a.split(",").some(t=>Eo(t))||t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(i,30)||"SDR"!==t.videoRange&&t.videoRange!==n||t.bitrate>Math.max(r,8e6))||!!h&&sa(c)&&Object.keys(h).some(t=>parseInt(t)>c)}function Ko(t,e,n,i={}){const r=t.videoCodec;if(!r&&!t.audioCodec||!n)return Promise.resolve(jo);const s=[],a=function(t){var e;const n=null==(e=t.videoCodec)?void 0:e.split(","),i=Yo(t),r=t.width||640,s=t.height||480,a=t.frameRate||30,o=t.videoRange.toLowerCase();return n?n.map(t=>{const e={contentType:Io(Uo(t),"video"),width:r,height:s,bitrate:i,framerate:a};return"sdr"!==o&&(e.transferFunction=o),e}):[]}(t),o=a.length,l=function(t,e,n){var i;const r=null==(i=t.audioCodec)?void 0:i.split(","),s=Yo(t);return r&&t.audioGroups?t.audioGroups.reduce((t,i)=>{var a;const o=i?null==(a=e.groups[i])?void 0:a.tracks:null;return o?o.reduce((t,e)=>{if(e.groupId===i){const i=parseFloat(e.channels||"");r.forEach(e=>{const r={contentType:Io(e,"audio"),bitrate:n?Wo(e,s):s};i&&(r.channels=""+i),t.push(r)})}return t},t):t},[]):[]}(t,e,o>0),u=l.length;for(let t=o||1*u||1;t--;){const e={type:"media-source"};if(o&&(e.video=a[t%o]),u){e.audio=l[t%u];const n=e.audio.bitrate;e.video&&n&&(e.video.bitrate-=n)}s.push(e)}if(r){const t=navigator.userAgent;if(r.split(",").some(t=>Eo(t))&&Lo())return Promise.resolve(Ho(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${t})`),s))}return Promise.all(s.map(t=>{const e=function(t){let e="";const{audio:n,video:i}=t;return i&&(e+=`${zo(i.contentType)}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`),n&&(e+=`${i?"_":""}${zo(n.contentType)}_c${n.channels}`),e}(t);return i[e]||(i[e]=n.decodingInfo(t))})).then(t=>({supported:!t.some(t=>!t.supported),configurations:s,decodingInfoResults:t})).catch(t=>({supported:!1,configurations:s,decodingInfoResults:[],error:t}))}function Wo(t,e){if(e<=1)return 1;let n=128e3;return"ec-3"===t?n=768e3:"ac-3"===t&&(n=64e4),Math.min(e/2,n)}function Yo(t){return 1e3*Math.ceil(Math.max(.9*t.bitrate,t.averageBitrate)/1e3)||1}const Zo=["NONE","TYPE-0","TYPE-1",null],qo=["SDR","PQ","HLG"];function Xo(t){const{canSkipUntil:e,canSkipDateRanges:n,age:i}=t;return e&&i<e/2?n?"v2":"YES":""}class Qo{constructor(t,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=n}addDirectives(t){const e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Jo{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const n=null==(e=t.supplemental)?void 0:e.videoCodec;n&&n!==t.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return tl(this._audioGroups,t)}hasSubtitleGroup(t){return tl(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e)if("audio"===t){let t=this._audioGroups;t||(t=this._audioGroups=[]),-1===t.indexOf(e)&&t.push(e)}else if("text"===t){let t=this._subtitleGroups;t||(t=this._subtitleGroups=[]),-1===t.indexOf(e)&&t.push(e)}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return null==(t=this.audioGroups)?void 0:t[0]}get textGroupId(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}addFallback(){}}function tl(t,e){return!(!e||!t)&&-1!==t.indexOf(e)}const el=(t,e)=>JSON.stringify(t,(t=>{const e=new WeakSet;return(n,i)=>{if(t&&(i=t(n,i)),"object"==typeof i&&null!==i){if(e.has(i))return;e.add(i)}return i}})(e));function nl(t,e){Ca.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function il(t){return t.reduce((t,e)=>{let n=t.groups[e.groupId];n||(n=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(e);const i=e.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||e.default,n.hasAutoSelect=n.hasAutoSelect||e.autoselect,n.hasDefault&&(t.hasDefaultAudio=!0),n.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function rl(t){if(!t)return t;const{lang:e,assocLang:n,characteristics:i,channels:r,audioCodec:s}=t;return{lang:e,assocLang:n,characteristics:i,channels:r,audioCodec:s}}function sl(t,e,n){if("attrs"in t){const n=e.indexOf(t);if(-1!==n)return n}for(let i=0;i<e.length;i++)if(al(t,e[i],n))return i;return-1}function al(t,e,n){const{groupId:i,name:r,lang:s,assocLang:a,default:o}=t,l=t.forced;return(void 0===i||e.groupId===i)&&(void 0===r||e.name===r)&&(void 0===s||function(t,e="--"){return t.length===e.length?t===e:t.startsWith(e)||e.startsWith(t)}(s,e.lang))&&(void 0===s||e.assocLang===a)&&(void 0===o||e.default===o)&&(void 0===l||e.forced===l)&&(!("characteristics"in t)||function(t,e=""){const n=t.split(","),i=e.split(",");return n.length===i.length&&!n.some(t=>-1===i.indexOf(t))}(t.characteristics||"",e.characteristics))&&(void 0===n||n(t,e))}function ol(t,e){const{audioCodec:n,channels:i}=t;return!(void 0!==n&&(e.audioCodec||"").substring(0,4)!==n.substring(0,4)||void 0!==i&&i!==(e.channels||"2"))}function ll(t,e,n){for(let i=e;i>-1;i--)if(n(t[i]))return i;for(let i=e+1;i<t.length;i++)if(n(t[i]))return i;return-1}function ul(t,e){var n;return!!t&&t!==(null==(n=e.loadLevelObj)?void 0:n.uri)}const cl=function(t,e){let n=0,i=t.length-1,r=null,s=null;for(;n<=i;){r=(n+i)/2|0,s=t[r];const a=e(s);if(a>0)n=r+1;else{if(!(a<0))return s;i=r-1}}return null};function hl(t,e,n=0,i=0,r=.005){let s=null;if(t){s=e[1+t.sn-e[0].sn]||null;const i=t.endDTS-n;i>0&&i<15e-7&&(n+=15e-7),s&&t.level!==s.level&&s.end<=t.end&&(s=e[2+t.sn-e[0].sn]||null)}else 0===n&&0===e[0].start&&(s=e[0]);if(s&&((!t||t.level===s.level)&&0===dl(n,i,s)||function(t,e,n){if(e&&0===e.start&&e.level<t.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((t,e)=>("INF"===e[0]&&(t+=parseFloat(e[1])),t),n);return t.start<=i}return!1}(s,t,Math.min(r,i))))return s;const a=cl(e,dl.bind(null,n,i));return!a||a===t&&s?s:a}function dl(t=0,e=0,n){if(n.start<=t&&n.start+n.duration>t)return 0;const i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=t?1:n.start-i>t&&n.start?-1:0}function fl(t,e,n){const i=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>t}function pl(t,e,n){if(t&&t.startCC<=e&&t.endCC>=e){let i=t.fragments;const{fragmentHint:r}=t;let s;return r&&(i=i.concat(r)),cl(i,t=>t.cc<e?1:t.cc>e?-1:(s=t,t.end<=n?1:t.start>n?-1:0)),s||null}return null}function ml(t){switch(t.details){case ua.FRAG_LOAD_TIMEOUT:case ua.KEY_LOAD_TIMEOUT:case ua.LEVEL_LOAD_TIMEOUT:case ua.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function gl(t){return t.details.startsWith("key")}function vl(t){return gl(t)&&!!t.frag&&!t.frag.decryptdata}function yl(t,e){const n=ml(e);return t.default[(n?"timeout":"error")+"Retry"]}function _l(t,e){const n="linear"===t.backoff?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function bl(t){return Sa(Sa({},t),{errorRetry:null,timeoutRetry:null})}function El(t,e,n,i){if(!t)return!1;const r=null==i?void 0:i.code,s=e<t.maxNumRetry&&(function(t){return Tl(t)||!!t&&(t<400||t>499)}(r)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,i,s):s}function Tl(t){return 0===t&&!1===navigator.onLine}function Sl(t){const e={action:0,flags:0};return t&&(e.resolved=!0),e}var Dl="NOT_LOADED",wl="APPENDING",Ll="PARTIAL",kl="OK";class Al{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.BUFFER_APPENDED,this.onBufferAppended,this),t.on(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ca.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.BUFFER_APPENDED,this.onBufferAppended,this),t.off(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ca.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const n=this.activePartLists[e];if(n)for(let e=n.length;e--;){const i=n[e];if(!i)break;if(i.start<=t&&t<=i.end&&i.loaded)return i}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,n){const{fragments:i}=this,r=Object.keys(i);for(let s=r.length;s--;){const a=i[r[s]];if((null==a?void 0:a.body.type)===e&&(!n||a.buffered)){const e=a.body;if(e.start<=t&&t<=e.end)return e}}return null}detectEvictedFragments(t,e,n,i,r){this.timeRanges&&(this.timeRanges[t]=e);const s=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;if(s>=a.body.sn)return;if(!a.buffered&&(!a.loaded||r))return void(a.body.type===n&&this.removeFragment(a.body));const o=a.range[t];o&&(0!==o.time.length?o.time.some(t=>{const n=!this.isTimeBuffered(t.startPTS,t.endPTS,e);return n&&this.removeFragment(a.body),n}):this.removeFragment(a.body))})}detectPartialFragments(t){const e=this.timeRanges;if(!e||"initSegment"===t.frag.sn)return;const n=t.frag,i=Cl(n),r=this.fragments[i];if(!r||r.buffered&&n.gap)return;const s=!n.relurl;Object.keys(e).forEach(i=>{const a=n.elementaryStreams[i];if(!a)return;const o=e[i],l=s||!0===a.partial;r.range[i]=this.getBufferedTimes(n,t.part,l,o)}),r.loaded=null,Object.keys(r.range).length?(r.buffered=!0,(r.body.endList=n.endList||r.body.endList)&&(this.endListFragments[r.body.type]=r),xl(r)||this.removeParts(n.sn-1,n.type)):this.removeFragment(r.body)}removeParts(t,e){const n=this.activePartLists[e];n&&(this.activePartLists[e]=Il(n,e=>e.fragment.sn>=t))}fragBuffered(t,e){const n=Cl(t);let i=this.fragments[n];!i&&e&&(i=this.fragments[n]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(t,e,n,i){const r={time:[],partial:n},s=t.start,a=t.end,o=t.minEndPTS||a,l=t.maxStartPTS||s;for(let t=0;t<i.length;t++){const e=i.start(t)-this.bufferPadding,n=i.end(t)+this.bufferPadding;if(l>=e&&o<=n){r.time.push({startPTS:Math.max(s,i.start(t)),endPTS:Math.min(a,i.end(t))});break}if(s<n&&a>e){const e=Math.max(s,i.start(t)),n=Math.min(a,i.end(t));n>e&&(r.partial=!0,r.time.push({startPTS:e,endPTS:n}))}else if(a<=e)break}return r}getPartialFragment(t){let e,n,i,r=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&xl(u)&&(n=u.body.start-a,i=u.body.end+a,t>=n&&t<=i&&(e=Math.min(t-n,i-t),s<=e&&(r=u.body,s=e)))}),r}isEndListAppended(t){const e=this.endListFragments[t];return void 0!==e&&(e.buffered||xl(e))}getState(t){const e=Cl(t),n=this.fragments[e];return n?n.buffered?xl(n)?Ll:kl:wl:Dl}isTimeBuffered(t,e,n){let i,r;for(let s=0;s<n.length;s++){if(i=n.start(s)-this.bufferPadding,r=n.end(s)+this.bufferPadding,t>=i&&e<=r)return!0;if(e<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if("initSegment"===e.frag.sn||e.frag.bitrateTest)return;const n=e.frag,i=e.part?null:e,r=Cl(n);this.fragments[r]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:n,part:i,timeRanges:r,type:s}=e;if("initSegment"===n.sn)return;const a=n.type;if(i){let t=this.activePartLists[a];t||(this.activePartLists[a]=t=[]),t.push(i)}this.timeRanges=r;const o=r[s];this.detectEvictedFragments(s,o,a,i)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=Cl(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,n=Object.keys(e);if(!t)return n.length>0;for(let i=n.length;i--;){const r=e[n[i]];if((null==r?void 0:r.body.type)===t)return!0}return!1}hasParts(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)}removeFragmentsInRange(t,e,n,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==n||i&&!o.gap||o.start<e&&o.end>t&&(a.buffered||r)&&this.removeFragment(o)})}removeFragment(t){const e=Cl(t);t.clearElementaryStreamInfo();const n=this.activePartLists[t.type];if(n){const e=t.sn;this.activePartLists[t.type]=Il(n,t=>t.fragment.sn!==e)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=null==(t=this.hls)||null==(t=t.latestLevelDetails)?void 0:t.partList;e&&e.forEach(t=>t.clearElementaryStreamInfo())}}function xl(t){var e,n,i;return t.buffered&&!!(t.body.gap||null!=(e=t.range.video)&&e.partial||null!=(n=t.range.audio)&&n.partial||null!=(i=t.range.audiovideo)&&i.partial)}function Cl(t){return`${t.type}_${t.level}_${t.sn}`}function Il(t,e){return t.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}class Pl{constructor(t,e,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=n}decrypt(t,e){switch(this.aesMode){case 0:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case 1:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class Rl{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),n=new Uint32Array(4);for(let t=0;t<4;t++)n[t]=e.getUint32(4*t);return n}initTable(){const t=this.sBox,e=this.invSBox,n=this.subMix,i=n[0],r=n[1],s=n[2],a=n[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],d=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,t[f]=n,e[n]=f;const o=d[f],m=d[o],g=d[m];let v=257*d[n]^16843008*n;i[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,a[f]=v,v=16843009*g^65537*m^257*o^16843008*f,l[n]=v<<24|v>>>8,u[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,h[n]=v,f?(f=o^d[d[d[g^o]]],p^=d[d[p]]):f=p=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let n=!0,i=0;for(;i<e.length&&n;)n=e[i]===this.key[i],i++;if(n)return;this.key=e;const r=this.keySize=e.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const s=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),u=this.invKeySchedule=new Uint32Array(s),c=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],m=d[2],g=d[3];let v,y;for(a=0;a<s;a++)a<r?v=l[a]=e[a]:(y=v,a%r===0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=h[a/r|0]<<24):r>6&&a%r===4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),l[a]=v=(l[a-r]^y)>>>0);for(o=0;o<s;o++)a=s-o,y=3&o?l[a]:l[a-4],u[o]=o<4||a<=4?y:f[c[y>>>24]]^p[c[y>>>16&255]]^m[c[y>>>8&255]]^g[c[255&y]],u[o]=u[o]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}decrypt(t,e,n){const i=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],u=a[2],c=a[3],h=this.uint8ArrayToUint32Array_(n);let d=h[0],f=h[1],p=h[2],m=h[3];const g=new Int32Array(t),v=new Int32Array(g.length);let y,_,b,E,T,S,D,w,L,k,A,x,C,I;const P=this.networkToHostOrderSwap;for(;e<g.length;){for(L=P(g[e]),k=P(g[e+1]),A=P(g[e+2]),x=P(g[e+3]),T=L^r[0],S=x^r[1],D=A^r[2],w=k^r[3],C=4,I=1;I<i;I++)y=o[T>>>24]^l[S>>16&255]^u[D>>8&255]^c[255&w]^r[C],_=o[S>>>24]^l[D>>16&255]^u[w>>8&255]^c[255&T]^r[C+1],b=o[D>>>24]^l[w>>16&255]^u[T>>8&255]^c[255&S]^r[C+2],E=o[w>>>24]^l[T>>16&255]^u[S>>8&255]^c[255&D]^r[C+3],T=y,S=_,D=b,w=E,C+=4;y=s[T>>>24]<<24^s[S>>16&255]<<16^s[D>>8&255]<<8^s[255&w]^r[C],_=s[S>>>24]<<24^s[D>>16&255]<<16^s[w>>8&255]<<8^s[255&T]^r[C+1],b=s[D>>>24]<<24^s[w>>16&255]<<16^s[T>>8&255]<<8^s[255&S]^r[C+2],E=s[w>>>24]<<24^s[T>>16&255]<<16^s[S>>8&255]<<8^s[255&D]^r[C+3],v[e]=P(y^d),v[e+1]=P(E^f),v[e+2]=P(b^p),v[e+3]=P(_^m),d=L,f=k,p=A,m=x,e+=4}return v.buffer}}class Ol{constructor(t,e,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=n}expandKey(){const t=function(t){switch(t){case 0:return"AES-CBC";case 1:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${t}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}class Ml{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch(t){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const n=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?function(t){const e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?t.slice(0,e-n):t}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,n,i){return this.useSoftware?new Promise((r,s)=>{const a=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(a,e,n,i);const o=this.flush();o?r(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,n,i)}softwareDecrypt(t,e,n,i){const{currentIV:r,currentResult:s,remainderData:a}=this;if(0!==i||16!==e.byteLength)return Ca.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(t=_o(a,t),this.remainderData=null);const o=this.getValidChunk(t);if(!o.length)return null;r&&(n=r);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new Rl),l.expandKey(e);const u=s;return this.currentResult=l.decrypt(o.buffer,0,n),this.currentIV=o.slice(-16).buffer,u||null}webCryptoDecrypt(t,e,n,i){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,n,i));this.key=e,this.fastAesKey=new Ol(this.subtle,e,i)}return this.fastAesKey.expandKey().then(e=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Pl(this.subtle,new Uint8Array(n),i).decrypt(t.buffer,e)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Ca.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(t,e,n,i)))}onWebCryptoError(t,e,n,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,n,i);const r=this.flush();if(r)return r.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const n=t.length-t.length%16;return n!==t.length&&(e=t.slice(0,n),this.remainderData=t.slice(n)),e}logOnce(t){this.logEnabled&&(Ca.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Fl=Math.pow(2,17);class Nl{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const n=t.url;if(!n)return Promise.reject(new $l({type:la.NETWORK_ERROR,details:ua.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),t.gap){if(t.tagList.some(t=>"GAP"===t[0]))return void o(Ul(t));t.gap=!1}const l=this.loader=r?new r(i):new s(i),u=Bl(t);t.loader=l;const c=bl(i.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:Fl};t.stats=l.stats;const d={onSuccess:(e,n,i,r)=>{this.resetLoader(t,l);let s=e.data;i.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:t,part:null,payload:s,networkDetails:r})},onError:(e,i,r,s)=>{this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:Sa({url:n,data:void 0},e),error:new Error(`HTTP Error ${e.code} ${e.text}`),networkDetails:r,stats:s}))},onAbort:(e,n,i)=>{this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:i,stats:e}))},onTimeout:(e,n,i)=>{this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:e}))}};e&&(d.onProgress=(n,i,r,s)=>e({frag:t,part:null,payload:r,networkDetails:s})),l.load(u,h,d)})}loadPart(t,e,n){this.abort();const i=this.config,r=i.fLoader,s=i.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap)return void o(Ul(t,e));const l=this.loader=r?new r(i):new s(i),u=Bl(t,e);t.loader=l;const c=bl(i.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Fl};e.stats=l.stats,l.load(u,h,{onSuccess:(i,r,s,o)=>{this.resetLoader(t,l),this.updateStatsFromPart(t,e);const u={frag:t,part:e,payload:i.data,networkDetails:o};n(u),a(u)},onError:(n,i,r,s)=>{this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:Sa({url:u.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:r,stats:s}))},onAbort:(n,i,r)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:r,stats:n}))},onTimeout:(n,i,r)=>{this.resetLoader(t,l),o(new $l({type:la.NETWORK_ERROR,details:ua.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:n}))}})})}updateStatsFromPart(t,e){const n=t.stats,i=e.stats,r=i.total;if(n.loaded+=i.loaded,r){const i=Math.round(t.duration/e.duration),s=Math.min(Math.round(n.loaded/r),i),a=(i-s)*Math.round(n.loaded/s);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);const s=n.loading,a=i.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Bl(t,e=null){const n=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},r=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(sa(r)&&sa(s)){var a;let e=r,n=s;if("initSegment"===t.sn&&("AES-128"===(o=null==(a=t.decryptdata)?void 0:a.method)||"AES-256"===o)){const t=s-r;t%16&&(n=s+(16-t%16)),0!==r&&(i.resetIV=!0,e=r-16)}i.rangeStart=e,i.rangeEnd=n}var o;return i}function Ul(t,e){const n=new Error(`GAP ${t.gap?"tag":"attribute"} found`),i={type:la.MEDIA_ERROR,details:ua.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(i.part=e),(e||t).stats.aborted=!0,new $l(i)}class $l extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class zl extends Da{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Gl{constructor(t,e,n,i=0,r=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=n,this.size=i,this.part=r,this.partial=s}}const jl={length:0,start:()=>0,end:()=>0};class Hl{static isBuffered(t,e){if(t){const n=Hl.getBuffered(t);for(let t=n.length;t--;)if(e>=n.start(t)&&e<=n.end(t))return!0}return!1}static bufferedRanges(t){if(t){const e=Hl.getBuffered(t);return Hl.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let n=0;n<t.length;n++)e.push({start:t.start(n),end:t.end(n)});return e}static bufferInfo(t,e,n){if(t){const i=Hl.bufferedRanges(t);if(i.length)return Hl.bufferedInfo(i,e,n)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,n){e=Math.max(0,e),t.length>1&&t.sort((t,e)=>t.start-e.start||e.end-t.end);let i=-1,r=[];if(n)for(let s=0;s<t.length;s++){e>=t[s].start&&e<=t[s].end&&(i=s);const a=r.length;if(a){const e=r[a-1].end;t[s].start-e<n?t[s].end>e&&(r[a-1].end=t[s].end):r.push(t[s])}else r.push(t[s])}else r=t;let s,a=0,o=e,l=e;for(let t=0;t<r.length;t++){const u=r[t].start,c=r[t].end;if(-1===i&&e>=u&&e<=c&&(i=t),e+n>=u&&e<c)o=u,l=c,a=l-e;else if(e+n<u){s=u;break}}return{len:a,start:o||0,end:l||0,nextStart:s,buffered:t,bufferedIndex:i}}static getBuffered(t){try{return t.buffered||jl}catch(t){return Ca.log("failed to get media.buffered",t),jl}}}const Vl=/\{\$([a-zA-Z0-9-_]+)\}/g;function Kl(t){return Vl.test(t)}function Wl(t,e){if(null!==t.variableList||t.hasVariableRefs){const n=t.variableList;return e.replace(Vl,e=>{const i=e.substring(2,e.length-1),r=null==n?void 0:n[i];return void 0===r?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),e):r})}return e}function Yl(t,e,n){let i,r,s=t.variableList;if(s||(t.variableList=s={}),"QUERYPARAM"in e){i=e.QUERYPARAM;try{const t=new self.URL(n).searchParams;if(!t.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${n}"`);r=t.get(i)}catch(e){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${e.message}`))}}else i=e.NAME,r=e.VALUE;i in s?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=r||""}function Zl(t,e,n){const i=e.IMPORT;if(n&&i in n){let e=t.variableList;e||(t.variableList=e={}),e[i]=n[i]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const ql=/^(\d+)x(\d+)$/,Xl=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ql{constructor(t,e){"string"==typeof t&&(t=Ql.parseAttrList(t,e)),Ea(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>"X-"===t.substring(0,2))}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;const n=new Uint8Array(e.length/2);for(let t=0;t<e.length/2;t++)n[t]=parseInt(e.slice(2*t,2*t+2),16);return n}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const n=this[t];return n?parseFloat(n):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const n=this[t];return(n?n.split(/[ ,]+/):[]).reduce((t,e)=>(t[e.toLowerCase()]=!0,t),e)}bool(t){return"YES"===this[t]}decimalResolution(t){const e=ql.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let n;const i={};for(Xl.lastIndex=0;null!==(n=Xl.exec(t));){const r=n[1].trim();let s=n[2];const a=0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1;let o=!1;if(a)s=s.slice(1,-1);else switch(r){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(e&&(a||o))s=Wl(e,s);else if(!o&&!a)switch(r){case"CLOSED-CAPTIONS":if("NONE"===s)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ca.warn(`${t}: attribute ${r} is missing quotes`)}i[r]=s}return i}}function Jl(t){return"ID"!==t&&"CLASS"!==t&&"CUE"!==t&&"START-DATE"!==t&&"DURATION"!==t&&"END-DATE"!==t&&"END-ON-NEXT"!==t}function tu(t){return"SCTE35-OUT"===t||"SCTE35-IN"===t||"SCTE35-CMD"===t}class eu{constructor(t,e,n=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==e?void 0:e.tagAnchor)||null,this.tagOrder=null!=(i=null==e?void 0:e.tagOrder)?i:n,e){const n=e.attr;for(const e in n)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==n[e]){Ca.warn(`DATERANGE tag attribute: "${e}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=e;break}t=Ea(new Ql({}),n,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const t=(null==e?void 0:e.endDate)||new Date(this.attr["END-DATE"]);sa(t.getTime())&&(this._endDate=t)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return void 0===t?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return null===t||null===t.programDateTime?(Ca.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return null!==e?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(sa(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&sa(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class nu{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t)return this.advanced=!0,void(this.updated=!0);const e=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1}hasKey(t){return this.encryptedFragments.some(e=>{let n=e.decryptdata;return n||(e.setKeyFormat(t.keyFormat),n=e.decryptdata),!!n&&t.matches(n)})}get hasProgramDateTime(){return!!this.fragments.length&&sa(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(-1!==e){for(let n=t.length;n--;)if(t[n].index>e)return t[n].index;return e}}return 0}get lastPartSn(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function iu(t,e){return t.length===e.length&&!t.some((t,n)=>t!==e[n])}function ru(t,e){return!t&&!e||!(!t||!e)&&iu(t,e)}function su(t){return"AES-128"===t||"AES-256"===t||"AES-256-CTR"===t}function au(t){switch(t){case"AES-128":case"AES-256":return 0;case"AES-256-CTR":return 1;default:throw new Error(`invalid full segment method ${t}`)}}function ou(t){return Uint8Array.from(atob(t),t=>t.charCodeAt(0))}function lu(t){return Uint8Array.from(unescape(encodeURIComponent(t)),t=>t.charCodeAt(0))}function uu(t){const e=function(t,e,n){const i=t[e];t[e]=t[n],t[n]=i};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function cu(t){const e=t.split(":");let n=null;if("data"===e[0]&&2===e.length){const t=e[1].split(";"),i=t[t.length-1].split(",");if(2===i.length){const e="base64"===i[0],r=i[1];e?(t.splice(-1,1),n=ou(r)):n=function(t){const e=lu(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}(r)}}return n}const hu="undefined"!=typeof self?self:void 0;var du={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},fu="org.w3.clearkey",pu="com.apple.streamingkeydelivery",mu="com.microsoft.playready",gu="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function vu(t){switch(t){case pu:return du.FAIRPLAY;case mu:return du.PLAYREADY;case gu:return du.WIDEVINE;case fu:return du.CLEARKEY}}function yu(t){switch(t){case du.FAIRPLAY:return pu;case du.PLAYREADY:return mu;case du.WIDEVINE:return gu;case du.CLEARKEY:return fu}}function _u(t){const{drmSystems:e,widevineLicenseUrl:n}=t,i=e?[du.FAIRPLAY,du.WIDEVINE,du.PLAYREADY,du.CLEARKEY].filter(t=>!!e[t]):[];return!i[du.WIDEVINE]&&n&&i.push(du.WIDEVINE),i}const bu=null!=hu&&null!=(Eu=hu.navigator)&&Eu.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Eu;function Tu(t){const e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(e)),i=n.substring(n.indexOf("<"),n.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const t=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(t){const e=ou(t).subarray(0,16);return uu(e),e}}return null}let Su={};class Du{static clearKeyUriToKeyIdMap(){Su={}}static setKeyIdForUri(t,e){Su[t]=e}constructor(t,e,n,i=[1],r=null,s){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=n,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&!su(t),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(Ma(s)))}matches(t){return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&iu(t.keyFormatVersions,this.keyFormatVersions)&&ru(t.iv,this.iv)&&ru(t.keyId,this.keyId)}isSupported(){if(this.method){if(su(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case pu:case gu:case mu:case fu:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t,e){if(!this.encrypted||!this.uri)return null;if(su(this.method)){let e=this.iv;return e||("number"!=typeof t&&(Ca.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0),e=function(t){const e=new Uint8Array(16);for(let n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}(t)),new Du(this.method,this.uri,"identity",this.keyFormatVersions,e)}if(this.keyId){const t=Su[this.uri];if(t&&!iu(this.keyId,t)&&Du.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=cu(this.uri);if(n)switch(this.keyFormat){case gu:if(this.pssh=n,!this.keyId){const t=function(t){const e=[];if(t instanceof ArrayBuffer){const n=t.byteLength;let i=0;for(;i+32<n;){const n=wo(new DataView(t,i));e.push(n),i+=n.size}}return e}(n.buffer);if(t.length){var i;const e=t[0];this.keyId=null!=(i=e.kids)&&i.length?e.kids[0]:null}}this.keyId||(this.keyId=wu(e));break;case mu:{const t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(t,e,n){if(16!==t.byteLength)throw new RangeError("Invalid system id");let i,r,s;i=0,r=new Uint8Array,s=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),function(t,...e){const n=e.length;let i=8,r=n;for(;r--;)i+=e[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(t,4),r=0,i=8;r<n;r++)s.set(e[r],i),i+=e[r].byteLength;return s}([112,115,115,104],new Uint8Array([0,0,0,0]),t,s,r,a,n)}(t,0,n),this.keyId=Tu(n);break}default:{let t=n.subarray(0,16);if(16!==t.length){const e=new Uint8Array(16);e.set(t,16-t.length),t=e}this.keyId=t;break}}if(!this.keyId||16!==this.keyId.byteLength){let t;t=function(t){const e=null==t?void 0:t[gu];return e?e.keyId:null}(e),t||(t=wu(e),t||(t=Su[this.uri])),t&&(this.keyId=t,Du.setKeyIdForUri(this.uri,t))}return this}}function wu(t){const e=null==t?void 0:t[mu];if(e){const t=cu(e.uri);if(t)return Tu(t)}return null}const Lu=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ku=/#EXT-X-MEDIA:(.*)/g,Au=/^#EXT(?:INF|-X-TARGETDURATION):/m,xu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Cu=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Iu{static findGroup(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i.id===e)return i}}static resolve(t,e){return Ha.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return Au.test(t)}static parseMasterPlaylist(t,e){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Kl(t)},i=[];if(Lu.lastIndex=0,!t.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let r;for(;null!=(r=Lu.exec(t));)if(r[1]){var s;const t=new Ql(r[1],n),a=Wl(n,r[2]),o={attrs:t,bitrate:t.decimalInteger("BANDWIDTH")||t.decimalInteger("AVERAGE-BANDWIDTH"),name:t.NAME,url:Iu.resolve(a,e)},l=t.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),Fu(t.CODECS,o);const u=t["SUPPLEMENTAL-CODECS"];u&&(o.supplemental={},Fu(u,o.supplemental)),null!=(s=o.unknownCodecs)&&s.length||i.push(o),n.levels.push(o)}else if(r[3]){const t=r[3],i=r[4];switch(t){case"SESSION-DATA":{const t=new Ql(i,n),e=t["DATA-ID"];e&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[e]=t);break}case"SESSION-KEY":{const t=Ou(i,e,n);t.encrypted&&t.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(t)):Ca.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":Yl(n,new Ql(i,n),e);break;case"CONTENT-STEERING":{const t=new Ql(i,n);n.contentSteering={uri:Iu.resolve(t["SERVER-URI"],e),pathwayId:t["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=Mu(i)}}const a=i.length>0&&i.length<n.levels.length;return n.levels=a?i:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(t,e,n){let i;const r={},s=n.levels,a={AUDIO:s.map(t=>({id:t.attrs.AUDIO,audioCodec:t.audioCodec})),SUBTITLES:s.map(t=>({id:t.attrs.SUBTITLES,textCodec:t.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(ku.lastIndex=0;null!==(i=ku.exec(t));){const t=new Ql(i[1],n),s=t.TYPE;if(s){const n=a[s],i=r[s]||[];r[s]=i;const l=t.LANGUAGE,u=t["ASSOC-LANGUAGE"],c=t.CHANNELS,h=t.CHARACTERISTICS,d=t["INSTREAM-ID"],f={attrs:t,bitrate:0,id:o++,groupId:t["GROUP-ID"]||"",name:t.NAME||l||"",type:s,default:t.bool("DEFAULT"),autoselect:t.bool("AUTOSELECT"),forced:t.bool("FORCED"),lang:l,url:t.URI?Iu.resolve(t.URI,e):""};if(u&&(f.assocLang=u),c&&(f.channels=c),h&&(f.characteristics=h),d&&(f.instreamId=d),null!=n&&n.length){const t=Iu.findGroup(n,f.groupId)||n[0];Nu(f,t,"audioCodec"),Nu(f,t,"textCodec")}i.push(f)}}return r}static parseLevelPlaylist(t,e,n,i,r,s){var a;const o={url:e},l=new nu(e),u=l.fragments,c=[];let h,d,f,p,m=null,g=0,v=0,y=0,_=0,b=0,E=null,T=new Xa(i,o),S=-1,D=!1,w=null;if(xu.lastIndex=0,l.m3u8=t,l.hasVariableRefs=Kl(t),"#EXTM3U"!==(null==(a=xu.exec(t))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=xu.exec(t));){D&&(D=!1,T=new Xa(i,o),T.playlistOffset=y,T.setStart(y),T.sn=g,T.cc=_,b&&(T.bitrate=b),T.level=n,m&&(T.initSegment=m,m.rawProgramDateTime&&(T.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),w&&(T.setByteRange(w),w=null)));const t=h[1];if(t){T.duration=parseFloat(t);const e=(" "+h[2]).slice(1);T.title=e||null,T.tagList.push(e?["INF",t,e]:["INF",t])}else if(h[3]){if(sa(T.duration)){T.playlistOffset=y,T.setStart(y),f&&$u(T,f,l),T.sn=g,T.level=n,T.cc=_,u.push(T);const t=(" "+h[3]).slice(1);T.relurl=Wl(l,t),Bu(T,E,c),E=T,y+=T.duration,g++,v=0,D=!0}}else{if(h=h[0].match(Cu),!h){Ca.warn("No matches on slow regex match for level playlist!");continue}for(d=1;d<h.length&&void 0===h[d];d++);const t=(" "+h[d]).slice(1),r=(" "+h[d+1]).slice(1),a=h[d+2]?(" "+h[d+2]).slice(1):null;switch(t){case"BYTERANGE":E?T.setByteRange(r,E):T.setByteRange(r);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=r,T.tagList.push(["PROGRAM-DATE-TIME",r]),-1===S&&(S=u.length);break;case"PLAYLIST-TYPE":l.type&&zu(l,t,h),l.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?zu(l,t,h):u.length>0&&Gu(l,t,h),g=l.startSN=parseInt(r);break;case"SKIP":{l.skippedSegments&&zu(l,t,h);const e=new Ql(r,l),n=e.decimalInteger("SKIPPED-SEGMENTS");if(sa(n)){l.skippedSegments+=n;for(let t=n;t--;)u.push(null);g+=n}const i=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");i&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(i.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&zu(l,t,h),l.targetduration=Math.max(parseInt(r),1);break;case"VERSION":null!==l.version&&zu(l,t,h),l.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||zu(l,t,h),l.live=!1;break;case"#":(r||a)&&T.tagList.push(a?[r,a]:[r]);break;case"DISCONTINUITY":_++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([t]);break;case"BITRATE":T.tagList.push([t,r]),b=1e3*parseInt(r),sa(b)?T.bitrate=b:b=0;break;case"DATERANGE":{const t=new Ql(r,l),e=new eu(t,l.dateRanges[t.ID],l.dateRangeTagCount);l.dateRangeTagCount++,e.isValid||l.skippedSegments?l.dateRanges[e.id]=e:Ca.warn(`Ignoring invalid DATERANGE tag: "${r}"`),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const t=new Ql(r,l);"IMPORT"in t?Zl(l,t,s):Yl(l,t,e)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?zu(l,t,h):u.length>0&&Gu(l,t,h),l.startCC=_=parseInt(r);break;case"KEY":{const t=Ou(r,e,l);if(t.isSupported()){if("NONE"===t.method){f=void 0;break}f||(f={});const e=f[t.keyFormat];null!=e&&e.matches(t)||(e&&(f=Ea({},f)),f[t.keyFormat]=t)}else Ca.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${r}"`);break}case"START":l.startTimeOffset=Mu(r);break;case"MAP":{const t=new Ql(r,l);if(T.duration){const e=new Xa(i,o);Uu(e,t,n,f),m=e,T.initSegment=m,m.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=m.rawProgramDateTime)}else{const e=T.byteRangeEndOffset;if(e){const t=T.byteRangeStartOffset;w=`${e-t}@${t}`}else w=null;Uu(T,t,n,f),m=T,D=!0}m.cc=_;break}case"SERVER-CONTROL":p&&zu(l,t,h),p=new Ql(r),l.canBlockReload=p.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=p.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&p.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=p.optionalFloat("PART-HOLD-BACK",0),l.holdBack=p.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&zu(l,t,h);const e=new Ql(r);l.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let t=l.partList;t||(t=l.partList=[]);const e=v>0?t[t.length-1]:void 0,n=v++,i=new Ql(r,l),s=new Qa(i,T,o,n,e);t.push(s),T.duration+=s.duration;break}case"PRELOAD-HINT":{const t=new Ql(r,l);l.preloadHint=t;break}case"RENDITION-REPORT":{const t=new Ql(r,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(t);break}default:Ca.warn(`line parsed but not handled: ${h}`)}}}E&&!E.relurl?(u.pop(),y-=E.duration,l.partList&&(l.fragmentHint=E)):l.partList&&(Bu(T,E,c),T.cc=_,l.fragmentHint=T,f&&$u(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const L=u.length,k=u[0],A=u[L-1];if(y+=l.skippedSegments*l.targetduration,y>0&&L&&A){l.averagetargetduration=y/L;const t=A.sn;l.endSN="initSegment"!==t?t:0,l.live||(A.endList=!0),S>0&&(function(t,e){let n=t[e];for(let i=e;i--;){const e=t[i];if(!e)return;e.programDateTime=n.programDateTime-1e3*e.duration,n=e}}(u,S),k&&c.unshift(k))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,c.length&&l.dateRangeTagCount&&k&&Pu(c,l),l.endCC=_,l}}function Pu(t,e){let n=t.length;if(!n){if(!e.hasProgramDateTime)return;{const i=e.fragments[e.fragments.length-1];t.push(i),n++}}const i=t[n-1],r=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const l=e.dateRanges[s[o]],u=l.startDate.getTime();l.tagAnchor=i.ref;for(let i=n;i--;){var a;if((null==(a=t[i])?void 0:a.sn)<e.startSN)break;const n=Ru(e,u,t,i,r);if(-1!==n){l.tagAnchor=e.fragments[n].ref;break}}}}function Ru(t,e,n,i,r){const s=n[i];if(s){const o=s.programDateTime;var a;if(e>=o||0===i)if(e<=o+1e3*(((null==(a=n[i+1])?void 0:a.start)||r)-s.start)){const r=n[i].sn-t.startSN;if(r<0)return-1;const s=t.fragments;if(s.length>n.length)for(let a=(n[i+1]||s[s.length-1]).sn-t.startSN;a>r;a--){const t=s[a].programDateTime;if(e>=t&&e<t+1e3*s[a].duration)return a}return r}}return-1}function Ou(t,e,n){var i,r;const s=new Ql(t,n),a=null!=(i=s.METHOD)?i:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=null!=(r=s.KEYFORMAT)?r:"identity";o&&s.IV&&!l&&Ca.error(`Invalid IV: ${s.IV}`);const h=o?Iu.resolve(o,e):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Du(a,h,c,d,l,s.KEYID)}function Mu(t){const e=new Ql(t).decimalFloatingPoint("TIME-OFFSET");return sa(e)?e:null}function Fu(t,e){let n=(t||"").split(/[ ,]+/).filter(t=>t);["video","audio","text"].forEach(t=>{const i=n.filter(e=>Ao(e,t));i.length&&(e[`${t}Codec`]=i.map(t=>t.split("/")[0]).join(","),n=n.filter(t=>-1===i.indexOf(t)))}),e.unknownCodecs=n}function Nu(t,e,n){const i=e[n];i&&(t[n]=i)}function Bu(t,e,n){t.rawProgramDateTime?n.push(t):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime)}function Uu(t,e,n,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function $u(t,e,n){t.levelkeys=e;const{encryptedFragments:i}=n;i.length&&i[i.length-1].levelkeys===e||!Object.keys(e).some(t=>e[t].isCommonEncryption)||i.push(t)}function zu(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${n[0]})`)}function Gu(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${n[0]})`)}function ju(t,e){const n=e.startPTS;if(sa(n)){let i,r=0;e.sn>t.sn?(r=n-t.start,i=t):(r=t.start-n,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.setStart(t.start+(t.minEndPTS-t.start)):e.setStart(t.start+t.duration):e.setStart(Math.max(t.start-e.duration,0))}function Hu(t,e,n,i,r,s,a){i-n<=0&&(a.warn("Fragment should have a positive duration",e),i=n+e.duration,s=r+e.duration);let o=n,l=i;const u=e.startPTS,c=e.endPTS;if(sa(u)){const h=Math.abs(u-n);t&&h>t.totalduration?a.warn(`media timestamps and playlist times differ by ${h}s for level ${e.level} ${t.url}`):sa(e.deltaPTS)?e.deltaPTS=Math.max(h,e.deltaPTS):e.deltaPTS=h,o=Math.max(n,u),n=Math.min(n,u),r=void 0!==e.startDTS?Math.min(r,e.startDTS):r,l=Math.min(i,c),i=Math.max(i,c),s=void 0!==e.endDTS?Math.max(s,e.endDTS):s}const h=n-e.start;0!==e.start&&e.setStart(n),e.setDuration(i-e.start),e.startPTS=n,e.maxStartPTS=o,e.startDTS=r,e.endPTS=i,e.minEndPTS=l,e.endDTS=s;const d=e.sn;if(!t||d<t.startSN||d>t.endSN)return 0;let f;const p=d-t.startSN,m=t.fragments;for(m[p]=e,f=p;f>0;f--)ju(m[f],m[f-1]);for(f=p;f<m.length-1;f++)ju(m[f],m[f+1]);return t.fragmentHint&&ju(m[m.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,h}function Vu(t,e,n,i,r){return new Error(`${t} ${r.url}\nPlaylist starting @${e.startSN}\n${e.m3u8}\n\nPlaylist starting @${n.startSN}\n${n.m3u8}`)}function Ku(t,e,n=!0){const i=e.startSN+e.skippedSegments-t.startSN,r=t.fragments,s=i>=0;let a=0;if(s&&i<r.length)a=r[i].start;else if(s&&e.startSN===t.endSN+1)a=t.fragmentEnd;else if(s&&n)a=t.fragmentStart+i*e.levelTargetDuration;else{if(e.skippedSegments||0!==e.fragmentStart)return;a=t.fragmentStart}Wu(e,a)}function Wu(t,e){if(e){const n=t.fragments;for(let i=t.skippedSegments;i<n.length;i++)n[i].addStart(e);t.fragmentHint&&t.fragmentHint.addStart(e)}}function Yu(t,e=1/0){let n=1e3*t.targetduration;if(t.updated){const i=t.fragments,r=4;if(i.length&&n*r>e){const t=1e3*i[i.length-1].duration;t<n&&(n=t)}}else n/=2;return Math.round(n)}function Zu(t,e,n){if(!t)return null;let i=t.fragments[e-t.startSN];return i||(i=t.fragmentHint,i&&i.sn===e?i:e<t.startSN&&n&&n.sn===e?n:null)}function qu(t,e,n){return t?Xu(t.partList,e,n):null}function Xu(t,e,n){if(t)for(let i=t.length;i--;){const r=t[i];if(r.index===n&&r.fragment.sn===e)return r}return null}function Qu(t){t.forEach((t,e)=>{var n;null==(n=t.details)||n.fragments.forEach(t=>{t.level=e,t.initSegment&&(t.initSegment.level=e)})})}function Ju(t,e){return!(t===e||!e)&&tc(t)!==tc(e)}function tc(t){return t.replace(/\?[^?]*$/,"")}function ec(t,e){for(let i=0,r=t.length;i<r;i++){var n;if((null==(n=t[i])?void 0:n.cc)===e)return t[i]}return null}function nc(t,e){const n=t.start+e;t.startPTS=n,t.setStart(n),t.endPTS=n+t.duration}function ic(t,e){const n=e.fragments;for(let e=0,i=n.length;e<i;e++)nc(n[e],t);e.fragmentHint&&nc(e.fragmentHint,t),e.alignedSliding=!0}function rc(t,e){if(!function(t,e){return!!(t&&e.startCC<t.endCC&&e.endCC>t.startCC)}(e,t))return;const n=Math.min(e.endCC,t.endCC),i=ec(e.fragments,n),r=ec(t.fragments,n);i&&r&&(Ca.log(`Aligning playlist at start of dicontinuity sequence ${n}`),ic(i.start-r.start,t))}function sc(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const n=t.fragments,i=e.fragments;if(!n.length||!i.length)return;let r,s;const a=Math.min(e.endCC,t.endCC);e.startCC<a&&t.startCC<a&&(r=ec(i,a),s=ec(n,a)),r&&s||(r=i[Math.floor(i.length/2)],s=ec(n,r.cc)||n[Math.floor(n.length/2)]);const o=r.programDateTime,l=s.programDateTime;o&&l&&ic((l-o)/1e3-(s.start-r.start),t)}function ac(t,e,n){oc(t,e,n),t.addEventListener(e,n)}function oc(t,e,n){t.removeEventListener(e,n)}const lc="STOPPED",uc="IDLE",cc="KEY_LOADING",hc="FRAG_LOADING",dc="FRAG_LOADING_WAITING_RETRY",fc="WAITING_TRACK",pc="PARSING",mc="PARSED",gc="ENDED",vc="ERROR",yc="WAITING_INIT_PTS",_c="WAITING_LEVEL";class bc extends zl{constructor(t,e,n,i,r){super(i,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=lc,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:t,fragCurrent:e,media:n,mediaBuffer:i,state:r}=this,s=n?n.currentTime:0,a=Hl.bufferInfo(i||n,s,t.maxBufferHole),o=!a.len;if(this.log(`Media seeking to ${sa(s)?s.toFixed(3):s}, state: ${r}, ${o?"out of":"in"} buffer`),this.state===gc)this.resetLoadingState();else if(e){const n=t.maxFragLookUpTolerance,i=e.start-n,r=e.start+e.duration+n;if(o||r<a.start||i>a.end){const t=s>r;(s<i||t)&&(t&&e.loader&&(this.log(`Cancelling fragment load for seek (sn: ${e.sn})`),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(n&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),s>this.lastCurrentTime&&(this.lastCurrentTime=s),!this.loadingParts)){const t=Math.max(a.end,s),e=this.shouldLoadParts(this.getLevelDetails(),t);e&&(this.log(`LL-Part loading ON after seeking to ${s.toFixed(2)} with buffer @${t.toFixed(2)}`),this.loadingParts=e)}this.hls.hasEnoughToStart||(this.log(`Setting ${o?"startPosition":"nextLoadPosition"} to ${s} for seek without enough to start`),this.nextLoadPosition=s,o&&(this.startPosition=s)),o&&this.state===uc&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=t,this.fragmentLoader=new Nl(t.config),this.keyLoader=n,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Ml(t.config)}registerListeners(){const{hls:t}=this;t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ca.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===lc)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=lc}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return-1===e&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const n=t.end||0,i=this.config.timelineOffset||0;if(n<=i)return!1;const r=t.buffered;this.config.maxBufferHole&&r&&r.length>1&&(t=Hl.bufferedInfo(r,t.start,0));const s=t.nextStart;if(s&&s>i&&s<e.edge)return!1;if(this.media.currentTime<t.start)return!1;const a=e.partList;if(null!=a&&a.length){const t=a[a.length-1];return Hl.isBuffered(this.media,t.start+t.duration/2)}const o=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;var e;return t?(null==(e=this.getLevelDetails())?void 0:e.appliedTimelineOffset)||t:0}onMediaAttached(t,e){const n=this.media=this.mediaBuffer=e.media;ac(n,"seeking",this.onMediaSeeking),ac(n,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===lc&&this.startLoad(i.startPosition)}onMediaDetaching(t,e){const n=!!e.transferMedia,i=this.media;if(null!==i){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),oc(i,"seeking",this.onMediaSeeking),oc(i,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=lc,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,n){this.startFragRequested=!0,this._loadFragForPlayback(t,e,n)}_loadFragForPlayback(t,e,n){this._doFragLoad(t,e,n,t=>{const e=t.frag;if(this.fragContextChanged(e))return this.warn(`${e.type} sn: ${e.sn}${t.part?" part: "+t.part.index:""} of ${this.fragInfo(e,!1,t.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)}).then(t=>{if(!t)return;const e=this.state,n=t.frag;this.fragContextChanged(n)?(e===hc||!this.fragCurrent&&e===pc)&&(this.fragmentTracker.removeFragment(n),this.state=uc):("payload"in t&&(this.log(`Loaded ${n.type} sn: ${n.sn} of ${this.playlistLabel()} ${n.level}`),this.hls.trigger(ca.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))}).catch(e=>{this.state!==lc&&this.state!==vc&&(this.warn(`Frag error: ${(null==e?void 0:e.message)||e}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:n}=this;if(n.getState(t)===wl){const e=t.type,i=this.getFwdBufferInfo(this.mediaBuffer,e),r=Math.max(t.duration,i?i.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?t.sn-s.sn:0)||this.reduceMaxBufferLength(r,t.duration))&&n.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?n.removeAllFragments():n.hasParts(t.type)&&(n.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),n.getState(t)===Ll&&n.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return(null==e?void 0:e.live)&&"EVENT"!==e.type&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,n=null){if(!(t-e))return;const i={startOffset:t,endOffset:e,type:n};this.hls.trigger(ca.BUFFER_FLUSHING,i)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(t=>{const e=null==t?void 0:t.frag;if(!e||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t}).then(t=>{const{hls:e}=this,{frag:n,payload:i}=t,r=n.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&su(r.method)){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer,au(r.method)).catch(t=>{throw e.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:n}),t}).then(i=>{const r=self.performance.now();return e.trigger(ca.FRAG_DECRYPTED,{frag:n,payload:i,stats:{tstart:s,tdecrypt:r}}),t.payload=i,this.completeInitSegmentLoad(t)})}return this.completeInitSegmentLoad(t)}).catch(e=>{this.state!==lc&&this.state!==vc&&(this.warn(e),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const n=t.frag.stats;this.state!==lc&&(this.state=uc),t.frag.data=new Uint8Array(t.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var n,i;const r=t.tracks;if(r&&!e.encrypted&&(null!=(n=r.audio)&&n.encrypted||null!=(i=r.video)&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const t=this.media,n=new Error(`Encrypted track with no key in ${this.fragInfo(e)} (media ${t?"attached mediaKeys: "+t.mediaKeys:"detached"})`);return this.warn(n.message),!(!t||t.mediaKeys)&&(this.hls.trigger(ca.ERROR,{type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_NO_KEYS,fatal:!1,error:n,frag:e}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${n?function(t){let e="";const n=t.length;for(let i=0;i<n;i++)e+=`[${t.start(i).toFixed(3)}-${t.end(i).toFixed(3)}]`;return e}(Hl.getBuffered(n)):"(detached)"})`),qa(t)){var i;if(t.type!==va){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return void(this.state=uc)}const e=null==(i=this.levels)?void 0:i[t.level];null!=e&&e.fragmentError&&(this.log(`Resetting level fragment error count of ${e.fragmentError} on frag buffered`),e.fragmentError=0)}this.state=uc}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:n,part:i,partsLoaded:r}=t,s=!r||0===r.length||r.some(t=>!t),a=new Gl(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!s);e.flush(a)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,n=null,i){var r;this.fragCurrent=t;const s=e.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let a=null;if(!t.encrypted||null!=(r=t.decryptdata)&&r.key)t.encrypted||(a=this.keyLoader.loadClear(t,s.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log(`Loading key for ${t.sn} of [${s.startSN}-${s.endSN}], ${this.playlistLabel()} ${t.level}`),this.state=cc,this.fragCurrent=t,a=this.keyLoader.load(t).then(t=>{if(!this.fragContextChanged(t.frag))return this.hls.trigger(ca.KEY_LOADED,t),this.state===cc&&(this.state=uc),t}),this.hls.trigger(ca.KEY_LOADING,{frag:t}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(qa(t)&&(!o||t.sn!==o.sn)){const n=this.shouldLoadParts(e.details,t.end);n!==this.loadingParts&&(this.log(`LL-Part loading ${n?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${t.sn}`),this.loadingParts=n)}if(n=Math.max(t.start,n||0),this.loadingParts&&qa(t)){const r=s.partList;if(r&&i){n>s.fragmentEnd&&s.fragmentHint&&(t=s.fragmentHint);const o=this.getNextPart(r,t,n);if(o>-1){const l=r[o];let u;return t=this.fragCurrent=l.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${l.index} (${o}/${r.length-1}) of ${this.fragInfo(t,!1,l)}) cc: ${t.cc} [${s.startSN}-${s.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=hc,u=a?a.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(t,l,e,i)).catch(t=>this.handleFragLoadError(t)):this.doFragPartsLoad(t,l,e,i).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(ca.FRAG_LOADING,{frag:t,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!t.url||this.loadedEndOfParts(r,n))return Promise.resolve(null)}}var l;if(qa(t)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${t.sn} loaded parts: ${null==(l=s.partList)?void 0:l.filter(t=>t.loaded).map(t=>`[${t.start}-${t.end}]`)}`),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${"["+s.startSN+"-"+s.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),sa(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=hc;const u=this.config.progressive;let c;return c=u&&a?a.then(e=>!e||this.fragContextChanged(e.frag)?null:this.fragmentLoader.load(t,i)).catch(t=>this.handleFragLoadError(t)):Promise.all([this.fragmentLoader.load(t,u?i:void 0),a]).then(([t])=>(!u&&i&&i(t),t)).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(ca.FRAG_LOADING,{frag:t,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(t,e,n,i){return new Promise((r,s)=>{var a;const o=[],l=null==(a=n.details)?void 0:a.partList,u=e=>{this.fragmentLoader.loadPart(t,e,i).then(i=>{o[e.index]=i;const s=i.part;this.hls.trigger(ca.FRAG_LOADED,i);const a=qu(n.details,t.sn,e.index+1)||Xu(l,t.sn,e.index+1);if(!a)return r({frag:t,part:s,partsLoaded:o});u(a)}).catch(s)};u(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e.frag&&e.details===ua.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===la.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(ca.ERROR,e)}else this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==pc)return void(this.fragCurrent||this.state===lc||this.state===vc||(this.state=uc));const{frag:n,part:i,level:r}=e,s=self.performance.now();n.stats.parsing.end=s,i&&(i.stats.parsing.end=s);const a=this.getLevelDetails(),o=a&&n.sn>a.endSN||this.shouldLoadParts(a,n.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(n,i,r,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var n;const r=t.partList[0];if(r.fragment.type===va)return!1;var i;if(e>=r.end+((null==(n=t.fragmentHint)?void 0:n.duration)||0))if((this.hls.hasEnoughToStart?(null==(i=this.media)?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:n}=this,{level:i,sn:r,part:s}=t;if(null==e||!e[i])return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const a=e[i],o=a.details,l=s>-1?qu(o,r,s):null,u=l?l.fragment:Zu(o,r,n);return u?(n&&n!==u&&(u.stats=n.stats),{frag:u,part:l,level:a}):null}bufferFragmentData(t,e,n,i,r){if(this.state!==pc)return;const{data1:s,data2:a}=t;let o=s;if(a&&(o=_o(s,a)),!o.length)return;const l=this.initPTS[e.cc],u=l?-l.baseTime/l.timescale:void 0,c={type:t.type,frag:e,part:n,chunkMeta:i,offset:u,parent:e.type,data:o};if(this.hls.trigger(ca.BUFFER_APPENDING,c),t.dropped&&t.independent&&!n){if(r)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Hl.isBuffered(e,e.currentTime))return void this.flushMainBuffer(0,t.start);const n=e.currentTime,i=Hl.bufferInfo(e,n,0),r=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(t.start-s,i.end-s),n+s);t.start-a>s&&this.flushMainBuffer(a,t.start)}getFwdBufferInfo(t,e){var n;const i=this.getLoadPosition();if(!sa(i))return null;const r=this.lastCurrentTime>i||null!=(n=this.media)&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,i,e,r)}getFwdBufferInfoAtPos(t,e,n,i){const r=Hl.bufferInfo(t,e,i);if(0===r.len&&void 0!==r.nextStart){const s=this.fragmentTracker.getBufferedFrag(e,n);if(s&&(r.nextStart<=s.end||s.gap)){const n=Math.max(Math.min(r.nextStart,s.end)-e,i);return Hl.bufferInfo(t,e,n)}}return r}getMaxBufferLength(t){const{config:e}=this;let n;return n=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength,Math.min(n,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const n=this.config,i=Math.max(Math.min(t-e,n.maxBufferLength),e),r=Math.max(t-3*e,n.maxMaxBufferLength/2,i);return r>=i&&(n.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}getAppendedFrag(t,e=ma){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(t,e){const n=e.fragments,i=n.length;if(!i)return null;const{config:r}=this,s=n[0].start,a=r.lowLatencyMode&&!!e.partList;let o=null;if(e.live){const n=r.initialLiveManifestSize;if(i<n)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${n})`),null;if(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<s){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(e);const n=this.hls.startPosition,i=this.hls.liveSyncPosition,r=o?(-1!==n&&n>=s?n:i)||o.start:t;this.log(`Setting startPosition to ${r} to match start frag at live edge. mainStart: ${n} liveSyncPosition: ${i} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=r}}else t<=s&&(o=n[0]);if(!o){const n=this.loadingParts?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,n,e)}let u=this.filterReplacedPrimary(o,e);if(!u&&o){const t=o.sn-e.startSN;u=this.filterReplacedPrimary(n[t+1]||null,e)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(t,e){const n=this.fragmentTracker.getState(t);return(n===kl||n===Ll&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,n,i,r){let s=null;if(t.gap&&(s=this.getNextFragment(this.nextLoadPosition,e),s&&!s.gap&&n.nextStart)){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i,0);if(null!==t&&n.len+t.len>=r){const t=s.sn;return this.loopSn!==t&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${t}`),this.loopSn=t),null}}return this.loopSn=void 0,s}get primaryPrefetch(){var t;if(Ec(this.config)&&(null==(t=this.hls.interstitialsManager)||null==(t=t.playingItem)?void 0:t.event))return!0;return!1}filterReplacedPrimary(t,e){if(!t)return t;if(Ec(this.config)&&t.type!==va){const n=this.hls.interstitialsManager,i=null==n?void 0:n.bufferingItem;if(i){const n=i.event;if(n){if(n.appendInPlace||Math.abs(t.start-i.start)>1||0===i.start)return null}else{if(t.end<=i.start&&!1===(null==e?void 0:e.live))return null;if(t.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||t.start-i.end>1))return null}}const r=null==n?void 0:n.playerQueue;if(r)for(let e=r.length;e--;){const n=r[e].interstitial;if(n.appendInPlace&&t.start>=n.startTime&&t.end<=n.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return null==t||!t.initSegment||t.initSegment.data||this.bitrateTest?t:t.initSegment}getNextPart(t,e,n){let i=-1,r=!1,s=!0;for(let a=0,o=t.length;a<o;a++){const o=t[a];if(s=s&&!o.independent,i>-1&&n<o.start)break;const l=o.loaded;l?i=-1:(r||(o.independent||s)&&o.fragment===e)&&(o.fragment!==e&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${o.start}`),i=a),r=l}return i}loadedEndOfParts(t,e){let n;for(let i=t.length;i--;){if(n=t[i],!n.loaded)return!1;if(e>n.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,n=this.fragPrevious;let i=null;if(n){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=function(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!sa(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;for(let i=0;i<t.length;++i){const r=t[i];if(fl(e,n,r))return r}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=n.sn+1;if(r>=t.startSN&&r<=t.endSN){const s=e[r-t.startSN];n.cc===s.cc&&(i=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=pl(t,n.cc,n.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const e=this.hls.liveSyncPosition;null!==e&&(i=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t))}return i}getFragmentAtPosition(t,e,n){const{config:i}=this;let{fragPrevious:r}=this,{fragments:s,endSN:a}=n;const{fragmentHint:o}=n,{maxFragLookUpTolerance:l}=i,u=n.partList,c=!!(this.loadingParts&&null!=u&&u.length&&o);let h;var d;(c&&!this.bitrateTest&&u[u.length-1].fragment.sn===o.sn&&(s=s.concat(o),a=o.sn),t<e)?h=hl(r,s,t,t<this.lastCurrentTime||t>e-l||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:l):h=s[s.length-1];if(h){const t=h.sn-n.startSN,e=this.fragmentTracker.getState(h);if((e===kl||e===Ll&&h.gap)&&(r=h),r&&h.sn===r.sn&&(!c||u[0].fragment.sn>h.sn||!n.live)&&h.level===r.level){const e=s[t+1];h=h.sn<a&&this.fragmentTracker.getState(e)!==kl?e:null}}return h}alignPlaylists(t,e,n){const i=t.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=t.fragmentStart,s=!e,a=t.alignedSliding&&sa(r);if(s||!a&&!r){!function(t,e){t&&(rc(e,t),e.alignedSliding||sc(e,t),e.alignedSliding||e.skippedSegments||Ku(t,e,!1))}(n,t);const r=t.fragmentStart;return this.log(`Live playlist sliding: ${r.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${i}`),r}return r}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)}setStartPosition(t,e){let n=this.startPosition;n<e&&(n=-1);const i=this.timelineOffset;if(-1===n){const r=null!==this.startTimeOffset,s=r?this.startTimeOffset:t.startTimeOffset;null!==s&&sa(s)?(n=e+s,s<0&&(n+=t.edge),n=Math.min(Math.max(e,n),e+t.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${s} found in ${r?"multivariant":"media"} playlist`),this.startPosition=n):t.live?(n=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+i}this.nextLoadPosition=n+i}getLoadPosition(){var t;const{media:e}=this;let n=0;return null!=(t=this.hls)&&t.hasEnoughToStart&&e?n=e.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&qa(t)&&t.stats.aborted&&(this.log(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===dc)||(this.state=uc)}onFragmentOrKeyLoadError(t,e){var n;if(e.chunkMeta&&!e.frag){const t=this.getCurrentContext(e.chunkMeta);t&&(e.frag=t.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;var r;if(this.fragContextChanged(i))return void this.warn(`Frag load error must match current frag to retry ${i.url} > ${null==(r=this.fragCurrent)?void 0:r.url}`);const s=e.details===ua.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const a=e.errorAction;if(!a)return void(this.state=vc);const{action:o,flags:l,retryCount:u=0,retryConfig:c}=a,h=!!c,d=h&&5===o,f=h&&!a.resolved&&1===l,p=null==(n=this.hls.latestLevelDetails)?void 0:n.live;if(!d&&f&&qa(i)&&!i.endList&&p&&!vl(e))this.resetFragmentErrors(t),this.treatAsGap(i),a.resolved=!0;else if((d||f)&&u<c.maxNumRetry){var m;const n=Tl(null==(m=e.response)?void 0:m.code),r=_l(c,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+r,this.state=dc,a.resolved=!0,n)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(e.reason="offline");this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${r}ms`)}else if(c){if(this.resetFragmentErrors(t),!(u<c.maxNumRetry))return void this.warn(`${e.details} reached or exceeded max retry (${u})`);s||3===o||(a.resolved=!0)}else this.state=2===o?_c:vc;this.tickImmediate()}checkRetryDate(){const t=self.performance.now(),e=this.retryDate,n=e===1/0;(!e||t>=e||n&&!Tl(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=uc)}reduceLengthAndFlushBuffer(t){if(this.state===pc||this.state===mc){const e=t.frag,n=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,n),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==e?void 0:e.duration)||10);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(t){t===ga&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==lc&&(this.state=uc)}afterBufferFlushed(t,e,n){if(!t)return;const i=Hl.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,i,n),this.state===gc&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==lc&&(this.state=uc)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=this.levelLastLoaded,e=t?t.details:null;null!=e&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.log(`Loading context changed while buffering sn ${t.sn} of ${this.playlistLabel()} ${-1===t.level?"<removed>":t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,n,i){const r=n.details;if(r){var s;if(!Object.keys(t.elementaryStreams).reduce((e,s)=>{const a=t.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${t.sn} ${s} duration reliably (${o})`),e||!1;const l=i?0:Hu(r,t,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(ca.LEVEL_PTS_UPDATED,{details:r,level:n,drift:l,type:s,frag:t,start:a.startPTS,end:a.endPTS}),!0}return e},!1)&&(0===n.fragmentError&&this.treatAsGap(t,n),null===(null==(s=this.transmuxer)?void 0:s.error))){const e=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(e.message),this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=mc,this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(ca.FRAG_PARSED,{frag:t,part:e})}else this.warn("level.details undefined")}playlistLabel(){return this.playlistType===ma?"level":"track"}fragInfo(t,e=!0,n){var i,r;return`${this.playlistLabel()} ${t.level} (${n?"part":"frag"}:[${(null!=(i=e&&!n?t.startPTS:(n||t).start)?i:NaN).toFixed(3)}-${(null!=(r=e&&!n?t.endPTS:(n||t).end)?r:NaN).toFixed(3)}]${n&&"main"===t.type?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;null==(t=this.transmuxer)||t.reset()}recoverWorkerError(t){"demuxerWorker"===t.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Ec(t){return!!t.interstitialsController&&!1!==t.enableInterstitialPlayback}class Tc{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let n;return t.length?(n=1===t.length?t[0]:function(t,e){const n=new Uint8Array(e);let i=0;for(let e=0;e<t.length;e++){const r=t[e];n.set(r,i),i+=r.length}return n}(t,e),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Sc,Dc={exports:{}},wc=(Sc||(Sc=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new r(i,s||t,a),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),o.prototype.eventNames=function(){var t,i,r=[];if(0===this._eventsCount)return r;for(i in t=this._events)e.call(t,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,a=new Array(s);r<s;r++)a[r]=i[r].fn;return a},o.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,r,s,a){var o=n?n+t:t;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,r),!0;case 5:return c.fn.call(c.context,e,i,r,s),!0;case 6:return c.fn.call(c.context,e,i,r,s,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,i);break;case 4:c[u].fn.call(c[u].context,e,i,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},o.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},o.prototype.removeListener=function(t,e,i,r){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||r&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==e||r&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o}(Dc)),Dc.exports),Lc=Fa(wc);const kc="1.6.14",Ac={};function xc(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function Cc(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function Ic(t,e){let n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3],n}function Pc(t,e){const n=e;let i=0;for(;Cc(t,e);)i+=10,i+=Ic(t,e+6),xc(t,e+10)&&(i+=10),e+=i;if(i>0)return t.subarray(n,n+i)}function Rc(t,e){return 255===t[e]&&240==(246&t[e+1])}function Oc(t,e){return 1&t[e+1]?7:9}function Mc(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function Fc(t,e){return e+1<t.length&&Rc(t,e)}function Nc(t,e){if(Fc(t,e)){const n=Oc(t,e);if(e+n>=t.length)return!1;const i=Mc(t,e);if(i<=n)return!1;const r=e+i;return r===t.length||Fc(t,r)}return!1}function Bc(t,e,n,i,r){if(!t.samplerate){const s=function(t,e,n,i){const r=e[n+2],s=r>>2&15;if(s>12){const e=new Error(`invalid ADTS sampling index:${s}`);return void t.emit(ca.ERROR,ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_PARSING_ERROR,fatal:!0,error:e,reason:e.message})}const a=1+(r>>6&3),o=e[n+3]>>6&3|(1&r)<<2,l="mp4a.40."+a,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][s];let c=s;5!==a&&29!==a||(c-=3);const h=[a<<3|(14&c)>>1,(1&c)<<7|o<<3];return Ca.log(`manifest codec:${i}, parsed codec:${l}, channels:${o}, rate:${u} (ADTS object type:${a} sampling index:${s})`),{config:h,samplerate:u,channelCount:o,codec:l,parsedCodec:l,manifestCodec:i}}(e,n,i,r);if(!s)return;Ea(t,s)}}function Uc(t){return 9216e4/t}function $c(t,e,n,i,r){const s=i+r*Uc(t.samplerate),a=function(t,e){const n=Oc(t,e);if(e+n<=t.length){const i=Mc(t,e)-n;if(i>0)return{headerLength:n,frameLength:i}}}(e,n);let o;if(a){const{frameLength:i,headerLength:r}=a,l=r+i,u=Math.max(0,n+l-e.length);u?(o=new Uint8Array(l-r),o.set(e.subarray(n+r,e.length),0)):o=e.subarray(n+r,n+l);const c={unit:o,pts:s};return u||t.samples.push(c),{sample:c,length:l,missing:u}}const l=e.length-n;return o=new Uint8Array(l),o.set(e.subarray(n,e.length),0),{sample:{unit:o,pts:s},length:l,missing:-1}}function zc(t,e){return Cc(t,e)&&Ic(t,e+6)+10<=t.length-e}function Gc(t,e=0,n=1/0){return function(t,e,n,i){const r=(s=t)instanceof ArrayBuffer?s:s.buffer;var s;let a=1;"BYTES_PER_ELEMENT"in i&&(a=i.BYTES_PER_ELEMENT);const o=(h=t)&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?t.byteOffset:0,l=(o+t.byteLength)/a,u=(o+e)/a,c=Math.floor(Math.max(0,Math.min(u,l)));var h;return new i(r,c,Math.floor(Math.min(c+Math.max(n,0),l))-c)}(t,e,n,Uint8Array)}function jc(t){return"PRIV"===t.type?function(t){if(t.size<2)return;const e=Ra(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}}(t):"W"===t.type[0]?function(t){if("WXXX"===t.type){if(t.size<2)return;let e=1;const n=Ra(t.data.subarray(e),!0);e+=n.length+1;const i=Ra(t.data.subarray(e));return{key:t.type,info:n,data:i}}const e=Ra(t.data);return{key:t.type,info:"",data:e}}(t):"APIC"===t.type?function(t){const e={key:t.type,description:"",data:"",mimeType:null,pictureType:null};if(t.size<2)return;if(3!==t.data[0])return void console.log("Ignore frame with unrecognized character encoding");const n=t.data.subarray(1).indexOf(0);if(-1===n)return;const i=Ra(Gc(t.data,1,n)),r=t.data[2+n],s=t.data.subarray(3+n).indexOf(0);if(-1===s)return;const a=Ra(Gc(t.data,3+n,s));let o;return o="--\x3e"===i?Ra(Gc(t.data,4+n+s)):(l=t.data.subarray(4+n+s))instanceof ArrayBuffer?l:0==l.byteOffset&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer,e.mimeType=i,e.pictureType=r,e.description=a,e.data=o,e;var l}(t):function(t){if(t.size<2)return;if("TXXX"===t.type){let e=1;const n=Ra(t.data.subarray(e),!0);e+=n.length+1;const i=Ra(t.data.subarray(e));return{key:t.type,info:n,data:i}}const e=Ra(t.data.subarray(1));return{key:t.type,info:"",data:e}}(t)}function Hc(t){const e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=Ic(t,4);return{type:e,size:n,data:t.subarray(10,10+n)}}function Vc(t){let e=0;const n=[];for(;Cc(t,e);){const i=Ic(t,e+6);t[e+5]>>6&1&&(e+=10),e+=10;const r=e+i;for(;e+10<r;){const i=Hc(t.subarray(e)),r=jc(i);r&&n.push(r),e+=i.size+10}xc(t,e)&&(e+=10)}return n}function Kc(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info}function Wc(t){if(8===t.data.byteLength){const e=new Uint8Array(t.data),n=1&e[3];let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}}function Yc(t){const e=Vc(t);for(let t=0;t<e.length;t++){const n=e[t];if(Kc(n))return Wc(n)}}let Zc=function(t){return t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3",t.misbklv="urn:misb:KLV:bin:1910.1",t}({});function qc(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Xc{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,n){}demux(t,e){this.cachedData&&(t=_o(this.cachedData,t),this.cachedData=null);let n,i=Pc(t,0),r=i?i.length:0;const s=this._audioTrack,a=this._id3Track,o=i?Yc(i):void 0,l=t.length;for((null===this.basePTS||0===this.frameIndex&&sa(o))&&(this.basePTS=Qc(o,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Zc.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(t,r)){const e=this.appendFrame(s,t,r);e?(this.frameIndex++,this.lastPTS=e.sample.pts,r+=e.length,n=r):r=l}else zc(t,r)?(i=Pc(t,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Zc.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,n=r):r++;if(r===l&&n!==l){const e=t.slice(n);this.cachedData?this.cachedData=_o(this.cachedData,e):this.cachedData=e}}return{audioTrack:s,videoTrack:qc(),id3Track:a,textTrack:qc()}}demuxSampleAes(t,e,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:qc(),id3Track:this._id3Track,textTrack:qc()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Qc=(t,e,n)=>sa(t)?90*t:9e4*e+(n?9e4*n.baseTime/n.timescale:0);let Jc=null;const th=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],eh=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],nh=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ih=[0,1,1,4];function rh(t,e,n,i,r){if(n+24>e.length)return;const s=sh(e,n);if(s&&n+s.frameLength<=e.length){const a=i+r*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:e.subarray(n,n+s.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function sh(t,e){const n=t[e+1]>>3&3,i=t[e+1]>>1&3,r=t[e+2]>>4&15,s=t[e+2]>>2&3;if(1!==n&&0!==r&&15!==r&&3!==s){const a=t[e+2]>>1&1,o=t[e+3]>>6,l=1e3*th[14*(3===n?3-i:3===i?3:4)+r-1],u=eh[3*(3===n?0:2===n?1:2)+s],c=3===o?1:2,h=nh[n][i],d=ih[i],f=8*h*d,p=Math.floor(h*l/u+a)*d;if(null===Jc){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jc=t?parseInt(t[1]):0}return!!Jc&&Jc<=87&&2===i&&l>=224e3&&0===o&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:c,frameLength:p,samplesPerFrame:f}}}function ah(t,e){return!(255!==t[e]||224&~t[e+1]||!(6&t[e+1]))}function oh(t,e){return e+1<t.length&&ah(t,e)}function lh(t,e){if(e+1<t.length&&ah(t,e)){const n=4,i=sh(t,e);let r=n;null!=i&&i.frameLength&&(r=i.frameLength);const s=e+r;return s===t.length||oh(t,s)}return!1}const uh=(t,e)=>{let n=0,i=5;e+=i;const r=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=t[e];const o=Math.min(i,8),l=8-o;s[0]=4278190080>>>24+l<<l,r[0]=(a[0]&s[0])>>l,n=n?n<<o|r[0]:r[0],e+=1,i-=o}return n};function ch(t,e,n,i,r){if(n+8>e.length)return-1;if(11!==e[n]||119!==e[n+1])return-1;const s=e[n+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&e[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(n+l>e.length)return-1;const u=e[n+6]>>5;let c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));const h=(e[n+6]<<8|e[n+7])>>12-c&1,d=[2,1,2,3,3,4,4,5][u]+h,f=e[n+5]>>3,p=7&e[n+5],m=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|u<<3|h<<2|o>>4,o<<4&224]),g=i+r*(1536/a*9e4),v=e.subarray(n,n+l);return t.config=m,t.channelCount=d,t.samplerate=a,t.samples.push({unit:v,pts:g}),l}const hh=/\/emsg[-/]ID3/i;function dh(t,e){return sa(t.presentationTime)?t.presentationTime/t.timeScale:e+t.presentationTimeDelta/t.timeScale}class fh{constructor(t,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Ml(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,0)}decryptAacSample(t,e,n){const i=t[e].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),s=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(s).then(r=>{const s=new Uint8Array(r);i.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,n)}).catch(n)}decryptAacSamples(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,n),this.decrypter.isSync())))return}}getAvcEncryptedData(t){const e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e);let i=0;for(let e=32;e<t.length-16;e+=160,i+=16)n.set(t.subarray(e,e+16),i);return n}getAvcDecryptedUnit(t,e){const n=new Uint8Array(e);let i=0;for(let e=32;e<t.length-16;e+=160,i+=16)t.set(n.subarray(i,i+16),e);return t}decryptAvcSample(t,e,n,i,r){const s=Do(r.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{r.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(t,e,n+1,i)}).catch(i)}decryptAvcSamples(t,e,n,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=t.length)return void i();const r=t[e].units;for(;!(n>=r.length);n++){const s=r[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(t,e,n,i,s),this.decrypter.isSync())))return}}}}class ph{constructor(){this.VideoSample=null}createVideoSample(t,e,n){return{key:t,frame:!1,pts:e,dts:n,units:[],length:0}}getLastNalUnit(t){var e;let n,i=this.VideoSample;if(i&&0!==i.units.length||(i=t[t.length-1]),null!=(e=i)&&e.units){const t=i.units;n=t[t.length-1]}return n}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){const n=e.samples,i=n.length;if(!i)return void e.dropped++;{const e=n[i-1];t.pts=e.pts,t.dts=e.dts}}e.samples.push(t)}}parseNALu(t,e,n){const i=e.byteLength;let r=t.naluState||0;const s=r,a=[];let o,l,u,c=0,h=-1,d=0;for(-1===r&&(h=0,d=this.getNALuType(e,0),r=0,c=1);c<i;)if(o=e[c++],r)if(1!==r)if(o)if(1===o){if(l=c-r-1,h>=0){const t={data:e.subarray(h,l),type:d};a.push(t)}else{const n=this.getLastNalUnit(t.samples);n&&(s&&c<=4-s&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-s)),l>0&&(n.data=_o(n.data,e.subarray(0,l)),n.state=0))}c<i?(u=this.getNALuType(e,c),h=c,d=u,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(h>=0&&r>=0){const t={data:e.subarray(h,i),type:d,state:r};a.push(t)}if(0===a.length){const n=this.getLastNalUnit(t.samples);n&&(n.data=_o(n.data,e))}return t.naluState=r,a}}class mh{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,n=t.byteLength-e,i=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");i.set(t.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}skipBits(t){let e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const n=this.word>>>32-e;if(t>32&&Ca.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return e=t-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class gh extends ph{parsePES(t,e,n,i){const r=this.parseNALu(t,n.data,i);let s,a=this.VideoSample,o=!1;n.data=null,a&&r.length&&!t.audFound&&(this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 1:{let e=!1;s=!0;const r=i.data;if(o&&r.length>4){const t=this.readSliceType(r);2!==t&&4!==t&&7!==t&&9!==t||(e=!0)}var u;e&&null!=(u=a)&&u.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=e;break}case 5:s=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:s=!0,So(i.data,1,n.pts,e.samples);break;case 7:{var c,h;s=!0,o=!0;const e=i.data,n=this.readSPS(e);if(!t.sps||t.width!==n.width||t.height!==n.height||(null==(c=t.pixelRatio)?void 0:c[0])!==n.pixelRatio[0]||(null==(h=t.pixelRatio)?void 0:h[1])!==n.pixelRatio[1]){t.width=n.width,t.height=n.height,t.pixelRatio=n.pixelRatio,t.sps=[e];const i=e.subarray(1,4);let r="avc1.";for(let t=0;t<3;t++){let e=i[t].toString(16);e.length<2&&(e="0"+e),r+=e}t.codec=r}break}case 8:s=!0,t.pps=[i.data];break;case 9:s=!0,t.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,t),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:s=!0;break;default:s=!1}a&&s&&a.units.push(i)}),i&&a&&(this.pushAccessUnit(a,t),this.VideoSample=null)}getNALuType(t,e){return 31&t[e]}readSliceType(t){const e=new mh(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let n,i=8,r=8;for(let s=0;s<t;s++)0!==r&&(n=e.readEG(),r=(i+n+256)%256),i=0===r?i:r}readSPS(t){const e=new mh(t);let n,i,r,s=0,a=0,o=0,l=0;const u=e.readUByte.bind(e),c=e.readBits.bind(e),h=e.readUEG.bind(e),d=e.readBoolean.bind(e),f=e.skipBits.bind(e),p=e.skipEG.bind(e),m=e.skipUEG.bind(e),g=this.skipScalingList.bind(this);u();const v=u();if(c(5),f(3),u(),m(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const t=h();if(3===t&&f(1),m(),m(),f(1),d())for(i=3!==t?8:12,r=0;r<i;r++)d()&&g(r<6?16:64,e)}m();const y=h();if(0===y)h();else if(1===y)for(f(1),p(),p(),n=h(),r=0;r<n;r++)p();m(),f(1);const _=h(),b=h(),E=c(1);0===E&&f(1),f(1),d()&&(s=h(),a=h(),o=h(),l=h());let T=[1,1];if(d()&&d())switch(u()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(_+1)-2*s-2*a),height:(2-E)*(b+1)*16-(E?2:4)*(o+l),pixelRatio:T}}}class vh extends ph{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,n,i){const r=this.parseNALu(t,n.data,i);let s,a=this.VideoSample,o=!1;n.data=null,a&&r.length&&!t.audFound&&(this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),r.forEach(i=>{var r,l;switch(i.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,s=!0;break;case 16:case 17:case 18:case 21:var u;s=!0,o&&null!=(u=a)&&u.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:s=!0,null!=(r=a)&&r.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:s=!0,So(i.data,2,n.pts,e.samples);break;case 32:s=!0,t.vps||("object"!=typeof t.params&&(t.params={}),t.params=Ea(t.params,this.readVPS(i.data)),this.initVPS=i.data),t.vps=[i.data];break;case 33:if(s=!0,o=!0,void 0===t.vps||t.vps[0]===this.initVPS||void 0===t.sps||this.matchSPS(t.sps[0],i.data)||(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const e=this.readSPS(i.data);t.width=e.width,t.height=e.height,t.pixelRatio=e.pixelRatio,t.codec=e.codecString,t.sps=[],"object"!=typeof t.params&&(t.params={});for(const n in e.params)t.params[n]=e.params[n]}this.pushParameterSet(t.sps,i.data,t.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(s=!0,"object"==typeof t.params){if(!t.pps){t.pps=[];const e=this.readPPS(i.data);for(const n in e)t.params[n]=e[n]}this.pushParameterSet(t.pps,i.data,t.vps)}break;case 35:s=!0,t.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,t),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:s=!1}a&&s&&a.units.push(i)}),i&&a&&(this.pushAccessUnit(a,t),this.VideoSample=null)}pushParameterSet(t,e,n){(n&&n[0]===this.initVPS||!n&&!t.length)&&t.push(e)}getNALuType(t,e){return(126&t[e])>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let n=0;for(let i=0;i<t.byteLength;i++)i>=2&&3===t[i]&&0===t[i-1]&&0===t[i-2]||(e[n]=t[i],n++);return new Uint8Array(e.buffer,0,n)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new mh(t);return e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6),{numTemporalLayers:e.readBits(3)+1,temporalIdNested:e.readBoolean()}}readSPS(t){const e=new mh(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const n=e.readBits(3);e.readBoolean();const i=e.readBits(2),r=e.readBoolean(),s=e.readBits(5),a=e.readUByte(),o=e.readUByte(),l=e.readUByte(),u=e.readUByte(),c=e.readUByte(),h=e.readUByte(),d=e.readUByte(),f=e.readUByte(),p=e.readUByte(),m=e.readUByte(),g=e.readUByte(),v=[],y=[];for(let t=0;t<n;t++)v.push(e.readBoolean()),y.push(e.readBoolean());if(n>0)for(let t=n;t<8;t++)e.readBits(2);for(let t=0;t<n;t++)v[t]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),y[t]&&e.readUByte();e.readUEG();const _=e.readUEG();3==_&&e.skipBits(1);const b=e.readUEG(),E=e.readUEG(),T=e.readBoolean();let S=0,D=0,w=0,L=0;T&&(S+=e.readUEG(),D+=e.readUEG(),w+=e.readUEG(),L+=e.readUEG());const k=e.readUEG(),A=e.readUEG(),x=e.readUEG();for(let t=e.readBoolean()?0:n;t<=n;t++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let t=0;t<4;t++)for(let n=0;n<(3===t?2:6);n++)if(e.readBoolean()){const n=Math.min(64,1<<4+(t<<1));t>1&&e.readEG();for(let t=0;t<n;t++)e.readEG()}else e.readUEG();e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const C=e.readUEG();let I=0;for(let t=0;t<C;t++){let n=!1;if(0!==t&&(n=e.readBoolean()),n){t===C&&e.readUEG(),e.readBoolean(),e.readUEG();let n=0;for(let t=0;t<=I;t++){const t=e.readBoolean();let i=!1;t||(i=e.readBoolean()),(t||i)&&n++}I=n}else{const t=e.readUEG(),n=e.readUEG();I=t+n;for(let n=0;n<t;n++)e.readUEG(),e.readBoolean();for(let t=0;t<n;t++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const t=e.readUEG();for(let n=0;n<t;n++){for(let t=0;t<x+4;t++)e.readBits(1);e.readBits(1)}}let P=0,R=1,O=1,M=!0,F=1,N=0;e.readBoolean(),e.readBoolean();let B=!1;if(e.readBoolean()){if(e.readBoolean()){const t=e.readUByte();t>0&&t<16?(R=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][t-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][t-1]):255===t&&(R=e.readBits(16),O=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),B=e.readBoolean(),B&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(F=e.readBits(32),N=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const t=e.readBoolean(),i=e.readBoolean();let r=!1;(t||i)&&(r=e.readBoolean(),r&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),r&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let s=0;s<=n;s++){M=e.readBoolean();let n=!1;M||e.readBoolean()?e.readEG():n=e.readBoolean();const s=n?1:e.readUEG()+1;if(t)for(let t=0;t<s;t++)e.readUEG(),e.readUEG(),r&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(i)for(let t=0;t<s;t++)e.readUEG(),e.readUEG(),r&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),P=e.readUEG())}let U=b,$=E;if(T){let t=1,e=1;1===_?t=e=2:2==_&&(t=2),U=b-t*D-t*S,$=E-e*L-e*w}const z=i?["A","B","C"][i]:"",G=a<<24|o<<16|l<<8|u;let j=0;for(let t=0;t<32;t++)j=(j|(G>>t&1)<<31-t)>>>0;let H=j.toString(16);return 1===s&&"2"===H&&(H="6"),{codecString:`hvc1.${z}${s}.${H}.${r?"H":"L"}${g}.B0`,params:{general_tier_flag:r,general_profile_idc:s,general_profile_space:i,general_profile_compatibility_flags:[a,o,l,u],general_constraint_indicator_flags:[c,h,d,f,p,m],general_level_idc:g,bit_depth:k+8,bit_depth_luma_minus8:k,bit_depth_chroma_minus8:A,min_spatial_segmentation_idc:P,chroma_format_idc:_,frame_rate:{fixed:M,fps:N/F}},width:U,height:$,pixelRatio:[R,O]}}readPPS(t){const e=new mh(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const n=e.readBoolean(),i=e.readBoolean();let r=1;return i&&n?r=0:i?r=3:n&&(r=2),{parallelismType:r}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const yh=188;class _h{constructor(t,e,n,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.logger=i,this.videoParser=null}static probe(t,e){const n=_h.syncOffset(t);return n>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),-1!==n}static syncOffset(t){const e=t.length;let n=Math.min(940,e-yh)+1,i=0;for(;i<n;){let r=!1,s=-1,a=0;for(let o=i;o<e;o+=yh){if(71!==t[o]||e-o!==yh&&71!==t[o+yh]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(n=Math.min(s+18612,t.length-yh)+1)),r||(r=0===bh(t,o)),r&&a>1&&(0===s&&a>2||o+yh>n))return s}i++}return-1}static createTrack(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:no[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}}resetInitSegment(t,e,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=_h.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=_h.createTrack("audio",i),this._id3Track=_h.createTrack("id3"),this._txtTrack=_h.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:n}=this;t&&(t.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,n=!1,i=!1){let r;n||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=s.pid,c=s.pesData,h=a.pid,d=o.pid,f=a.pesData,p=o.pesData,m=null,g=this.pmtParsed,v=this._pmtId,y=t.length;if(this.remainderData&&(y=(t=_o(this.remainderData,t)).length,this.remainderData=null),y<yh&&!i)return this.remainderData=t,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const _=Math.max(0,_h.syncOffset(t));y-=(y-_)%yh,y<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,y,t.buffer.byteLength-y));let b=0;for(let e=_;e<y;e+=yh)if(71===t[e]){const i=!!(64&t[e+1]),y=bh(t,e);let b;if((48&t[e+3])>>4>1){if(b=e+5+t[e+4],b===e+yh)continue}else b=e+4;switch(y){case u:i&&(c&&(r=wh(c,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,l,r,!1)),c={data:[],size:0}),c&&(c.data.push(t.subarray(b,e+yh)),c.size+=e+yh-b);break;case h:if(i){if(f&&(r=wh(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r)}f={data:[],size:0}}f&&(f.data.push(t.subarray(b,e+yh)),f.size+=e+yh-b);break;case d:i&&(p&&(r=wh(p,this.logger))&&this.parseID3PES(o,r),p={data:[],size:0}),p&&(p.data.push(t.subarray(b,e+yh)),p.size+=e+yh-b);break;case 0:i&&(b+=t[b]+1),v=this._pmtId=Eh(t,b);break;case v:{i&&(b+=t[b]+1);const r=Th(t,b,this.typeSupported,n,this.observer,this.logger);u=r.videoPid,u>0&&(s.pid=u,s.segmentCodec=r.segmentVideoCodec),h=r.audioPid,h>0&&(a.pid=h,a.segmentCodec=r.segmentAudioCodec),d=r.id3Pid,d>0&&(o.pid=d),null===m||g||(this.logger.warn(`MPEG-TS PMT found at ${e} after unknown PID '${m}'. Backtracking to sync byte @${_} to parse all TS packets.`),m=null,e=_-188),g=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=y}}else b++;b>0&&Sh(this.observer,new Error(`Found ${b} TS packet/s that do not start with 0x47`),void 0,this.logger),s.pesData=c,a.pesData=f,o.pesData=p;const E={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(E),E}flush(){const{remainderData:t}=this;let e;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:n,id3Track:i,textTrack:r}=t,s=n.pesData,a=e.pesData,o=i.pesData;let l;if(s&&(l=wh(s,this.logger))?(this.readyVideoParser(n.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(n,r,l,!0),n.pesData=null)):n.pesData=s,a&&(l=wh(a,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,l);break;case"mp3":this.parseMPEGPES(e,l);break;case"ac3":this.parseAC3PES(e,l)}e.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=a;o&&(l=wh(o,this.logger))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(t,e,n){const i=this.demux(t,n,!0,!this.config.progressive),r=this.sampleAes=new fh(this.observer,this.config,e);return this.decrypt(i,r)}readyVideoParser(t){null===this.videoParser&&("avc"===t?this.videoParser=new gh:"hevc"===t&&(this.videoParser=new vh))}decrypt(t,e){return new Promise(n=>{const{audioTrack:i,videoTrack:r}=t;i.samples&&"aac"===i.segmentCodec?e.decryptAacSamples(i.samples,0,()=>{r.samples?e.decryptAvcSamples(r.samples,0,0,()=>{n(t)}):n(t)}):r.samples&&e.decryptAvcSamples(r.samples,0,0,()=>{n(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let n=0;const i=this.aacOverFlow;let r,s,a,o=e.data;if(i){this.aacOverFlow=null;const e=i.missing,r=i.sample.unit.byteLength;if(-1===e)o=_o(i.sample.unit,o);else{const s=r-e;i.sample.unit.set(o.subarray(0,e),s),t.samples.push(i.sample),n=i.missing}}for(r=n,s=o.length;r<s-1&&!Fc(o,r);r++);if(r!==n){let t;const e=r<s-1;if(t=e?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",Sh(this.observer,new Error(t),e,this.logger),!e)return}if(Bc(t,this.observer,o,r,this.audioCodec),void 0!==e.pts)a=e.pts;else{if(!i)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const e=Uc(t.samplerate);a=i.sample.pts+e}}let l,u=0;for(;r<s;){if(l=$c(t,o,r,a,u),r+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;r<s-1&&!Fc(o,r);r++);}}parseMPEGPES(t,e){const n=e.data,i=n.length;let r=0,s=0;const a=e.pts;if(void 0!==a)for(;s<i;)if(oh(n,s)){const e=rh(t,n,s,a,r);if(!e)break;s+=e.length,r++}else s++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(t,e){{const n=e.data,i=e.pts;if(void 0===i)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=n.length;let s,a=0,o=0;for(;o<r&&(s=ch(t,n,o,i,a++))>0;)o+=s}}parseID3PES(t,e){if(void 0===e.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=Ea({},e,{type:this._videoTrack?Zc.emsg:Zc.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(n)}}function bh(t,e){return((31&t[e+1])<<8)+t[e+2]}function Eh(t,e){return(31&t[e+10])<<8|t[e+11]}function Th(t,e,n,i,r,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<o;){const o=bh(t,e),l=(15&t[e+3])<<8|t[e+4];switch(t[e]){case 207:if(!i){Dh("ADTS AAC",s);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!i){Dh("H.264",s);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:n.mpeg||n.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){Dh("AC-3",s);break}case 129:n.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let i=e+5,r=l;for(;r>2;){106===t[i]&&(!0!==n.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3"));const e=t[i+1]+2;i+=e,r-=e}}break;case 194:case 135:return Sh(r,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}e+=l+5}return a}function Sh(t,e,n,i){i.warn(`parsing error: ${e.message}`),t.emit(ca.ERROR,ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function Dh(t,e){e.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function wh(t,e){let n,i,r,s,a,o=0;const l=t.data;if(!t||0===t.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=_o(l[0],l[1]),l.splice(1,1);if(n=l[0],1===(n[0]<<16)+(n[1]<<8)+n[2]){if(i=(n[4]<<8)+n[5],i&&i>t.size-6)return null;const u=n[7];192&u&&(s=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&u?(a=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,s-a>54e5&&(e.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),r=n[8];let c=r+9;if(t.size<=c)return null;t.size-=c;const h=new Uint8Array(t.size);for(let t=0,e=l.length;t<e;t++){n=l[t];let e=n.byteLength;if(c){if(c>e){c-=e;continue}n=n.subarray(c),e-=c,c=0}h.set(n,o),o+=e}return i&&(i-=r+3),{data:h,pts:s,dts:a,len:i}}return null}class Lh{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const kh=Math.pow(2,32)-1;class Ah{static init(){let t;for(t in Ah.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Ah.types)Ah.types.hasOwnProperty(t)&&(Ah.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Ah.HDLR_TYPES={video:e,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Ah.STTS=Ah.STSC=Ah.STCO=r,Ah.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ah.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Ah.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Ah.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Ah.FTYP=Ah.box(Ah.types.ftyp,s,o,s,a),Ah.DINF=Ah.box(Ah.types.dinf,Ah.box(Ah.types.dref,i))}static box(t,...e){let n=8,i=e.length;const r=i;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=255&n,s.set(t,4),i=0,n=8;i<r;i++)s.set(e[i],n),n+=e[i].byteLength;return s}static hdlr(t){return Ah.box(Ah.types.hdlr,Ah.HDLR_TYPES[t])}static mdat(t){return Ah.box(Ah.types.mdat,t)}static mdhd(t,e){e*=t;const n=Math.floor(e/(kh+1)),i=Math.floor(e%(kh+1));return Ah.box(Ah.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static mdia(t){return Ah.box(Ah.types.mdia,Ah.mdhd(t.timescale||0,t.duration||0),Ah.hdlr(t.type),Ah.minf(t))}static mfhd(t){return Ah.box(Ah.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return"audio"===t.type?Ah.box(Ah.types.minf,Ah.box(Ah.types.smhd,Ah.SMHD),Ah.DINF,Ah.stbl(t)):Ah.box(Ah.types.minf,Ah.box(Ah.types.vmhd,Ah.VMHD),Ah.DINF,Ah.stbl(t))}static moof(t,e,n){return Ah.box(Ah.types.moof,Ah.mfhd(t),Ah.traf(n,e))}static moov(t){let e=t.length;const n=[];for(;e--;)n[e]=Ah.trak(t[e]);return Ah.box.apply(null,[Ah.types.moov,Ah.mvhd(t[0].timescale||0,t[0].duration||0)].concat(n).concat(Ah.mvex(t)))}static mvex(t){let e=t.length;const n=[];for(;e--;)n[e]=Ah.trex(t[e]);return Ah.box.apply(null,[Ah.types.mvex,...n])}static mvhd(t,e){e*=t;const n=Math.floor(e/(kh+1)),i=Math.floor(e%(kh+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ah.box(Ah.types.mvhd,r)}static sdtp(t){const e=t.samples||[],n=new Uint8Array(4+e.length);let i,r;for(i=0;i<e.length;i++)r=e[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Ah.box(Ah.types.sdtp,n)}static stbl(t){return Ah.box(Ah.types.stbl,Ah.stsd(t),Ah.box(Ah.types.stts,Ah.STTS),Ah.box(Ah.types.stsc,Ah.STSC),Ah.box(Ah.types.stsz,Ah.STSZ),Ah.box(Ah.types.stco,Ah.STCO))}static avc1(t){let e,n,i,r=[],s=[];for(e=0;e<t.sps.length;e++)n=t.sps[e],i=n.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(n));for(e=0;e<t.pps.length;e++)n=t.pps[e],i=n.byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(n));const a=Ah.box(Ah.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(s))),o=t.width,l=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return Ah.box(Ah.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,Ah.box(Ah.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Ah.box(Ah.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,255&e,0,0])}static mp4a(t){return Ah.box(Ah.types.mp4a,Ah.audioStsd(t),Ah.box(Ah.types.esds,Ah.esds(t)))}static mp3(t){return Ah.box(Ah.types[".mp3"],Ah.audioStsd(t))}static ac3(t){return Ah.box(Ah.types["ac-3"],Ah.audioStsd(t),Ah.box(Ah.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if("audio"===t.type){if("aac"===e)return Ah.box(Ah.types.stsd,Ah.STSD,Ah.mp4a(t));if("ac3"===e&&t.config)return Ah.box(Ah.types.stsd,Ah.STSD,Ah.ac3(t));if("mp3"===e&&"mp3"===t.codec)return Ah.box(Ah.types.stsd,Ah.STSD,Ah.mp3(t))}else{if(!t.pps||!t.sps)throw new Error("video track missing pps or sps");if("avc"===e)return Ah.box(Ah.types.stsd,Ah.STSD,Ah.avc1(t));if("hevc"===e&&t.vps)return Ah.box(Ah.types.stsd,Ah.STSD,Ah.hvc1(t))}throw new Error(`unsupported ${t.type} segment codec (${e}/${t.codec})`)}static tkhd(t){const e=t.id,n=(t.duration||0)*(t.timescale||0),i=t.width||0,r=t.height||0,s=Math.floor(n/(kh+1)),a=Math.floor(n%(kh+1));return Ah.box(Ah.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static traf(t,e){const n=Ah.sdtp(t),i=t.id,r=Math.floor(e/(kh+1)),s=Math.floor(e%(kh+1));return Ah.box(Ah.types.traf,Ah.box(Ah.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),Ah.box(Ah.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s])),Ah.trun(t,n.length+16+20+8+16+8+8),n)}static trak(t){return t.duration=t.duration||4294967295,Ah.box(Ah.types.trak,Ah.tkhd(t),Ah.mdia(t))}static trex(t){const e=t.id;return Ah.box(Ah.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const n=t.samples||[],i=n.length,r=12+16*i,s=new Uint8Array(r);let a,o,l,u,c,h;for(e+=8+r,s.set(["video"===t.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),a=0;a<i;a++)o=n[a],l=o.duration,u=o.size,c=o.flags,h=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return Ah.box(Ah.types.trun,s)}static initSegment(t){Ah.types||Ah.init();const e=Ah.moov(t);return _o(Ah.FTYP,e)}static hvc1(t){const e=t.params,n=[t.vps,t.sps,t.pps],i=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),3|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),n.length]);let r=i.length;for(let t=0;t<n.length;t+=1){r+=3;for(let e=0;e<n[t].length;e+=1)r+=2+n[t][e].length}const s=new Uint8Array(r);s.set(i,0),r=i.length;const a=n.length-1;for(let t=0;t<n.length;t+=1){s.set(new Uint8Array([32+t|(t===a?128:0),0,n[t].length]),r),r+=3;for(let e=0;e<n[t].length;e+=1)s.set(new Uint8Array([n[t][e].length>>8,255&n[t][e].length]),r),r+=2,s.set(n[t][e],r),r+=n[t][e].length}const o=Ah.box(Ah.types.hvcC,s),l=t.width,u=t.height,c=t.pixelRatio[0],h=t.pixelRatio[1];return Ah.box(Ah.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Ah.box(Ah.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Ah.box(Ah.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))}}function xh(t,e,n=1,i=!1){const r=t*e*n;return i?Math.round(r):r}function Ch(t,e=!1){return xh(t,1e3,1/9e4,e)}function Ih(t){const{baseTime:e,timescale:n,trackId:i}=t;return`${e/n} (${e}/${n}) trackId: ${i}`}Ah.types=void 0,Ah.HDLR_TYPES=void 0,Ah.STTS=void 0,Ah.STSC=void 0,Ah.STCO=void 0,Ah.STSZ=void 0,Ah.VMHD=void 0,Ah.SMHD=void 0,Ah.STSD=void 0,Ah.FTYP=void 0,Ah.DINF=void 0;let Ph,Rh=null,Oh=null;function Mh(t,e,n,i){return{duration:e,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}class Fh extends Da{constructor(t,e,n,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===Rh){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Rh=t?parseInt(t[1]):0}if(null===Oh){const t=navigator.userAgent.match(/Safari\/(\d+)/i);Oh=t?parseInt(t[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){const e=this._initPTS;e&&t&&t.trackId===e.trackId&&t.baseTime===e.baseTime&&t.timescale===e.timescale||this.log(`Reset initPTS: ${e?Ih(e):e} > ${t?Ih(t):t}`),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const n=t[0].pts,i=t.reduce((t,i)=>{let r=i.pts,s=r-t;return s<-4294967296&&(e=!0,r=Nh(r,n),s=r-t),s>0?t:r},n);return e&&this.debug("PTS rollover detected"),i}remux(t,e,n,i,r,s,a,o){let l,u,c,h,d,f,p=r,m=r;const g=t.pid>-1,v=e.pid>-1,y=e.samples.length,_=t.samples.length>0,b=a&&y>0||y>1;if((!g||_)&&(!v||b)||this.ISGenerated||a){if(this.ISGenerated){var E,T,S,D;const t=this.videoTrackConfig;(t&&(e.width!==t.width||e.height!==t.height||(null==(E=e.pixelRatio)?void 0:E[0])!==(null==(T=t.pixelRatio)?void 0:T[0])||(null==(S=e.pixelRatio)?void 0:S[1])!==(null==(D=t.pixelRatio)?void 0:D[1]))||!t&&b||null===this.nextAudioTs&&_)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(t,e,r,s));const n=this.isVideoContiguous;let i,a=-1;if(b&&(a=function(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn(`Dropped ${a} out of ${y} video samples due to a missing keyframe`);const t=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(a),e.dropped+=a,m+=(e.samples[0].pts-t)/e.inputTimeScale,i=m}else-1===a&&(this.warn(`No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(_&&b){const n=this.getVideoStartPts(e.samples),i=(Nh(t.samples[0].pts,n)-n)/e.inputTimeScale;p+=Math.max(0,i),m+=Math.max(0,-i)}if(_){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(t,e,r,s)),u=this.remuxAudio(t,p,this.isAudioContiguous,s,v||b||o===ga?m:void 0),b){const i=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(t,e,r,s)),l=this.remuxVideo(e,m,n,i)}}else b&&(l=this.remuxVideo(e,m,n,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=Bh(n,r,this._initPTS,this._initDTS)),i.samples.length&&(h=Uh(i,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:h,id3:d}}computeInitPts(t,e,n,i){const r=Math.round(n*e);let s=Nh(t,r);if(s<r+e)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-s)/e} ${i}`);s<r+e;)s+=8589934592;return s-r}generateIS(t,e,n,i){const r=t.samples,s=e.samples,a=this.typeSupported,o={},l=this._initPTS;let u,c,h,d=!l||i,f="audio/mp4",p=-1;if(d&&(u=c=1/0),t.config&&r.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",t.codec=""):a.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}o.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&a.mpeg?new Uint8Array(0):Ah.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(p=t.id,h=t.inputTimeScale,l&&h===l.timescale?d=!1:u=c=this.computeInitPts(r[0].pts,h,n,"audio"))}if(e.sps&&e.pps&&s.length){if(e.timescale=e.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Ah.initSegment([e]),metadata:{width:e.width,height:e.height}},d)if(p=e.id,h=e.inputTimeScale,l&&h===l.timescale)d=!1;else{const t=this.getVideoStartPts(s),e=Nh(s[0].dts,t),i=this.computeInitPts(e,h,n,"video"),r=this.computeInitPts(t,h,n,"video");c=Math.min(c,i),u=Math.min(u,r)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,d?(l&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${u/h} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${u/h} (${u}/${h}) trackId: ${p}`),this._initPTS={baseTime:u,timescale:h,trackId:p},this._initDTS={baseTime:c,timescale:h,trackId:p}):u=h=void 0,{tracks:o,initPTS:u,timescale:h,trackId:p}}remuxVideo(t,e,n,i){const r=t.inputTimeScale,s=t.samples,a=[],o=s.length,l=this._initPTS,u=l.baseTime*r/l.timescale;let c,h,d=this.nextVideoTs,f=8,p=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===d){const t=u+e*r,i=s[0].pts-Nh(s[0].dts,s[0].pts);Rh&&null!==d&&Math.abs(t-i-(d+u))<15e3?n=!0:d=t-i-u}const y=d+u;for(let t=0;t<o;t++){const e=s[t];e.pts=Nh(e.pts,y),e.dts=Nh(e.dts,y),e.dts<s[t>0?t-1:t].dts&&(v=!0)}v&&s.sort(function(t,e){const n=t.dts-e.dts,i=t.pts-e.pts;return n||i}),c=s[0].dts,h=s[s.length-1].dts;const _=h-c,b=_?Math.round(_/(o-1)):p||t.inputTimeScale/30;if(n){const n=c-y,i=n>b,r=n<-1;if((i||r)&&(i?this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${Ch(n,!0)} ms (${n}dts) hole between fragments detected at ${e.toFixed(3)}`):this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${Ch(-n,!0)} ms (${n}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!r||y>=s[0].pts||Rh)){c=y;const t=s[0].pts-n;if(i)s[0].dts=c,s[0].pts=t;else{let e=!0;for(let i=0;i<s.length&&!(s[i].dts>t&&e);i++){const t=s[i].pts;if(s[i].dts-=n,s[i].pts-=n,i<s.length-1){const n=s[i+1].pts;e=n<=s[i].pts==n<=t}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ch(t,!0)}/${Ch(c,!0)}, delta: ${Ch(n,!0)} ms`)}}c=Math.max(0,c);let E=0,T=0,S=c;for(let t=0;t<o;t++){const e=s[t],n=e.units,i=n.length;let r=0;for(let t=0;t<i;t++)r+=n[t].data.length;T+=r,E+=i,e.length=r,e.dts<S?(e.dts=S,S+=b/4|0||1):S=e.dts,m=Math.min(e.pts,m),g=Math.max(e.pts,g)}h=s[o-1].dts;const D=T+4*E+8;let w;try{w=new Uint8Array(D)}catch(t){return void this.observer.emit(ca.ERROR,ca.ERROR,{type:la.MUX_ERROR,details:ua.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:D,reason:`fail allocating video mdat ${D}`})}const L=new DataView(w.buffer);L.setUint32(0,D),w.set(Ah.types.mdat,4);let k=!1,A=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,I=Number.NEGATIVE_INFINITY;for(let t=0;t<o;t++){const e=s[t],n=e.units;let l,c=0;for(let t=0,e=n.length;t<e;t++){const e=n[t],i=e.data,r=e.data.byteLength;L.setUint32(f,r),f+=4,w.set(i,f),f+=r,c+=4+r}if(t<o-1)p=s[t+1].dts-e.dts,l=s[t+1].pts-e.pts;else{const n=this.config,a=t>0?e.dts-s[t-1].dts:b;if(l=t>0?e.pts-s[t-1].pts:b,n.stretchShortVideoTrack&&null!==this.nextAudioTs){const t=Math.floor(n.maxBufferHole*r),s=(i?m+i*r:this.nextAudioTs+u)-e.pts;s>t?(p=s-a,p<0?p=a:k=!0,this.log(`It is approximately ${s/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=a}else p=a}const h=Math.round(e.pts-e.dts);A=Math.min(A,p),C=Math.max(C,p),x=Math.min(x,l),I=Math.max(I,l),a.push(Mh(e.key,p,c,h))}if(a.length)if(Rh){if(Rh<70){const t=a[0].flags;t.dependsOn=2,t.isNonSync=0}}else if(Oh&&I-x<C-A&&b/C<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let t=c;for(let e=0,n=a.length;e<n;e++){const i=t+a[e].duration,r=t+a[e].cts;if(e<n-1){const t=i+a[e+1].cts;a[e].duration=t-r}else a[e].duration=e?a[e-1].duration:b;a[e].cts=0,t=i}}p=k||!p?b:p;const P=h+p;this.nextVideoTs=d=P-u,this.videoSampleDuration=p,this.isVideoContiguous=!0;const R={data1:Ah.moof(t.sequenceNumber++,c,Ea(t,{samples:a})),data2:w,startPTS:(m-u)/r,endPTS:(g+p-u)/r,startDTS:(c-u)/r,endDTS:d/r,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,R}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(t,e,n,i,r){const s=t.inputTimeScale,a=s/(t.samplerate?t.samplerate:s),o=this.getSamplesPerFrame(t),l=o*a,u=this._initPTS,c="mp3"===t.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==r;let f=t.samples,p=c?0:8,m=this.nextAudioTs||-1;const g=u.baseTime*s/u.timescale,v=g+e*s;if(this.isAudioContiguous=n=n||f.length&&m>0&&(i&&Math.abs(v-(m+g))<9e3||Math.abs(Nh(f[0].pts,v)-(m+g))<20*l),f.forEach(function(t){t.pts=Nh(t.pts,v)}),!n||m<0){const t=f.length;if(f=f.filter(t=>t.pts>=0),t!==f.length&&this.warn(`Removed ${f.length-t} of ${t} samples (initPTS ${g} / ${s})`),!f.length)return;m=0===r?0:i&&!d?Math.max(0,v-g):f[0].pts-g}if("aac"===t.segmentCodec){const e=this.config.maxAudioFramesDrift;for(let n=0,i=m+g;n<f.length;n++){const r=f[n],a=r.pts,o=a-i,u=Math.abs(1e3*o/s);if(o<=-e*l&&d)0===n&&(this.warn(`Audio frame @ ${(a/s).toFixed(3)}s overlaps marker by ${Math.round(1e3*o/s)} ms.`),this.nextAudioTs=m=a-g,i=a);else if(o>=e*l&&u<1e4&&d){let e=Math.round(o/l);for(i=a-e*l;i<0&&e&&l;)e--,i+=l;0===n&&(this.nextAudioTs=m=i-g),this.warn(`Injecting ${e} audio frames @ ${((i-g)/s).toFixed(3)}s due to ${Math.round(1e3*o/s)} ms gap.`);for(let s=0;s<e;s++){let e=Lh.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);e||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),e=r.unit.subarray()),f.splice(n,0,{unit:e,pts:i}),i+=l,n++}}r.pts=i,i+=l}}let y,_=null,b=null,E=0,T=f.length;for(;T--;)E+=f[T].unit.byteLength;for(let e=0,i=f.length;e<i;e++){const i=f[e],r=i.unit;let s=i.pts;if(null!==b)h[e-1].duration=Math.round((s-b)/a);else{if(n&&"aac"===t.segmentCodec&&(s=m+g),_=s,!(E>0))return;E+=p;try{y=new Uint8Array(E)}catch(t){return void this.observer.emit(ca.ERROR,ca.ERROR,{type:la.MUX_ERROR,details:ua.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:E,reason:`fail allocating audio mdat ${E}`})}c||(new DataView(y.buffer).setUint32(0,E),y.set(Ah.types.mdat,4))}y.set(r,p);const l=r.byteLength;p+=l,h.push(Mh(!0,o,l,0)),b=s}const S=h.length;if(!S)return;const D=h[h.length-1];m=b-g,this.nextAudioTs=m+a*D.duration;const w=c?new Uint8Array(0):Ah.moof(t.sequenceNumber++,_/a,Ea({},t,{samples:h}));t.samples=[];const L=(_-g)/s,k=m/s,A={data1:w,data2:y,startPTS:L,endPTS:k,startDTS:L,endDTS:k,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,A}}function Nh(t,e){let n;if(null===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function Bh(t,e,n,i){const r=t.samples.length;if(!r)return;const s=t.inputTimeScale;for(let a=0;a<r;a++){const r=t.samples[a];r.pts=Nh(r.pts-n.baseTime*s/n.timescale,e*s)/s,r.dts=Nh(r.dts-i.baseTime*s/i.timescale,e*s)/s}const a=t.samples;return t.samples=[],{samples:a}}function Uh(t,e,n){const i=t.samples.length;if(!i)return;const r=t.inputTimeScale;for(let s=0;s<i;s++){const i=t.samples[s];i.pts=Nh(i.pts-n.baseTime*r/n.timescale,e*r)/r}t.samples.sort((t,e)=>t.pts-e.pts);const s=t.samples;return t.samples=[],{samples:s}}function $h(t,e,n=!1){return void 0!==(null==t?void 0:t.start)?(t.start+(n?t.duration:0))/t.timescale:e}function zh(t,e,n){const i=t.codec;return i&&i.length>4?i:e===Ka?"ec-3"===i||"ac-3"===i||"alac"===i?i:"fLaC"===i||"Opus"===i?Fo(i,!1):(n.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(n.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}try{Ph=self.performance.now.bind(self.performance)}catch(t){Ph=Date.now}const Gh=[{demux:class{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,n,i){const r=this.videoTrack=qc("video",1),s=this.audioTrack=qc("audio",1),a=this.txtTrack=qc("text",1);if(this.id3Track=qc("id3",1),this.timeOffset=0,null==t||!t.byteLength)return;const o=co(t);if(o.video){const{id:t,timescale:e,codec:n,supplemental:i}=o.video;r.id=t,r.timescale=a.timescale=e,r.codec=n,r.supplemental=i}if(o.audio){const{id:t,timescale:e,codec:n}=o.audio;s.id=t,s.timescale=e,s.codec=n}a.id=no.text,r.sampleDuration=0,r.duration=s.duration=i}resetContiguity(){this.remainderData=null}static probe(t){return function(t){const e=t.byteLength;for(let n=0;n<e;){const i=so(t,n);if(i>8&&109===t[n+4]&&111===t[n+5]&&111===t[n+6]&&102===t[n+7])return!0;n=i>1?n+i:e}return!1}(t)}demux(t,e){this.timeOffset=e;let n=t;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=_o(this.remainderData,t));const e=function(t){const e={valid:null,remainder:null},n=lo(t,["moof"]);if(n.length<2)return e.remainder=t,e;const i=n[n.length-1];return e.valid=t.slice(0,i.byteOffset-8),e.remainder=t.slice(i.byteOffset-8),e}(n);this.remainderData=e.remainder,i.samples=e.valid||new Uint8Array}else i.samples=n;const s=this.extractID3Track(i,e);return r.samples=bo(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,n=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(e,this.timeOffset);return n.samples=bo(t,e),{videoTrack:e,audioTrack:qc(),id3Track:i,textTrack:qc()}}extractID3Track(t,e){const n=this.id3Track;if(t.samples.length){const i=lo(t.samples,["emsg"]);i&&i.forEach(t=>{const i=function(t){const e=t[0];let n="",i="",r=0,s=0,a=0,o=0,l=0,u=0;if(0===e){for(;"\0"!==io(t.subarray(u,u+1));)n+=io(t.subarray(u,u+1)),u+=1;for(n+=io(t.subarray(u,u+1)),u+=1;"\0"!==io(t.subarray(u,u+1));)i+=io(t.subarray(u,u+1)),u+=1;i+=io(t.subarray(u,u+1)),u+=1,r=so(t,12),s=so(t,16),o=so(t,20),l=so(t,24),u=28}else if(1===e){u+=4,r=so(t,u),u+=4;const e=so(t,u);u+=4;const s=so(t,u);for(u+=4,a=2**32*e+s,aa(a)||(a=Number.MAX_SAFE_INTEGER,Ca.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=so(t,u),u+=4,l=so(t,u),u+=4;"\0"!==io(t.subarray(u,u+1));)n+=io(t.subarray(u,u+1)),u+=1;for(n+=io(t.subarray(u,u+1)),u+=1;"\0"!==io(t.subarray(u,u+1));)i+=io(t.subarray(u,u+1)),u+=1;i+=io(t.subarray(u,u+1)),u+=1}return{schemeIdUri:n,value:i,timeScale:r,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:t.subarray(u,t.byteLength)}}(t);if(hh.test(i.schemeIdUri)){const t=dh(i,e);let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const s=i.payload;n.samples.push({data:s,len:s.byteLength,dts:t,pts:t,type:Zc.emsg,duration:r})}else if(this.config.enableEmsgKLVMetadata&&i.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const t=dh(i,e);n.samples.push({data:i.payload,len:i.payload.byteLength,dts:t,pts:t,type:Zc.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(t,e,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends Da{constructor(t,e,n,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,n,i){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(t,i),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:n,videoCodec:i}=this;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:r,video:s}=this.initData=co(t);if(e)!function(t,e){if(!t||!e)return;const n=e.keyId;n&&e.isCommonEncryption&&vo(t,(t,e)=>{const i=t.subarray(8,24);i.some(t=>0!==t)||(Ca.log(`[eme] Patching keyId in 'enc${e?"a":"v"}>sinf>>tenc' box: ${Oa(i)} -> ${Oa(n)}`),t.set(n,8))})}(t,e);else{const t=r||s;null!=t&&t.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${t.codec}")!`)}r&&(n=zh(r,Ka,this)),s&&(i=zh(s,Wa,this));const a={};r&&s?a.audiovideo={container:"video/mp4",codec:n+","+i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:t,id:"main"}:r?a.audio={container:"audio/mp4",codec:n,encrypted:r.encrypted,initSegment:t,id:"audio"}:s?a.video={container:"video/mp4",codec:i,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(t,e,n,i,r,s){var a,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};sa(u)||(u=this.lastEndTime=r||0);const h=e.samples;if(!h.length)return c;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(t,e,n){const i={},r=lo(t,["moof","traf"]);for(let t=0;t<r.length;t++){const s=r[t],a=lo(s,["tfhd"])[0],o=so(a,4),l=e[o];if(!l)continue;i[o]||(i[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const u=i[o],c=lo(s,["tfdt"])[0];if(c){const t=c[0];let e=so(c,4);1===t&&(e===to?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(e*=to+1,e+=so(c,8))),sa(e)&&(!sa(u.start)||e<u.start)&&(u.start=e)}const h=l.default,d=so(a,0)|(null==h?void 0:h.flags);let f=(null==h?void 0:h.duration)||0;8&d&&(f=so(a,2&d?12:8));const p=lo(s,["trun"]);let m=u.start||0,g=0,v=f;for(let t=0;t<p.length;t++){const e=p[t],n=so(e,4),i=u.sampleCount;u.sampleCount+=n;const r=1&e[3],s=4&e[3],a=1&e[2],o=2&e[2],l=4&e[2],c=8&e[2];let h=8,d=n;for(r&&(h+=4),s&&n&&(1&e[h+1]||void 0!==u.keyFrameIndex||(u.keyFrameIndex=i),h+=4,a?(v=so(e,h),h+=4):v=f,o&&(h+=4),c&&(h+=4),m+=v,g+=v,d--);d--;)a?(v=so(e,h),h+=4):v=f,o&&(h+=4),l&&(1&e[h+1]||void 0===u.keyFrameIndex&&(u.keyFrameIndex=u.sampleCount-(d+1),u.keyFrameStart=m),h+=4),c&&(h+=4),m+=v,g+=v;!g&&f&&(g+=f*n)}u.duration+=g}if(!Object.keys(i).some(t=>i[t].duration)){let e=1/0,n=0;const r=lo(t,["sidx"]);for(let t=0;t<r.length;t++){const i=uo(r[t]);if(null!=i&&i.references){e=Math.min(e,i.earliestPresentationTime/i.timescale);const t=i.references.reduce((t,e)=>t+e.info.duration||0,0);n=Math.max(n,t+i.earliestPresentationTime/i.timescale)}}n&&sa(n)&&Object.keys(i).forEach(t=>{i[t].duration||(i[t].duration=n*i[t].timescale-i[t].start)})}return i}(h,f,this),m=f.audio?p[f.audio.id]:null,g=f.video?p[f.video.id]:null,v=$h(g,1/0),y=$h(m,1/0),_=$h(g,0,!0),b=$h(m,0,!0);let E=r,T=0;const S=m&&(!g||!l&&y<v||l&&l.trackId===f.audio.id),D=S?m:g;if(D){const t=D.timescale,e=D.start-r*t,n=S?f.audio.id:f.video.id;E=D.start/t,T=S?b-y:_-v,!s&&l||!function(t,e,n,i){if(null===t)return!0;const r=Math.max(i,1),s=e-t.baseTime/t.timescale;return Math.abs(s-n)>r}(l,E,r,T)&&t===l.timescale||(l&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${e/t} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${E-r} (${e}/${t}) trackId: ${n}`),l=null,d.initPTS=e,d.timescale=t,d.trackId=n)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);l?(d.initPTS=l.baseTime,d.timescale=l.timescale,d.trackId=l.trackId):(d.timescale&&void 0!==d.trackId&&void 0!==d.initPTS||(this.warn("Could not set initPTS"),d.initPTS=E,d.timescale=1,d.trackId=-1),this.initPTS=l={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const w=E-l.baseTime/l.timescale,L=w+T;T>0?this.lastEndTime=L:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const k=!!f.audio,A=!!f.video;let x="";k&&(x+="audio"),A&&(x+="video");const C={data1:h,startPTS:w,startDTS:w,endPTS:L,endDTS:L,type:x,hasAudio:k,hasVideo:A,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};c.audio=k&&!A?C:void 0,c.video=A?C:void 0;const I=null==g?void 0:g.sampleCount;if(I){const t=g.keyFrameIndex,e=-1!==t;C.nb=I,C.dropped=0===t||this.isVideoContiguous?0:e?t:I,C.independent=e,C.firstKeyFrame=t,e&&g.keyFrameStart&&(C.firstKeyFramePTS=(g.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(c.independent=e),this.isVideoContiguous||(this.isVideoContiguous=e),C.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${t}/${I} dropped: ${C.dropped} start: ${C.firstKeyFramePTS||"NA"}`)}return c.initSegment=d,c.id3=Bh(n,r,l,l),i.samples.length&&(c.text=Uh(i,r,l)),c}}},{demux:_h,remux:Fh},{demux:class extends Xc{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,n,i){super.resetInitSegment(t,e,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const n=Pc(t,0);let i=(null==n?void 0:n.length)||0;if(lh(t,i))return!1;for(let n=t.length;i<n;i++)if(Nc(t,i))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return function(t,e){return e+5<t.length}(t,e)&&Rc(t,e)&&Mc(t,e)<=t.length-e}(t,e)}appendFrame(t,e,n){Bc(t,this.observer,e,n,t.manifestCodec);const i=$c(t,e,n,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},remux:Fh},{demux:class extends Xc{resetInitSegment(t,e,n,i){super.resetInitSegment(t,e,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=Pc(t,0);let n=(null==e?void 0:e.length)||0;if(e&&11===t[n]&&119===t[n+1]&&void 0!==Yc(e)&&uh(t,n)<=16)return!1;for(let e=t.length;n<e;n++)if(lh(t,n))return Ca.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return ah(t,e)&&4<=t.length-e}(t,e)}appendFrame(t,e,n){if(null!==this.basePTS)return rh(t,e,n,this.basePTS,this.frameIndex)}},remux:Fh}];Gh.splice(2,0,{demux:class extends Xc{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,n,i){super.resetInitSegment(t,e,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:i,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,n){const i=ch(t,e,n,this.basePTS,this.frameIndex);if(-1!==i)return{sample:t.samples[t.samples.length-1],length:i,missing:0}}static probe(t){if(!t)return!1;const e=Pc(t,0);if(!e)return!1;const n=e.length;return 11===t[n]&&119===t[n+1]&&void 0!==Yc(e)&&uh(t,n)<16}},remux:Fh});class jh{constructor(t,e,n,i,r,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=n,this.id=r,this.logger=s}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,n,i){const r=n.transmuxing;r.executeStart=Ph();let s=new Uint8Array(t);const{currentTransmuxState:a,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:h,timeOffset:d,initSegmentChange:f}=i||a,{audioCodec:p,videoCodec:m,defaultInitPts:g,duration:v,initSegmentData:y}=o,_=function(t,e){let n=null;return t.byteLength>0&&null!=(null==e?void 0:e.key)&&null!==e.iv&&null!=e.method&&(n=e),n}(s,e);if(_&&su(_.method)){const t=this.getDecrypter(),e=au(_.method);if(!t.isSync())return this.asyncResult=!0,this.decryptionPromise=t.webCryptoDecrypt(s,_.key.buffer,_.iv.buffer,e).then(t=>{const e=this.push(t,null,n);return this.decryptionPromise=null,e}),this.decryptionPromise;{let i=t.softwareDecrypt(s,_.key.buffer,_.iv.buffer,e);if(n.part>-1){const e=t.flush();i=e?e.buffer:e}if(!i)return r.executeEnd=Ph(),Hh(n);s=new Uint8Array(i)}}const b=this.needsProbing(u,c);if(b){const t=this.configureTransmuxer(s);if(t)return this.logger.warn(`[transmuxer] ${t.message}`),this.observer.emit(ca.ERROR,ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_PARSING_ERROR,fatal:!1,error:t,reason:t.message}),r.executeEnd=Ph(),Hh(n)}(u||c||f||b)&&this.resetInitSegment(y,p,m,v,e),(u||f||b)&&this.resetInitialTimestamp(g),l||this.resetContiguity();const E=this.transmux(s,_,d,h,n);this.asyncResult=Vh(E);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,r.executeEnd=Ph(),E}flush(t){const e=t.transmuxing;e.executeStart=Ph();const{decrypter:n,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(t));const s=[],{timeOffset:a}=i;if(n){const e=n.flush();e&&s.push(this.push(e.buffer,null,t))}const{demuxer:o,remuxer:l}=this;if(!o||!l){e.executeEnd=Ph();const n=[Hh(t)];return this.asyncResult?Promise.resolve(n):n}const u=o.flush(a);return Vh(u)?(this.asyncResult=!0,u.then(e=>(this.flushRemux(s,e,t),s))):(this.flushRemux(s,u,t),this.asyncResult?Promise.resolve(s):s)}flushRemux(t,e,n){const{audioTrack:i,videoTrack:r,id3Track:s,textTrack:a}=e,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===ma?"level":"track"} ${n.level}`);const u=this.remuxer.remux(i,r,s,a,l,o,!0,this.id);t.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Ph()}resetInitialTimestamp(t){const{demuxer:e,remuxer:n}=this;e&&n&&(e.resetTimeStamp(t),n.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,n,i,r){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(t,e,n,i),a.resetInitSegment(t,e,n,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,n,i,r){let s;return s=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,n,i,r):this.transmuxUnencrypted(t,n,i,r),s}transmuxUnencrypted(t,e,n,i){const{audioTrack:r,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,s,a,o,e,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(t,e,n,i,r){return this.demuxer.demuxSampleAes(t,e,n).then(t=>({remuxResult:this.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,n,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(t){const{config:e,observer:n,typeSupported:i}=this;let r;for(let e=0,n=Gh.length;e<n;e++){var s;if(null!=(s=Gh[e].demux)&&s.probe(t,this.logger)){r=Gh[e];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=r.remux,u=r.demux;o&&o instanceof l||(this.remuxer=new l(n,e,i,this.logger)),a&&a instanceof u||(this.demuxer=new u(n,e,i,this.logger),this.probe=u.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Ml(this.config)),t}}const Hh=t=>({remuxResult:{},chunkMeta:t});function Vh(t){return"then"in t&&t.then instanceof Function}class Kh{constructor(t,e,n,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=n,this.duration=i,this.defaultInitPts=r||null}}class Wh{constructor(t,e,n,i,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=s}}let Yh=0;class Zh{constructor(t,e,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Yh++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=t=>{const e=t.data,n=this.hls;if(n&&null!=e&&e.event&&e.instanceNo===this.instanceNo)switch(e.event){case"init":{var i;const t=null==(i=this.workerContext)?void 0:i.objectURL;t&&self.URL.revokeObjectURL(t);break}case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":n.logger[e.data.logType]&&n.logger[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.part=this.part,e.data.id=this.id,n.trigger(e.event,e.data)}},this.onWorkerError=t=>{if(!this.hls)return;const e=new Error(`${t.message}  (${t.filename}:${t.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:e})};const r=t.config;this.hls=t,this.id=e,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const s=(t,e)=>{(e=e||{}).frag=this.frag||void 0,t===ca.ERROR&&(e.parent=this.id,e.part=this.part,this.error=e.error),this.hls.trigger(t,e)};this.observer=new Lc,this.observer.on(ca.FRAG_DECRYPTED,s),this.observer.on(ca.ERROR,s);const a=$o(r.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const n=this.hls.logger;if(r.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{r.workerPath?(n.log(`loading Web Worker ${r.workerPath} for "${e}"`),this.workerContext=function(t){const e=Ac[t];if(e)return e.clientCount++,e;const n=new self.URL(t,self.location.href).href,i={worker:new self.Worker(n),scriptURL:n,clientCount:1};return Ac[t]=i,i}(r.workerPath)):(n.log(`injecting Web Worker for "${e}"`),this.workerContext=function(){const t=Ac[kc];if(t)return t.clientCount++,t;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),n=self.URL.createObjectURL(e),i={worker:new self.Worker(n),objectURL:n,clientCount:1};return Ac[kc]=i,i}());const{worker:t}=this.workerContext;t.addEventListener("message",this.onWorkerMessage),t.addEventListener("error",this.onWorkerError),t.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:e,config:el(r)})}catch(i){n.warn(`Error setting up "${e}" Web Worker, fallback to inline`,i),this.terminateWorker(),this.error=null,this.transmuxer=new jh(this.observer,a,r,"",e,t.logger)}return}}this.transmuxer=new jh(this.observer,a,r,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=Yh++;const e=this.hls.config,n=$o(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:n,id:this.id,config:el(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),function(t){const e=Ac[t||kc];if(e&&1===e.clientCount--){const{worker:n,objectURL:i}=e;delete Ac[t||kc],i&&self.URL.revokeObjectURL(i),n.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,n,i,r,s,a,o,l,u){var c,h;l.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:f}=this,p=s?s.start:r.start,m=r.decryptdata,g=this.frag,v=!(g&&r.cc===g.cc),y=!(g&&l.level===g.level),_=g?l.sn-g.sn:-1,b=this.part?l.part-this.part.index:-1,E=0===_&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),T=!y&&(1===_||0===_&&(1===b||E&&b<=0)),S=self.performance.now();(y||_||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!s||!b&&T||(s.stats.parsing.start=S);const D=!(g&&(null==(c=r.initSegment)?void 0:c.url)===(null==(h=g.initSegment)?void 0:h.url)),w=new Wh(v,T,o,y,p,D);if(!T||v||D){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===ma?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${v}\n        trackSwitch: ${y}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${p}\n        initSegmentChange: ${D}`);const t=new Kh(n,i,e,a,u);this.configureTransmuxer(t)}if(this.frag=r,this.part=s,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:t,decryptdata:m,chunkMeta:l,state:w},t instanceof ArrayBuffer?[t]:[]);else if(f){const e=f.push(t,m,l,w);Vh(e)?e.then(t=>{this.handleTransmuxComplete(t)}).catch(t=>{this.transmuxerError(t,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(e)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(n){const e=n.flush(t);Vh(e)?e.then(e=>{this.handleFlushResult(e,t)}).catch(e=>{this.transmuxerError(e,t,"transmuxer-interface flush error")}):this.handleFlushResult(e,t)}}transmuxerError(t,e,n){this.hls&&(this.error=t,this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:n}))}handleFlushResult(t,e){t.forEach(t=>{this.handleTransmuxComplete(t)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):n&&n.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}class qh extends Da{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,n){const i=null==e?void 0:e.renditionReports;if(i){let r=-1;for(let n=0;n<i.length;n++){const s=i[n];let a;try{a=new self.URL(s.URI,e.url).href}catch(t){this.warn(`Could not construct new URL for Rendition Report: ${t}`),a=s.URI||""}if(a===t){r=n;break}a===t.substring(0,a.length)&&(r=n)}if(-1!==r){const t=i[r],s=parseInt(t["LAST-MSN"])||e.lastPartSn;let a=parseInt(t["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const t=Math.min(e.age-e.partTarget,e.targetduration);a>=0&&t>e.partTarget&&(a+=1)}const o=n&&Xo(n);return new Qo(s,a>=0?a:void 0,o)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}return t}playlistLoaded(t,e,n){const{details:i,stats:r}=e,s=self.performance.now(),a=r.loading.first?Math.max(0,s-r.loading.first):0;i.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==i.appliedTimelineOffset){const t=Math.max(o||0,0);i.appliedTimelineOffset=t,i.fragments.forEach(e=>{e.setStart(e.playlistOffset+t)})}if(i.live||null!=n&&n.live){const o="levelInfo"in e?e.levelInfo:e.track;if(i.reloaded(n),n&&i.fragments.length>0){!function(t,e,n){if(t===e)return;let i=null;const r=t.fragments;for(let t=r.length-1;t>=0;t--){const e=r[t].initSegment;if(e){i=e;break}}let s;t.fragmentHint&&delete t.fragmentHint.endPTS,function(t,e,n){const i=e.skippedSegments,r=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let u=r;u<=s;u++){const r=l[a+u];let s=o[u];if(i&&!s&&r&&(s=e.fragments[u]=r),r&&s){n(r,s,u,o);const i=r.relurl,a=s.relurl;if(i&&Ju(i,a))return void(e.playlistParsingError=Vu(`media sequence mismatch ${s.sn}:`,t,e,0,s));if(r.cc!==s.cc)return void(e.playlistParsingError=Vu(`discontinuity sequence mismatch (${r.cc}!=${s.cc})`,t,e,0,s))}}}(t,e,(t,n,r,a)=>{if((!e.startCC||e.skippedSegments)&&n.cc!==t.cc){const i=t.cc-n.cc;for(let t=r;t<a.length;t++)a[t].cc+=i;e.endCC=a[a.length-1].cc}sa(t.startPTS)&&sa(t.endPTS)&&(n.setStart(n.startPTS=t.startPTS),n.startDTS=t.startDTS,n.maxStartPTS=t.maxStartPTS,n.endPTS=t.endPTS,n.endDTS=t.endDTS,n.minEndPTS=t.minEndPTS,n.setDuration(t.endPTS-t.startPTS),n.duration&&(s=n),e.PTSKnown=e.alignedSliding=!0),t.hasStreams&&(n.elementaryStreams=t.elementaryStreams),n.loader=t.loader,t.hasStats&&(n.stats=t.stats),t.initSegment&&(n.initSegment=t.initSegment,i=t.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(i&&o.forEach(t=>{var e;!t||t.initSegment&&t.initSegment.relurl!==(null==(e=i)?void 0:e.relurl)||(t.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(t=>!t),e.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let t=e.skippedSegments;t--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=function(t,e,n){const{dateRanges:i,recentlyRemovedDateranges:r}=e,s=Ea({},t);r&&r.forEach(t=>{delete s[t]});const a=Object.keys(s).length;return a?(Object.keys(i).forEach(t=>{const e=s[t],r=new eu(i[t].attr,e);r.isValid?(s[t]=r,e||(r.tagOrder+=a)):n.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${el(i[t].attr)}"`)}),s):i}(t.dateRanges,e,n));const i=t.fragments.filter(t=>t.rawProgramDateTime);if(t.hasProgramDateTime&&!e.hasProgramDateTime)for(let t=1;t<o.length;t++)null===o[t].programDateTime&&Bu(o[t],o[t-1],i);Pu(i,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const n=Zu(t,e.startSN-1);e.startCC=null!=(l=null==n?void 0:n.cc)?l:a[0].cc}!function(t,e,n){if(t&&e){let i=0;for(let r=0,s=t.length;r<=s;r++){const s=t[r],a=e[r+i];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?n(s,a):i--}}}(t.partList,e.partList,(t,e)=>{e.elementaryStreams=t.elementaryStreams,e.stats=t.stats}),s?Hu(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,n):Ku(t,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const t=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=t),e.driftEndTime=u,e.driftEnd=t}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime;-1===e.requestScheduled&&(e.requestScheduled=t.requestScheduled)}(n,i,this);const t=i.playlistParsingError;if(t){this.warn(t);const n=this.hls;if(!n.config.ignorePlaylistParsingErrors){var l;const{networkDetails:s}=e;return void n.trigger(ca.ERROR,{type:la.NETWORK_ERROR,details:ua.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:t,reason:t.message,level:e.level||void 0,parent:null==(l=i.fragments[0])?void 0:l.type,networkDetails:s,stats:r})}i.playlistParsingError=null}}-1===i.requestScheduled&&(i.requestScheduled=r.loading.start);const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,h=Yu(i,1e3*(i.edge-c));if(i.requestScheduled+h<s?i.requestScheduled=s:i.requestScheduled+=h,this.log(`live playlist ${t} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let d,f,p;if(i.canBlockReload&&i.endSN&&i.advanced){const t=this.hls.config.lowLatencyMode,r=i.lastPartSn,a=i.endSN,l=i.lastPartIndex,u=r===a;-1!==l?u?(f=a+1,p=t?0:l):(f=r,p=t?l+1:i.maxPartIndex):f=a+1;const c=i.age,h=c+i.ageHeader;let m=Math.min(h-i.partTarget,1.5*i.targetduration);if(m>0){if(h>3*i.targetduration)this.log(`Playlist last advanced ${c.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,p=void 0;else if(null!=n&&n.tuneInGoal&&h-i.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${m} with playlist age: ${i.age}`),m=0;else{const t=Math.floor(m/i.targetduration);f+=t,void 0!==p&&(p+=Math.round(m%i.targetduration/i.partTarget)),this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${c.toFixed(2)}s goal: ${m} skip sn ${t} to part ${p}`)}i.tuneInGoal=m}if(d=this.getDeliveryDirectives(i,e.deliveryDirectives,f,p),t||!u)return i.requestScheduled=s,void this.loadingPlaylist(o,d)}else(i.canBlockReload||i.canSkipUntil)&&(d=this.getDeliveryDirectives(i,e.deliveryDirectives,f,p));d&&void 0!==f&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(h-2*a,h/2)),this.scheduleLoading(o,d,i)}else this.clearTimer()}scheduleLoading(t,e,n){const i=n||t.details;if(!i)return void this.loadingPlaylist(t,e);const r=self.performance.now(),s=i.requestScheduled;if(r>=s)return void this.loadingPlaylist(t,e);const a=s-r;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),a)}getDeliveryDirectives(t,e,n,i){let r=Xo(t);return null!=e&&e.skip&&t.deltaUpdateFailed&&(n=e.msn,i=e.part,r=""),new Qo(n,i,r)}checkRetry(t){const e=t.details,n=ml(t),i=t.errorAction,{action:r,retryCount:s=0,retryConfig:a}=i||{},o=!!i&&!!a&&(5===r||!i.resolved&&2===r);if(o){var l;if(s>=a.maxNumRetry)return!1;if(n&&null!=(l=t.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const t=_l(a,s);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),t),this.warn(`Retrying playlist loading ${s+1}/${a.maxNumRetry} after "${e}" in ${t}ms`)}t.levelRetry=!0,i.resolved=!0}return o}}function Xh(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Qh(t[n].attrs,e[n].attrs))return!1;return!0}function Qh(t,e,n){const i=t["STABLE-RENDITION-ID"];return i&&!n?i===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>t[n]!==e[n])}function Jh(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}class td{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,n){if(null===this.queues||null===this.tracks)return;const i=this.queues[e];i.push(t),1!==i.length||n||this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const n={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const n={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(n)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const n=null==(e=t[0])?void 0:e.label;"async-blocker"!==n&&"async-blocker-prepend"!==n||(t[0].execute(),t.splice(0,1))})}unblockAudio(t){null!==this.queues&&this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(null===this.queues||null===this.tracks)return;const e=this.queues[t];if(e.length){const i=e[0];try{i.execute()}catch(e){var n;if(i.onError(e),null===this.queues||null===this.tracks)return;const r=null==(n=this.tracks[t])?void 0:n.buffer;null!=r&&r.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){null!==this.queues&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return(null==(e=this.queues)?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return null===t||null===e?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(t){var e,n;return null!=(e=this.queues)&&e[t]||null!=(n=this.tracks)&&n[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const n=null==(e=this.tracks)?void 0:e[t],i=null==n?void 0:n.buffer;return i?`SourceBuffer${i.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(t){var e;return(null==(e=this.queues)?void 0:e[t].map(t=>t.label).join(", "))||""}}const ed=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,nd="HlsJsTrackRemovedError";class id extends Error{constructor(t){super(t),this.name=nd}}function rd(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(e=>{t.removeChild(e)})}function sd(t){return"audio"===t?1:0}class ad{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(ca.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ca.BUFFER_CODECS,this.onBufferCodecs,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(ca.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ca.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const n=this.hls.levels[e.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const n=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,n.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&sa(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const t=this.hls.levels;if(t.length){const e=this.hls,n=this.getMaxLevel(t.length-1);n!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${n}: ${t[n].height}p@${t[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=n,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const n=e.filter((e,n)=>this.isLevelAllowed(e)&&n<=t);return this.clientRect=null,ad.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height)}static getMaxLevelByMediaSize(t,e,n){if(null==t||!t.length)return-1;const i=(t,e)=>!e||t.width!==e.width||t.height!==e.height;let r=t.length-1;const s=Math.max(e,n);for(let e=0;e<t.length;e+=1){const n=t[e];if((n.width>=s||n.height>=s)&&i(n,t[e+1])){r=e;break}}return r}}const od="m",ld="a",ud="v",cd="av",hd="i",dd="tt",fd="h";class pd{constructor(t,e){Array.isArray(t)&&(t=t.map(t=>t instanceof pd?t:new pd(t))),this.value=t,this.params=e}}function md(t,e,n){return function(t,e,n,i){return new Error(`failed to ${t} "${r=e,Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":"object"==typeof r?JSON.stringify(r):String(r)}" as ${n}`,{cause:i});var r}("serialize",t,e,n)}class gd{constructor(t){this.description=t}}const vd="Bare Item";function yd(t){if(function(t){return t<-999999999999999||999999999999999<t}(t))throw md(t,"Integer");return t.toString()}function _d(t,e){if(t<0)return-_d(-t,e);const n=Math.pow(10,e);if(Math.abs(t*n%1-.5)<Number.EPSILON){const e=Math.floor(t*n);return(e%2==0?e:e+1)/n}return Math.round(t*n)/n}function bd(t){const e=_d(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw md(t,"Decimal");const n=e.toString();return n.includes(".")?n:`${n}.0`}const Ed=/[\x00-\x1f\x7f]+/;function Td(t){const e=(n=t).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e))throw md(e,"Token");return e}function Sd(t){switch(typeof t){case"number":if(!sa(t))throw md(t,vd);return Number.isInteger(t)?yd(t):bd(t);case"string":return function(t){if(Ed.test(t))throw md(t,"String");return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(t);case"symbol":return Td(t);case"boolean":return function(t){if("boolean"!=typeof t)throw md(t,"Boolean");return t?"?1":"?0"}(t);case"object":if(t instanceof Date)return function(t){return`@${yd(t.getTime()/1e3)}`}(t);if(t instanceof Uint8Array)return function(t){if(!1===ArrayBuffer.isView(t))throw md(t,"Byte Sequence");return`:${e=t,btoa(String.fromCharCode(...e))}:`;var e}(t);if(t instanceof gd)return Td(t);default:throw md(t,vd)}}function Dd(t){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(t))throw md(t,"Key");return t}function wd(t){return null==t?"":Object.entries(t).map(([t,e])=>!0===e?`;${Dd(t)}`:`;${Dd(t)}=${Sd(e)}`).join("")}function Ld(t){return t instanceof pd?`${Sd(t.value)}${wd(t.params)}`:Sd(t)}function kd(t,e){return function(t,e={whitespace:!0}){if("object"!=typeof t||null==t)throw md(t,"Dict");const n=t instanceof Map?t.entries():Object.entries(t),i=(null==e?void 0:e.whitespace)?" ":"";return Array.from(n).map(([t,e])=>{e instanceof pd==0&&(e=new pd(e));let n=Dd(t);var i;return!0===e.value?n+=wd(e.params):(n+="=",Array.isArray(e.value)?n+=`(${(i=e).value.map(Ld).join(" ")})${wd(i.params)}`:n+=Ld(e)),n}).join(`,${i}`)}(t,e)}const Ad="CMCD-Object",xd="CMCD-Request",Cd="CMCD-Session",Id="CMCD-Status",Pd={br:Ad,ab:Ad,d:Ad,ot:Ad,tb:Ad,tpb:Ad,lb:Ad,tab:Ad,lab:Ad,url:Ad,pb:xd,bl:xd,tbl:xd,dl:xd,ltc:xd,mtp:xd,nor:xd,nrr:xd,rc:xd,sn:xd,sta:xd,su:xd,ttfb:xd,ttfbb:xd,ttlb:xd,cmsdd:xd,cmsds:xd,smrt:xd,df:xd,cs:xd,ts:xd,cid:Cd,pr:Cd,sf:Cd,sid:Cd,st:Cd,v:Cd,msd:Cd,bs:Id,bsd:Id,cdn:Id,rtp:Id,bg:Id,pt:Id,ec:Id,e:Id},Rd=xd;const Od="event",Md=t=>Math.round(t),Fd=(t,e)=>Array.isArray(t)?t.map(t=>Fd(t,e)):t instanceof pd&&"string"==typeof t.value?new pd(Fd(t.value,e),t.params):(e.baseUrl&&(t=function(t,e){const n=new URL(t),i=new URL(e);if(n.origin!==i.origin)return t;const r=n.pathname.split("/").slice(1),s=i.pathname.split("/").slice(1,-1);for(;r[0]===s[0];)r.shift(),s.shift();for(;s.length;)s.shift(),r.unshift("..");return r.join("/")+n.search+n.hash}(t,e.baseUrl)),1===e.version?encodeURIComponent(t):t),Nd=t=>100*Md(t/100),Bd={br:Md,d:Md,bl:Nd,dl:Nd,mtp:Nd,nor:(t,e)=>{let n=t;return e.version>=2&&(t instanceof pd&&"string"==typeof t.value?n=new pd([t]):"string"==typeof t&&(n=[t])),Fd(n,e)},rtp:Nd,tb:Md},Ud="request",$d="response",zd=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Gd=["e"],jd=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Hd(t){return jd.test(t)}const Vd=["d","dl","nor","ot","rtp","su"],Kd=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],Wd=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Yd(t){return Wd.includes(t)||Hd(t)}const Zd={[$d]:function(t){return zd.includes(t)||Vd.includes(t)||Kd.includes(t)||Hd(t)},[Od]:function(t){return zd.includes(t)||Gd.includes(t)||Hd(t)},[Ud]:function(t){return zd.includes(t)||Vd.includes(t)||Hd(t)}};function qd(t,e={}){const n={};if(null==t||"object"!=typeof t)return n;const i=e.version||t.v||1,r=e.reportingMode||Ud,s=1===i?Yd:Zd[r];let a=Object.keys(t).filter(s);const o=e.filter;"function"==typeof o&&(a=a.filter(o));const l=r===$d||r===Od;l&&!a.includes("ts")&&a.push("ts"),i>1&&!a.includes("v")&&a.push("v");const u=Ea({},Bd,e.formatters),c={version:i,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(e=>{let r=t[e];const s=u[e];if("function"==typeof s&&(r=s(r,c)),"v"===e){if(1===i)return;r=i}"pr"==e&&1===r||(l&&"ts"===e&&!sa(r)&&(r=Date.now()),function(t){return"number"==typeof t?sa(t):null!=t&&""!==t&&!1!==t}(r)&&(function(t){return["ot","sf","st","e","sta"].includes(t)}(e)&&"string"==typeof r&&(r=new gd(r)),n[e]=r))}),n}function Xd(t,e,n){return Ea(t,function(t,e={}){const n={};if(!t)return n;const i=function(t,e){const n={};if(!t)return n;const i=Object.keys(t),r=e?(s=e,Object.keys(s).reduce((t,e)=>{var n;return null===(n=s[e])||void 0===n||n.forEach(n=>t[n]=e),t},{})):{};var s;return i.reduce((e,n)=>{var i;const s=Pd[n]||r[n]||Rd;return(null!==(i=e[s])&&void 0!==i?i:e[s]={})[n]=t[n],e},n)}(qd(t,e),null==e?void 0:e.customHeaderMap);return Object.entries(i).reduce((t,[e,n])=>{const i=kd(n,{whitespace:!1});return i&&(t[e]=i),t},n)}(e,n))}const Qd=/CMCD=[^&#]+/;function Jd(t,e,n){const i=function(t,e={}){return t?`CMCD=${function(t,e={}){if(!t)return"";const n=function(t,e={}){return t?kd(qd(t,e),{whitespace:!1}):""}(t,e);return encodeURIComponent(n)}(t,e)}`:""}(e,n);if(!i)return t;if(Qd.test(t))return t.replace(Qd,i);const r=t.includes("?")?"&":"?";return`${t}${r}${i}`}function tf(t,e,n,i){t&&Object.keys(e).forEach(r=>{const s=t.filter(t=>t.groupId===r).map(t=>{const s=Ea({},t);return s.details=void 0,s.attrs=new Ql(s.attrs),s.url=s.attrs.URI=ef(t.url,t.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=e[r],s.attrs["PATHWAY-ID"]=i,s});t.push(...s)})}function ef(t,e,n,i){const{HOST:r,PARAMS:s,[n]:a}=i;let o;e&&(o=null==a?void 0:a[e],o&&(t=o));const l=new self.URL(t);return r&&!o&&(l.host=r),s&&Object.keys(s).sort().forEach(t=>{t&&l.searchParams.set(t,s[t])}),l.href}class nf extends Da{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=nf.CDMCleanupPromise?[nf.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:e,initData:n}=t,i=`"${t.type}" event: init data type: "${e}"`;if(this.debug(i),null!==n){if(!this.keyFormatPromise){let t=Object.keys(this.keySystemAccessPromises);t.length||(t=_u(this.config));const e=t.map(yu).filter(t=>!!t);this.keyFormatPromise=this.getKeyFormatPromise(e)}this.keyFormatPromise.then(r=>{const s=vu(r);if("sinf"!==e||s!==du.FAIRPLAY)return void this.log(`Ignoring "${t.type}" event with init data type: "${e}" for selected key-system ${s}`);let a;try{const t=io(new Uint8Array(n)),e=yo(ou(JSON.parse(t).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(e.subarray(8,24))}catch(t){return void this.warn(`${i} Failed to parse sinf: ${t}`)}const o=Oa(a),{keyIdToKeySessionPromise:l,mediaKeySessions:u}=this;let c=l[o];for(let t=0;t<u.length;t++){const i=u[t],r=i.decryptdata;if(!r.keyId)continue;const s=Oa(r.keyId);if(iu(a,r.keyId)||-1!==r.uri.replace(/-/g,"").indexOf(o)){if(c=l[s],!c)continue;if(r.pssh)break;delete l[s],r.pssh=new Uint8Array(n),r.keyId=a,c=l[o]=c.then(()=>this.generateRequestWithPreferredKeySession(i,e,n,"encrypted-event-key-match")),c.catch(t=>this.handleError(t));break}}c||this.handleError(new Error(`Key ID ${o} not encountered in playlist. Key-system sessions ${u.length}.`))}).catch(t=>this.handleError(t))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ca.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ca.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(ca.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ca.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ca.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(ca.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:n}=this.config,i=null==e?void 0:e[t];return i?i.licenseUrl:t===du.WIDEVINE&&n?n:void 0}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(void 0===e)throw new Error(`no license server URL configured for key-system "${t}"`);return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,n=null==e?void 0:e[t];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,n=(t,e,n)=>!!t&&n.indexOf(t)===e,i=e.map(t=>t.audioCodec).filter(n),r=e.map(t=>t.videoCodec).filter(n);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((e,n)=>{const s=t=>{const a=t.shift();this.getMediaKeysPromise(a,i,r).then(t=>e({keySystem:a,mediaKeys:t})).catch(e=>{t.length?s(t):n(e instanceof af?e:new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))})};s(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!=typeof n){let t=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===bu&&"http:"===self.location.protocol&&(t=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(t))}return n(t,e)}getMediaKeysPromise(t,e,n){var i;const r=function(t,e,n,i){let r;switch(t){case du.FAIRPLAY:r=["cenc","sinf"];break;case du.WIDEVINE:case du.PLAYREADY:r=["cenc"];break;case du.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return function(t,e,n,i){return[{initDataTypes:t,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(t=>({contentType:`audio/mp4; codecs=${t}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(t=>({contentType:`video/mp4; codecs=${t}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}(r,e,n,i)}(t,e,n,this.config.drmSystemOptions||{});let s=this.keySystemAccessPromises[t],a=null==(i=s)?void 0:i.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${t}" key-system access with config: ${el(r)}`),a=this.requestMediaKeySystemAccess(t,r);const e=s=this.keySystemAccessPromises[t]={keySystemAccess:a};return a.catch(e=>{this.log(`Failed to obtain access to key-system "${t}": ${e}`)}),a.then(n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const i=this.fetchServerCertificate(t);this.log(`Create media-keys for "${t}"`);const r=e.mediaKeys=n.createMediaKeys().then(n=>(this.log(`Media-keys created for "${t}"`),e.hasMediaKeys=!0,i.then(e=>e?this.setMediaKeysServerCertificate(n,t,e):n)));return r.catch(e=>{this.error(`Failed to create media-keys for "${t}"}: ${e}`)}),r})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:n}){this.log(`Creating key-system session "${e}" keyId: ${Oa(t.keyId||[])} keyUri: ${t.uri}`);const i=n.createSession(),r={decryptdata:t,keySystem:e,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const n=this.createMediaKeySessionContext(t),i=rf(e),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,r,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,e){const n=t.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${Oa(t.decryptdata.keyId||[])}\n      } (data length: ${e.byteLength})`),n.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>yu(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:t,mediaKeys:e})=>this.attemptSetMediaKeys(t,e))}selectKeySystem(t){return new Promise((e,n)=>{this.getKeySystemSelectionPromise(t).then(({keySystem:t})=>{const i=yu(t);i?e(i):n(new Error(`Unable to find format for key-system "${t}"`))}).catch(n)})}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=_u(this.config),n=t.map(vu).filter(t=>!!t&&-1!==e.indexOf(t));return this.selectKeySystem(n)}getKeyStatus(t){const{mediaKeySessions:e}=this;for(let n=0;n<e.length;n++){const i=sf(t,e[n]);if(i)return i}}loadKey(t){const e=t.keyInfo.decryptdata,n=rf(e),i=this.bannedKeyIds[n];if(i||"internal-error"===this.getKeyStatus(e)){const n=of(i||"internal-error",e);return this.handleError(n,t.frag),Promise.reject(n)}const r=`(keyId: ${n} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${r}`);const s=this.keyIdToKeySessionPromise[n];if(!s){const i=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${r}`),this.attemptSetMediaKeys(n,i).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:n,mediaKeys:i,decryptdata:e}))))).then(t=>{const n=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(t,"cenc",n,"playlist-key")});return i.catch(e=>this.handleError(e,t.frag)),this.keyIdToKeySessionPromise[n]=i,i}return s.catch(n=>{if(n instanceof af){const i=Sa({},n.data);"internal-error"===this.getKeyStatus(e)&&(i.decryptdata=e);const r=new af(i,n.message);this.handleError(r,t.frag)}}),s}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t,e){if(this.hls)if(t instanceof af){e&&(t.data.frag=e);const n=t.data.decryptdata;this.error(`${t.message}${n?` (${Oa(n.keyId||[])})`:""}`),this.hls.trigger(ca.ERROR,t.data)}else this.error(t.message),this.hls.trigger(ca.ERROR,{type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){const e=rf(t),n=this.keyIdToKeySessionPromise[e];if(!n){const e=vu(t.keyFormat),n=e?[e]:_u(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(t){if(t.length||(t=_u(this.config)),0===t.length)throw new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${el({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaResolved=void 0,this.mediaKeys===e)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const i=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(e):new Promise((t,n)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return n(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=e,this.media.setMediaKeys(e).then(t).catch(n)}}));return this.mediaKeys=e,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${t}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(t=>-1===n.indexOf(t))})}generateRequestWithPreferredKeySession(t,e,n,i){var r;const s=null==(r=this.config.drmSystems)||null==(r=r[t.keySystem])?void 0:r.generateRequest;if(s)try{const i=s.call(this.hls,e,n,t);if(!i)throw new Error("Invalid response from configured generateRequest filter");e=i.initDataType,n=i.initData?i.initData:null,t.decryptdata.pssh=n?new Uint8Array(n):null}catch(t){if(this.warn(t.message),this.hls&&this.hls.config.debug)throw t}if(null===n)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(t);const a=rf(t.decryptdata),o=t.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${a} URI: ${o} (init data type: ${e} length: ${n.byteLength})`);const l=new Lc,u=t._onmessage=e=>{const n=t.mediaKeysSession;if(!n)return void l.emit("error",new Error("invalid state"));const{messageType:i,message:r}=e;this.log(`"${i}" message event for session "${n.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(t,r).catch(t=>{l.eventNames().length?l.emit("error",t):this.handleError(t)}):"license-release"===i?t.keySystem===du.FAIRPLAY&&this.updateKeySession(t,lu("acknowledged")).then(()=>this.removeSession(t)).catch(t=>this.handleError(t)):this.warn(`unhandled media key message type "${i}"`)},c=(t,e)=>{let n;e.keyStatus=t,t.startsWith("usable")?l.emit("resolved"):"internal-error"===t||"output-restricted"===t||"output-downscaled"===t?n=of(t,e.decryptdata):"expired"===t?n=new Error(`key expired (keyId: ${a})`):"released"===t?n=new Error("key released"):"status-pending"===t||this.warn(`unhandled key status change "${t}" (keyId: ${a})`),n&&(l.eventNames().length?l.emit("error",n):this.handleError(n))},h=t._onkeystatuseschange=e=>{if(!t.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const n=this.getKeyStatuses(t);if(!Object.keys(n).some(t=>"status-pending"!==n[t]))return;if("expired"===n[a])return this.log(`Expired key ${el(n)} in key-session "${t.mediaKeysSession.sessionId}"`),void this.renewKeySession(t);let i=n[a];if(i)c(i,t);else{var r;const e=1e3;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(r=t.keyStatusTimeouts)[a]||(r[a]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;const n=this.getKeyStatus(t.decryptdata);if(n&&"status-pending"!==n)return this.log(`No status for keyId ${a} in key-session "${t.mediaKeysSession.sessionId}". Using session key-status ${n} from other session.`),c(n,t);this.log(`key status for ${a} in key-session "${t.mediaKeysSession.sessionId}" timed out after ${e}ms`),i="internal-error",c(i,t)},e)),this.log(`No status for keyId ${a} (${el(n)}).`)}};ac(t.mediaKeysSession,"message",u),ac(t.mediaKeysSession,"keystatuseschange",h);const d=new Promise((t,e)=>{l.on("error",e),l.on("resolved",t)});return t.mediaKeysSession.generateRequest(e,n).then(()=>{this.log(`Request generated for key-session "${t.mediaKeysSession.sessionId}" keyId: ${a} URI: ${o}`)}).catch(e=>{throw new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_NO_SESSION,error:e,decryptdata:t.decryptdata,fatal:!1},`Error generating key-session request: ${e}`)}).then(()=>d).catch(e=>(l.removeAllListeners(),this.removeSession(t).then(()=>{throw e}))).then(()=>(l.removeAllListeners(),t))}getKeyStatuses(t){const e={};return t.mediaKeysSession.keyStatuses.forEach((n,i)=>{if("string"==typeof i&&"object"==typeof n){const t=i;i=n,n=t}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);t.keySystem===du.PLAYREADY&&16===r.length&&uu(r);const s=Oa(r);"internal-error"===n&&(this.bannedKeyIds[s]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${s} key-session "${t.mediaKeysSession.sessionId}"`),e[s]=n}),e}fetchServerCertificate(t){const e=this.config,n=new(0,e.loader)(e),i=this.getServerCertificateUrl(t);return i?(this.log(`Fetching server certificate for "${t}"`),new Promise((r,s)=>{const a={responseType:"arraybuffer",url:i},o=e.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,e,n,i)=>{r(t.data)},onError:(e,n,r,o)=>{s(new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:Sa({url:a.url,data:void 0},e)},`"${t}" certificate request failed (${i}). Status: ${e.code} (${e.text})`))},onTimeout:(e,n,r)=>{s(new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:r,response:{url:a.url,data:void 0}},`"${t}" certificate request timed out (${i})`))},onAbort:(t,e,n)=>{s(new Error("aborted"))}};n.load(a,l,u)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,n){return new Promise((i,r)=>{t.setServerCertificate(n).then(r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${n.byteLength}) on "${e}"`),i(t)}).catch(t=>{r(new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(e=>this.updateKeySession(t,new Uint8Array(e)).catch(e=>{throw new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:e,fatal:!1},e.message)}))}unpackPlayReadyKeyMessage(t,e){const n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!n.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let e;for(let n=0,i=r.length;n<i;n++){var s,a;e=r[n];const i=null==(s=e.querySelector("name"))?void 0:s.textContent,o=null==(a=e.querySelector("value"))?void 0:a.textContent;i&&o&&t.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return lu(atob(l))}setupLicenseXHR(t,e,n,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return r.call(this.hls,t,e,n,i)}).catch(s=>{if(!n.decryptdata)throw s;return t.open("POST",e,!0),r.call(this.hls,t,e,n,i)}).then(n=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||i})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:i}))}requestLicense(t,e){const n=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const s=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${s}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let e=a.response;this.log(`License received ${e instanceof ArrayBuffer?e.byteLength:e}`);const n=this.config.licenseResponseCallback;if(n)try{e=n.call(this.hls,a,s,t)}catch(t){this.error(t)}i(e)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new af({type:la.KEY_SYSTEM_ERROR,details:ua.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${s}). Status: ${a.status} (${a.statusText})`));else{const n=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(t,e).then(i,r)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=a,this.setupLicenseXHR(a,s,t,e).then(({xhr:e,licenseChallenge:n})=>{t.keySystem==du.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(e,n)),e.send(n)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const n=e.media;this.media=n,ac(n,"encrypted",this.onMediaEncrypted),ac(n,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=n.mediaKeys}onMediaDetached(){const t=this.media;t&&(oc(t,"encrypted",this.onMediaEncrypted),oc(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const e=this.mediaResolved;if(e&&e(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Du.clearKeyUriToKeyIdMap();const r=i.length;nf.CDMCleanupPromise=Promise.all(i.map(t=>this.removeSession(t)).concat((null==n||null==(t=n.setMediaKeys(null))?void 0:t.catch(t=>{this.log(`Could not clear media keys: ${t}`),this.hls&&this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${t}`)})}))||Promise.resolve())).catch(t=>{this.log(`Could not close sessions and clear media keys: ${t}`),this.hls&&this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${t}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,{sessionKeys:e}){if(e&&this.config.emeEnabled&&!this.keyFormatPromise){const t=e.reduce((t,e)=>(-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t),[]);this.log(`Selecting key-system from session-keys ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:n,decryptdata:i}=t;if(e){this.log(`Remove licenses and keys and close session "${e.sessionId}" keyId: ${Oa((null==i?void 0:i.keyId)||[])}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(t);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:s}=t;s&&Object.keys(s).forEach(t=>self.clearTimeout(s[t]));const{drmSystemOptions:a}=this.config,o=function(t){var e;return!(!t||"persistent-license"!==t.sessionType&&(null==(e=t.sessionTypes)||!e.some(t=>"persistent-license"===t)))}(a)?new Promise((t,n)=>{self.setTimeout(()=>n(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(t).catch(n)}):Promise.resolve();return o.catch(t=>{this.log(`Could not remove session: ${t}`),this.hls&&this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${t}`)})}).then(()=>e.close()).catch(t=>{this.log(`Could not close session: ${t}`),this.hls&&this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${t}`)})})}return Promise.resolve()}}function rf(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return Oa(t.keyId)}function sf(t,e){return t.keyId&&e.mediaKeysSession.keyStatuses.has(t.keyId)?e.mediaKeysSession.keyStatuses.get(t.keyId):t.matches(e.decryptdata)?e.keyStatus:void 0}nf.CDMCleanupPromise=void 0;class af extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}function of(t,e){const n="output-restricted"===t,i=n?ua.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:ua.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new af({type:la.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},n?"HDCP level output restricted":`key status changed to "${t}"`)}function lf(t,e){let n;try{n=new Event("addtrack")}catch(t){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function uf(t,e){const n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Ca.debug(`[texttrack-utils]: ${n}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,t.addCue(n)}catch(t){Ca.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${t}`)}}"disabled"===n&&(t.mode=n)}function cf(t,e){const n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues)for(let n=t.cues.length;n--;)e&&t.cues[n].removeEventListener("enter",e),t.removeCue(t.cues[n]);"disabled"===n&&(t.mode=n)}function hf(t,e,n,i){const r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&t.cues.length>0){const r=function(t,e,n){const i=[],r=function(t,e){if(e<=t[0].startTime)return 0;const n=t.length-1;if(e>t[n].endTime)return-1;let i,r=0,s=n;for(;r<=s;)if(i=Math.floor((s+r)/2),e<t[i].startTime)s=i-1;else{if(!(e>t[i].startTime&&r<n))return i;r=i+1}return t[r].startTime-e<e-t[s].startTime?r:s}(t,e);if(r>-1)for(let s=r,a=t.length;s<a;s++){const r=t[s];if(r.startTime>=e&&r.endTime<=n)i.push(r);else if(r.startTime>n)return i}return i}(t.cues,e,n);for(let e=0;e<r.length;e++)i&&!i(r[e])||t.removeCue(r[e])}"disabled"===r&&(t.mode=r)}function df(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||e.push(t[n])}return e}function ff(t){let e=5381,n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()}const pf=.025;let mf=function(t){return t[t.Point=0]="Point",t[t.Range=1]="Range",t}({});function gf(t,e,n){return`${t.identifier}-${n+1}-${ff(e)}`}class vf{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,null==(t=this.assetListLoader)||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const n=this.playoutLimit;return!(t<=0||isNaN(n))&&(0===n||((null==(e=this.assetList[t])?void 0:e.startOffset)||0)>n)}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return yf(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime;return e-yf(e,t)<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=sa(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return yf(t,e)}return t}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<pf))}set appendInPlace(t){this.appendInPlaceStarted?this.resetOnResume=!t:this.appendInPlaceDisabled=!t}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?mf.Range:mf.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(t=this).identifier}" ${t.cue.pre?"<pre>":t.cue.post?"<post>":""}${t.timelineStart.toFixed(2)}-${t.resumeTime.toFixed(2)}]`;var t}}function yf(t,e){return t-e.start<e.duration/2&&!(Math.abs(t-(e.start+e.duration))<pf)?e.start:e.start+e.duration}function _f(t,e,n){const i=new self.URL(t,n);return"data:"!==i.protocol&&i.searchParams.set("_HLS_primary_id",e),i}function bf(t,e){for(;null!=(n=t.assetList[++e])&&n.error;)var n;return e}function Ef(t){const e=t.timelineStart,n=t.duration||0;return`["${t.identifier}" ${e.toFixed(2)}-${(e+n).toFixed(2)}]`}class Tf{constructor(t,e,n,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(ca.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new t(e);this.interstitial=n,this.assetItem=i;const s=()=>{this.hasDetails=!0};r.once(ca.LEVEL_LOADED,s),r.once(ca.AUDIO_TRACK_LOADED,s),r.once(ca.SUBTITLE_TRACK_LOADED,s),r.on(ca.MEDIA_ATTACHING,(t,{media:e})=>{this.removeMediaListeners(),this.mediaAttached=e,this.interstitial.playoutLimit&&(e.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(ca.BUFFER_APPENDED,()=>{const t=this.bufferedEnd;this.reachedPlayout(t)&&(this._bufferedEosTime=t,r.trigger(ca.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=_f(e,t.config.primarySessionId||"").href}catch(t){}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if(null!=(e=this.hls)&&e.bufferedToEnd)return!0;if(!t)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=Hl.bufferInfo(t,i,0);return this.getAssetTime(r.end)>=n-.02}reachedPlayout(t){const e=this.interstitial.playoutLimit;return this.startOffset+t>=e}get destroyed(){var t;return!(null!=(t=this.hls)&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return(null==(t=this.hls)?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=Hl.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const n=e-this.startOffset;if(n>0&&n<t)return n}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return(null==(t=this.hls)?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const n=t-e;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,t-e),n)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var t;this.mediaAttached&&null!=(t=this.hls)&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),null==(e=this.hls)||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,null==(t=this.hls)||t.detachMedia()}resumeBuffering(){var t;null==(t=this.hls)||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.hls)||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),(null==(t=this.hls)?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=t=>delete t.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,n){var i;null==(i=this.hls)||i.on(t,e)}once(t,e,n){var i;null==(i=this.hls)||i.once(t,e)}off(t,e,n){var i;null==(i=this.hls)||i.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${Ef(this.assetItem)} ${null==(t=this.hls)?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class Sf extends Da{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((n,i)=>t<=i.startOffset&&e>i.startOffset?(delete i.error,n+1):n,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let n=-1;t.nextEvent?n=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(n=this.findEventIndex(t.previousEvent.identifier)+1);const i=this.items;if(i)for(i[n]||(void 0===e&&(e=t.start),n=this.findItemIndexAtTime(e));n>=0&&null!=(r=i[n])&&r.event;){var r;n--}return n}findItemIndexAtTime(t,e){const n=this.items;if(n)for(let i=0;i<n.length;i++){let r=n[i];if(e&&"primary"!==e&&(r=r[e]),t===r.start||t>r.start&&t<r.end)return i}return-1}findJumpRestrictedIndex(t,e){const n=this.items;if(n)for(let i=t;i<=e&&n[i];i++){const t=n[i].event;if(null!=t&&t.restrictions.jump&&!t.appendInPlace)return i}return-1}findEventIndex(t){const e=this.items;if(e)for(let i=e.length;i--;){var n;if((null==(n=e[i].event)?void 0:n.identifier)===t)return i}return-1}findAssetIndex(t,e){const n=t.assetList,i=n.length;if(i>1)for(let t=0;t<i;t++){const r=n[t];if(!r.error){const n=r.timelineStart;if(e===n||e>n&&(e<n+(r.duration||0)||t===i-1))return t}}return 0}get assetIdAtEnd(){var t;const e=null==(t=this.items)||null==(t=t[this.length-1])?void 0:t.event;if(e){const t=e.assetList,n=t[t.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(t,e){const n=t.main.details,{dateRanges:i}=n,r=this.events,s=this.parseDateRanges(i,{url:n.url},e),a=Object.keys(i),o=r?r.filter(t=>!a.includes(t.identifier)):[];s.length&&s.sort((t,e)=>{const n=t.cue.pre,i=t.cue.post,r=e.cue.pre,s=e.cue.post;if(n&&!r)return-1;if(r&&!n)return 1;if(i&&!s)return 1;if(s&&!i)return-1;if(!(n||r||i||s)){const n=t.startTime,i=e.startTime;if(n!==i)return n-i}return t.dateRange.tagOrder-e.dateRange.tagOrder}),this.events=s,o.forEach(t=>{this.removeEvent(t)}),this.updateSchedule(t,o)}updateSchedule(t,e=[],n=!1){const i=this.events||[];if(i.length||e.length||this.length<2){const r=this.items,s=this.parseSchedule(i,t);(n||e.length||(null==r?void 0:r.length)!==s.length||s.some((t,e)=>Math.abs(t.playout.start-r[e].playout.start)>.005||Math.abs(t.playout.end-r[e].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(e,r))}}parseDateRanges(t,e,n){const i=[],r=Object.keys(t);for(let s=0;s<r.length;s++){const a=r[s],o=t[a];if(o.isInterstitial){let t=this.eventMap[a];t?t.setDateRange(o):(t=new vf(o,e),this.eventMap[a]=t,!1===n&&(t.appendInPlace=n)),i.push(t)}}return i}parseSchedule(t,e){const n=[],i=e.main.details,r=i.live?1/0:i.edge;let s=0;if((t=t.filter(t=>!(t.error||t.cue.once&&t.hasPlayed))).length){this.resolveOffsets(t,e);let i=0,o=0;if(t.forEach((e,a)=>{const l=e.cue.pre,u=e.cue.post,c=t[a-1]||null,h=e.appendInPlace,d=u?r:e.startOffset,f=e.duration,p=e.timelineOccupancy===mf.Range?f:0,m=e.resumptionOffset,g=(null==c?void 0:c.startTime)===d,v=d+e.cumulativeDuration;let y=h?v+f:d+m;if(l||!u&&d<=0){const t=o;o+=p,e.timelineStart=v;const i=s;s+=f,n.push({event:e,start:v,end:y,playout:{start:i,end:s},integrated:{start:t,end:o}})}else{if(!(d<=r))return;{if(!g){const r=d-i;if(r>.033){const l=i,u=o;o+=r;const c=s;s+=r;const h={previousEvent:t[a-1]||null,nextEvent:e,start:l,end:l+r,playout:{start:c,end:s},integrated:{start:u,end:o}};n.push(h)}else r>0&&c&&(c.cumulativeDuration+=r,n[n.length-1].end=d)}u&&(y=v),e.timelineStart=v;const r=o;o+=p;const l=s;s+=f,n.push({event:e,start:v,end:y,playout:{start:l,end:s},integrated:{start:r,end:o}})}}const _=e.resumeTime;i=u||_>r?r:_}),i<r){var a;const t=i,e=o,l=r-i;o+=l;const u=s;s+=l,n.push({previousEvent:(null==(a=n[n.length-1])?void 0:a.event)||null,nextEvent:null,start:i,end:t+l,playout:{start:u,end:s},integrated:{start:e,end:o}})}this.setDurations(r,s,o)}else{const t=0;n.push({previousEvent:null,nextEvent:null,start:t,end:r,playout:{start:t,end:r},integrated:{start:t,end:r}}),this.setDurations(r,r,r)}return n}setDurations(t,e,n){this.durations={primary:t,playout:e,integrated:n}}resolveOffsets(t,e){const n=e.main.details,i=n.live?1/0:n.edge;let r=0,s=-1;t.forEach((a,o)=>{const l=a.cue.pre,u=a.cue.post,c=l?0:u?i:a.startTime;this.updateAssetDurations(a),s===c?a.cumulativeDuration=r:(r=0,s=c),!u&&a.snapOptions.in&&(a.resumeAnchor=hl(null,n.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,e)||(a.appendInPlace=!1)),!a.appendInPlace&&o+1<t.length&&t[o+1].startTime-t[o].resumeTime<.033&&(t[o+1].appendInPlace=!1,t[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const h=sa(a.resumeOffset)?a.resumeOffset:a.duration;r+=h})}primaryCanResumeInPlaceAt(t,e){const n=t.resumeTime,i=t.startTime+t.resumptionOffset;return Math.abs(n-i)>pf?(this.log(`"${t.identifier}" resumption ${n} not aligned with estimated timeline end ${i}`),!1):!Object.keys(e).some(i=>{const r=e[i].details,s=r.edge;if(n>=s)return this.log(`"${t.identifier}" resumption ${n} past ${i} playlist end ${s}`),!1;const a=hl(null,r.fragments,n);if(!a)return this.log(`"${t.identifier}" resumption ${n} does not align with any fragments in ${i} playlist (${r.fragStart}-${r.fragmentEnd})`),!0;const o="audio"===i?.175:0;return!(Math.abs(a.start-n)<pf+o||Math.abs(a.end-n)<pf+o||(this.log(`"${t.identifier}" resumption ${n} not aligned with ${i} fragment bounds (${a.start}-${a.end} sn: ${a.sn} cc: ${a.cc})`),0))})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let n=0,i=!1,r=!1;for(let s=0;s<t.assetList.length;s++){const a=t.assetList[s],o=e+n;a.startOffset=n,a.timelineStart=o,i||(i=null===a.duration),r||(r=!!a.error),n+=a.error?0:a.duration||0}t.duration=i&&!r?Math.max(n,t.duration):n}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function Df(t){return`[${t.event?'"'+t.event.identifier+'"':"primary"}: ${t.start.toFixed(2)}-${t.end.toFixed(2)}]`}class wf{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const n=t.assetListUrl;let i;try{i=_f(n,this.hls.sessionId,t.baseUrl)}catch(e){const i=this.assignAssetListError(t,ua.ASSET_LIST_LOAD_ERROR,e,n);return void this.hls.trigger(ca.ERROR,i)}e&&"data:"!==i.protocol&&i.searchParams.set("_HLS_start_offset",""+e);const r=this.hls.config,s=new(0,r.loader)(r),a={responseType:"json",url:i.href},o=r.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,n,i,r)=>{const s=e.data,a=null==s?void 0:s.ASSETS;if(!Array.isArray(a)){const e=this.assignAssetListError(t,ua.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),i.url,n,r);return void this.hls.trigger(ca.ERROR,e)}t.assetListResponse=s,this.hls.trigger(ca.ASSET_LIST_LOADED,{event:t,assetListResponse:s,networkDetails:r})},onError:(e,n,i,r)=>{const s=this.assignAssetListError(t,ua.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${e.code} ${e.text} (${n.url})`),n.url,r,i);this.hls.trigger(ca.ERROR,s)},onTimeout:(e,n,i)=>{const r=this.assignAssetListError(t,ua.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${n.url})`),n.url,e,i);this.hls.trigger(ca.ERROR,r)}};return s.load(a,l,u),this.hls.trigger(ca.ASSET_LIST_LOADING,{event:t}),s}assignAssetListError(t,e,n,i,r,s){return t.error=n,{type:la.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:i,error:n,networkDetails:s,stats:r}}}function Lf(t){var e;null==t||null==(e=t.play())||e.catch(()=>{})}function kf(t,e){return`[${t}] Advancing timeline position to ${e}`}class Af{constructor(t){this.buffered=void 0;const e=(e,n,i)=>{if((n>>>=0)>i-1)throw new DOMException(`Failed to execute '${e}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return t[n][e]};this.buffered={get length(){return t.length},end:n=>e("end",n,t.length),start:n=>e("start",n,t.length)}}}const xf={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Cf=t=>String.fromCharCode(xf[t]||t),If=15,Pf=100,Rf={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Of={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Mf={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ff={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Nf=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Bf{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const n="function"==typeof e?e():e;Ca.log(`${this.time} [${t}] ${n}`)}}}const Uf=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].toString(16));return e};class $f{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let n=0;n<e.length;n++){const i=e[n];t.hasOwnProperty(i)&&(this[i]=t[i])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class zf{constructor(){this.uchar=" ",this.penState=new $f}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Gf{constructor(t){this.chars=[],this.pos=0,this.currPenState=new $f,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Pf;t++)this.chars.push(new zf);this.logger=t}equals(t){for(let e=0;e<Pf;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<Pf;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Pf;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Pf&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Pf)}moveCursor(t){const e=this.pos+t;if(t>1)for(let t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=Cf(t);this.pos>=Pf?this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))}clearFromPos(t){let e;for(e=t;e<Pf;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let n=0;n<Pf;n++){const i=this.chars[n].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class jf{constructor(t){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<If;e++)this.rows.push(new Gf(t));this.logger=t}reset(){for(let t=0;t<If;t++)this.rows[t].clear();this.currRow=14}equals(t){let e=!0;for(let n=0;n<If;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e}copy(t){for(let e=0;e<If;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<If;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+el(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let t=0;t<If;t++)this.rows[t].clear();const t=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const i=n.rows[t].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let i=0;i<this.nrRollUpRows;i++)this.rows[e-this.nrRollUpRows+i+1].copy(n.rows[t+i])}}this.currRow=e;const n=this.rows[this.currRow];if(null!==t.indent){const e=t.indent,i=Math.max(e-1,0);n.setCursor(t.indent),t.color=n.chars[i].penState.foreground}const i={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+el(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let n="",i=-1;for(let n=0;n<If;n++){const r=this.rows[n].getTextString();r&&(i=n+1,t?e.push("Row "+i+": '"+r+"'"):e.push(r.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n}getTextAndFormat(){return this.rows}}class Hf{constructor(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new jf(n),this.nonDisplayedMemory=new jf(n),this.lastOutputScreen=new jf(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{const n=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[n]}this.logger.log(2,"MIDROW: "+el(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class Vf{constructor(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const i=this.logger=new Bf;this.channels=[null,new Hf(t,e,i),new Hf(t+1,n,i)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let t=0;t<e.length;t+=2){const n=127&e[t],i=127&e[t+1];let r=!1,s=null;if(0===n&&0===i)continue;this.logger.log(3,()=>"["+Uf([e[t],e[t+1]])+"] -> ("+Uf([n,i])+")");const a=this.cmdHistory;if(n>=16&&n<=31){if(Wf(n,i,a)){Kf(null,null,a),this.logger.log(3,()=>"Repeated command ("+Uf([n,i])+") is dropped");continue}Kf(n,i,this.cmdHistory),r=this.parseCmd(n,i),r||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i))}else Kf(null,null,a);if(!r&&(s=this.parseChars(n,i),s)){const t=this.currentChannel;t&&t>0?this.channels[t].insertChars(s):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+Uf([n,i])+" orig: "+Uf([e[t],e[t+1]]))}}parseCmd(t,e){if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;const n=20===t||21===t||23===t?1:2,i=this.channels[n];return 20===t||21===t||28===t||29===t?32===e?i.ccRCL():33===e?i.ccBS():34===e?i.ccAOF():35===e?i.ccAON():36===e?i.ccDER():37===e?i.ccRU(2):38===e?i.ccRU(3):39===e?i.ccRU(4):40===e?i.ccFON():41===e?i.ccRDC():42===e?i.ccTR():43===e?i.ccRTD():44===e?i.ccEDM():45===e?i.ccCR():46===e?i.ccENM():47===e&&i.ccEOC():i.ccTO(e-32),this.currentChannel=n,!0}parseMidrow(t,e){let n=0;if((17===t||25===t)&&e>=32&&e<=47){if(n=17===t?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return!!i&&(i.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+Uf([t,e])+")"),!0)}return!1}parsePAC(t,e){let n;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;const i=t<=23?1:2;n=e>=64&&e<=95?1===i?Rf[t]:Mf[t]:1===i?Of[t]:Ff[t];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(n,e)),this.currentChannel=i,!0)}interpretPAC(t,e){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,i.underline=!(1&~n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i}parseChars(t,e){let n,i=null,r=null;if(t>=25?(n=2,r=t-8):(n=1,r=t),r>=17&&r<=19){let t;t=17===r?e+80:18===r?e+112:e+144,this.logger.log(2,()=>"Special char '"+Cf(t)+"' in channel "+n),i=[t]}else t>=32&&t<=127&&(i=0===e?[t]:[t,e]);return i&&this.logger.log(3,()=>"Char codes =  "+Uf(i).join(",")),i}parseBackgroundAttributes(t,e){if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;let n;const i={};16===t||24===t?(n=Math.floor((e-32)/2),i.background=Nf[n],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0));const r=t<=23?1:2;return this.channels[r].setBkgData(i),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Kf(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const n=this.channels[e];n&&n.cueSplitAtTime(t)}}}function Kf(t,e,n){n.a=t,n.b=e}function Wf(t,e,n){return n.a===t&&n.b===e}var Yf=function(){if(null!=hu&&hu.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function n(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;const n=e.toLowerCase();return!!~t.indexOf(n)&&n}function i(t){return n(e,t)}function r(t,...e){let n=1;for(;n<arguments.length;n++){const e=arguments[n];for(const n in e)t[n]=e[n]}return t}function s(e,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let u="",c=!1,h=e,d=s,f=a,p=null,m="",g=!0,v="auto",y="start",_=50,b="middle",E=50,T="middle";Object.defineProperty(o,"id",r({},l,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return c},set:function(t){c=!!t}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return m},set:function(e){const i=function(e){return n(t,e)}(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");m=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return g},set:function(t){g=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return v},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return y},set:function(t){const e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return _},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return b},set:function(t){const e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return T},set:function(t){const e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");T=e,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class Zf{decode(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function qf(t){function e(t,e,n,i){return 3600*(0|t)+60*(0|e)+(0|n)+parseFloat(i||0)}const n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}class Xf{constructor(){this.values=Object.create(null)}set(t,e){this.get(t)||""===e||(this.values[t]=e)}get(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,n){for(let i=0;i<n.length;++i)if(e===n[i]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1}}function Qf(t,e,n,i){const r=i?t.split(i):[t];for(const t in r){if("string"!=typeof r[t])continue;const i=r[t].split(n);2===i.length&&e(i[0],i[1])}}const Jf=new Yf(0,0,""),tp="middle"===Jf.align?"middle":"center";function ep(t,e,n){const i=t;function r(){const e=qf(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}if(s(),e.startTime=r(),s(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.slice(3),s(),e.endTime=r(),s(),function(t,e){const i=new Xf;Qf(t,function(t,e){let r;switch(t){case"region":for(let r=n.length-1;r>=0;r--)if(n[r].id===e){i.set(t,n[r].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":r=e.split(","),i.integer(t,r[0]),i.percent(t,r[0])&&i.set("snapToLines",!1),i.alt(t,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",tp,"end"]);break;case"position":r=e.split(","),i.percent(t,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",tp,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",tp,"end","left","right"])}},/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===Jf.line&&(r=-1),e.line=r,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",tp);let s=i.get("position","auto");"auto"===s&&50===Jf.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function np(t){return t.replace(/<br(?: \/)?>/gi,"\n")}class ip{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Zf,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;function n(){let t=e.buffer,n=0;for(t=np(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;const i=t.slice(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.slice(n),i}function i(t){Qf(t,function(t,e){},/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{let t="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;t=n();const i=t.match(/^()?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let r=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:t=n(),e.state){case"HEADER":/:/.test(t)?i(t):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new Yf(0,0,""),e.state="CUE",-1===t.indexOf("--\x3e")){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{ep(t,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==t.indexOf("--\x3e");if(!t||n&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=t}continue;case"BADCUE":t||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const rp=/\r\n|\n\r|\n|\r/g,sp=function(t,e,n=0){return t.slice(n,n+e.length)===e};function ap(t,e,n){return ff(t.toString())+ff(e.toString())+ff(n)}const op="stpp.ttml.im1t",lp=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,up=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,cp={left:"start",center:"center",right:"end",start:"start",end:"end"};function hp(t,e,n,i){const r=lo(new Uint8Array(t),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const s=r.map(t=>Ra(t)),a=function(t,e,n=1,i=!1){return xh(t,e,1/n,i)}(e.baseTime,1,e.timescale);try{s.forEach(t=>n(function(t,e){const n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},r=Object.keys(i).reduce((t,e)=>(t[e]=n.getAttribute(`ttp:${e}`)||i[e],t),{}),s="preserve"!==n.getAttribute("xml:space"),a=fp(dp(n,"styling","style")),o=fp(dp(n,"layout","region")),l=dp(n,"body","[begin]");return[].map.call(l,t=>{const n=pp(t,s);if(!n||!t.hasAttribute("begin"))return null;const i=vp(t.getAttribute("begin"),r),l=vp(t.getAttribute("dur"),r);let u=vp(t.getAttribute("end"),r);if(null===i)throw gp(t);if(null===u){if(null===l)throw gp(t);u=i+l}const c=new Yf(i-e,u-e,n);c.id=ap(c.startTime,c.endTime,c.text);const h=function(t,e,n){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return s&&n.hasOwnProperty(s)&&(r=n[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((n,s)=>{const a=mp(e,i,s)||mp(t,i,s)||mp(r,i,s);return a&&(n[s]=a),n},{})}(o[t.getAttribute("region")],a[t.getAttribute("style")],a),{textAlign:d}=h;if(d){const t=cp[d];t&&(c.lineAlign=t),c.align=d}return Ea(c,h),c}).filter(t=>null!==t)}(t,a)))}catch(t){i(t)}}function dp(t,e,n){const i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function fp(t){return t.reduce((t,e)=>{const n=e.getAttribute("xml:id");return n&&(t[n]=e),t},{})}function pp(t,e){return[].slice.call(t.childNodes).reduce((t,n,i)=>{var r;return"br"===n.nodeName&&i?t+"\n":null!=(r=n.childNodes)&&r.length?pp(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function mp(t,e,n){return t&&t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function gp(t){return new Error(`Could not parse ttml timestamp ${t}`)}function vp(t,e){if(!t)return null;let n=qf(t);return null===n&&(lp.test(t)?n=function(t,e){const n=lp.exec(t),i=(0|n[4])+(0|n[5])/e.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+i/e.frameRate}(t,e):up.test(t)&&(n=function(t,e){const n=up.exec(t),i=Number(n[1]);switch(n[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}(t,e))),n}class yp{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function _p(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function bp(t,e){return!!t&&t.kind===_p(e)&&Jh(e,t)}function Ep(t,e,n,i){return Math.min(e,i)-Math.max(t,n)}const Tp=/\s/,Sp={newCue(t,e,n,i){const r=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let d=0;d<i.rows.length;d++)if(s=i.rows[d],o=!0,l=0,u="",!s.isEmpty()){var h;for(let t=0;t<s.chars.length;t++)Tp.test(s.chars[t].uchar)&&o?l++:(u+=s.chars[t].uchar,o=!1);s.cueStartTime=e,e===n&&(n+=1e-4),l>=16?l--:l++;const i=np(u.trim()),f=ap(e,n,i);null!=t&&null!=(h=t.cues)&&h.getCueById(f)||(a=new c(e,n,i),a.id=f,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return t&&r.length&&(r.sort((t,e)=>"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line),r.forEach(e=>uf(t,e))),r}},Dp=/(\d+)-(\d+)\/(\d+)/;class wp{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Lp,this.controller=new self.AbortController,this.stats=new Va}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function(t,e){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ea({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}(t,this.controller.signal),s="arraybuffer"===t.responseType,a=s?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,r),self.clearTimeout(this.requestTimeout),e.timeout=o&&sa(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,t,this.response))},e.timeout),(Vh(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(n=>{var r;this.response=this.loader=n;const a=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,t,this.response))},l-(a-i.loading.start)),!n.ok){const{status:t,statusText:e}=n;throw new kp(e||"fetch, bad network response",t,n)}i.loading.first=a,i.total=function(t){const e=t.get("Content-Range");if(e){const t=function(t){const e=Dp.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(sa(t))return t}const n=t.get("Content-Length");if(n)return parseInt(n)}(n.headers)||i.total;const o=null==(r=this.callbacks)?void 0:r.onProgress;return o&&sa(e.highWaterMark)?this.loadProgressively(n,i,t,e.highWaterMark,o):s?n.arrayBuffer():"json"===t.responseType?n.json():n.text()}).then(n=>{var r,s;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=n[a];l&&(i.loaded=i.total=l);const u={url:o.url,data:n,code:o.status},c=null==(r=this.callbacks)?void 0:r.onProgress;c&&!sa(e.highWaterMark)&&c(i,t,n,o),null==(s=this.callbacks)||s.onSuccess(u,i,t,o)}).catch(e=>{var n;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=e&&e.code||0,s=e?e.message:null;null==(n=this.callbacks)||n.onError({code:r,text:s},t,e?e.details:null,i)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,n,i=0,r){const s=new Tc,a=t.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return s.dataLength&&r(e,n,s.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const l=a.value,u=l.length;return e.loaded+=u,u<i||s.dataLength?(s.push(l),s.dataLength>=i&&r(e,n,s.flush().buffer,t)):r(e,n,l.buffer,t),o()}).catch(()=>Promise.reject());return o()}}function Lp(t,e){return new self.Request(t.url,e)}class kp extends Error{constructor(t,e,n){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=n}}const Ap=/^age:\s*[\d.]+\s*$/im;class xp{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Va,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return r(n,e.url)}).catch(t=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",e.url,!0),r(n,e.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,e,t)}).catch(t=>{var r;null==(r=this.callbacks)||r.onError({code:n.status,text:t.message},e,n,i)}):this.openAndSendXhr(n,e,t)}openAndSendXhr(t,e,n){t.readyState||t.open("GET",e.url,!0);const i=e.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:s}=n.loadPolicy;if(i)for(const e in i)t.setRequestHeader(e,i[e]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),n.timeout=r&&sa(r)?r:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:n}=this;if(!t||!e)return;const i=e.readyState,r=this.config;if(!n.aborted&&i>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const i=e.status,l="text"===e.responseType?e.responseText:null;if(i>=200&&i<300){const r=null!=l?l:e.response;if(null!=r){var s,a;n.loading.end=Math.max(self.performance.now(),n.loading.first);const o="arraybuffer"===e.responseType?r.byteLength:r.length;n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first);const l=null==(s=this.callbacks)?void 0:s.onProgress;l&&l(n,t,r,e);const u={url:e.responseURL,data:r,code:i};return void(null==(a=this.callbacks)||a.onSuccess(u,n,t,e))}}const u=r.loadPolicy.errorRetry;var o;El(u,n.retry,!1,{url:t.url,data:void 0,code:i})?this.retry(u):(Ca.error(`${i} while loading ${t.url}`),null==(o=this.callbacks)||o.onError({code:i,text:e.statusText},t,e,n))}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry;if(El(t,this.stats.retry,!0))this.retry(t);else{var e;Ca.warn(`timeout while loading ${null==(e=this.context)?void 0:e.url}`);const t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:n}=this;this.retryDelay=_l(t,n.retry),n.retry++,Ca.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==e?void 0:e.url}, retrying ${n.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&Ap.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const Cp=Sa(Sa({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:xp,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends Da{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var e;const{fragCurrent:n,partCurrent:i,hls:r}=this,{autoLevelEnabled:s,media:a}=r;if(!n||!a)return;const o=performance.now(),l=i?i.stats:n.stats,u=i?i.duration:n.duration,c=o-l.loading.start,h=r.minAutoLevel,d=n.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||d<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s)return;const p=f>-1&&f!==d,m=!!t||p;if(!m&&(a.paused||!a.playbackRate||!a.readyState))return;const g=r.mainForwardBufferInfo;if(!m&&null===g)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(a.playbackRate);if(c<=Math.max(v,u/(2*y)*1e3))return;const _=g?g.len/y:0,b=l.loading.first?l.loading.first-l.loading.start:-1,E=l.loaded&&b>-1,T=this.getBwEstimate(),S=r.levels,D=S[d],w=Math.max(l.loaded,Math.round(u*(n.bitrate||D.averageBitrate)/8));let L=E?c-b:c;L<1&&E&&(L=Math.min(c,8*l.loaded/T));const k=E?1e3*l.loaded/L:0,A=v/1e3,x=k?(w-l.loaded)/k:8*w/T+A;if(x<=_)return;const C=k?8*k:T,I=!0===(null==(e=(null==t?void 0:t.details)||this.hls.latestLevelDetails)?void 0:e.live),P=this.hls.config.abrBandWidthUpFactor;let R,O=Number.POSITIVE_INFINITY;for(R=d-1;R>h;R--){const t=S[R].maxBitrate,e=!S[R].details||I;if(O=this.getTimeToLoadFrag(A,C,u*t,e),O<Math.min(_,u+A))break}if(O>=x)return;if(O>10*u)return;E?this.bwEstimator.sample(c-Math.min(v,b),l.loaded):this.bwEstimator.sampleTTFB(c);const M=S[R].maxBitrate;this.getBwEstimate()*P>M&&this.resetEstimator(M);const F=this.findBestLevel(M,h,R,0,_,1,1);F>-1&&(R=F),this.warn(`Fragment ${n.sn}${i?" part "+i.index:""} of level ${d} is loading too slowly;\n      Fragment duration: ${n.duration.toFixed(3)}\n      Time to underbuffer: ${_.toFixed(3)} s\n      Estimated load time for current fragment: ${x.toFixed(3)} s\n      Estimated load time for down switch fragment: ${O.toFixed(3)} s\n      TTFB estimate: ${0|b} ms\n      Current BW estimate: ${sa(T)?0|T:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${R} @ ${0|M} bps`),r.nextLoadLevel=r.nextAutoLevel=R,this.clearTimer();const N=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===R&&R>0){const t=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${R>0?"and switching down":""}\n      Fragment duration: ${n.duration.toFixed(3)} s\n      Time to underbuffer: ${t.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,R>h){let e=this.findBestLevel(this.hls.levels[h].bitrate,h,R,0,t,1,1);-1===e&&(e=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=e,this.resetEstimator(this.hls.levels[e].bitrate)}}};p||x>2*O?N():this.timer=self.setInterval(N,1e3*O),r.trigger(ca.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:i,stats:l})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new _a(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.FRAG_LOADING,this.onFragLoading,this),t.on(ca.FRAG_LOADED,this.onFragLoaded,this),t.on(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ca.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.FRAG_LOADING,this.onFragLoading,this),t.off(ca.FRAG_LOADED,this.onFragLoaded,this),t.off(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ca.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(ca.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const n=e.frag;var i;this.ignoreFragment(n)||(n.bitrateTest||(this.fragCurrent=n,this.partCurrent=null!=(i=e.part)?i:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case ua.BUFFER_ADD_CODEC_ERROR:case ua.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ua.FRAG_LOAD_TIMEOUT:{const t=e.frag,{fragCurrent:n,partCurrent:i}=this;if(t&&n&&t.sn===n.sn&&t.level===n.level){const e=performance.now(),n=i?i.stats:t.stats,r=e-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&s>-1){const t=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(t,s),n.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}getTimeToLoadFrag(t,e,n,i){return t+n/e+(i?t+this.lastLevelLoadSec:0)}onLevelLoaded(t,e){const n=this.hls.config,{loading:i}=e.stats,r=i.end-i.first;sa(r)&&(this.lastLevelLoadSec=r/1e3),e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:n}){const i=n?n.stats:e.stats;if(e.type===ma&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const t=n?n.duration:e.duration,r=this.hls.levels[e.level],s=(r.loaded?r.loaded.bytes:0)+i.loaded,a=(r.loaded?r.loaded.duration:0)+t;r.loaded={bytes:s,duration:a},r.realBitrate=Math.round(8*s/a)}if(e.bitrateTest){const t={stats:i,frag:e,part:n,id:e.type};this.onFragBuffered(ca.FRAG_BUFFERED,t),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:n,part:i}=e,r=null!=i&&i.stats.loaded?i.stats:n.stats;if(r.aborted)return;if(this.ignoreFragment(n))return;const s=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,r.loaded),r.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==ma||"initSegment"===t.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(n,e,t,0,i,1,1);if(r>-1)return r;const s=this.hls.firstLevel,a=Math.min(Math.max(s,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===t||e&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;const i=e&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){const e=this.hls.levels;if(e.length>Math.max(t,i)&&e[t].loadError<=e[i].loadError)return t}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:s}=n,a=e?e.duration:t?t.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor;if(l){const t=this.findBestLevel(o,s,i,l,0,u,c);if(t>=0)return this.rebufferNotice=-1,t}let h=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const t=this.bitrateTestDelay;t&&(h=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-t,this.info(`bitrate test took ${Math.round(1e3*t)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=c=1)}const d=this.findBestLevel(o,s,i,l,h,u,c);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`)),d>-1)return d;const f=n.levels[s],p=n.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?s:n.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const n=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,i=t.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,n,i,r,s,a){var o;const l=i+r,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:d}=this,{levels:f,allAudioTracks:p,loadLevel:m,config:g}=this.hls;if(1===f.length)return 0;const v=f[c],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),_=-1===m||-1===u;let b,E="SDR",T=(null==v?void 0:v.frameRate)||0;const{audioPreference:S,videoPreference:D}=g,w=this.audioTracksByGroup||(this.audioTracksByGroup=il(p));let L=-1;if(_){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function(t,e,n,i){return t.slice(n,i+1).reduce((t,n,i)=>{if(!n.codecSet)return t;const r=n.audioGroups;let s=t[n.codecSet];s||(t[n.codecSet]=s={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:i,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),s.minBitrate=Math.min(s.minBitrate,n.bitrate);const a=Math.min(n.height,n.width);return s.minHeight=Math.min(s.minHeight,a),s.minFramerate=Math.min(s.minFramerate,n.frameRate),s.minIndex=Math.min(s.minIndex,i),s.maxScore=Math.max(s.maxScore,n.score),s.fragmentError+=n.fragmentError,s.videoRanges[n.videoRange]=(s.videoRanges[n.videoRange]||0)+1,r&&r.forEach(t=>{if(!t)return;const n=e.groups[t];n&&(s.hasDefaultAudio=s.hasDefaultAudio||e.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(n.channels).forEach(t=>{s.channels[t]=(s.channels[t]||0)+n.channels[t]}))}),t},{})}(f,w,e,n)),r=function(t,e,n,i,r){const s=Object.keys(t),a=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=null==r?void 0:r.videoCodec,u=a&&2===parseInt(a);let c=!1,h=!1,d=1/0,f=1/0,p=1/0,m=1/0,g=0,v=[];const{preferHDR:y,allowedVideoRanges:_}=function(t,e){let n=!1,i=[];if(t&&(n="SDR"!==t,i=[t]),e){i=e.allowedVideoRanges||qo.slice(0);const t="SDR"!==i.join("")&&!e.videoCodec;n=void 0!==e.preferHDR?e.preferHDR:t&&function(){if("function"==typeof matchMedia){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return!0===t.matches}return!1}(),n||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}(e,r);for(let e=s.length;e--;){const n=t[s[e]];c||(c=n.channels[2]>0),d=Math.min(d,n.minHeight),f=Math.min(f,n.minFramerate),p=Math.min(p,n.minBitrate),_.filter(t=>n.videoRanges[t]>0).length>0&&(h=!0)}d=sa(d)?d:0,f=sa(f)?f:0;const b=Math.max(1080,d),E=Math.max(30,f);p=sa(p)?p:n,n=Math.max(p,n),h||(e=void 0);const T=s.length>1;return{codecSet:s.reduce((e,i)=>{const r=t[i];if(i===e)return e;if(v=h?_.filter(t=>r.videoRanges[t]>0):[],T){if(r.minBitrate>n)return nl(i,`min bitrate of ${r.minBitrate} > current estimate of ${n}`),e;if(!r.hasDefaultAudio)return nl(i,"no renditions with default or auto-select sound found"),e;if(o&&i.indexOf(o.substring(0,4))%5!=0)return nl(i,`audio codec preference "${o}" not found`),e;if(a&&!u){if(!r.channels[a])return nl(i,`no renditions with ${a} channel sound found (channels options: ${Object.keys(r.channels)})`),e}else if((!o||u)&&c&&0===r.channels[2])return nl(i,"no renditions with stereo sound found"),e;if(r.minHeight>b)return nl(i,`min resolution of ${r.minHeight} > maximum of ${b}`),e;if(r.minFramerate>E)return nl(i,`min framerate of ${r.minFramerate} > maximum of ${E}`),e;if(!v.some(t=>r.videoRanges[t]>0))return nl(i,`no variants with VIDEO-RANGE of ${el(v)} found`),e;if(l&&i.indexOf(l.substring(0,4))%5!=0)return nl(i,`video codec preference "${l}" not found`),e;if(r.maxScore<g)return nl(i,`max score of ${r.maxScore} < selected max of ${g}`),e}return e&&(Ro(i)>=Ro(e)||r.fragmentError>t[e].fragmentError)?e:(m=r.minIndex,g=r.maxScore,i)},void 0),videoRanges:v,preferHDR:y,minFramerate:f,minBitrate:p,minIndex:m}}(i,E,t,S,D),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:u,preferHDR:c}=r;L=u,b=s,E=c?a[a.length-1]:a[0],T=o,t=Math.max(t,l),this.log(`picked start tier ${el(r)}`)}else b=null==v?void 0:v.codecSet,E=null==v?void 0:v.videoRange;const k=d?d.duration:h?h.duration:0,A=this.bwEstimator.getEstimateTTFB()/1e3,x=[];for(let o=n;o>=e;o--){var C;const e=f[o],h=o>c;if(!e)continue;if(g.useMediaCapabilities&&!e.supportedResult&&!e.supportedPromise){const n=navigator.mediaCapabilities;"function"==typeof(null==n?void 0:n.decodingInfo)&&Vo(e,w,E,T,t,S)?(e.supportedPromise=Ko(e,w,n,this.supportedCache),e.supportedPromise.then(t=>{if(!this.hls)return;e.supportedResult=t;const n=this.hls.levels,i=n.indexOf(e);t.error?this.warn(`MediaCapabilities decodingInfo error: "${t.error}" for level ${i} ${el(t)}`):t.supported?t.decodingInfoResults.some(t=>!1===t.smooth||!1===t.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${i} not smooth or powerEfficient: ${el(t)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${i} ${el(t)}`),i>-1&&n.length>1&&(this.log(`Removing unsupported level ${i}`),this.hls.removeLevel(i),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(t=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${t}`)})):e.supportedResult=jo}if((b&&e.codecSet!==b||E&&e.videoRange!==E||h&&T>e.frameRate||!h&&T>0&&T<e.frameRate||null!=(C=e.supportedResult)&&null!=(C=C.decodingInfoResults)&&C.some(t=>!1===t.smooth))&&(!_||o!==L)){x.push(o);continue}const p=e.details,v=(d?null==p?void 0:p.partTarget:null==p?void 0:p.averagetargetduration)||k;let D;D=h?a*t:s*t;const I=k&&i>=2*k&&0===r?e.averageBitrate:e.maxBitrate,P=this.getTimeToLoadFrag(A,D,I*v,void 0===p);if(D>=I&&(o===u||0===e.loadError&&0===e.fragmentError)&&(P<=A||!sa(P)||y&&!this.bitrateTestDelay||P<l)){const t=this.forcedAutoLevel;return o===m||-1!==t&&t===m||(x.length&&this.trace(`Skipped level(s) ${x.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${f[x[0]].codecs}" ${f[x[0]].videoRange}; not compatible with "${b}" ${E}`),this.info(`switch candidate:${c}->${o} adjustedbw(${Math.round(D)})-bitrate=${Math.round(D-I)} ttfb:${A.toFixed(1)} avgDuration:${v.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${_} codecSet:${e.codecSet} videoRange:${e.videoRange} hls.loadLevel:${m}`)),_&&(this.firstSelection=o),o}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:n}=this.hls;return Math.min(Math.max(t,n),e)}},bufferController:class extends Da{constructor(t,e){var n;super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=t=>{var e;this.hls&&"open"===(null==(e=this.mediaSource)?void 0:e.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=t=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=t=>{const{media:e,mediaSource:n}=this;t&&this.log("Media source opened"),e&&n&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(ca.MEDIA_ATTACHED,{media:e,mediaSource:n}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:t,_objectUrl:e}=this;t!==e&&this.error(`Media element src was set while attaching MediaSource (${e} > ${t})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=(n=Ia(t.config.preferManagedMediaSource),"undefined"!=typeof self&&n===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.BUFFER_RESET,this.onBufferReset,this),t.on(ca.BUFFER_APPENDING,this.onBufferAppending,this),t.on(ca.BUFFER_CODECS,this.onBufferCodecs,this),t.on(ca.BUFFER_EOS,this.onBufferEos,this),t.on(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ca.FRAG_PARSED,this.onFragParsed,this),t.on(ca.FRAG_CHANGED,this.onFragChanged,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.BUFFER_RESET,this.onBufferReset,this),t.off(ca.BUFFER_APPENDING,this.onBufferAppending,this),t.off(ca.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ca.BUFFER_EOS,this.onBufferEos,this),t.off(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ca.FRAG_PARSED,this.onFragParsed,this),t.off(ca.FRAG_CHANGED,this.onFragChanged,this),t.off(ca.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const n={};if(this.operationQueue){const t=this.isUpdating();t||this.operationQueue.removeBlockers();const e=this.isQueued();(t||e)&&this.warn(`Transfering MediaSource with${e?" operations in queue":""}${t?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===e?Ea(n,i.tracks):this.sourceBuffers.forEach(t=>{const[e]=t;e&&(n[e]=Ea({},this.tracks[e]),this.removeBuffer(e)),t[0]=t[1]=null}),{media:t,mediaSource:e,tracks:n}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var n;let i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),null!=(n=this.transferData)&&n.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(t,e){const n=this.media=e.media;this.transferData=this.overrides=void 0;const i=Ia(this.appendSource);if(i){const t=!!e.mediaSource;(t||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const r=this.mediaSource=e.mediaSource||new i;if(this.assignMediaSource(r),t)this._objectUrl=n.src,this.attachTransferred();else{const t=this._objectUrl=self.URL.createObjectURL(r);if(this.appendSource)try{n.removeAttribute("src");const e=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||e&&r instanceof e,rd(n),function(t,e){const n=self.document.createElement("source");n.type="video/mp4",n.src=e,t.appendChild(n)}(n,t),n.load()}catch(e){n.src=t}else n.src=t}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,n;this.log(`${(null==(e=this.transferData)?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${null==(n=t.constructor)?void 0:n.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const n=this.tracks,i=e.tracks,r=i?Object.keys(i):null,s=r?r.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&s){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${el(n,(t,e)=>"initSegment"===t?void 0:e)};\ntransfer tracks: ${el(i,(t,e)=>"initSegment"===t?void 0:e)}}`),!Pa(i,n)){e.mediaSource=null,e.tracks=void 0;const r=t.currentTime,s=this.details,a=Math.max(r,(null==s?void 0:s.fragments[0].start)||0);return a-r>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${r} -> ${a}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(n)}") start time: ${a} currentTime: ${r}`),this.onMediaDetaching(ca.MEDIA_DETACHING,{}),this.onMediaAttaching(ca.MEDIA_ATTACHING,e),void(t.currentTime=a))}this.transferData=void 0,r.forEach(t=>{const e=t,n=i[e];if(n){const t=n.buffer;if(t){const i=this.fragmentTracker,r=n.id;if(i.hasFragments(r)||i.hasParts(r)){const n=Hl.getBuffered(t);i.detectEvictedFragments(e,n,r,null,!0)}const s=sd(e),a=[e,t];this.sourceBuffers[s]=a,t.updating&&this.operationQueue&&this.operationQueue.prependBlocker(e),this.trackSourceBuffer(e,n)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var t;const e=null==(t=this.mediaSource)?void 0:t.readyState;return"open"===e||"ended"===e}onMediaDetaching(t,e){const n=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:s}=this;if(r){if(this.log("media source "+(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(([t])=>{t&&this.removeBuffer(t)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const t="open"===r.readyState;try{const e=r.sourceBuffers;for(let n=e.length;n--;)t&&e[n].abort(),r.removeSourceBuffer(e[n]);t&&r.endOfStream()}catch(t){this.warn(`onMediaDetaching: ${t.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),n||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(i.removeAttribute("src"),this.appendSource&&rd(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(ca.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const n=null==(e=this.tracks[t])?void 0:e.buffer;if(this.removeBuffer(t),n)try{var i;null!=(i=this.mediaSource)&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(e){this.warn(`onBufferReset ${t}`,e)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[sd(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new td(this.tracks)}onBufferCodecs(t,e){var n;const i=this.tracks,r=Object.keys(e);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in e&&(i.audio||i.video)||i.audiovideo&&("audio"in e||"video"in e),a=!s&&this.sourceBufferCount&&this.media&&r.some(t=>!i[t]);s||a?this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`):(r.forEach(t=>{var n,r;const s=e[t],{id:a,codec:o,levelCodec:l,container:u,metadata:c,supplemental:h}=s;let d=i[t];const f=null==(n=this.transferData)||null==(n=n.tracks)?void 0:n[t],p=null!=f&&f.buffer?f:d,m=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),g=null==p?void 0:p.levelCodec;d||(d=i[t]={buffer:void 0,listeners:[],codec:o,supplemental:h,container:u,levelCodec:l,metadata:c,id:a});const v=No(m,g),y=null==v?void 0:v.replace(ed,"$1");let _=No(o,l);const b=null==(r=_)?void 0:r.replace(ed,"$1");_&&v&&y!==b&&("audio"===t.slice(0,5)&&(_=Fo(_,this.appendSource)),this.log(`switching codec ${m} to ${_}`),_!==(d.pendingCodec||d.codec)&&(d.pendingCodec=_),d.container=u,this.appendChangeType(t,u,_))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&"main"===(null==(n=e.audio)?void 0:n.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const n=this.tracks[e];return t[e]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},t},{})}appendChangeType(t,e,n){const i=`${e};codecs=${n}`,r={label:`change-type=${i}`,execute:()=>{const r=this.tracks[t];if(r){const s=r.buffer;null!=s&&s.changeType&&(this.log(`changing ${t} sourceBuffer type to ${i}`),s.changeType(i),r.codec=n,r.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn(`Failed to change ${t} SourceBuffer type`,e)}};this.append(r,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const n=t.start,i=n+.05*t.duration;if(!0===(null==(e=this.fragmentTracker.getAppendedFrag(n,ma))?void 0:e.gap))return;const r={label:"block-audio",execute:()=>{var t;const e=this.tracks.video;(this.lastVideoAppendEnd>i||null!=e&&e.buffer&&Hl.isBuffered(e.buffer,i)||!0===(null==(t=this.fragmentTracker.getAppendedFrag(i,ma))?void 0:t.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Error executing block-audio operation",t)}};this.blockedAudioAppend={op:r,frag:t},this.append(r,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:n}=this,{data:i,type:r,parent:s,frag:a,part:o,chunkMeta:l,offset:u}=e,c=l.buffering[r],{sn:h,cc:d}=a,f=self.performance.now();c.start=f;const p=a.stats.buffering,m=o?o.stats.buffering:null;0===p.start&&(p.start=f),m&&0===m.start&&(m.start=f);const g=n.audio;let v=!1;"audio"===r&&"audio/mpeg"===(null==g?void 0:g.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=n.video,_=null==y?void 0:y.buffer;if(_&&"initSegment"!==h){const t=o||a,e=this.blockedAudioAppend;if("audio"!==r||"main"===s||this.blockedAudioAppend||y.ending||y.ended){if("video"===r){const n=t.end;if(e){const t=e.frag.start;(n>t||n<this.lastVideoAppendEnd||Hl.isBuffered(_,t))&&this.unblockAudio()}this.lastVideoAppendEnd=n}}else{const e=t.start+.05*t.duration,n=_.buffered,i=this.currentOp("video");n.length||i?!i&&!Hl.isBuffered(_,e)&&this.lastVideoAppendEnd<e&&this.blockAudio(t):this.blockAudio(t)}}const b=(o||a).start,E={label:`append-${r}`,execute:()=>{var t;c.executeStart=self.performance.now();const e=null==(t=this.tracks[r])?void 0:t.buffer;e&&(v?this.updateTimestampOffset(e,b,.1,r,h,d):void 0!==u&&sa(u)&&this.updateTimestampOffset(e,u,1e-6,r,h,d)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const t=self.performance.now();c.executeEnd=c.end=t,0===p.first&&(p.first=t),m&&0===m.first&&(m.first=t);const e={};this.sourceBuffers.forEach(([t,n])=>{t&&(e[t]=Hl.getBuffered(n))}),this.appendErrors[r]=0,"audio"===r||"video"===r?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(ca.BUFFER_APPENDED,{type:r,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:e})},onError:t=>{var e;const n={type:la.MEDIA_ERROR,parent:a.type,details:ua.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:a,part:o,chunkMeta:l,error:t,err:t,fatal:!1},i=null==(e=this.media)?void 0:e.error;if(t.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==t.name||"quota"in t)n.details=ua.BUFFER_FULL_ERROR;else if(t.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!i)n.errorAction=Sl(!0);else if(t.name===nd&&0===this.sourceBufferCount)n.errorAction=Sl(!0);else{const t=++this.appendErrors[r];this.warn(`Failed ${t}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${i||"no media error"})`),(t>=this.hls.config.appendErrorMaxRetry||i)&&(n.fatal=!0)}this.hls.trigger(ca.ERROR,n)}};this.log(`queuing "${r}" append sn: ${h}${o?" p: "+o.index:""} of ${a.type===ma?"level":"track"} ${a.level} cc: ${d}`),this.append(E,r,this.isPending(this.tracks[r]))}getFlushOp(t,e,n){return this.log(`queuing "${t}" remove ${e}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(ca.BUFFER_FLUSHED,{type:t})},onError:i=>{this.warn(`Failed to remove ${e}-${n} from "${t}" SourceBuffer`,i)}}}onBufferFlushing(t,e){const{type:n,startOffset:i,endOffset:r}=e;n?this.append(this.getFlushOp(n,i,r),n):this.sourceBuffers.forEach(([t])=>{t&&this.append(this.getFlushOp(t,i,r),t)})}onFragParsed(t,e){const{frag:n,part:i}=e,r=[],s=i?i.elementaryStreams:n.elementaryStreams;s[Ya]?r.push("audiovideo"):(s[Ka]&&r.push("audio"),s[Wa]&&r.push("video")),0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(()=>{const t=self.performance.now();n.stats.buffering.end=t,i&&(i.stats.buffering.end=t);const e=i?i.stats:n.stats;this.hls.trigger(ca.FRAG_BUFFERED,{frag:n,part:i,stats:e,id:n.type})},r).catch(t=>{this.warn(`Fragment buffered callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(t,e){var n;this.sourceBuffers.forEach(([t])=>{if(t){const n=this.tracks[t];e.type&&e.type!==t||(n.ending=!0,n.ended||(n.ended=!0,this.log(`${t} buffer reached EOS`)))}});const i=!1!==(null==(n=this.overrides)?void 0:n.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{var e;return t&&!(null!=(e=this.tracks[t])&&e.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:t}=this;t&&"open"===t.readyState?(this.log("Calling mediaSource.endOfStream()"),t.endOfStream(),this.hls.trigger(ca.BUFFERED_TO_END,void 0)):t&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${t.readyState}`)})):(this.tracksEnded(),this.hls.trigger(ca.BUFFERED_TO_END,void 0)):"video"===e.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(null!==t){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===ua.BUFFER_APPEND_ERROR&&e.frag){var n;const t=null==(n=e.errorAction)?void 0:n.nextAutoLevel;sa(t)&&t!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:n}=this;if(!n||null===e)return;if(!this.sourceBufferCount)return;const i=t.config,r=n.currentTime,s=e.levelTargetDuration,a=e.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(sa(a)&&a>=0){const t=Math.max(a,s),e=Math.floor(r/s)*s-t;this.flushBackBuffer(r,s,e)}const o=i.frontBufferFlushThreshold;if(sa(o)&&o>0){const t=Math.max(i.maxBufferLength,o),e=Math.max(t,s),n=Math.floor(r/s)*s+e;this.flushFrontBuffer(r,s,n)}}flushBackBuffer(t,e,n){this.sourceBuffers.forEach(([t,e])=>{if(e){const r=Hl.getBuffered(e);if(r.length>0&&n>r.start(0)){var i;this.hls.trigger(ca.BACK_BUFFER_REACHED,{bufferEnd:n});const e=this.tracks[t];if(null!=(i=this.details)&&i.live)this.hls.trigger(ca.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(null!=e&&e.ended)return void this.log(`Cannot flush ${t} back buffer while SourceBuffer is in ended state`);this.hls.trigger(ca.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:t})}}})}flushFrontBuffer(t,e,n){this.sourceBuffers.forEach(([e,i])=>{if(i){const r=Hl.getBuffered(i),s=r.length;if(s<2)return;const a=r.start(s-1),o=r.end(s-1);if(n>a||t>=a&&t<=o)return;this.hls.trigger(ca.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:e})}})}getDurationAndRange(){var t;const{details:e,mediaSource:n}=this;if(!e||!this.media||"open"!==(null==n?void 0:n.readyState))return null;const i=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&n.setLiveSeekableRange){const t=Math.max(0,e.fragmentStart);return{duration:1/0,start:t,end:Math.max(t,i)}}return{duration:1/0}}const r=null==(t=this.overrides)?void 0:t.duration;if(r)return sa(r)?{duration:r}:null;const s=this.media.duration;return i>(sa(n.duration)?n.duration:0)&&i>s||!sa(s)?{duration:i}:null}updateMediaSource({duration:t,start:e,end:n}){const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==t&&(sa(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),i.duration=t),void 0!==e&&void 0!==n&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${e}-${n}.`),i.setLiveSeekableRange(e,n)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${el(n)}`),this.tracksReady){var i;const t=null==(i=this.transferData)?void 0:i.tracks;t&&Object.keys(t).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,n])=>{if(e){const i=this.tracks[e];t[e]={buffer:n,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(ca.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in t){const s=r,a=t[s];if(this.isPending(a)){const t=this.getTrackCodec(a,s),r=`${a.container};codecs=${t}`;a.codec=t,this.log(`creating sourceBuffer(${r})${this.currentOp(s)?" Queued":""} ${el(a)}`);try{const t=n.addSourceBuffer(r),i=sd(s),o=[s,t];e[i]=o,a.buffer=t}catch(t){var i;return this.error(`error while trying to add sourceBuffer: ${t.message}`),this.shiftAndExecuteNext(s),null==(i=this.operationQueue)||i.removeBlockers(),delete this.tracks[s],void this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,sourceBufferName:s,mimeType:r,parent:a.id})}this.trackSourceBuffer(s,a)}}this.bufferCreated()}getTrackCodec(t,e){const n=t.supplemental;let i=t.codec;n&&("video"===e||"audiovideo"===e)&&xo(n,"video")&&(i=function(t,e){const n=[];if(t){const e=t.split(",");for(let t=0;t<e.length;t++)Ao(e[t],"video")||n.push(e[t])}return e&&n.push(e),n.join(",")}(i,n));const r=No(i,t.levelCodec);return r?"audio"===e.slice(0,5)?Fo(r,this.appendSource):r:""}trackSourceBuffer(t,e){const n=e.buffer;if(!n)return;const i=this.getTrackCodec(e,t);this.tracks[t]={buffer:n,codec:i,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(t,e)=>{const n=e.removedRanges;null!=n&&n.length&&this.hls.trigger(ca.BUFFER_FLUSHED,{type:t})})}get mediaSrc(){var t,e;const n=(null==(t=this.media)||null==(e=t.querySelector)?void 0:e.call(t,"source"))||this.media;return null==n?void 0:n.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if("closed"===(null==(e=this.mediaSource)?void 0:e.readyState))return void this.resetBuffer(t);const n=this.currentOp(t);n&&(n.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var n;const i=new Error(`${t} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${i}`,e),this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:i,fatal:!1});const r=this.currentOp(t);r&&r.onError(i)}updateTimestampOffset(t,e,n,i,r,s){const a=e-t.timestampOffset;Math.abs(a)>=n&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${e} (sn: ${r} cc: ${s})`),t.timestampOffset=e)}removeExecutor(t,e,n){const{media:i,mediaSource:r}=this,s=this.tracks[t],a=null==s?void 0:s.buffer;if(!i||!r||!a)return this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(t);const o=sa(i.duration)?i.duration:1/0,l=sa(r.duration)?r.duration:1/0,u=Math.max(0,e),c=Math.min(n,o,l);c>u&&(!s.ending||s.ended)?(s.ended=!1,this.log(`Removing [${u},${c}] from the ${t} SourceBuffer`),a.remove(u,c)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const n=this.tracks[e],i=null==n?void 0:n.buffer;if(!i)throw new id(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,i.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:n}=this,i=e.map(t=>this.appendBlocker(t));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(e=>{n===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(t=>{var e;const n=null==(e=this.tracks[t])?void 0:e.buffer;n&&!n.updating&&this.shiftAndExecuteNext(t)})}append(t,e,n){this.operationQueue&&this.operationQueue.append(t,e,n)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,n){const i=this.tracks[t];if(!i)return;const r=i.buffer;if(!r)return;const s=n.bind(this,t);i.listeners.push({event:e,listener:s}),r.addEventListener(e,s)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const n=e.buffer;n&&(e.listeners.forEach(t=>{n.removeEventListener(t.event,t.listener)}),e.listeners.length=0)}},capLevelController:ad,errorController:class extends Da{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(ca.ERROR,this.onError,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(ca.ERROR,this.onError,this),t.off(ca.ERROR,this.onErrorOut,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(null==t?void 0:t.type)===ma?t.level:this.getVariantIndex()}getVariantIndex(){var t;const e=this.hls,n=e.currentLevel;return null!=(t=e.loadLevelObj)&&t.details||-1===n?e.loadLevel:n}variantHasKey(t,e){if(t){var n;if(null!=(n=t.details)&&n.hasKey(e))return!0;const i=t.audioGroups;if(i)return this.hls.allAudioTracks.filter(t=>i.indexOf(t.groupId)>=0).some(t=>{var n;return null==(n=t.details)?void 0:n.hasKey(e)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(t,e){var n;if(e.fatal)return;const i=this.hls,r=e.context;switch(e.details){case ua.FRAG_LOAD_ERROR:case ua.FRAG_LOAD_TIMEOUT:case ua.KEY_LOAD_ERROR:case ua.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case ua.FRAG_PARSING_ERROR:if(null!=(n=e.frag)&&n.gap)return void(e.errorAction=Sl());case ua.FRAG_GAP:case ua.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=2);case ua.LEVEL_EMPTY_ERROR:case ua.LEVEL_PARSING_ERROR:{var s;const t=e.parent===ma?e.level:i.loadLevel;e.details===ua.LEVEL_EMPTY_ERROR&&null!=(s=e.context)&&null!=(s=s.levelDetails)&&s.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,t):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t))}return;case ua.LEVEL_LOAD_ERROR:case ua.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==r?void 0:r.level)&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.level)));case ua.AUDIO_TRACK_LOAD_ERROR:case ua.AUDIO_TRACK_LOAD_TIMEOUT:case ua.SUBTITLE_LOAD_ERROR:case ua.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const t=i.loadLevelObj;if(t&&(r.type===fa&&t.hasAudioGroup(r.groupId)||r.type===pa&&t.hasSubtitleGroup(r.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,i.loadLevel),e.errorAction.action=2,void(e.errorAction.flags=1)}return;case ua.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(e.errorAction={action:2,flags:2});case ua.KEY_SYSTEM_SESSION_UPDATE_FAILED:case ua.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case ua.KEY_SYSTEM_NO_SESSION:return void(e.errorAction={action:2,flags:4});case ua.BUFFER_ADD_CODEC_ERROR:case ua.REMUX_ALLOC_ERROR:case ua.BUFFER_APPEND_ERROR:var a;return void(e.errorAction||(e.errorAction=this.getLevelSwitchAction(e,null!=(a=e.level)?a:i.loadLevel)));case ua.INTERNAL_EXCEPTION:case ua.BUFFER_APPENDING_ERROR:case ua.BUFFER_FULL_ERROR:case ua.LEVEL_SWITCH_ERROR:case ua.BUFFER_STALLED_ERROR:case ua.BUFFER_SEEK_OVER_HOLE:case ua.BUFFER_NUDGE_ON_STALL:return void(e.errorAction=Sl())}e.type===la.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=Sl())}getPlaylistRetryOrSwitchAction(t,e){const n=yl(this.hls.config.playlistLoadPolicy,t),i=this.playlistError++;if(El(n,i,ml(t),t.response))return{action:5,flags:0,retryConfig:n,retryCount:i};const r=this.getLevelSwitchAction(t,e);return n&&(r.retryConfig=n,r.retryCount=i),r}getFragRetryOrSwitchAction(t){const e=this.hls,n=this.getVariantLevelIndex(t.frag),i=e.levels[n],{fragLoadPolicy:r,keyLoadPolicy:s}=e.config,a=yl(gl(t)?s:r,t),o=e.levels.reduce((t,e)=>t+e.fragmentError,0);if(i&&(t.details!==ua.FRAG_GAP&&i.fragmentError++,!vl(t))&&El(a,o,ml(t),t.response))return{action:5,flags:0,retryConfig:a,retryCount:o};const l=this.getLevelSwitchAction(t,n);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(t,e){const n=this.hls;null==e&&(e=n.loadLevel);const i=this.hls.levels[e];if(i){var r,s;const e=t.details;i.loadError++,e===ua.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:h,maxAutoLevel:d}=n;n.autoLevelEnabled||n.config.preserveManualLevelOnError||(n.loadLevel=-1);const f=null==(r=t.frag)?void 0:r.type,p=(f===ga&&e===ua.FRAG_PARSING_ERROR||"audio"===t.sourceBufferName&&(e===ua.BUFFER_ADD_CODEC_ERROR||e===ua.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:t})=>i.audioCodec!==t),m="video"===t.sourceBufferName&&(e===ua.BUFFER_ADD_CODEC_ERROR||e===ua.BUFFER_APPEND_ERROR)&&u.some(({codecSet:t,audioCodec:e})=>i.codecSet!==t&&i.audioCodec===e),{type:g,groupId:v}=null!=(s=t.context)?s:{};for(let n=u.length;n--;){const r=(n+c)%u.length;if(r!==c&&r>=h&&r<=d&&0===u[r].loadError){var a,o;const n=u[r];if(e===ua.FRAG_GAP&&f===ma&&t.frag){const e=u[r].details;if(e){const n=hl(t.frag,e.fragments,t.frag.start);if(null!=n&&n.gap)continue}}else{if(g===fa&&n.hasAudioGroup(v)||g===pa&&n.hasSubtitleGroup(v))continue;if(f===ga&&null!=(a=i.audioGroups)&&a.some(t=>n.hasAudioGroup(t))||f===va&&null!=(o=i.subtitleGroups)&&o.some(t=>n.hasSubtitleGroup(t))||p&&i.audioCodec===n.audioCodec||m&&i.codecSet===n.codecSet||!p&&i.codecSet!==n.codecSet)continue}l=r;break}}if(l>-1&&n.loadLevel!==l)return t.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:l}}return{action:2,flags:1}}onErrorOut(t,e){var n;switch(null==(n=e.errorAction)?void 0:n.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===ua.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(t){const e=this.hls,n=t.errorAction;if(!n)return;const{flags:i}=n,r=n.nextAutoLevel;switch(i){case 0:this.switchLevel(t,r);break;case 2:{const i=this.getVariantLevelIndex(t.frag),r=e.levels[i],s=null==r?void 0:r.attrs["HDCP-LEVEL"];if(n.hdcpLevel=s,"NONE"===s)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(s){e.maxHdcpLevel=Zo[Zo.indexOf(s)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}}case 4:{const e=t.decryptdata;if(e){const i=this.hls.levels,r=i.length;for(let n=r;n--;){var s,a;this.variantHasKey(i[n],e)&&(this.log(`Banned key found in level ${n} (${i[n].bitrate}bps) or audio group "${null==(s=i[n].audioGroups)?void 0:s.join(",")}" (${null==(a=t.frag)?void 0:a.type} fragment) ${Oa(e.keyId||[])}`),i[n].fragmentError++,i[n].loadError++,this.log(`Removing level ${n} with key error (${t.error})`),this.hls.removeLevel(n))}const o=t.frag;if(this.hls.levels.length<r)n.resolved=!0;else if(o&&o.type!==ma){const t=o.decryptdata;t&&!e.matches(t)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(t,r)}switchLevel(t,e){if(void 0!==e&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===ua.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&"audiovideo"!==t.sourceBufferName)){const e=zo(t.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i][`${t.sourceBufferName}Codec`]===e&&(this.log(`Removing level ${i} for ${t.details} ("${e}" not supported)`),this.hls.removeLevel(i))}}},fpsController:class{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const n=this.hls.config;if(n.capLevelOnFPSDrop){const t=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=t,t&&"function"==typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,n){const i=performance.now();if(e){if(this.lastTime){const t=i-this.lastTime,r=n-this.lastDroppedFrames,s=e-this.lastDecodedFrames,a=1e3*r/t,o=this.hls;if(o.trigger(ca.FPS_DROP,{currentDropped:r,currentDecoded:s,totalDroppedFrames:n}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*s){let t=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=t)&&(t-=1,o.trigger(ca.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:o.currentLevel}),o.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:bu,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Sp,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends bc{constructor(t,e,n){super(t,e,n,"subtitle-stream-controller",va),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ca.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(ca.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(ca.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(ca.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(ca.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ca.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(ca.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(ca.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(ca.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(ca.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=uc,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:n,success:i}=e;if(this.fragContextChanged(n)||(qa(n)&&(this.fragPrevious=n),this.state=uc),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let s;const a=n.start;for(let t=0;t<r.length;t++)if(a>=r[t].start&&a<=r[t].end){s=r[t];break}const o=n.start+n.duration;s?s.end=o:(s={start:a,end:o},r.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:n,endOffset:i}=e;if(0===n&&i!==Number.POSITIVE_INFINITY){const t=i-1;if(t<=0)return;e.endOffsetSubtitles=Math.max(0,t),this.tracksBuffered.forEach(e=>{for(let n=0;n<e.length;)if(e[n].end<=t)e.shift();else{if(!(e[n].start<t))break;e[n].start=t,n++}}),this.fragmentTracker.removeFragmentsInRange(n,t,va)}}onError(t,e){const n=e.frag;(null==n?void 0:n.type)===va&&(e.details===ua.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==lc&&(this.state=uc))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){this.levels&&Xh(this.levels,e)?this.levels=e.map(t=>new Jo(t)):(this.tracksBuffered=[],this.levels=e.map(t=>{const e=new Jo(t);return this.tracksBuffered[e.id]=[],e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,va),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(t,e){var n;if(this.currentTrackId=e.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==lc&&this.setInterval(500)}onSubtitleTrackLoaded(t,e){var n;const{currentTrackId:i,levels:r}=this,{details:s,id:a}=e;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=r[a];if(a>=r.length||!o)return;this.log(`Subtitle track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(n=o.details)&&n.live){if(s.deltaUpdateFailed)return;const t=this.mainDetails;if(!t)return void(this.startFragRequested=!1);const e=t.fragments[0];var u;o.details?(l=this.alignPlaylists(s,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&e&&(l=e.start,Wu(s,l))):s.hasProgramDateTime&&t.hasProgramDateTime?(sc(s,t),l=s.fragmentStart):e&&(l=e.start,Wu(s,l)),t&&!this.startFragRequested&&this.setStartPosition(t,l)}o.details=s,this.levelLastLoaded=o,a===i&&(this.hls.trigger(ca.SUBTITLE_TRACK_UPDATED,{details:s,id:a,groupId:e.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===uc)&&(hl(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}_handleFragmentLoadComplete(t){const{frag:e,payload:n}=t,i=e.decryptdata,r=this.hls;if(!this.fragContextChanged(e)&&n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&su(i.method)){const t=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,au(i.method)).catch(t=>{throw r.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(n=>{const i=performance.now();r.trigger(ca.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:t,tdecrypt:i}})}).catch(t=>{this.warn(`${t.name}: ${t.message}`),this.state=uc})}}doTick(){if(this.media){if(this.state===uc){const{currentTrackId:t,levels:e}=this,n=null==e?void 0:e[t];if(!n||!e.length||!n.details)return;if(this.waitForLive(n))return;const{config:i}=this,r=this.getLoadPosition(),s=Hl.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:a,len:o}=s,l=n.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const u=l.fragments,c=u.length,h=l.edge;let d=null;const f=this.fragPrevious;if(a<h){const t=i.maxFragLookUpTolerance,e=a>h-t?0:t;d=hl(f,u,Math.max(u[0].start,a),e),!d&&f&&f.start<u[0].start&&(d=u[0])}else d=u[c-1];if(d=this.filterReplacedPrimary(d,n.details),!d)return;const p=u[d.sn-l.startSN-1];if(p&&p.cc===d.cc&&this.fragmentTracker.getState(p)===Dl&&(d=p),this.fragmentTracker.getState(d)===Dl){const t=this.mapToInitFragWhenRequired(d);t&&this.loadFragment(t,n,a)}}}else this.state=uc}loadFragment(t,e,n){qa(t)?super.loadFragment(t,e,n):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new Af(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends qh{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const e=df(this.media.textTracks);for(let n=0;n<e.length;n++)if("hidden"===e[n].mode)t=e[n];else if("showing"===e[n].mode){t=e[n];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.LEVEL_LOADING,this.onLevelLoading,this),t.on(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ca.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.LEVEL_LOADING,this.onLevelLoading,this),t.off(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ca.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(ca.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const n=this.media;if(!n)return;const i=!!e.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i||df(n.textTracks).forEach(t=>{cf(t)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:n,groupId:i,details:r}=e,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=e.details,this.log(`Subtitle track ${n} "${s.name}" lang:${s.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(t=>-1===(null==i?void 0:i.indexOf(t)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!n||-1!==n.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.subtitlePreference;if(!r&&e){this.selectDefaultTrack=!1;const n=sl(e,t);if(n>-1)r=t[n];else{const t=sl(e,this.tracks);r=this.tracks[t]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const s={subtitleTracks:t};this.log(`Updating subtitle tracks, ${t.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(ca.SUBTITLE_TRACKS_UPDATED,s),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}}findTrackId(t){const e=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<e.length;i++){const r=e[i];if((!n||r.default)&&(n||t)&&(!t||al(r,t)))return i}if(t){for(let n=0;n<e.length;n++){const i=e[n];if(Qh(t.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<e.length;n++){const i=e[n];if(Qh(t.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let n=0;n<e.length;n++)if(Jh(e[n],t))return n}return-1}onError(t,e){!e.fatal&&e.context&&(e.context.type!==pa||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(-1===t.id)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const n=this.currentTrack;if(n&&al(t,n))return n;const i=sl(t,this.tracksInGroup);if(i>-1){const t=this.tracksInGroup[i];return this.setSubtitleTrack(i),t}if(n)return null;{const n=sl(t,e);if(n>-1)return e[n]}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const n=t.id,i=t.groupId,r=this.getUrlWithDirectives(t.url,e),s=t.details,a=null==s?void 0:s.age;this.log(`Loading subtitle ${n} "${t.name}" lang:${t.lang} group:${i}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""}${a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""} ${r}`),this.hls.trigger(ca.SUBTITLE_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=df(t.textTracks),n=this.currentTrack;let i;if(n&&(i=e.filter(t=>Jh(n,t))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(e).forEach(t=>{"disabled"!==t.mode&&t!==i&&(t.mode="disabled")}),i){const t=this.subtitleDisplay?"showing":"hidden";i.mode!==t&&(i.mode=t)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=t);if(t<-1||t>=e.length||!sa(t))return void this.warn(`Invalid subtitle track id: ${t}`);this.selectDefaultTrack=!1;const n=this.currentTrack,i=e[t]||null;if(this.trackId=t,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(ca.SUBTITLE_TRACK_SWITCH,{id:t});const r=!!i.details&&!i.details.live;if(t===this.trackId&&i===n&&r)return;this.log(`Switching to subtitle-track ${t}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:s,groupId:a="",name:o,type:l,url:u}=i;this.hls.trigger(ca.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:u});const c=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(c)}},timelineController:class{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ca.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(ca.FRAG_LOADING,this.onFragLoading,this),t.on(ca.FRAG_LOADED,this.onFragLoaded,this),t.on(ca.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(ca.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(ca.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(ca.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(ca.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ca.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(ca.FRAG_LOADING,this.onFragLoading,this),t.off(ca.FRAG_LOADED,this.onFragLoaded,this),t.off(ca.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(ca.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(ca.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(ca.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new yp(this,"textTrack1"),e=new yp(this,"textTrack2"),n=new yp(this,"textTrack3"),i=new yp(this,"textTrack4");this.cea608Parser1=new Vf(1,t,e),this.cea608Parser2=new Vf(3,n,i)}addCues(t,e,n,i,r){let s=!1;for(let t=r.length;t--;){const i=r[t],a=Ep(i[0],i[1],e,n);if(a>=0&&(i[0]=Math.min(i[0],e),i[1]=Math.max(i[1],n),s=!0,a/(n-e)>.5))return}if(s||r.push([e,n]),this.config.renderTextTracksNatively){const r=this.captionsTracks[t];this.Cues.newCue(r,e,n,i)}else{const r=this.Cues.newCue(null,e,n,i);this.hls.trigger(ca.CUES_PARSED,{type:"captions",cues:r,track:t})}}onInitPtsFound(t,{frag:e,id:n,initPTS:i,timescale:r,trackId:s}){const{unparsedVttFrags:a}=this;n===ma&&(this.initPTS[e.cc]={baseTime:i,timescale:r,trackId:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(t=>{this.initPTS[t.frag.cc]?this.onFragLoaded(ca.FRAG_LOADED,t):this.hls.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const r=n.textTracks[i];if(bp(r,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:n,media:i}=this,{label:r,languageCode:s}=e[t],a=this.getExistingTrack(r,s);if(a)n[t]=a,cf(n[t]),lf(n[t],i);else{const e=this.createTextTrack("captions",r,s);e&&(e[t]=!0,n[t]=e)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(ca.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(t,e,n){const i=this.media;if(i)return i.addTextTrack(t,e,n)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const n=!!e.transferMedia;if(this.media=null,n)return;const{captionsTracks:i}=this;Object.keys(i).forEach(t=>{cf(i[t]),delete i[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let t=0;t<e.length;t++)cf(e[t])}onSubtitleTracksUpdated(t,e){const n=e.subtitleTracks||[],i=n.some(t=>t.textCodec===op);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Xh(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const t=this.media,e=t?df(t.textTracks):null;if(this.tracks.forEach((t,n)=>{let i;if(e){let n=null;for(let i=0;i<e.length;i++)if(e[i]&&bp(e[i],t)){n=e[i],e[i]=null;break}n&&(i=n)}if(i)cf(i);else{const e=_p(t);i=this.createTextTrack(e,t.name,t.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)}),null!=e&&e.length){const t=e.filter(t=>null!==t).map(t=>t.label);t.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${t.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const t=this.tracks.map(t=>({label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}));this.hls.trigger(ca.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(t=>{const e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(!e)return;const n=`textTrack${e[1]}`,i=this.captionsProperties[n];i&&(i.label=t.name,t.lang&&(i.languageCode=t.lang),i.media=t)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===ma){var n,i;const{cea608Parser1:t,cea608Parser2:r,lastSn:s}=this,{cc:a,sn:o}=e.frag,l=null!=(n=null==(i=e.part)?void 0:i.index)?n:-1;t&&r&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(t.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(t,e){const{frag:n,payload:i}=e;if(n.type===va)if(i.byteLength){const t=n.decryptdata,r="stats"in e;if(null==t||!t.encrypted||r){const t=this.tracks[n.level],r=this.vttCCs;r[n.cc]||(r[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),t&&t.textCodec===op?this._parseIMSC1(n,i):this._parseVTTs(e)}}else this.hls.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const n=this.hls;hp(e,this.initPTS[t.cc],e=>{this._appendCues(e,t.level),n.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},e=>{n.logger.log(`Failed to parse IMSC1: ${e}`),n.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})})}_parseVTTs(t){var e;const{frag:n,payload:i}=t,{initPTS:r,unparsedVttFrags:s}=this,a=r.length-1;if(!r[n.cc]&&-1===a)return void s.push(t);const o=this.hls;!function(t,e,n,i,r,s,a){const o=new ip,l=Ra(new Uint8Array(t)).trim().replace(rp,"\n").split("\n"),u=[],c=e?function(t,e=1){return xh(t,9e4,1/e)}(e.baseTime,e.timescale):0;let h,d="00:00.000",f=0,p=0,m=!0;o.oncue=function(t){const s=n[i];let a=n.ccOffset;const o=(f-c)/9e4;if(null!=s&&s.new&&(void 0!==p?a=n.ccOffset=s.start:function(t,e,n){let i=t[e],r=t[i.prevCC];if(!r||!r.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;null!=(s=r)&&s.new;){var s;t.ccOffset+=i.start-r.start,i.new=!1,i=r,r=t[i.prevCC]}t.presentationOffset=n}(n,i,o)),o){if(!e)return void(h=new Error("Missing initPTS for VTT MPEGTS"));a=o-n.presentationOffset}const l=t.endTime-t.startTime,d=Nh(9e4*(t.startTime+a-p),9e4*r)/9e4;t.startTime=Math.max(d,0),t.endTime=Math.max(d+l,0);const m=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(m)),t.id||(t.id=ap(t.startTime,t.endTime,m)),t.endTime>0&&u.push(t)},o.onparsingerror=function(t){h=t},o.onflush=function(){h?a(h):s(u)},l.forEach(t=>{if(m){if(sp(t,"X-TIMESTAMP-MAP=")){m=!1,t.slice(16).split(",").forEach(t=>{sp(t,"LOCAL:")?d=t.slice(6):sp(t,"MPEGTS:")&&(f=parseInt(t.slice(7)))});try{p=function(t){let e=parseInt(t.slice(-3));const n=parseInt(t.slice(-6,-4)),i=parseInt(t.slice(-9,-7)),r=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(sa(e)&&sa(n)&&sa(i)&&sa(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*n,e+=6e4*i,e+=36e5*r,e}(d)/1e3}catch(t){h=t}return}""===t&&(m=!1)}o.parse(t+"\n")}),o.flush()}(null!=(e=n.initSegment)&&e.data?_o(n.initSegment.data,new Uint8Array(i)).buffer:i,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,t=>{this._appendCues(t,n.level),o.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},e=>{const r="Missing initPTS for VTT MPEGTS"===e.message;r?s.push(t):this._fallbackToIMSC1(n,i),o.logger.log(`Failed to parse VTT cue: ${e}`),r&&a>n.cc||o.trigger(ca.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:e})})}_fallbackToIMSC1(t,e){const n=this.tracks[t.level];n.textCodec||hp(e,this.initPTS[t.cc],()=>{n.textCodec=op,this._parseIMSC1(t,e)},()=>{n.textCodec="wvtt"})}_appendCues(t,e){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[e];if(!n||"disabled"===n.mode)return;t.forEach(t=>uf(n,t))}else{const i=this.tracks[e];if(!i)return;const r=i.default?"default":"subtitles"+e;n.trigger(ca.CUES_PARSED,{type:"subtitles",cues:t,track:r})}}onFragDecrypted(t,e){const{frag:n}=e;n.type===va&&this.onFragLoaded(ca.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:i}=e;if(n.type!==ma||"NONE"!==this.closedCaptionsForLevel(n))for(let t=0;t<i.length;t++){const e=i[t].bytes;if(e){this.cea608Parser1||this.initCea608Parsers();const n=this.extractCea608Data(e);this.cea608Parser1.addData(i[t].pts,n[0]),this.cea608Parser2.addData(i[t].pts,n[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:n,endOffsetSubtitles:i,type:r}){const{media:s}=this;if(s&&!(s.currentTime<n)){if(!r||"video"===r){const{captionsTracks:t}=this;Object.keys(t).forEach(i=>hf(t[i],e,n))}if(this.config.renderTextTracksNatively&&0===e&&void 0!==i){const{textTracks:t}=this;Object.keys(t).forEach(n=>hf(t[n],e,i))}}}extractCea608Data(t){const e=[[],[]],n=31&t[0];let i=2;for(let r=0;r<n;r++){const n=t[i++],r=127&t[i++],s=127&t[i++];if((0!==r||0!==s)&&4&n){const t=3&n;0!==t&&1!==t||(e[t].push(r),e[t].push(s))}}return e}},audioStreamController:class extends bc{constructor(t,e,n){super(t,e,n,"audio-stream-controller",ga),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ca.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ca.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(ca.BUFFER_RESET,this.onBufferReset,this),t.on(ca.BUFFER_CREATED,this.onBufferCreated,this),t.on(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ca.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(ca.FRAG_LOADING,this.onFragLoading,this),t.on(ca.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ca.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ca.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(ca.BUFFER_RESET,this.onBufferReset,this),t.off(ca.BUFFER_CREATED,this.onBufferCreated,this),t.off(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ca.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(ca.FRAG_LOADING,this.onFragLoading,this),t.off(ca.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:n,initPTS:i,timescale:r,trackId:s}){if(n===ma){const t=e.cc,n=this.fragCurrent;if(this.initPTS[t]={baseTime:i,timescale:r,trackId:s},this.log(`InitPTS for cc: ${t} found from main: ${i/r} (${i}/${r}) trackId: ${s}`),this.mainAnchor=e,this.state===yc){const n=this.waitingData;(!n&&!this.loadingParts||n&&n.frag.cc!==t)&&this.syncWithAnchor(e,null==n?void 0:n.frag)}else!this.hls.hasEnoughToStart&&n&&n.cc!==t?(n.abortRequests(),this.syncWithAnchor(e,n)):this.state===uc&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var n;const i=(null==(n=this.mainFragLoading)?void 0:n.frag)||null;if(e&&(null==i?void 0:i.cc)===e.cc)return;const r=(i||t).cc,s=pl(this.getLevelDetails(),r,this.getLoadPosition());s&&(this.log(`Syncing with main frag at ${s.start} cc ${s.cc}`),this.startFragRequested=!1,this.nextLoadPosition=s.start,this.resetLoadingState(),this.state===uc&&this.doTickIdle())}startLoad(t,e){if(!this.levels)return this.startPosition=t,void(this.state=lc);const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),n>0&&-1===t?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),t=n,this.state=uc):this.state=fc,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case uc:this.doTickIdle();break;case fc:{const{levels:t,trackId:e}=this,n=null==t?void 0:t[e],i=null==n?void 0:n.details;if(i&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(i))break;this.state=yc}break}case dc:this.checkRetryDate();break;case yc:{const t=this.waitingData;if(t){const{frag:e,part:n,cache:i,complete:r}=t,s=this.mainAnchor;if(void 0!==this.initPTS[e.cc]){this.waitingData=null,this.state=hc;const t={frag:e,part:n,payload:i.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(t),r&&super._handleFragmentLoadComplete(t)}else s&&s.cc!==t.frag.cc&&this.syncWithAnchor(s,t.frag)}else this.state=uc}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:n,media:i,trackId:r}=this,s=e.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!s.startFragPrefetch)||null==n||!n[r])return;const a=n[r],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=fc,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,Ka,ga));const u=this.getFwdBufferInfo(l,ga);if(null===u)return;if(!this.switchingTrack&&this._streamEnded(u,o))return e.trigger(ca.BUFFER_EOS,{type:"audio"}),void(this.state=gc);const c=u.len,h=e.maxBufferLength,d=o.fragments,f=d[0].start,p=this.getLoadPosition(),m=this.flushing?p:u.end;if(this.switchingTrack&&i){const t=p;o.PTSKnown&&t<f&&(u.end>f||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=f+.05)}if(c>=h&&!this.switchingTrack&&m<d[d.length-1].start)return;let g=this.getNextFragment(m,o);if(g&&this.isLoopLoading(g,m)&&(g=this.getNextFragmentLoopLoading(g,o,u,ma,h)),!g)return void(this.bufferFlushed=!0);let v=(null==(t=this.mainFragLoading)?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&qa(g)&&!g.endList&&(!o.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===kl&&(this.mainFragLoading=v=null),v&&qa(v))){if(g.start>v.end){const t=this.fragmentTracker.getFragAtPos(m,ma);t&&t.end>v.end&&(v=t,this.mainFragLoading={frag:t,targetBufferTime:null})}if(g.start>v.end)return}this.loadFragment(g,a,m)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(t=>new Jo(t))}onAudioTrackSwitching(t,e){const n=!!e.url;this.trackId=e.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==lc&&(this.setInterval(100),this.state=uc,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(ca.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(t,e){var n;const{levels:i}=this,{details:r,id:s,groupId:a,track:o}=e;if(!i)return void this.warn(`Audio tracks reset while loading track ${s} "${o.name}" of "${a}"`);const l=this.mainDetails;if(!l||r.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=e,void(this.state!==lc&&(this.state=fc));this.cachedTrackLoadedData=null,this.log(`Audio track ${s} "${o.name}" of "${a}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const u=i[s];let c=0;if(r.live||null!=(n=u.details)&&n.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;var h;u.details&&(c=this.alignPlaylists(r,u.details,null==(h=this.levelLastLoaded)?void 0:h.details)),r.alignedSliding||(rc(r,l),r.alignedSliding||sc(r,l),c=r.fragmentStart)}u.details=r,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(l,c),this.hls.trigger(ca.AUDIO_TRACK_UPDATED,{details:r,id:s,groupId:e.groupId}),this.state!==fc||this.waitForCdnTuneIn(r)||(this.state=uc),this.tick()}_handleFragmentLoadProgress(t){var e;const n=t.frag,{part:i,payload:r}=t,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const c=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new Zh(this.hls,ga,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],f=null==(e=n.initSegment)?void 0:e.data;if(void 0!==d){const t=!1,e=i?i.index:-1,s=-1!==e,a=new Gl(n.level,n.sn,n.stats.chunkCount,r.byteLength,e,s);h.push(r,f,c,"",n,i,u.totalduration,t,a,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:t}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new Tc,complete:!1};t.push(new Uint8Array(r)),this.state!==lc&&(this.state=yc)}}_handleFragmentLoadComplete(t){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const n=e.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===ma&&qa(e.frag)&&(this.mainFragLoading=e,this.state===uc&&this.tick())}onFragBuffered(t,e){const{frag:n,part:i}=e;if(n.type===ga)if(this.fragContextChanged(n))this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(qa(n)){this.fragPrevious=n;const t=this.switchingTrack;t&&(this.bufferedTrack=t,this.switchingTrack=null,this.hls.trigger(ca.AUDIO_TRACK_SWITCHED,Sa({},t)))}this.fragBufferedComplete(n,i),this.media&&this.tick()}else this.audioOnly||n.type!==ma||n.elementaryStreams.video||n.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(t,e){var n;if(e.fatal)this.state=vc;else switch(e.details){case ua.FRAG_GAP:case ua.FRAG_PARSING_ERROR:case ua.FRAG_DECRYPT_ERROR:case ua.FRAG_LOAD_ERROR:case ua.FRAG_LOAD_TIMEOUT:case ua.KEY_LOAD_ERROR:case ua.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ga,e);break;case ua.AUDIO_TRACK_LOAD_ERROR:case ua.AUDIO_TRACK_LOAD_TIMEOUT:case ua.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==fc||(null==(n=e.context)?void 0:n.type)!==fa||(this.state=uc);break;case ua.BUFFER_ADD_CODEC_ERROR:case ua.BUFFER_APPEND_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case ua.BUFFER_FULL_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ua.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onBufferFlushing(t,{type:e}){e!==Wa&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==Wa){this.flushing=!1,this.bufferFlushed=!0,this.state===gc&&(this.state=uc);const t=this.mediaBuffer||this.media;t&&(this.afterBufferFlushed(t,e,ga),this.tick())}}_handleTransmuxComplete(t){var e;const n="audio",{hls:i}=this,{remuxResult:r,chunkMeta:s}=t,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:u}=a,{details:c}=u,{audio:h,text:d,id3:f,initSegment:p}=r;if(!this.fragContextChanged(o)&&c){if(this.state=pc,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const t=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(u,p.tracks,t,s),i.trigger(ca.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:n,tracks:p.tracks})}if(h){const{startPTS:t,endPTS:e,startDTS:n,endDTS:i}=h;l&&(l.elementaryStreams[Ka]={startPTS:t,endPTS:e,startDTS:n,endDTS:i}),o.setElementaryStreamInfo(Ka,t,e,n,i),this.bufferFragmentData(h,o,l,s)}if(null!=f&&null!=(e=f.samples)&&e.length){const t=Ea({id:n,frag:o,details:c},f);i.trigger(ca.FRAG_PARSING_METADATA,t)}if(d){const t=Ea({id:n,frag:o,details:c},d);i.trigger(ca.FRAG_PARSING_USERDATA,t)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(t,e,n,i){if(this.state!==pc)return;if(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio)return;const r=e.audio;r.id=ga;const s=t.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${s}/${r.codec}]`),s&&1===s.split(",").length&&(r.levelCodec=s),this.hls.trigger(ca.BUFFER_CODECS,e);const a=r.initSegment;if(null!=a&&a.byteLength){const t={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:a};this.hls.trigger(ca.BUFFER_APPENDING,t)}this.tickImmediate()}loadFragment(t,e,n){const i=this.fragmentTracker.getState(t);var r;if(this.switchingTrack||i===Dl||i===Ll)if(qa(t))if(null!=(r=e.details)&&r.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=yc;const n=this.mainDetails;n&&n.fragmentStart!==e.details.fragmentStart&&sc(e.details,n)}else super.loadFragment(t,e,n);else this._loadInitSegment(t,e);else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:n,assocLang:i,characteristics:r,audioCodec:s,channels:a}=this.bufferedTrack;al({name:e,lang:n,assocLang:i,characteristics:r,audioCodec:s,channels:a},t,ol)||(ul(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(ca.AUDIO_TRACK_SWITCHED,Sa({},t))}},audioTrackController:class extends qh{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.LEVEL_LOADING,this.onLevelLoading,this),t.on(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ca.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.LEVEL_LOADING,this.onLevelLoading,this),t.off(ca.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ca.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(ca.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:n,groupId:i,details:r}=e,s=this.tracksInGroup[n];if(!s||s.groupId!==i)return void this.warn(`Audio track with id:${n} and group:${i} not found in active group ${null==s?void 0:s.groupId}`);const a=s.details;s.details=e.details,this.log(`Audio track ${n} "${s.name}" lang:${s.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!n||(null==i?void 0:i.length)!==(null==n?void 0:n.length)||null!=n&&n.some(t=>-1===(null==i?void 0:i.indexOf(t)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!n||-1!==n.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.audioPreference;if(!r&&e){const n=sl(e,t,ol);if(n>-1)r=t[n];else{const t=sl(e,this.tracks);r=this.tracks[t]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={audioTracks:t};this.log(`Updating audio tracks, ${t.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(ca.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(t.length&&-1===o){var s;const e=new Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${t.length}`);this.warn(e.message),this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:e})}}}onError(t,e){!e.fatal&&e.context&&(e.context.type!==fa||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&al(t,i,ol))return i;const r=sl(t,this.tracksInGroup,ol);if(r>-1){const t=this.tracksInGroup[r];return this.setAudioTrack(r),t}if(i){let i=e.loadLevel;-1===i&&(i=e.firstAutoLevel);const r=function(t,e,n,i,r){const s=e[i],a=e.reduce((t,e,n)=>{const i=e.uri;return(t[i]||(t[i]=[])).push(n),t},{})[s.uri];a.length>1&&(i=Math.max.apply(Math,a));const o=s.videoRange,l=s.frameRate,u=s.codecSet.substring(0,4),c=ll(e,i,e=>{if(e.videoRange!==o||e.frameRate!==l||e.codecSet.substring(0,4)!==u)return!1;const i=e.audioGroups,s=n.filter(t=>!i||-1!==i.indexOf(t.groupId));return sl(t,s,r)>-1});return c>-1?c:ll(e,i,e=>{const i=e.audioGroups,s=n.filter(t=>!i||-1!==i.indexOf(t.groupId));return sl(t,s,r)>-1})}(t,e.levels,n,i,ol);if(-1===r)return null;e.nextLoadLevel=r}if(t.channels||t.audioCodec){const e=sl(t,n);if(e>-1)return n[e]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length)return void this.warn(`Invalid audio track id: ${t}`);this.selectDefaultTrack=!1;const n=this.currentTrack,i=e[t],r=i.details&&!i.details.live;if(t===this.trackId&&i===n&&r)return;if(this.log(`Switching to audio-track ${t} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=t,this.currentTrack=i,this.hls.trigger(ca.AUDIO_TRACK_SWITCHING,Sa({},i)),r)return;const s=this.switchParams(i.url,null==n?void 0:n.details,i.details);this.loadPlaylist(s)}findTrackId(t){const e=this.tracksInGroup;for(let n=0;n<e.length;n++){const i=e[n];if((!this.selectDefaultTrack||i.default)&&(!t||al(t,i,ol)))return n}if(t){const{name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o}=t;for(let t=0;t<e.length;t++)if(al({name:n,lang:i,assocLang:r,characteristics:s,audioCodec:a,channels:o},e[t],ol))return t;for(let n=0;n<e.length;n++){const i=e[n];if(Qh(t.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<e.length;n++){const i=e[n];if(Qh(t.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&ul(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const n=t.id,i=t.groupId,r=this.getUrlWithDirectives(t.url,e),s=t.details,a=null==s?void 0:s.age;this.log(`Loading audio-track ${n} "${t.name}" lang:${t.lang} group:${i}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""}${a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""} ${r}`),this.hls.trigger(ca.AUDIO_TRACK_LOADING,{url:r,id:n,groupId:i,deliveryDirectives:e||null,track:t})}},emeController:nf,cmcdController:class{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=t=>{try{this.apply(t,{ot:od,su:!this.initialized})}catch(t){this.hls.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=t=>{try{const{frag:e,part:n}=t,i=this.hls.levels[e.level],r=this.getObjectType(e),s={d:1e3*(n||e).duration,ot:r};r!==ud&&r!==ld&&r!=cd||(s.br=i.bitrate/1e3,s.tb=this.getTopBandwidth(r)/1e3,s.bl=this.getBufferLength(r));const a=n?this.getNextPart(n):this.getNextFrag(e);null!=a&&a.url&&a.url!==e.url&&(s.nor=a.url),this.apply(t,s)}catch(t){this.hls.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=t;const e=this.config=t.config,{cmcd:n}=e;null!=n&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||t.sessionId,this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHED,this.onMediaDetached,this),t.on(ca.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHED,this.onMediaDetached,this),t.off(ca.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var n,i;this.audioBuffer=null==(n=e.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(i=e.tracks.video)?void 0:i.buffer}createData(){var t;return{v:1,sf:fd,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Ea(e,this.createData());const n=e.ot===hd||e.ot===ud||e.ot===cd;this.starved&&n&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering);const{includeKeys:i}=this;i&&(e=Object.keys(e).reduce((t,n)=>(i.includes(n)&&(t[n]=e[n]),t),{}));const r={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),Xd(t.headers,e,r)):t.url=Jd(t.url,e,r)}getNextFrag(t){var e;const n=null==(e=this.hls.levels[t.level])?void 0:e.details;if(n){const e=t.sn-n.startSN;return n.fragments[e+1]}}getNextPart(t){var e;const{index:n,fragment:i}=t,r=null==(e=this.hls.levels[i.level])||null==(e=e.details)?void 0:e.partList;if(r){const{sn:t}=i;for(let e=r.length-1;e>=0;e--){const i=r[e];if(i.index===n&&i.fragment.sn===t)return r[e+1]}}}getObjectType(t){const{type:e}=t;return"subtitle"===e?dd:"initSegment"===t.sn?hd:"audio"===e?ld:"main"===e?this.hls.audioTracks.length?ud:cd:void 0}getTopBandwidth(t){let e,n=0;const i=this.hls;if(t===ld)e=i.audioTracks;else{const t=i.maxAutoLevel,n=t>-1?t+1:i.levels.length;e=i.levels.slice(0,n)}return e.forEach(t=>{t.bitrate>n&&(n=t.bitrate)}),n>0?n:NaN}getBufferLength(t){const e=this.media,n=t===ld?this.audioBuffer:this.videoBuffer;return n&&e?1e3*Hl.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,i){e(t),this.loader.load(t,n,i)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,i){e(t),this.loader.load(t,n,i)}}}},contentSteeringController:class extends Da{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(e=>e!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:n}=e;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:n}=e;if(2===(null==n?void 0:n.action)&&1===n.flags){const t=this.levels;let i=this._pathwayPriority,r=this.pathwayId;if(e.context){const{groupId:n,pathwayId:i,type:s}=e.context;n&&t?r=this.getPathwayForGroupId(n,s,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&t&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==r),e.details!==ua.BUFFER_APPEND_ERROR||e.fatal?n.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${r} levels: ${t?t.length:t} priorities: ${el(i)} penalized: ${el(this.penalizedPathways)}`):n.resolved=!0}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){const n=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),e=this.getLevelsForPathway(n),this.pathwayId=n}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){let e;this._pathwayPriority=t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(t=>{i-n[t]>3e5&&delete n[t]});for(let i=0;i<t.length;i++){const r=t[i];if(r in n)continue;if(r===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(e=this.getLevelsForPathway(r),e.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,Qu(e),this.hls.trigger(ca.LEVELS_UPDATED,{levels:e});const t=this.hls.levels[s];a&&t&&this.levels&&(t.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&t.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${t.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(t,e,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let n=0;n<i.length;n++)if(e===fa&&i[n].hasAudioGroup(t)||e===pa&&i[n].hasSubtitleGroup(t))return i[n].pathwayId;return n}clonePathways(t){const e=this.levels;if(!e)return;const n={},i={};t.forEach(t=>{const{ID:r,"BASE-ID":s,"URI-REPLACEMENT":a}=t;if(e.some(t=>t.pathwayId===r))return;const o=this.getLevelsForPathway(s).map(t=>{const e=new Ql(t.attrs);e["PATHWAY-ID"]=r;const s=e.AUDIO&&`${e.AUDIO}_clone_${r}`,o=e.SUBTITLES&&`${e.SUBTITLES}_clone_${r}`;s&&(n[e.AUDIO]=s,e.AUDIO=s),o&&(i[e.SUBTITLES]=o,e.SUBTITLES=o);const l=ef(t.uri,e["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),u=new Jo({attrs:e,audioCodec:t.audioCodec,bitrate:t.bitrate,height:t.height,name:t.name,url:l,videoCodec:t.videoCodec,width:t.width});if(t.audioGroups)for(let e=1;e<t.audioGroups.length;e++)u.addGroupId("audio",`${t.audioGroups[e]}_clone_${r}`);if(t.subtitleGroups)for(let e=1;e<t.subtitleGroups.length;e++)u.addGroupId("text",`${t.subtitleGroups[e]}_clone_${r}`);return u});e.push(...o),tf(this.audioTracks,n,a,r),tf(this.subtitleTracks,i,a,r)})}loadSteeringManifest(t){const e=this.hls.config,n=e.loader;let i;this.loader&&this.loader.destroy(),this.loader=new n(e);try{i=new self.URL(t)}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${t}`)}if("data:"!==i.protocol){const t=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+t)}const r={responseType:"json",url:i.href},s=e.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(t,e,n,r)=>{this.log(`Loaded steering manifest: "${i}"`);const s=t.data;if(1!==(null==s?void 0:s.VERSION))return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,i).href}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||n.url),o&&this.clonePathways(o);const u={steeringManifest:s,url:i.toString()};this.hls.trigger(ca.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(t,e,n,i)=>{if(this.log(`Error loading steering manifest: ${t.code} ${t.text} (${e.url})`),this.stopLoad(),410===t.code)return this.enabled=!1,void this.log(`Steering manifest ${e.url} no longer available`);let r=1e3*this.timeToLoad;if(429===t.code){const t=this.loader;if("function"==typeof(null==t?void 0:t.getResponseHeader)){const e=t.getResponseHeader("Retry-After");e&&(r=1e3*parseFloat(e))}return void this.log(`Steering manifest ${e.url} rate limited`)}this.scheduleRefresh(this.uri||e.url,r)},onTimeout:(t,e,n)=>{this.log(`Timeout loading steering manifest (${e.url})`),this.scheduleRefresh(this.uri||e.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}scheduleRefresh(t,e=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var e;const n=null==(e=this.hls)?void 0:e.media;!n||n.ended?this.scheduleRefresh(t,1e3*this.timeToLoad):this.loadSteeringManifest(t)},e)}},interstitialsController:class extends Da{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const t=this.currentTime;if(void 0===t||this.playbackDisabled||!this.schedule)return;const e=t-this.timelinePos;if(Math.abs(e)<1/7056e5)return;const n=e<=-.01;this.timelinePos=t,this.bufferedPos=t;const i=this.playingItem;if(!i)return void this.checkBuffer();if(n&&this.schedule.resetErrorsInRange(t,t-e)&&this.updateSchedule(!0),this.checkBuffer(),n&&t<i.start||t>=i.end){var r;const e=this.findItemIndex(i);let s=this.schedule.findItemIndexAtTime(t);if(-1===s&&(s=e+(n?-1:1),this.log(`seeked ${n?"back ":""}to position not covered by schedule ${t} (resolving from ${e} to ${s})`)),!this.isInterstitial(i)&&null!=(r=this.media)&&r.paused&&(this.shouldPlay=!1),!n&&s>e){const t=this.schedule.findJumpRestrictedIndex(e+1,s);if(t>e)return void this.setSchedulePosition(t)}return void this.setSchedulePosition(s)}const s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(i)){const e=i.event.assetList[0];e&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(t,e))}return}const a=s.timelineStart,o=s.duration||0;var l;(n&&t<a||t>=a+o)&&(null!=(l=i.event)&&l.appendInPlace&&(this.clearInterstitial(i.event,i),this.flushFrontBuffer(t)),this.setScheduleToAssetAtTime(t,s))},this.onTimeupdate=()=>{const t=this.currentTime;if(void 0===t||this.playbackDisabled)return;if(!(t>this.timelinePos))return;this.timelinePos=t,t>this.bufferedPos&&this.checkBuffer();const e=this.playingItem;if(!e||this.playingLastItem)return;if(t>=e.end){this.timelinePos=e.end;const t=this.findItemIndex(e);this.setSchedulePosition(t+1)}const n=this.playingAsset;n&&t>=n.timelineStart+(n.duration||0)&&this.setScheduleToAssetAtTime(t,n)},this.onScheduleUpdate=(t,e)=>{const n=this.schedule;if(!n)return;const i=this.playingItem,r=n.events||[],s=n.items||[],a=n.durations,o=t.map(t=>t.identifier),l=!(!r.length&&!o.length);(l||e)&&this.log(`INTERSTITIALS_UPDATED (${r.length}): ${r}\nSchedule: ${s.map(t=>Df(t))} pos: ${this.timelinePos}`),o.length&&this.log(`Removed events ${o}`);let u=null,c=null;i&&(u=this.updateItem(i,this.timelinePos),this.itemsMatch(i,u)?this.playingItem=u:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h&&(c=this.updateItem(h,this.bufferedPos),this.itemsMatch(h,c)?this.bufferingItem=c:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))),t.forEach(t=>{t.assetList.forEach(t=>{this.clearAssetPlayer(t.identifier,null)})}),this.playerQueue.forEach(t=>{if(t.interstitial.appendInPlace){const e=t.assetItem.timelineStart,n=t.timelineOffset-e;if(n)try{t.timelineOffset=e}catch(i){Math.abs(n)>pf&&this.warn(`${i} ("${t.assetId}" ${t.timelineOffset}->${e})`)}}}),l||e){if(this.hls.trigger(ca.INTERSTITIALS_UPDATED,{events:r.slice(0),schedule:s.slice(0),durations:a,removedIds:o}),this.isInterstitial(i)&&o.includes(i.event.identifier))return this.warn(`Interstitial "${i.event.identifier}" removed while playing`),void this.primaryFallback(i.event);i&&this.trimInPlace(u,i),h&&c!==u&&this.trimInPlace(c,h),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new wf(t),this.schedule=new Sf(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ca.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(ca.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(ca.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(ca.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(ca.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(ca.BUFFER_APPENDED,this.onBufferAppended,this),t.on(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ca.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(ca.MEDIA_ENDED,this.onMediaEnded,this),t.on(ca.ERROR,this.onError,this),t.on(ca.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ca.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(ca.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(ca.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(ca.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(ca.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(ca.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ca.BUFFER_APPENDED,this.onBufferAppended,this),t.off(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ca.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(ca.MEDIA_ENDED,this.onMediaEnded,this),t.off(ca.ERROR,this.onError,this),t.off(ca.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;null==(t=this.getBufferingPlayer())||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.getBufferingPlayer())||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){oc(t,"play",this.onPlay),oc(t,"pause",this.onPause),oc(t,"seeking",this.onSeeking),oc(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const n=this.media=e.media;ac(n,"seeking",this.onSeeking),ac(n,"timeupdate",this.onTimeupdate),ac(n,"play",this.onPlay),ac(n,"pause",this.onPause)}onMediaAttached(t,e){const n=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,null===n)this.checkStart();else if(!i){this.clearScheduleState();const t=this.findItemIndex(n);this.setSchedulePosition(t)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const n=!!e.transferMedia,i=this.media;if(this.media=null,!n&&(i&&this.removeMediaListeners(i),this.detachedData)){const t=this.getBufferingPlayer();t&&(this.log(`Removing schedule state for detachedData and ${t}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,t.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,n=e=>e?t.getAssetPlayer(e.identifier):e,i=(e,i,s,a,o)=>{if(e){let l=e[i].start;const u=e.event;if(u){if("playout"===i||u.timelineOccupancy!==mf.Point){const t=n(s);(null==t?void 0:t.interstitial)===u&&(l+=t.assetItem.startOffset+t[o])}}else l+=("bufferedPos"===a?r():t[a])-e.start;return l}return 0},r=()=>{const e=t.bufferedPos;return e===Number.MAX_VALUE?s("primary"):Math.max(e,0)},s=e=>{var n,i;return null!=(n=t.primaryDetails)&&n.live?t.primaryDetails.edge:(null==(i=t.schedule)?void 0:i.durations[e])||0},a=(e,r)=>{var s,a;const o=t.effectivePlayingItem;if(null!=o&&null!=(s=o.event)&&s.restrictions.skip||!t.schedule)return;t.log(`seek to ${e} "${r}"`);const l=t.effectivePlayingItem,u=t.schedule.findItemIndexAtTime(e,r),c=null==(a=t.schedule.items)?void 0:a[u],h=t.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,p=l&&t.itemsMatch(l,c);if(l&&(f||p)){const s=n(t.playingAsset),a=(null==s?void 0:s.media)||t.primaryMedia;if(a){const n="primary"===r?a.currentTime:i(l,r,t.playingAsset,"timelinePos","currentTime"),o=e-n,u=(f?n:a.currentTime)+o;if(u>=0&&(!s||f||u<=s.duration))return void(a.currentTime=u)}}if(c){let n=e;if("primary"!==r){const t=e-c[r].start;n=c.start+t}const i=!t.isInterstitial(c);if(t.isInterstitial(l)&&!l.event.appendInPlace||!i&&!c.event.appendInPlace){if(l){const s=t.findItemIndex(l);if(u>s){const e=t.schedule.findJumpRestrictedIndex(s+1,u);if(e>s)return void t.setSchedulePosition(e)}let a=0;if(i)t.timelinePos=n,t.checkBuffer();else{const t=c.event.assetList,n=e-(c[r]||c).start;for(let e=t.length;e--;){const i=t[e];if(i.duration&&n>=i.startOffset&&n<i.startOffset+i.duration){a=e;break}}}t.setSchedulePosition(u,a)}}else{const e=t.media||(f?null==h?void 0:h.media:null);e&&(e.currentTime=n)}}},o=()=>{const n=t.effectivePlayingItem;if(t.isInterstitial(n))return n;const i=e();return t.isInterstitial(i)?i:null},l={get bufferedEnd(){const n=e(),r=t.bufferingItem;var s;return r&&r===n&&(i(r,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-r.playout.start||(null==(s=t.bufferingAsset)?void 0:s.startOffset))||0},get currentTime(){const e=o(),n=t.effectivePlayingItem;return n&&n===e?i(n,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-n.playout.start:0},set currentTime(e){const n=o(),i=t.effectivePlayingItem;i&&i===n&&a(e+i.playout.start,"playout")},get duration(){const t=o();return t?t.playout.end-t.playout.start:0},get assetPlayers(){var e;const n=null==(e=o())?void 0:e.event.assetList;return n?n.map(e=>t.getAssetPlayer(e.identifier)):[]},get playingIndex(){var e;const n=null==(e=o())?void 0:e.event;return n&&t.effectivePlayingAsset?n.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var e;return(null==(e=t.schedule)||null==(e=e.events)?void 0:e.slice(0))||[]},get schedule(){var e;return(null==(e=t.schedule)||null==(e=e.items)?void 0:e.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const n=e();return t.findItemIndex(n)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const e=t.effectivePlayingItem;return t.findItemIndex(e)},primary:{get bufferedEnd(){return r()},get currentTime(){const e=t.timelinePos;return e>0?e:0},set currentTime(t){a(t,"primary")},get duration(){return s("primary")},get seekableStart(){var e;return(null==(e=t.primaryDetails)?void 0:e.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(t){a(t,"integrated")},get duration(){return s("integrated")},get seekableStart(){var e;return((e,n)=>{var i;if(0!==e&&null!=(i=t.schedule)&&i.length){var r;const i=t.schedule.findItemIndexAtTime(e),s=null==(r=t.schedule.items)?void 0:r[i];if(s)return e+(s[n].start-s.start)}return e})((null==(e=t.primaryDetails)?void 0:e.fragmentStart)||0,"integrated")}},skip:()=>{const e=t.effectivePlayingItem,n=null==e?void 0:e.event;if(n&&!n.restrictions.skip){const i=t.findItemIndex(e);if(n.appendInPlace){const t=e.playout.start+e.event.duration;a(t+.001,"playout")}else t.advanceAfterAssetEnded(n,i,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,n=null==(t=this.schedule)?void 0:t.items;return!!(this.playbackStarted&&e&&n)&&this.findItemIndex(e)===n.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var t,e;if(null===this.mediaSelection)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let i=this.media;!i&&null!=(t=this.bufferingItem)&&null!=(t=t.event)&&t.appendInPlace&&(i=this.primaryMedia);const r=null==(e=i)?void 0:e.currentTime;return void 0!==r&&sa(r)?r:void 0}get primaryMedia(){var t;return this.media||(null==(t=this.detachedData)?void 0:t.media)||null}isInterstitial(t){return!(null==t||!t.event)}retreiveMediaSource(t,e){const n=this.getAssetPlayer(t);n&&this.transferMediaFromPlayer(n,e)}transferMediaFromPlayer(t,e){const n=t.interstitial.appendInPlace,i=t.media;if(n&&i===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&i)return void(this.detachedData={media:i});const n=t.transferMedia();this.log(`transfer MediaSource from ${t} ${el(n)}`),this.detachedData=n}else e&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(t,e){var n,i;if(t.media===e)return;let r=null;const s=this.hls,a=t!==s,o=a&&t.interstitial.appendInPlace,l=null==(n=this.detachedData)?void 0:n.mediaSource;let u;if(s.media)o&&(r=s.transferMedia(),this.detachedData=r),u="Primary";else if(l){const t=this.getBufferingPlayer();t?(r=t.transferMedia(),u=`${t}`):u="detached MediaSource"}else u="detached media";if(!r)if(l)r=this.detachedData,this.log(`using detachedData: MediaSource ${el(r)}`);else if(!this.detachedData||s.media===e){const t=this.playerQueue;t.length>1&&t.forEach(t=>{if(a&&t.interstitial.appendInPlace!==o){const e=t.interstitial;this.clearInterstitial(t.interstitial,null),e.appendInPlace=!1,e.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${e}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}const c=r&&"mediaSource"in r&&"closed"!==(null==(i=r.mediaSource)?void 0:i.readyState),h=c&&r?r:e;this.log(`${c?"transfering MediaSource":"attaching media"} to ${a?t:"Primary"} from ${u} (media.currentTime: ${e.currentTime})`);const d=this.schedule;if(h===r&&d){const e=a&&t.assetId===d.assetIdAtEnd;h.overrides={duration:d.duration,endOfStream:!a||e,cueRemoval:!a}}t.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=null==t?void 0:t.events;if(!e||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const n=this.timelinePos,i=this.effectivePlayingItem;if(-1===n){const n=this.hls.startPosition;if(this.log(kf("checkStart",n)),this.timelinePos=n,e.length&&e[0].cue.pre){const n=t.findEventIndex(e[0].identifier);this.setSchedulePosition(n)}else if(n>=0||!this.primaryLive){const e=this.timelinePos=n>0?n:0,i=t.findItemIndexAtTime(e);this.setSchedulePosition(i)}}else if(i&&!this.playingItem){const e=t.findItemIndex(i);this.setSchedulePosition(e)}}advanceAssetBuffering(t,e){const n=t.event,i=n.findAssetIndex(e),r=bf(n,i);if(n.isAssetPastPlayoutLimit(r)){if(this.schedule){var s;const e=null==(s=this.schedule.items)?void 0:s[this.findItemIndex(t)+1];e&&this.bufferedToItem(e)}}else this.bufferedToEvent(t,r)}advanceAfterAssetEnded(t,e,n){const i=bf(t,n);if(t.isAssetPastPlayoutLimit(i)){if(this.schedule){const n=this.schedule.items;if(n){const i=e+1;if(i>=n.length)return void this.setSchedulePosition(-1);const r=t.resumeTime;this.timelinePos<r&&(this.log(kf("advanceAfterAssetEnded",r)),this.timelinePos=r,t.appendInPlace&&this.advanceInPlace(r),this.checkBuffer(this.bufferedPos<r)),this.setSchedulePosition(i)}}}else{if(t.appendInPlace){const e=t.assetList[i];e&&this.advanceInPlace(e.timelineStart)}this.setSchedulePosition(e,i)}}setScheduleToAssetAtTime(t,e){const n=this.schedule;if(!n)return;const i=e.parentIdentifier,r=n.getEvent(i);if(r){const e=n.findEventIndex(i),s=n.findAssetIndex(r,t);this.advanceAfterAssetEnded(r,e,s-1)}}setSchedulePosition(t,e){var n;const i=null==(n=this.schedule)?void 0:n.items;if(!i||this.playbackDisabled)return;const r=t>=0?i[t]:null;this.log(`setSchedulePosition ${t}, ${e} (${r?Df(r):r}) pos: ${this.timelinePos}`);const s=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){const n=s.event,u=this.playingAsset,c=null==u?void 0:u.identifier,h=c?this.getAssetPlayer(c):null;if(h&&c&&(!this.eventItemsMatch(s,r)||void 0!==e&&c!==n.assetList[e].identifier)){var o;const e=n.findAssetIndex(u);if(this.log(`INTERSTITIAL_ASSET_ENDED ${e+1}/${n.assetList.length} ${Ef(u)}`),this.endedAsset=u,this.playingAsset=null,this.hls.trigger(ca.INTERSTITIAL_ASSET_ENDED,{asset:u,assetListIndex:e,event:n,schedule:i.slice(0),scheduleIndex:t,player:h}),s!==this.playingItem)return void(this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(n,this.findItemIndex(this.playingItem),e));this.retreiveMediaSource(c,r),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(s,r)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${n} ${Df(s)}`),n.hasPlayed=!0,this.hls.trigger(ca.INTERSTITIAL_ENDED,{event:n,schedule:i.slice(0),scheduleIndex:t}),n.cue.once)){var l;this.updateSchedule();const t=null==(l=this.schedule)?void 0:l.items;if(r&&t){const n=this.findItemIndex(r);this.advanceSchedule(n,t,e,s,a)}return}}this.advanceSchedule(t,i,e,s,a)}advanceSchedule(t,e,n,i,r){const s=this.schedule;if(!s)return;const a=e[t]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(e=>{const n=e.interstitial,i=s.findEventIndex(n.identifier);(i<t||i>t+1)&&this.clearInterstitial(n,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const r=a.event;if(void 0===n){const e=bf(r,(n=s.findAssetIndex(r,this.timelinePos))-1);if(r.isAssetPastPlayoutLimit(e)||r.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(r,t,n);n=e}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let u=this.preloadAssets(r,n);if(this.eventItemsMatch(a,l||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Df(a)} ${r.appendInPlace?"append in place":""}`),this.hls.trigger(ca.INTERSTITIAL_STARTED,{event:r,schedule:e.slice(0),scheduleIndex:t})),!r.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${r}`);if(r.assetListLoader&&(r.assetListLoader.destroy(),r.assetListLoader=void 0),!o)return void this.log(`Waiting for attachMedia to start Interstitial ${r}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const c=r.assetList[n];if(!c)return void this.advanceAfterAssetEnded(r,t,n||0);if(u||(u=this.getAssetPlayer(c.identifier)),null===u||u.destroyed){const t=r.assetList.length;this.warn(`asset ${n+1}/${t} player destroyed ${r}`),u=this.createAssetPlayer(r,c,n),u.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&r.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(u,n,e,t,o),this.shouldPlay&&Lf(u.media)}else a?(this.resumePrimary(a,t,i),this.shouldPlay&&Lf(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var t;return null==(t=this.mediaSelection)?void 0:t.main.details}get primaryLive(){var t;return!(null==(t=this.primaryDetails)||!t.live)}resumePrimary(t,e,n){var i,r;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${Df(t)}`),null==(i=this.detachedData)||!i.mediaSource){let n=this.timelinePos;(n<t.start||n>=t.end)&&(n=this.getPrimaryResumption(t,e),this.log(kf("resumePrimary",n)),this.timelinePos=n),this.attachPrimary(n,t)}if(!n)return;const s=null==(r=this.schedule)?void 0:r.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Df(t)}`),this.hls.trigger(ca.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const n=t.start;if(this.primaryLive){const t=this.primaryDetails;if(0===e)return this.hls.startPosition;if(t&&(n<t.fragmentStart||n>t.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return null!=e&&e.hls?e.hls.bufferedToEnd:Hl.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,n){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),n&&this.startLoadingPrimaryAt(t,n)),n||(this.log(kf("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,n))}startLoadingPrimaryAt(t,e){var n;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs(((null==(n=i.mainForwardBufferInfo)?void 0:n.start)||i.media.currentTime)-t)>.5?i.startLoad(t,e):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),null==(t=this.schedule)||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(ca.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(ca.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(-1===e.level||!this.schedule)return;const n=this.hls.levels[e.level];if(!n.details)return;const i=Sa(Sa({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const n=this.hls.audioTracks[e.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Sa(Sa({},this.altSelection),{},{audio:n}));const r=Sa(Sa({},i),{},{audio:n});this.mediaSelection=r}onSubtitleTrackUpdated(t,e){const n=this.hls.subtitleTracks[e.id],i=this.mediaSelection;if(!i)return void(this.altSelection=Sa(Sa({},this.altSelection),{},{subtitles:n}));const r=Sa(Sa({},i),{},{subtitles:n});this.mediaSelection=r}onAudioTrackSwitching(t,e){const n=rl(e);this.playerQueue.forEach(({hls:t})=>t&&(t.setAudioOption(e)||t.setAudioOption(n)))}onSubtitleTrackSwitch(t,e){const n=rl(e);this.playerQueue.forEach(({hls:t})=>t&&(t.setSubtitleOption(e)||-1!==e.id&&t.setSubtitleOption(n)))}onBufferCodecs(t,e){const n=e.tracks;n&&(this.requiredTracks=n)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const t=this.timelinePos;this.bufferedPos=t,this.checkBuffer()}}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let t=0;t<e.length;t++){const i=e[t];if(i.cue.post){var n;const t=this.schedule.findEventIndex(i.identifier),e=null==(n=this.schedule.items)?void 0:n[t];this.isInterstitial(e)&&this.eventItemsMatch(e,this.bufferingItem)&&this.bufferedToItem(e,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const t=this.findItemIndex(e);this.setSchedulePosition(t+1)}else this.shouldPlay=!1}updateItem(t,e){var n;const i=null==(n=this.schedule)?void 0:n.items;return t&&i&&i[this.findItemIndex(t,e)]||null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((e,n)=>{t.event.isAssetPastPlayoutLimit(n)&&this.clearAssetPlayer(e.identifier,null)});const n=t.end+.25,i=Hl.bufferInfo(this.primaryMedia,n,0);if(i.end>n||(i.nextStart||0)>n){this.log(`trim buffered interstitial ${Df(t)} (was ${Df(e)})`);const i=!0;this.attachPrimary(n,null,i),this.flushFrontBuffer(n)}}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var n;return!!e&&(t===e||t.event.identifier===(null==(n=e.event)?void 0:n.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(t=!1){var e;const n=this.mediaSelection;n&&(null==(e=this.schedule)||e.updateSchedule(n,[],t))}checkBuffer(t){var e;const n=null==(e=this.schedule)?void 0:e.items;if(!n)return;const i=Hl.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=i.len<1),this.updateBufferedPos(i.end,n,t)}updateBufferedPos(t,e,n){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>t||!i)return;if(1===e.length&&this.itemsMatch(e[0],r))return void(this.bufferedPos=t);const s=this.playingItem,a=this.findItemIndex(s);let o=i.findItemIndexAtTime(t);if(this.bufferedPos<t){var l;const n=this.findItemIndex(r),i=Math.min(n+1,e.length-1),s=e[i];if((-1===o&&r&&t>=r.end||null!=(l=s.event)&&l.appendInPlace&&t+.01>=s.start)&&(o=i),this.isInterstitial(r)){const t=r.event;if(i-a>1&&!1===t.appendInPlace)return;if(0===t.assetList.length&&t.assetListLoader)return}if(this.bufferedPos=t,o>n&&o>a)this.bufferedToItem(s);else{const e=this.primaryDetails;this.primaryLive&&e&&t>e.edge-e.targetduration&&s.start<e.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(s)&&this.preloadAssets(s.event,0)}}else n&&s&&!this.itemsMatch(s,r)&&(o===a?this.bufferedToItem(s):o===a+1&&this.bufferedToItem(e[o]))}assetsBuffered(t,e){return 0!==t.event.assetList.length&&!t.event.assetList.some(t=>{const n=this.getAssetPlayer(t.identifier);return!(null!=n&&n.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(t,e)&&n){const{items:i,events:r}=n;if(!i||!r)return e;const s=this.isInterstitial(t),a=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const o=a?a.remaining:e?e.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Df(t)}`+(e?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(s){const e=n.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((t,n)=>{const i=this.getAssetPlayer(t.identifier);i&&(n===e&&i.loadSource(),i.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(t=>t.pauseBuffering());this.hls.trigger(ca.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t,e=0){const n=this.setBufferingItem(t);if(!this.playbackDisabled)if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(null!==n){this.bufferingAsset=null;const e=this.detachedData;if(e)if(e.mediaSource){const e=!0;this.attachPrimary(t.start,t,e)}else this.preloadPrimary(t);else this.preloadPrimary(t)}}preloadPrimary(t){const e=this.findItemIndex(t),n=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(n)}bufferedToEvent(t,e){const n=t.event,i=0===n.assetList.length&&!n.assetListLoader,r=n.cue.once;if(i||!r){const t=this.preloadAssets(n,e);if(null!=t&&t.interstitial.appendInPlace){const e=this.primaryMedia;e&&this.bufferAssetPlayer(t,e)}}}preloadAssets(t,e){const n=t.assetUrl,i=t.assetList.length,r=0===i&&!t.assetListLoader,s=t.cue.once;if(r){const r=t.timelineStart;if(t.appendInPlace){var a;const e=this.playingItem;this.isInterstitial(e)||(null==e||null==(a=e.nextEvent)?void 0:a.identifier)!==t.identifier||this.flushFrontBuffer(r+.25)}let s,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!t.cue.pre&&!t.cue.post){const t=o-r;t>0&&(s=Math.round(1e3*t)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${n?1:i} ${t}${s?` live-start: ${o} start-offset: ${s}`:""}`),n)return this.createAsset(t,0,0,r,t.duration,n);const l=this.assetListLoader.loadAssetList(t,s);l&&(t.assetListLoader=l)}else if(!s&&i){for(let n=e;n<i;n++){const e=t.assetList[n],i=this.getAssetPlayerQueueIndex(e.identifier);-1!==i&&!this.playerQueue[i].destroyed||e.error||this.createAssetPlayer(t,e,n)}const n=t.assetList[e];if(n){const t=this.getAssetPlayer(n.identifier);return t&&t.loadSource(),t}}return null}flushFrontBuffer(t){const e=this.requiredTracks;e&&(this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(e=>{this.hls.trigger(ca.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:e})}))}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let n=0;n<e.length;n++)if(t===e[n].assetId)return n;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e)for(let n=0;n<t.length;n++)if(t[n].media===e)return t[n];return null}createAsset(t,e,n,i,r,s){const a={parentIdentifier:t.identifier,identifier:gf(t,s,e),duration:r,startOffset:n,timelineStart:i,uri:s};return this.createAssetPlayer(t,a,e)}createAssetPlayer(t,e,n){const i=this.hls,r=i.userConfig;let s=r.videoPreference;const a=i.loadLevelObj||i.levels[i.currentLevel];(s||a)&&(s=Ea({},s),a.videoCodec&&(s.videoCodec=a.videoCodec),a.videoRange&&(s.allowedVideoRanges=[a.videoRange]));const o=i.audioTracks[i.audioTrack],l=i.subtitleTracks[i.subtitleTrack];let u=0;if(this.primaryLive||t.appendInPlace){const t=this.timelinePos-e.timelineStart;if(t>1){const n=e.duration;n&&t<n&&(u=t)}}const c=e.identifier,h=Sa(Sa({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:c,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:o||r.audioPreference,subtitlePreference:l||r.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(h.timelineOffset=e.timelineStart));const d=h.cmcd;null!=d&&d.sessionId&&d.contentId&&(h.cmcd=Ea({},d,{contentId:ff(e.uri)})),this.getAssetPlayer(c)&&this.warn(`Duplicate date range identifier ${t} and asset ${c}`);const f=new Tf(this.HlsPlayerClass,h,t,e);this.playerQueue.push(f),t.assetList[n]=e;let p=!0;const m=i=>{if(i.live){var r;const e=new Error(`Interstitials MUST be VOD assets ${t}`),i={fatal:!0,type:la.OTHER_ERROR,details:ua.INTERSTITIAL_ASSET_ITEM_ERROR,error:e},s=(null==(r=this.schedule)?void 0:r.findEventIndex(t.identifier))||-1;return void this.handleAssetItemError(i,t,s,n,e.message)}const s=i.edge-i.fragmentStart,a=e.duration;(p||null===a||s>a)&&(p=!1,this.log(`Interstitial asset "${c}" duration change ${a} > ${s}`),e.duration=s,this.updateSchedule())};f.on(ca.LEVEL_UPDATED,(t,{details:e})=>m(e)),f.on(ca.LEVEL_PTS_UPDATED,(t,{details:e})=>m(e)),f.on(ca.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const g=(t,e)=>{const n=this.getAssetPlayer(c);if(n&&e.tracks){n.off(ca.BUFFER_CODECS,g),n.tracks=e.tracks;const t=this.primaryMedia;this.bufferingAsset===n.assetItem&&t&&!n.media&&this.bufferAssetPlayer(n,t)}};f.on(ca.BUFFER_CODECS,g),f.on(ca.BUFFERED_TO_END,()=>{var n;const i=this.getAssetPlayer(c);if(this.log(`buffered to end of asset ${i}`),!i||!this.schedule)return;const r=this.schedule.findEventIndex(t.identifier),s=null==(n=this.schedule.items)?void 0:n[r];this.isInterstitial(s)&&this.advanceAssetBuffering(s,e)});const v=e=>()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;this.shouldPlay=!0;const n=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,n,e)};return f.once(ca.MEDIA_ENDED,v(n)),f.once(ca.PLAYOUT_LIMIT_REACHED,v(1/0)),f.on(ca.ERROR,(e,i)=>{if(!this.schedule)return;const r=this.getAssetPlayer(c);if(i.details===ua.BUFFER_STALLED_ERROR)return null!=r&&r.appendInPlace?void this.handleInPlaceStall(t):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(i,t,this.schedule.findEventIndex(t.identifier),n,`Asset player error ${i.error} ${t}`)}),f.on(ca.DESTROYING,()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;const e=new Error(`Asset player destroyed unexpectedly ${c}`),i={fatal:!0,type:la.OTHER_ERROR,details:ua.INTERSTITIAL_ASSET_ITEM_ERROR,error:e};this.handleAssetItemError(i,t,this.schedule.findEventIndex(t.identifier),n,e.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ef(e)}`),this.hls.trigger(ca.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:n,event:t,player:f}),f}clearInterstitial(t,e){t.assetList.forEach(t=>{this.clearAssetPlayer(t.identifier,e)}),t.reset()}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(-1!==e){this.log(`reset asset player "${t}" after error`);const n=this.playerQueue[e];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(t,e){const n=this.getAssetPlayerQueueIndex(t);if(-1!==n){const t=this.playerQueue[n];this.log(`clear ${t} toSegment: ${e?Df(e):e}`),this.transferMediaFromPlayer(t,e),this.playerQueue.splice(n,1),t.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,n,i,r){const{interstitial:s,assetItem:a,assetId:o}=t,l=s.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,u&&u.identifier===o||(u&&(this.clearAssetPlayer(u.identifier,n[i]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${l} ${Ef(a)}`),this.hls.trigger(ca.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:e,event:s,schedule:n.slice(0),scheduleIndex:i,player:t})),this.bufferAssetPlayer(t,r)}bufferAssetPlayer(t,e){var n,i;if(!this.schedule)return;const{interstitial:r,assetItem:s}=t,a=this.schedule.findEventIndex(r.identifier),o=null==(n=this.schedule.items)?void 0:n[a];if(!o)return;t.loadSource(),this.setBufferingItem(o),this.bufferingAsset=s;const l=this.getBufferingPlayer();if(l===t)return;const u=r.appendInPlace;if(u&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const c=(null==l?void 0:l.tracks)||(null==(i=this.detachedData)?void 0:i.tracks)||this.requiredTracks;if(u&&s!==this.playingAsset){if(!t.tracks)return void this.log(`Waiting for track info before buffering ${t}`);if(c&&!Pa(c,t.tracks)){const e=new Error(`Asset ${Ef(s)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(c)}')`),n={fatal:!0,type:la.OTHER_ERROR,details:ua.INTERSTITIAL_ASSET_ITEM_ERROR,error:e},i=r.findAssetIndex(s);return void this.handleAssetItemError(n,r,a,i,e.message)}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,n=this.primaryMedia;if(!e||!n)return;const i=n.currentTime,r=e.findAssetIndex(t,i),s=t.assetList[r];if(s){const a=this.getAssetPlayer(s.identifier);if(a){const o=a.currentTime||i-s.timelineStart,l=a.duration-o;if(this.warn(`Stalled at ${o} of ${o+l} in ${a} ${t} (media.currentTime: ${i})`),o&&(l/n.playbackRate<.5||a.bufferedInPlaceToEnd(n))&&a.hls){const n=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,n,r)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,n,i,r){if(t.details===ua.BUFFER_STALLED_ERROR)return;const s=e.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${s?Ef(s):s} ${t.error}`),!this.schedule)return;const a=(null==s?void 0:s.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,u=this.schedule.items,c=Ea({},t,{fatal:!1,errorAction:Sl(!0),asset:s,assetListIndex:i,event:e,schedule:u,scheduleIndex:n,player:l});if(this.hls.trigger(ca.INTERSTITIAL_ASSET_ERROR,c),!t.fatal)return;const h=this.playingAsset,d=this.bufferingAsset,f=new Error(r);if(s&&(this.clearAssetPlayer(a,null),s.error=f),e.assetList.some(t=>!t.error))for(let t=i;t<e.assetList.length;t++)this.resetAssetPlayer(e.assetList[t].identifier);else e.error=f;this.updateSchedule(!0),e.error?this.primaryFallback(e):h&&h.identifier===a?this.advanceAfterAssetEnded(e,n,i):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(t){const e=t.timelineStart,n=this.effectivePlayingItem;if(n){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${this.timelinePos} playing: ${Df(n)} error: ${t.error}`);let i=this.timelinePos;-1===i&&(i=this.hls.startPosition);const r=this.updateItem(n,i);if(this.itemsMatch(n,r)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e)),!this.schedule)return;const s=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(s)}else this.checkStart()}onAssetListLoaded(t,e){var n,i;const r=e.event,s=r.identifier,a=e.assetListResponse.ASSETS;if(null==(n=this.schedule)||!n.hasEvent(s))return;const o=r.timelineStart,l=r.duration;let u=0;a.forEach((t,e)=>{const n=parseFloat(t.DURATION);this.createAsset(r,e,u,o+u,n,t.URI),u+=n}),r.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${r}`);const c=this.waitingItem,h=(null==c?void 0:c.event.identifier)===s;this.updateSchedule();const d=null==(i=this.bufferingItem)?void 0:i.event;if(h){var f;const t=this.schedule.findEventIndex(s),e=null==(f=this.schedule.items)?void 0:f[t];if(e){if(!this.playingItem&&this.timelinePos>e.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==t)return r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.updateSchedule(!0),void this.primaryFallback(r);this.setBufferingItem(e)}this.setSchedulePosition(t)}else if((null==d?void 0:d.identifier)===s){const t=r.assetList[0];if(t){const e=this.getAssetPlayer(t.identifier);if(d.appendInPlace){const t=this.primaryMedia;e&&t&&this.bufferAssetPlayer(e,t)}else e&&e.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case ua.ASSET_LIST_PARSING_ERROR:case ua.ASSET_LIST_LOAD_ERROR:case ua.ASSET_LIST_LOAD_TIMEOUT:{const t=e.interstitial;t&&(this.updateSchedule(!0),this.primaryFallback(t));break}case ua.BUFFER_STALLED_ERROR:{const t=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(t)&&t.event.appendInPlace)return void this.handleInPlaceStall(t.event);this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Ip(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(Ip):Object.keys(t).reduce((e,n)=>(e[n]=Ip(t[n]),e),{}):t}class Pp extends zl{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var t;null!=(t=this.media)&&t.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var t;this.hls&&(this.ended=(null==(t=this.media)?void 0:t.currentTime)||1,this.hls.trigger(ca.MEDIA_ENDED,{stalled:!1}))},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(100),this.mediaSource=e.mediaSource;const n=this.media=e.media;ac(n,"playing",this.onMediaPlaying),ac(n,"waiting",this.onMediaWaiting),ac(n,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:n}=this;n&&(oc(n,"playing",this.onMediaPlaying),oc(n,"waiting",this.onMediaWaiting),oc(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(null==(t=this.media)||!t.readyState||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var n,i;const r=null==(n=this.hls)?void 0:n.config;if(!r)return;const s=this.media;if(!s)return;const{seeking:a}=s,o=this.seeking&&!a,l=!this.seeking&&a,u=s.paused&&!a||s.ended||0===s.playbackRate;if(this.seeking=a,t!==e)return e&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!u&&t>e&&this.nudgeOnVideoHole(t,e)),void(0===this.waiting&&this.stallResolved(t));if(l||o)return void(o&&this.stallResolved(t));if(u)return this.nudgeRetry=0,this.stallResolved(t),void(!this.ended&&s.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(ca.MEDIA_ENDED,{stalled:!1})));if(!Hl.getBuffered(s).length)return void(this.nudgeRetry=0);const c=Hl.bufferInfo(s,t,0),h=c.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const e=Rp(this.hls.inFlightFragments,t),n=c.len>2,i=!h||e||h-t>2&&!d.getPartialFragment(t);if(n||i)return;this.moved=!1}const f=null==(i=this.hls)?void 0:i.latestLevelDetails;if(!this.moved&&null!==this.stalled&&d){if(!(c.len>0||h))return;const e=Math.max(h,c.start||0)-t,n=null!=f&&f.live?2*f.targetduration:2,i=Mp(t,d);if(e>0&&(e<=n||i))return void(s.paused||this._trySkipBufferHole(i))}const p=r.detectStallWithCurrentTimeMs,m=self.performance.now(),g=this.waiting;let v=this.stalled;if(null===v){if(!(g>0&&m-g<p))return void(this.stalled=m);v=this.stalled=g}const y=m-v;if(!a&&(y>=p||g)&&this.hls){var _;if("ended"===(null==(_=this.mediaSource)?void 0:_.readyState)&&(null==f||!f.live)&&Math.abs(t-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=t||1,void this.hls.trigger(ca.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(c),!this.media||!this.hls)return}const b=Hl.bufferInfo(s,t,r.maxBufferHole);this._tryFixBufferStall(b,y,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(ca.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var n;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(n=this.buffered.audio)&&n.length&&i&&i.length>1&&t>i.end(0)){const n=Hl.bufferedInfo(Hl.timeRangesToArray(this.buffered.audio),t,0);if(n.len>1&&e>=n.start){const n=Hl.timeRangesToArray(i),r=Hl.bufferedInfo(n,e,0).bufferedIndex;if(r>-1&&r<n.length-1){const e=Hl.bufferedInfo(n,t,0).bufferedIndex,i=n[r].end,s=n[r+1].start;if((-1===e||e>r)&&s-i<1&&t-i<2){const n=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${i} -> ${s} buffered index: ${e}`);this.warn(n.message),this.media.currentTime+=1e-6;let r=Mp(t,this.fragmentTracker);r&&"fragment"in r?r=r.fragment:r||(r=void 0);const a=Hl.bufferInfo(this.media,t,0);this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,frag:r,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(t,e,n){var i,r;const{fragmentTracker:s,media:a}=this,o=null==(i=this.hls)?void 0:i.config;if(!a||!s||!o)return;const l=null==(r=this.hls)?void 0:r.latestLevelDetails,u=Mp(n,s);if((u||null!=l&&l.live&&n<l.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const c=t.buffered,h=this.adjacentTraversal(t,n);(c&&c.length>1&&t.len>o.maxBufferHole||t.nextStart&&(t.nextStart-n<o.maxBufferHole||h))&&(e>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const n=this.fragmentTracker,i=t.nextStart;if(n&&i){const t=n.getFragAtPos(e,ma),r=n.getFragAtPos(i,ma);if(t&&r)return r.sn-t.sn<2}return!1}_reportStall(t){const{hls:e,media:n,stallReported:i,stalled:r}=this;if(!i&&null!==r&&n&&e){this.stallReported=!0;const i=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${el(t)})`);this.warn(i.message),e.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:t.len,bufferInfo:t,stalled:{start:r}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:n,media:i}=this,r=null==(e=this.hls)?void 0:e.config;if(!i||!n||!r)return 0;const s=i.currentTime,a=Hl.bufferInfo(i,s,0),o=s<a.start?a.start:a.nextStart;if(o&&this.hls){const e=a.len<=r.maxBufferHole,u=a.len>0&&a.len<1&&i.readyState<3,c=o-s;if(c>0&&(e||u)){if(c>r.maxBufferHole){let e=!1;if(0===s){const t=n.getAppendedFrag(0,ma);t&&o<t.end&&(e=!0)}if(!e&&t){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(Rp(this.hls.inFlightFragments,o))return 0;let e=!1,i=t.end;for(;i<o;){const t=Mp(i,n);if(!t){e=!0;break}i+=t.duration}if(e)return 0}}const e=Math.max(o+.05,s+.1);if(this.warn(`skipping hole, adjusting currentTime from ${s} to ${e}`),this.moved=!0,i.currentTime=e,null==t||!t.gap){const n=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${e}`),i={type:la.MEDIA_ERROR,details:ua.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:n,reason:n.message,buffer:a.len,bufferInfo:a};t&&("fragment"in t?i.part=t:i.frag=t),this.hls.trigger(ca.ERROR,i)}return e}}return 0}_tryNudgeBuffer(t){const{hls:e,media:n,nudgeRetry:i}=this,r=null==e?void 0:e.config;if(!n||!r)return 0;const s=n.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const a=s+(i+1)*r.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${a}`);this.warn(o.message),n.currentTime=a,e.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:t.len,bufferInfo:t})}else{const n=new Error(`Playhead still not moving while enough data buffered @${s} after ${r.nudgeMaxRetry} nudges`);this.error(n.message),e.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.BUFFER_STALLED_ERROR,error:n,fatal:!0,buffer:t.len,bufferInfo:t})}}}function Rp(t,e){const n=Op(t.main);if(n&&n.start<=e)return n;const i=Op(t.audio);return i&&i.start<=e?i:null}function Op(t){if(!t)return null;switch(t.state){case uc:case lc:case gc:case vc:return null}return t.frag}function Mp(t,e){return e.getAppendedFrag(t,ma)||e.getPartialFragment(t)}function Fp(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Np(t,e,n,i,r){let s=new t(e,n,"");try{s.value=i,r&&(s.type=r)}catch(a){s=new t(e,n,el(r?Sa({type:r},i):i))}return s}const Bp=(()=>{const t=Fp();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Up{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(ca.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ca.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(ca.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(ca.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ca.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var n;this.media=e.media,!1===(null==(n=e.overrides)?void 0:n.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var t;const e=null==(t=this.hls)?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null,e.transferMedia||(this.id3Track&&(this.removeCues&&cf(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const n=t[e];if("metadata"===n.kind&&"id3"===n.label)return lf(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:i}=this.hls.config;if(!n&&!i)return;const{samples:r}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=Fp();if(s)for(let t=0;t<r.length;t++){const e=r[t].type;if(e===Zc.emsg&&!n||!i)continue;const a=Vc(r[t].data),o=r[t].pts;let l=o+r[t].duration;l>Bp&&(l=Bp),l-o<=0&&(l=o+.25);for(let t=0;t<a.length;t++){const n=a[t];if(!Kc(n)){this.updateId3CueEnds(o,e);const t=Np(s,o,l,n,e);t&&this.id3Track.addCue(t)}}}}updateId3CueEnds(t,e){var n;const i=null==(n=this.id3Track)?void 0:n.cues;if(i)for(let n=i.length;n--;){const r=i[n];r.type===e&&r.startTime<t&&r.endTime===Bp&&(r.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:n,type:i}){const{id3Track:r,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=s;if(r&&(a||o)){let t;t="audio"===i?t=>t.type===Zc.audioId3&&o:"video"===i?t=>t.type===Zc.emsg&&a:t=>t.type===Zc.audioId3&&o||t.type===Zc.emsg&&a,hf(r,e,n,t)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:s}=this.hls.config;if(!r)return;const a=Fp();if(n&&i&&!s){const{fragmentStart:e,fragmentEnd:i}=t;let r=this.assetCue;r?(r.startTime=e,r.endTime=i):a&&(r=this.assetCue=Np(a,e,i,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),r&&(r.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(r),r.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=t,u=Object.keys(l);let c=this.dateRangeCuesAppended;var h;if(o&&e)if(null!=(h=o.cues)&&h.length){const t=Object.keys(c).filter(t=>!u.includes(t));for(let e=t.length;e--;){var d;const n=t[e],i=null==(d=c[n])?void 0:d.cues;delete c[n],i&&Object.keys(i).forEach(t=>{const e=i[t];if(e){e.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(e)}catch(t){}}})}}else c=this.dateRangeCuesAppended={};const f=t.fragments[t.fragments.length-1];if(0!==u.length&&sa(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let t=0;t<u.length;t++){const e=u[t],n=l[e],i=n.startTime,r=c[e],o=(null==r?void 0:r.cues)||{};let h=(null==r?void 0:r.durationKnown)||!1,d=Bp;const{duration:f,endDate:p}=n;if(p&&null!==f)d=i+f,h=!0;else if(n.endOnNext&&!h){const t=u.reduce((t,e)=>{if(e!==n.id){const i=l[e];if(i.class===n.class&&i.startDate>n.startDate&&(!t||n.startDate<t.startDate))return i}return t},null);t&&(d=t.startTime,h=!0)}const m=Object.keys(n.attr);for(let t=0;t<m.length;t++){const l=m[t];if(!Jl(l))continue;const u=o[l];if(u)!h||null!=r&&r.durationKnown?Math.abs(u.startTime-i)>.01&&(u.startTime=i,u.endTime=d):u.endTime=d;else if(a){let t=n.attr[l];tu(l)&&(t=Ma(t));const r=Np(a,i,d,{key:l,data:t},Zc.dateRange);r&&(r.id=e,this.id3Track.addCue(r),o[l]=r,s&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||r.addEventListener("enter",this.onEventCueEnter)))}}c[e]={cues:o,dateRange:n,durationKnown:h}}}}}class $p{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,e=this.levelDetails;if(!t||!e)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:r}=this.config;if(!i||1===r||!e.live)return;const s=this.targetLatency;if(null===s)return;const a=n-s;if(a<Math.min(this.maxLatency,s+e.targetduration)&&a>.05&&this.forwardBufferLength>1){const e=Math.min(2,Math.max(1,r)),n=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,i=Math.min(e,Math.max(1,n));this.changeMediaPlaybackRate(t,i)}else 1!==t.playbackRate&&0!==t.playbackRate&&this.changeMediaPlaybackRate(t,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return(null==(t=this.hls)?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(void 0!==t.liveMaxLatencyDuration)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(null===t||null===this.hls)return null;const{holdBack:e,partHoldBack:n,targetduration:i}=t,{liveSyncDuration:r,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&n||e;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:s*i);const u=i;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(null===t||null===e)return null;const n=this.levelDetails;if(null===n)return null;const i=n.edge,r=t-e-this.edgeStalled,s=i-n.totalduration,a=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,r),a)}get drift(){const t=this.levelDetails;return null===t?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(null===t)return 0;const e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const n=t.buffered.length;return(n?t.buffered.end(n-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ca.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(ca.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ca.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ca.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var n;e.details===ua.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(n=this.levelDetails)&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var n,i;t.playbackRate!==e&&(null==(n=this.hls)||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(i=this.targetLatency)?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return null===t?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return null===t?null:t-this.currentTime}}class zp extends qh{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ca.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ca.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ca.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const n=this.hls.config.preferManagedMediaSource,i=[],r={},s={};let a=!1,o=!1,l=!1;e.levels.forEach(t=>{const e=t.attrs;let{audioCodec:u,videoCodec:c}=t;u&&(t.audioCodec=u=Fo(u,n)||void 0),c&&(c=t.videoCodec=function(t){const e=t.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&"avc1"===n[0]&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}(c));const{width:h,height:d,unknownCodecs:f}=t,p=(null==f?void 0:f.length)||0;if(a||(a=!(!h||!d)),o||(o=!!c),l||(l=!!u),p||u&&!this.isAudioSupported(u)||c&&!this.isVideoSupported(c))return void this.log(`Some or all CODECS not supported "${e.CODECS}"`);const{CODECS:m,"FRAME-RATE":g,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:_,"VIDEO-RANGE":b}=e,E=`${y||"."}-${t.bitrate}-${_}-${g}-${m}-${b}-${v}`;if(r[E])if(r[E].uri===t.url||t.attrs["PATHWAY-ID"])r[E].addGroupId("audio",e.AUDIO),r[E].addGroupId("text",e.SUBTITLES);else{const e=s[E]+=1;t.attrs["PATHWAY-ID"]=new Array(e+1).join(".");const n=this.createLevel(t);r[E]=n,i.push(n)}else{const e=this.createLevel(t);r[E]=e,s[E]=1,i.push(e)}}),this.filterAndSortMediaOptions(i,e,a,o,l)}createLevel(t){const e=new Jo(t),n=t.supplemental;if(null!=n&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const t=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(t.message),e.supportedResult=Ho(t,[])}return e}isAudioSupported(t){return xo(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return xo(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,n,i,r){var s;let a=[],o=[],l=t;const u=(null==(s=e.stats)?void 0:s.parsing)||{};if((n||i)&&r&&(l=l.filter(({videoCodec:t,videoRange:e,width:n,height:i})=>{return(!!t||!(!n||!i))&&!!(r=e)&&qo.indexOf(r)>-1;var r})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let t="no level with compatible codecs found in manifest",n=t;e.levels.length&&(n=`one or more CODECS in variant not supported: ${el(e.levels.map(t=>t.attrs.CODECS).filter((t,e,n)=>n.indexOf(t)===e))}`,this.warn(n),t+=` (${n})`);const i=new Error(t);this.hls.trigger(ca.ERROR,{type:la.MEDIA_ERROR,details:ua.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:i,reason:n})}}),void(u.end=performance.now());e.audioTracks&&(a=e.audioTracks.filter(t=>!t.audioCodec||this.isAudioSupported(t.audioCodec)),Gp(a)),e.subtitles&&(o=e.subtitles,Gp(o));const c=l.slice(0);l.sort((t,e)=>{if(t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"])return(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&t.height!==e.height)return t.height-e.height;if(t.frameRate!==e.frameRate)return t.frameRate-e.frameRate;if(t.videoRange!==e.videoRange)return qo.indexOf(t.videoRange)-qo.indexOf(e.videoRange);if(t.videoCodec!==e.videoCodec){const n=Po(t.videoCodec),i=Po(e.videoCodec);if(n!==i)return i-n}if(t.uri===e.uri&&t.codecSet!==e.codecSet){const n=Ro(t.codecSet),i=Ro(e.codecSet);if(n!==i)return i-n}return t.averageBitrate!==e.averageBitrate?t.averageBitrate-e.averageBitrate:0});let h=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(let t=0;t<c.length;t++)if(c[t].pathwayId===l[0].pathwayId){h=c[t];break}this._levels=l;for(let t=0;t<l.length;t++)if(l[t]===h){var d;this._firstLevel=t;const e=h.bitrate,n=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${e}`),void 0===(null==(d=this.hls.userConfig)?void 0:d.abrEwmaDefaultEstimate)){const t=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);t>n&&n===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=t)}break}const f=r&&!i,p=this.hls.config,m=!(!p.audioStreamController||!p.audioTrackController),g={levels:l,audioTracks:a,subtitleTracks:o,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:r,video:i,altAudio:m&&!f&&a.some(t=>!!t.url)};u.end=performance.now(),this.hls.trigger(ca.MANIFEST_PARSED,g)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(0===e.length)return;if(t<0||t>=e.length){const n=new Error("invalid level idx"),i=t<0;if(this.hls.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.LEVEL_SWITCH_ERROR,level:t,fatal:i,error:n,reason:n.message}),i)return;t=Math.min(t,e.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,s=e[t],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=s,n===t&&i&&r===a)return;this.log(`Switching to level ${t} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${a?" with Pathway "+a:""} from level ${n}${r?" with Pathway "+r:""}`);const o={level:t,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(ca.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const t=this.switchParams(s.uri,null==i?void 0:i.details,l);this.loadPlaylist(t)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(void 0===this._startLevel){const t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),n=t.filter(t=>-1!==e.indexOf(t));if(t.length<1)return void this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);this.steering.pathwayPriority=n}}onError(t,e){!e.fatal&&e.context&&e.context.type===da&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(void 0!==e&&e.type===ma){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return;const n=this._levels[e.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(t,e){var n;const{level:i,details:r}=e,s=e.levelInfo;var a;if(!s)return this.warn(`Invalid level index ${i}`),void(null!=(a=e.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));if(s===this.currentLevel||e.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let t=s.details;t===e.details&&t.advanced&&(t=void 0),this.playlistLoaded(i,e,t)}else null!=(n=e.deliveryDirectives)&&n.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const n=this.getUrlWithDirectives(t.uri,e),i=this.currentLevelIndex,r=t.attrs["PATHWAY-ID"],s=t.details,a=null==s?void 0:s.age;this.log(`Loading level index ${i}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""}${r?" Pathway "+r:""}${a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""} ${n}`),this.hls.trigger(ca.LEVEL_LOADING,{url:n,level:i,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(1===this._levels.length)return;const n=this._levels.filter((e,n)=>n!==t||(this.steering&&this.steering.removeLevel(e),e===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,e.details&&e.details.fragments.forEach(t=>t.level=-1)),!1));Qu(n),this._levels=n,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=n.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(ca.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(ca.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function Gp(t){const e={};t.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function jp(){return self.SourceBuffer||self.WebKitSourceBuffer}function Hp(){if(!Ia())return!1;const t=jp();return!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove}class Vp extends bc{constructor(t,e,n){super(t,e,n,"stream-controller",ma),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const t=this.media,e=t?t.currentTime:null;if(null===e||!sa(e))return;if(this.log(`Media seeked to ${e.toFixed(3)}`),!this.getBufferedFrag(e))return;const n=this.getFwdBufferInfoAtPos(t,e,ma,0);null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length at ${e} on "seeked" event ${n?n.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ca.LEVEL_LOADING,this.onLevelLoading,this),t.on(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ca.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ca.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(ca.BUFFER_CREATED,this.onBufferCreated,this),t.on(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ca.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(ca.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ca.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ca.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(ca.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ca.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(ca.BUFFER_CREATED,this.onBufferCreated,this),t.off(ca.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ca.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ca.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:n,hls:i}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let t=i.startLevel;-1===t&&(i.config.testBandwidth&&this.levels.length>1?(t=0,this.bitrateTest=!0):t=i.firstAutoLevel),i.nextLoadLevel=t,this.level=i.loadLevel,this._hasEnoughToStart=!!e}n>0&&-1===t&&!e&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),t=n),this.state=uc,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=lc}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case _c:{const{levels:t,level:e}=this,n=null==t?void 0:t[e],i=null==n?void 0:n.details;if(i&&(!i.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(i))break;this.state=uc;break}if(this.hls.nextLoadLevel!==this.level){this.state=uc;break}break}case dc:this.checkRetryDate()}this.state===uc&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),null!=(t=this.media)&&t.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:n,media:i}=this;if(null===e||!i&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?t.nextLoadLevel:t.loadLevel;if(null==n||!n[r])return;const s=n[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const t={};return 2===this.altAudio&&(t.type="video"),this.hls.trigger(ca.BUFFER_EOS,t),void(this.state=gc)}if(!this.buffering)return;t.loadLevel!==r&&-1===t.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=t.nextLoadLevel=r;const l=s.details;if(!l||this.state===_c||this.waitForLive(s))return this.level=r,this.state=_c,void(this.startFragRequested=!1);const u=a.len,c=this.getMaxBufferLength(s.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&d&&qa(d)&&this.fragmentTracker.getState(d)!==kl){var f;const t=(null!=(f=this.backtrackFragment)?f:d).sn-l.startSN,e=l.fragments[t-1];e&&d.cc===e.cc&&(d=e,this.fragmentTracker.removeFragment(e))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,h)){if(!d.gap){const t=this.audioOnly&&!this.altAudio?Ka:Wa,e=(t===Wa?this.videoBuffer:this.mediaBuffer)||this.media;e&&this.afterBufferFlushed(e,t,ma)}d=this.getNextFragmentLoopLoading(d,l,a,ma,c)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),this.loadFragment(d,s,h))}loadFragment(t,e,n){const i=this.fragmentTracker.getState(t);i===Dl||i===Ll?qa(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,n):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,ma)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(null!=e&&e.readyState){let n;const i=this.getAppendedFrag(e.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const t=this.getMainFwdBufferInfo();if(!t||t.len<2*r.targetduration)return}if(!e.paused&&t){const e=t[this.hls.nextLoadLevel],i=this.fragLastKbps;n=i&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*i)+1:0}else n=0;const s=this.getBufferedFrag(e.currentTime+n);if(s){const t=this.followingBufferedFrag(s);if(t){this.abortCurrentFrag();const e=t.maxStartPTS?t.maxStartPTS:t.start,n=t.duration,i=Math.max(s.end,e+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case cc:case hc:case dc:case pc:case mc:this.state=uc}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,2===this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const n=e.media;ac(n,"playing",this.onMediaPlaying),ac(n,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:n}=this;n&&(oc(n,"playing",this.onMediaPlaying),oc(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),e.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(ca.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let n=!1,i=!1;for(let t=0;t<e.levels.length;t++){const r=e.levels[t].audioCodec;r&&(n=n||-1!==r.indexOf("mp4a.40.2"),i=i||-1!==r.indexOf("mp4a.40.5"))}this.audioCodecSwitch=n&&i&&!function(){var t;const e=jp();return"function"==typeof(null==e||null==(t=e.prototype)?void 0:t.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:n}=this;if(!n||this.state!==uc)return;const i=e.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=_c)}onLevelLoaded(t,e){var n;const{levels:i,startFragRequested:r}=this,s=e.level,a=e.details,o=a.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${s}`);this.log(`Level ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=e.levelInfo,u=this.fragCurrent;!u||this.state!==hc&&this.state!==dc||u.level!==e.level&&u.loader&&this.abortCurrentFrag();let c=0;if(a.live||null!=(n=l.details)&&n.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;c=this.alignPlaylists(a,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=a,this.levelLastLoaded=l,r||this.setStartPosition(a,c),this.hls.trigger(ca.LEVEL_UPDATED,{details:a,level:s}),this.state===_c){if(this.waitForCdnTuneIn(a))return;this.state=uc}r&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),s=t.fragmentStart,a=t.edge,o=r>=s-e.maxFragLookUpTolerance&&r<=a;if(null!==i&&n.duration>i&&(r<i||!o)){const s=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!o&&n.readyState<4||r<a-s)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),n.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var l;const t=Hl.bufferInfo(n,i,0);if(null==(l=t.buffered)||!l.length)return void(n.currentTime=i);if(t.start<=r)return void(n.currentTime=i);const{nextStart:e}=Hl.bufferedInfo(t.buffered,r,0);e&&(n.currentTime=e)}else n.currentTime=i}}_handleFragmentLoadProgress(t){var e;const n=t.frag,{part:i,payload:r}=t,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const a=s[n.level];if(!a)return void this.warn(`Level ${n.level} not found on progress`);const o=a.details;if(!o)return this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),void this.fragmentTracker.removeFragment(n);const l=a.videoCodec,u=o.PTSKnown||!o.live,c=null==(e=n.initSegment)?void 0:e.data,h=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new Zh(this.hls,ma,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,p=-1!==f,m=new Gl(n.level,n.sn,n.stats.chunkCount,r.byteLength,f,p),g=this.initPTS[n.cc];d.push(r,c,h,l,n,i,o.totalduration,u,m,g)}onAudioTrackSwitching(t,e){const n=this.hls,i=2===this.altAudio;if(ul(e.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const t=this.fragCurrent;t&&(this.log("Switching to main audio track, cancel main fragment load"),t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i)return this.fragmentTracker.removeAllFragments(),n.once(ca.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(ca.AUDIO_TRACK_SWITCHED,e)}),void n.trigger(ca.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(ca.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const n=ul(e.url,this.hls);if(n){const t=this.videoBuffer;t&&this.mediaBuffer!==t&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t)}this.altAudio=n?2:0,this.tick()}onBufferCreated(t,e){const n=e.tracks;let i,r,s=!1;for(const t in n){const e=n[t];if("main"===e.id){if(r=t,i=e,"video"===t){const e=n[t];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:n,part:i}=e,r=n.type===ma;if(r){if(this.fragContextChanged(n))return this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===mc&&(this.state=uc));const t=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*t.total/(t.buffering.end-t.loading.first)),qa(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}const s=this.media;s&&(!this._hasEnoughToStart&&Hl.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var n;if(e.fatal)this.state=vc;else switch(e.details){case ua.FRAG_GAP:case ua.FRAG_PARSING_ERROR:case ua.FRAG_DECRYPT_ERROR:case ua.FRAG_LOAD_ERROR:case ua.FRAG_LOAD_TIMEOUT:case ua.KEY_LOAD_ERROR:case ua.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ma,e);break;case ua.LEVEL_LOAD_ERROR:case ua.LEVEL_LOAD_TIMEOUT:case ua.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==_c||(null==(n=e.context)?void 0:n.type)!==da||(this.state=uc);break;case ua.BUFFER_ADD_CODEC_ERROR:case ua.BUFFER_APPEND_ERROR:if("main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case ua.BUFFER_FULL_ERROR:if("main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case ua.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onFragLoadEmergencyAborted(){this.state=uc,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Ka||!this.altAudio){const t=(e===Wa?this.videoBuffer:this.mediaBuffer)||this.media;t&&(this.afterBufferFlushed(t,e,ma),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let n=this.startPosition;if(n>=0&&e<n){if(t.seeking)return void this.log(`could not seek to ${n}, already seeking at ${e}`);const i=this.timelineOffset;i&&n&&(n+=i);const r=this.getLevelDetails(),s=Hl.getBuffered(t),a=s.length?s.start(0):0,o=a-n,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==r?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),n+=o,this.startPosition=n),e<n&&(this.log(`seek to target start position ${n} from current time ${e} buffer start ${a}`),t.currentTime=n)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(t=>{const{hls:n}=this,i=null==t?void 0:t.frag;if(!i||this.fragContextChanged(i))return;e.fragmentError=0,this.state=uc,this.startFragRequested=!1,this.bitrateTest=!1;const r=i.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),n.trigger(ca.FRAG_LOADED,t),i.bitrateTest=!1}).catch(e=>{this.state!==lc&&this.state!==vc&&(this.warn(e),this.resetFragmentLoading(t))})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:n}=this,{remuxResult:i,chunkMeta:r}=t,s=this.getCurrentContext(r);if(!s)return void this.resetWhenMissingContext(r);const{frag:a,part:o,level:l}=s,{video:u,text:c,id3:h,initSegment:d}=i,{details:f}=l,p=this.altAudio?void 0:i.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=pc,d){const t=d.tracks;if(t){const i=a.initSegment||a;if(this.unhandledEncryptionError(d,a))return;this._bufferInitSegment(l,t,i,r),n.trigger(ca.FRAG_PARSING_INIT_SEGMENT,{frag:i,id:e,tracks:t})}const i=d.initPTS,s=d.timescale,o=this.initPTS[a.cc];if(sa(i)&&(!o||o.baseTime!==i||o.timescale!==s)){const t=d.trackId;this.initPTS[a.cc]={baseTime:i,timescale:s,trackId:t},n.trigger(ca.INIT_PTS_FOUND,{frag:a,id:e,initPTS:i,timescale:s,trackId:t})}}if(u&&f){p&&"audiovideo"===u.type&&this.logMuxedErr(a);const t=f.fragments[a.sn-1-f.startSN],e=a.sn===f.startSN,n=!t||a.cc>t.cc;if(!1!==i.independent){const{startPTS:t,endPTS:i,startDTS:s,endDTS:l}=u;if(o)o.elementaryStreams[u.type]={startPTS:t,endPTS:i,startDTS:s,endDTS:l};else if(u.firstKeyFrame&&u.independent&&1===r.id&&!n&&(this.couldBacktrack=!0),u.dropped&&u.independent){const r=this.getMainFwdBufferInfo(),s=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,o=u.firstKeyFramePTS?u.firstKeyFramePTS:t;if(!e&&s<o-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(u.type,a.start,i,a.start,l,!0)}else e&&t-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(u.type,t,i,s,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,o,r,e||n)}else{if(!e&&!n)return void this.backtrack(a);a.gap=!0}}if(p){const{startPTS:t,endPTS:e,startDTS:n,endDTS:i}=p;o&&(o.elementaryStreams[Ka]={startPTS:t,endPTS:e,startDTS:n,endDTS:i}),a.setElementaryStreamInfo(Ka,t,e,n,i),this.bufferFragmentData(p,a,o,r)}if(f&&null!=h&&h.samples.length){const t={id:e,frag:a,details:f,samples:h.samples};n.trigger(ca.FRAG_PARSING_METADATA,t)}if(f&&c){const t={id:e,frag:a,details:f,samples:c.samples};n.trigger(ca.FRAG_PARSING_USERDATA,t)}}}logMuxedErr(t){this.warn(`${qa(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,n,i){if(this.state!==pc)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(n));const{audio:r,video:s,audiovideo:a}=e;if(r){const n=t.audioCodec;let i=No(r.codec,n);"mp4a"===i&&(i="mp4a.40.5");const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){i&&(i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const t=r.metadata;t&&"channelCount"in t&&1!==(t.channelCount||1)&&-1===s.indexOf("firefox")&&(i="mp4a.40.5")}i&&-1!==i.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==r.container&&(i="mp4a.40.2",this.log(`Android: force audio codec to ${i}`)),n&&n!==i&&this.log(`Swapping manifest audio codec "${n}" for "${i}"`),r.levelCodec=i,r.id=ma,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${i||""}/${n||""}/${r.codec}]`),delete e.audiovideo}if(s){s.levelCodec=t.videoCodec,s.id=ma;const n=s.codec;if(4===(null==n?void 0:n.length))switch(n){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${t.videoCodec||""}/${n}]${s.codec!==n?" parsed-corrected="+s.codec:""}${s.supplemental?" supplemental="+s.supplemental:""}`),delete e.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${t.codecs}/${a.codec}]`),delete e.video,delete e.audio);const o=Object.keys(e);if(o.length){if(this.hls.trigger(ca.BUFFER_CODECS,e),!this.hls)return;o.forEach(t=>{const r=e[t].initSegment;null!=r&&r.byteLength&&this.hls.trigger(ca.BUFFER_APPENDING,{type:t,data:r,frag:n,part:null,chunkMeta:i,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,ma)}get maxBufferLength(){const{levels:t,level:e}=this,n=null==t?void 0:t[e];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=uc}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&!1===t.seeking){const n=t.currentTime;if(Hl.isBuffered(t,n)?e=this.getAppendedFrag(n):Hl.isBuffered(t,n+.1)&&(e=this.getAppendedFrag(n+.1)),e){this.backtrackFragment=null;const t=this.fragPlaying,n=e.level;t&&e.sn===t.sn&&t.level===n||(this.fragPlaying=e,this.hls.trigger(ca.FRAG_CHANGED,{frag:e}),t&&t.level===n||this.hls.trigger(ca.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;return sa(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;if(sa(e)){const t=this.getLevelDetails(),n=this.currentFrag||(t?hl(null,t.fragments,e):null);if(n){const t=n.programDateTime;if(null!==t){const i=t+1e3*(e-n.start);return new Date(i)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class Kp extends Da{constructor(t,e){super("key-loader",e),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const n in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[n].loader;if(i){var e;if(t&&t!==(null==(e=i.context)?void 0:e.frag.type))return;i.abort()}}}detach(){for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(t,e=ua.KEY_LOAD_ERROR,n,i,r){return new $l({type:la.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:r,error:n,networkDetails:i})}loadClear(t,e,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let i=0,r=e.length;i<r;i++){const s=e[i];if(t.cc<=s.cc&&(!qa(t)||!qa(s)||t.sn<s.sn)||!n&&i==r-1)return this.emeController.selectKeySystemFormat(s).then(t=>{if(!this.emeController)return;s.setKeyFormat(t);const e=vu(t);return e?this.emeController.getKeySystemAccess([e]):void 0})}if(this.config.requireKeySystemAccessOnStart){const t=_u(this.config);if(t.length)return this.emeController.getKeySystemAccess(t)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var n,i;e&&t.setKeyFormat(e);const r=t.decryptdata;if(!r){const n=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(t,ua.KEY_LOAD_ERROR,n))}const s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(t,ua.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));const a=Wp(r);let o=this.keyIdToKeyInfo[a];if(null!=(n=o)&&n.decryptdata.key)return r.key=o.decryptdata.key,Promise.resolve({frag:t,keyInfo:o});if(this.emeController&&null!=(i=o)&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(e=>{const{keyInfo:n}=e;return r.key=n.decryptdata.key,{frag:t,keyInfo:n}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${r.keyId?" keyId: "+Oa(r.keyId):""} URI: ${r.uri} from ${t.type} ${t.level}`),o=this.keyIdToKeyInfo[a]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(o,t):this.loadKeyEME(o,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,t);default:return Promise.reject(this.createKeyLoadError(t,ua.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(t,e){const n={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var i;if(!t.decryptdata.keyId&&null!=(i=e.initSegment)&&i.data){const n=function(t){const e=[];return vo(t,t=>e.push(t.subarray(8,24))),e}(e.initSegment.data);if(n.length){const e=n[0];e.some(t=>0!==t)&&(this.log(`Using keyId found in init segment ${Oa(e)}`),t.decryptdata.keyId=e,Du.setKeyIdForUri(t.decryptdata.uri,e))}}const r=this.emeController.loadKey(n);return(t.keyLoadPromise=r.then(e=>(t.mediaKeySessionContext=e,n))).catch(n=>{throw t.keyLoadPromise=null,"data"in n&&(n.data.frag=e),n})}return Promise.resolve(n)}loadKeyHTTP(t,e){const n=this.config,i=new(0,n.loader)(n);return e.keyLoader=t.loader=i,t.keyLoadPromise=new Promise((r,s)=>{const a={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},o=n.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,e,n,i)=>{const{frag:a,keyInfo:o}=n,l=Wp(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return s(this.createKeyLoadError(a,ua.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=a.decryptdata.key=new Uint8Array(t.data),a.keyLoader=null,o.loader=null,r({frag:a,keyInfo:o})},onError:(t,n,i,r)=>{this.resetLoader(n),s(this.createKeyLoadError(e,ua.KEY_LOAD_ERROR,new Error(`HTTP Error ${t.code} loading key ${t.text}`),i,Sa({url:a.url,data:void 0},t)))},onTimeout:(t,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(e,ua.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:(t,n,i)=>{this.resetLoader(n),s(this.createKeyLoadError(e,ua.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,l,u)})}resetLoader(t){const{frag:e,keyInfo:n,url:i}=t,r=n.loader;e.keyLoader===r&&(e.keyLoader=null,n.loader=null);const s=Wp(n.decryptdata)||i;delete this.keyIdToKeyInfo[s],r&&r.destroy()}}function Wp(t){if(t.keyFormat!==pu){const e=t.keyId;if(e)return Oa(e)}return t.uri}function Yp(t){const{type:e}=t;switch(e){case fa:return ga;case pa:return va;default:return ma}}function Zp(t,e){let n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n}class qp{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ca.LEVEL_LOADING,this.onLevelLoading,this),t.on(ca.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(ca.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(ca.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(ca.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ca.LEVEL_LOADING,this.onLevelLoading,this),t.off(ca.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(ca.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(ca.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,n=e.pLoader,i=e.loader,r=new(n||i)(e);return this.loaders[t.type]=r,r}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:n}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ha,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:n,level:i,pathwayId:r,url:s,deliveryDirectives:a,levelInfo:o}=e;this.load({id:n,level:i,pathwayId:r,responseType:"text",type:da,url:s,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(t,e){const{id:n,groupId:i,url:r,deliveryDirectives:s,track:a}=e;this.load({id:n,groupId:i,level:null,responseType:"text",type:fa,url:r,deliveryDirectives:s,levelOrTrack:a})}onSubtitleTrackLoading(t,e){const{id:n,groupId:i,url:r,deliveryDirectives:s,track:a}=e;this.load({id:n,groupId:i,level:null,responseType:"text",type:pa,url:r,deliveryDirectives:s,levelOrTrack:a})}onLevelsUpdated(t,e){const n=this.loaders[da];if(n){const t=n.context;t&&!e.levels.some(e=>e===t.levelOrTrack)&&(n.abort(),delete this.loaders[da])}}load(t){var e;const n=this.hls.config;let i,r=this.getInternalLoader(t);if(r){const e=this.hls.logger,n=r.context;if(n&&n.levelOrTrack===t.levelOrTrack&&(n.url===t.url||n.deliveryDirectives&&!t.deliveryDirectives))return void(n.url===t.url?e.log(`[playlist-loader]: ignore ${t.url} ongoing request`):e.log(`[playlist-loader]: ignore ${t.url} in favor of ${n.url}`));e.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),r.abort()}if(i=t.type===ha?n.manifestLoadPolicy.default:Ea({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),sa(null==(e=t.deliveryDirectives)?void 0:e.part)){let e;if(t.type===da&&null!==t.level?e=this.hls.levels[t.level].details:t.type===fa&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===pa&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e){const t=e.partTarget,n=e.targetduration;if(t&&n){const e=1e3*Math.max(3*t,.8*n);i=Ea({},i,{maxTimeToFirstByteMs:Math.min(e,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(e,i.maxTimeToFirstByteMs)})}}}const s=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(t,e,n,i)=>{const r=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=t.data;e.parsing.start=performance.now(),Iu.isMediaPlaylist(s)||n.type!==ha?this.handleTrackOrLevelPlaylist(t,e,n,i||null,r):this.handleMasterPlaylist(t,e,n,i)},onError:(t,e,n,i)=>{this.handleNetworkError(e,n,!1,t,i)},onTimeout:(t,e,n)=>{this.handleNetworkError(e,n,!0,void 0,t)}};r.load(t,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:n}=this.hls;(t||n)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,n,i){const r=this.hls,s=t.data,a=Zp(t,n),o=Iu.parseMasterPlaylist(s,a);if(o.playlistParsingError)return e.parsing.end=performance.now(),void this.handleManifestParsingError(t,n,o.playlistParsingError,i,e);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:h,startTimeOffset:d,variableList:f}=o;this.variableList=f,u.forEach(t=>{const{unknownCodecs:e}=t;if(e){const{preferManagedMediaSource:n}=this.hls.config;let{audioCodec:i,videoCodec:r}=t;for(let s=e.length;s--;){const a=e[s];xo(a,"audio",n)?(t.audioCodec=i=i?`${i},${a}`:a,ko.audio[i.substring(0,4)]=2,e.splice(s,1)):xo(a,"video",n)&&(t.videoCodec=r=r?`${r},${a}`:a,ko.video[r.substring(0,4)]=2,e.splice(s,1))}}});const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":g}=Iu.parseMasterPlaylistMedia(s,a,o);p.length&&(p.some(t=>!t.url)||!u[0].audioCodec||u[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ql({}),bitrate:0,url:""}))),r.trigger(ca.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:g,contentSteering:l,url:a,stats:e,networkDetails:i,sessionData:c,sessionKeys:h,startTimeOffset:d,variableList:f})}handleTrackOrLevelPlaylist(t,e,n,i,r){const s=this.hls,{id:a,level:o,type:l}=n,u=Zp(t,n),c=sa(o)?o:sa(a)?a:0,h=Yp(n),d=Iu.parseLevelPlaylist(t.data,u,c,h,0,this.variableList);if(l===ha){const t={attrs:new Ql({}),bitrate:0,details:d,name:"",url:u};d.requestScheduled=e.loading.start+Yu(d,0),s.trigger(ca.MANIFEST_LOADED,{levels:[t],audioTracks:[],url:u,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,t,e,n,i,r)}handleManifestParsingError(t,e,n,i,r){this.hls.trigger(ca.ERROR,{type:la.NETWORK_ERROR,details:ua.MANIFEST_PARSING_ERROR,fatal:e.type===ha,url:t.url,err:n,error:n,reason:n.message,response:t,context:e,networkDetails:i,stats:r})}handleNetworkError(t,e,n=!1,i,r){let s=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${t.type}`;t.type===da?s+=`: ${t.level} id: ${t.id}`:t.type!==fa&&t.type!==pa||(s+=` id: ${t.id} group-id: "${t.groupId}"`);const a=new Error(s);this.hls.logger.warn(`[playlist-loader]: ${s}`);let o=ua.UNKNOWN,l=!1;const u=this.getInternalLoader(t);switch(t.type){case ha:o=n?ua.MANIFEST_LOAD_TIMEOUT:ua.MANIFEST_LOAD_ERROR,l=!0;break;case da:o=n?ua.LEVEL_LOAD_TIMEOUT:ua.LEVEL_LOAD_ERROR,l=!1;break;case fa:o=n?ua.AUDIO_TRACK_LOAD_TIMEOUT:ua.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case pa:o=n?ua.SUBTITLE_TRACK_LOAD_TIMEOUT:ua.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(t.type);const c={type:la.NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:u,context:t,error:a,networkDetails:e,stats:r};if(i){const n=(null==e?void 0:e.url)||t.url;c.response=Sa({url:n,data:void 0},i)}this.hls.trigger(ca.ERROR,c)}handlePlaylistLoaded(t,e,n,i,r,s){const a=this.hls,{type:o,level:l,levelOrTrack:u,id:c,groupId:h,deliveryDirectives:d}=i,f=Zp(e,i),p=Yp(i);let m="number"==typeof i.level&&p===ma?l:void 0;const g=t.playlistParsingError;if(g){if(this.hls.logger.warn(`${g} ${t.url}`),!a.config.ignorePlaylistParsingErrors)return void a.trigger(ca.ERROR,{type:la.NETWORK_ERROR,details:ua.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:e,context:i,level:m,parent:p,networkDetails:r,stats:n});t.playlistParsingError=null}if(!t.fragments.length){const s=t.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(ca.ERROR,{type:la.NETWORK_ERROR,details:ua.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:s,reason:s.message,response:e,context:i,level:m,parent:p,networkDetails:r,stats:n})}switch(t.live&&s&&(s.getCacheAge&&(t.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),o){case ha:case da:if(m)if(u){if(u!==a.levels[m]){const t=a.levels.indexOf(u);t>-1&&(m=t)}}else m=0;a.trigger(ca.LEVEL_LOADED,{details:t,levelInfo:u||a.levels[0],level:m||0,id:c||0,stats:n,networkDetails:r,deliveryDirectives:d,withoutMultiVariant:o===ha});break;case fa:a.trigger(ca.AUDIO_TRACK_LOADED,{details:t,track:u,id:c||0,groupId:h||"",stats:n,networkDetails:r,deliveryDirectives:d});break;case pa:a.trigger(ca.SUBTITLE_TRACK_LOADED,{details:t,track:u,id:c||0,groupId:h||"",stats:n,networkDetails:r,deliveryDirectives:d})}}}class Xp{static get version(){return kc}static isMSESupported(){return Hp()}static isSupported(){return function(){if(!Hp())return!1;const t=Ia();return"function"==typeof(null==t?void 0:t.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(Io(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(Io(e,"audio"))))}()}static getMediaSource(){return Ia()}static get Events(){return ca}static get MetadataSchema(){return Zc}static get ErrorTypes(){return la}static get ErrorDetails(){return ua}static get DefaultConfig(){return Xp.defaultConfig?Xp.defaultConfig:Cp}static set DefaultConfig(t){Xp.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Lc,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=function(t,e,n){const i=ka();if("object"==typeof console&&!0===t||"object"==typeof t){const e=["debug","log","info","warn","error"];e.forEach(e=>{i[e]=Aa(e,t,n)});try{i.log('Debug logs enabled for "Hls instance" in hls.js version 1.6.14')}catch(t){return ka()}e.forEach(e=>{xa[e]=Aa(e,t)})}else Ea(xa,i);return i}(t.debug||!1,0,t.assetPlayerId),n=this.config=function(t,e,n){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Ip(t),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(t=>{const s=`${"level"===t?"playlist":t}LoadPolicy`,a=void 0===e[s],o=[];r.forEach(n=>{const r=`${t}Loading${n}`,l=e[r];if(void 0!==l&&a){o.push(r);const t=i[s].default;switch(e[s]={default:t},n){case"TimeOut":t.maxLoadTimeMs=l,t.maxTimeToFirstByteMs=l;break;case"MaxRetry":t.errorRetry.maxNumRetry=l,t.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":t.errorRetry.retryDelayMs=l,t.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":t.errorRetry.maxRetryDelayMs=l,t.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&n.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${s}": ${el(e[s])}`)}),Sa(Sa({},i),e)}(Xp.DefaultConfig,t,e);this.userConfig=t,n.progressive&&function(t,e){const n=t.loader;n!==wp&&n!==xp?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}()&&(t.loader=wp,t.progressive=!0,t.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}(n,e);const{abrController:i,bufferController:r,capLevelController:s,errorController:a,fpsController:o}=n,l=new a(this),u=this.abrController=new i(this),c=new Al(this),h=n.interstitialsController,d=h?this.interstitialsController=new h(this,Xp):null,f=this.bufferController=new r(this,c),p=this.capLevelController=new s(this),m=new o(this),g=new qp(this),v=n.contentSteeringController,y=v?new v(this):null,_=this.levelController=new zp(this,y),b=new Up(this),E=new Kp(this.config,this.logger),T=this.streamController=new Vp(this,c,E),S=this.gapController=new Pp(this,c);p.setStreamController(T),m.setStreamController(T);const D=[g,_,T];d&&D.splice(1,0,d),y&&D.splice(1,0,y),this.networkControllers=D;const w=[u,f,S,p,m,b,c];this.audioTrackController=this.createController(n.audioTrackController,D);const L=n.audioStreamController;L&&D.push(this.audioStreamController=new L(this,c,E)),this.subtitleTrackController=this.createController(n.subtitleTrackController,D);const k=n.subtitleStreamController;k&&D.push(this.subtititleStreamController=new k(this,c,E)),this.createController(n.timelineController,w),E.emeController=this.emeController=this.createController(n.emeController,w),this.cmcdController=this.createController(n.cmcdController,w),this.latencyController=this.createController($p,w),this.coreComponents=w,D.push(l);const A=l.onErrorOut;"function"==typeof A&&this.on(ca.ERROR,A,l),this.on(ca.MANIFEST_LOADED,g.onManifestLoaded,g)}createController(t,e){if(t){const n=new t(this);return e&&e.push(n),n}return null}on(t,e,n=this){this._emitter.on(t,e,n)}once(t,e,n=this){this._emitter.once(t,e,n)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,n=this,i){this._emitter.off(t,e,n,i)}listeners(t){return this._emitter.listeners(t)}emit(t,e,n){return this._emitter.emit(t,e,n)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),!this.triggeringException){this.triggeringException=!0;const n=t===ca.ERROR;this.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.INTERNAL_EXCEPTION,fatal:n,event:t,error:e}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(ca.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const e=new Error(`attachMedia failed: invalid argument (${t})`);return void this.trigger(ca.ERROR,{type:la.OTHER_ERROR,details:ua.ATTACH_MEDIA_ERROR,fatal:!0,error:e})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,n=e?t.media:t,i=e?t:{media:n};this._media=n,this.trigger(ca.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(ca.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(ca.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,n=this._url,i=this._url=Ha.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),e&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(ca.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,e){this.logger.log(`startLoad(${t+(e?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(t,e),this.started&&this.networkControllers);n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!this.started&&this.networkControllers);t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[ma]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[ga]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[va]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=null==t?void 0:t.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=function(){try{return crypto.randomUUID()}catch(t){try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch(t){let e=(new Date).getTime();const n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return n}}}()),t}get levels(){return this.levelController.levels||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return-1===t&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){(function(t){return Zo.indexOf(t)>-1})(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const n=t.length;for(let i=0;i<n;i++)if(t[i].maxBitrate>=e)return i;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:n}=this;let i;if(i=-1===e&&null!=t&&t.length?t.length-1:e,n)for(let e=i;e--;){const i=t[e].attrs["HDCP-LEVEL"];if(i&&i<=n)return e}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return(null==(e=this.audioTrackController)?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return(null==(e=this.subtitleTrackController)?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!(null==(t=this.bufferController)||!t.bufferedToEnd)}get interstitialsManager(){var t;return(null==(t=this.interstitialsController)?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,e=this.allAudioTracks){return Ko(t,il(e),navigator.mediaCapabilities)}}function Qp(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Jp(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jp(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function tm(t,e){return rm(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||nm(t,e)||em()}function em(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nm(t,e){if(t){if("string"==typeof t)return im(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?im(t,e):void 0}}function im(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function rm(t){if(Array.isArray(t))return t}function sm(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return am(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?am(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function am(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}Xp.defaultConfig=void 0;var om=[{key:"main",label:"Main",Component:function(){var e=tm((0,t.useState)(null),2),n=e[0],i=e[1],r=tm((0,t.useState)(null),2),s=r[0],a=r[1];return t.createElement("div",{className:"main-view"},t.createElement("div",{className:"map-section"},t.createElement(ys,{onMarkerClick:function(t){if(!t)return i(null),void a(null);var e,n=rm(e=t.split("/"))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||nm(e)||em(),r=n[0],s=n.slice(1);i(r),a(s.length?s.join("/"):null)}})),t.createElement("div",{className:"subview-section"},"image"===n&&t.createElement(Yr,{selectedSvgProp:s}),"datapoint"===n&&t.createElement(As,null),"communication"===n&&t.createElement(Os,null),!n&&t.createElement("div",null,"Select a marker to view details below.")))}},{key:"image",label:"Image",Component:Yr},{key:"datapoints",label:"Datapoints",Component:As},{key:"communications",label:"Communications",Component:Os},{key:"alarms",label:"Alarms",Component:function(){var e,n,i=(0,t.useCallback)(function(t){return t.alarm_occurrence_id||"".concat(t.datapoint_identifier,"@").concat(t.activation_time)},[]),r=(e=Gr("alarm","alarmupdatemsg",i),n=1,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Bs(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bs(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],s=Object.values(r).filter(function(t){return!(t.deactivation_time&&t.acknowledge_time)});function a(){return a=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){Ns(s,i,r,a,o,"next",t)}function o(t){Ns(s,i,r,a,o,"throw",t)}a(void 0)})}}(Ms().m(function t(e){var n;return Ms().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,jr("alarm","ackalarmmsg",{alarm_occurrence_id:e});case 1:t.n=3;break;case 2:t.p=2,n=t.v,alert("Ack failed: "+n.message);case 3:return t.a(2)}},t,null,[[0,2]])})),a.apply(this,arguments)}return(0,t.useEffect)(function(){var t=s.some(function(t){return!t.acknowledge_time});window.parent.postMessage(t?"RaiseAlert:Alarms":"LowerAlert:Alarms","*")},[s]),t.createElement("div",null,t.createElement("h2",null,"Active Alarms"),t.createElement("table",{id:"alarm-table"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"Rule ID"),t.createElement("th",null,"Datapoint"),t.createElement("th",null,"Activation Time"),t.createElement("th",null,"Deactivation Time"),t.createElement("th",null,"Acknowledge Time"),t.createElement("th",null,"Action"))),t.createElement("tbody",null,s.map(function(e){return t.createElement("tr",{key:i(e)},t.createElement("td",null,e.rule_id||"N/A"),t.createElement("td",null,e.datapoint_identifier),t.createElement("td",null,Us(e.activation_time)),t.createElement("td",null,Us(e.deactivation_time)),t.createElement("td",null,Us(e.acknowledge_time)),t.createElement("td",null,t.createElement("button",{onClick:function(){return function(t){return a.apply(this,arguments)}(i(e))}},"Ack")))}))))}},{key:"commands",label:"Commands",Component:function(){var e,n,i=(e=Gr("command","commandfeedbackmsg",Ys),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s,a,o=[],l=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,n)||function(t,e){if(t){if("string"==typeof t)return Ws(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ws(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=i[0],s=i[1];function a(t,e){return o.apply(this,arguments)}function o(){return o=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var s=t.apply(e,n);function a(t){Ks(s,i,r,a,o,"next",t)}function o(t){Ks(s,i,r,a,o,"throw",t)}a(void 0)})}}(zs().m(function t(e,n){var i,r;return zs().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,i="cmd_"+Math.random().toString(36).substring(2,10),t.n=1,jr("command","sendcommandmsg",{command_id:i,datapoint_identifier:e,value:n});case 1:t.n=3;break;case 2:t.p=2,r=t.v,window.alert("Failed to send command: "+r.message);case 3:return t.a(2)}},t,null,[[0,2]])})),o.apply(this,arguments)}return t.createElement("div",null,t.createElement("h2",null,"Command List"),t.createElement("table",{id:"command-table"},t.createElement("thead",null,t.createElement("tr",null,t.createElement("th",null,"Command"),t.createElement("th",null,"Value"),t.createElement("th",null,"Feedback"),t.createElement("th",null,"Timestamp"),t.createElement("th",null,"Send"))),t.createElement("tbody",null,Object.values(r).map(function(e){var n,i,r,o=null!==(n=e.value)&&void 0!==n?n:"",l=null!==(i=e.feedback)&&void 0!==i?i:"None",u=null!==(r=e.timestamp)&&void 0!==r?r:"None";return t.createElement("tr",{key:e.datapoint_identifier},t.createElement("td",null,e.datapoint_identifier),t.createElement("td",null,t.createElement("input",{type:"text",value:o,onChange:function(t){var n=t.target.value;s(function(t){return Hs(Hs({},t),{},Vs({},e.datapoint_identifier,Hs(Hs({},t[e.datapoint_identifier]),{},{value:n})))})},onKeyDown:function(t){"Enter"===t.key&&a(e.datapoint_identifier,t.target.value)}})),t.createElement("td",{className:"feedback"},l),t.createElement("td",{className:"timestamp"},u),t.createElement("td",null,t.createElement("button",{onClick:function(){return a(e.datapoint_identifier,e.value)}},"Send")))}))))}},{key:"tracking",label:"Tracking",Component:function(){var e=Zs(Gr("tracking","datafloweventmsg",Xs),1)[0],n=Zs((0,t.useState)(""),2),i=n[0],r=n[1],s=Zs((0,t.useState)(""),2),a=s[0],o=s[1],l=Zs((0,t.useState)(""),2),u=l[0],c=l[1],h=(0,t.useMemo)(function(){return Object.values(e).sort(function(t,e){var n=new Date(t.timestamp||0).getTime();return new Date(e.timestamp||0).getTime()-n}).filter(function(t){return(""===i||(t.track_id||"").toLowerCase().includes(i.toLowerCase()))&&(""===a||(t.event_type||"").toLowerCase().includes(a.toLowerCase()))&&(""===u||(t.source||"").toLowerCase().includes(u.toLowerCase()))}).slice(0,100)},[e,i,a,u]);return t.createElement("div",null,t.createElement("h2",null,"Data Flow Events"),t.createElement("div",{style:{marginBottom:"1em",display:"flex",flexWrap:"wrap",gap:"0.5em"}},t.createElement("label",null,"Track ID:"," ",t.createElement("input",{type:"text",value:i,onChange:function(t){return r(t.target.value)},style:{width:"14em"}})),t.createElement("label",null,"Event Type:"," ",t.createElement("input",{type:"text",value:a,onChange:function(t){return o(t.target.value)},style:{width:"14em"}})),t.createElement("label",null,"Source:"," ",t.createElement("input",{type:"text",value:u,onChange:function(t){return c(t.target.value)},style:{width:"14em"}}))),t.createElement("table",{id:"tracking-table",style:{width:"100%",borderCollapse:"collapse"}},t.createElement("thead",null,t.createElement("tr",{style:{background:"#f8f8f8"}},t.createElement("th",null,"Track ID"),t.createElement("th",null,"Event Type"),t.createElement("th",null,"Source"),t.createElement("th",null,"Status"),t.createElement("th",null,"Timestamp"),t.createElement("th",null,"Payload"))),t.createElement("tbody",null,h.map(function(e,n){return t.createElement("tr",{key:Xs(e)+"_"+n,style:{borderBottom:"1px solid #ddd",verticalAlign:"top"}},t.createElement("td",null,e.track_id||""),t.createElement("td",null,e.event_type||""),t.createElement("td",null,e.source||""),t.createElement("td",null,e.status||""),t.createElement("td",null,e.timestamp||""),t.createElement("td",null,t.createElement("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:"0.85em"}},JSON.stringify(e.payload,null,2))))}),0===h.length&&t.createElement("tr",null,t.createElement("td",{colSpan:"6",style:{textAlign:"center",padding:"1em"}},"No events to display")))))}},{key:"streams",label:"Streams",Component:function(){var e=Qp((0,t.useState)([]),2),n=e[0],i=e[1],r=Qp((0,t.useState)(null),2),s=r[0],a=r[1],o=(0,t.useRef)(null),l=(0,t.useRef)(null);return(0,t.useEffect)(function(){fetch("/streams").then(function(t){return t.json()}).then(function(t){i(t),t.length>0&&a(t[0])}).catch(function(t){return console.error("Failed to load streams:",t)})},[]),(0,t.useEffect)(function(){if(s&&o.current){var t=o.current,e="".concat(s.protocol,"://").concat(s.server||window.location.hostname,":").concat(s.port,"/").concat(s.path);if(l.current&&(l.current.destroy(),l.current=null),Xp.isSupported()){var n=new Xp;n.loadSource(e),n.attachMedia(t),n.on(Xp.Events.MANIFEST_PARSED,function(){t.muted=!0,t.play().catch(function(t){return console.error("Autoplay failed:",t)})}),n.on(Xp.Events.ERROR,function(t,e){console.error("HLS.js error:",e)}),l.current=n}else t.canPlayType("application/vnd.apple.mpegurl")?(t.src=e,t.muted=!0,t.play().catch(function(t){return console.error("Autoplay failed:",t)})):console.error("HLS is not supported in this browser.")}},[s]),t.createElement("div",null,t.createElement("h2",null,"Streaming Cameras"),t.createElement("select",{value:(null==s?void 0:s.id)||"",onChange:function(t){var e=n.find(function(e){return e.id===t.target.value});a(e)},style:{marginBottom:8}},n.map(function(e){return t.createElement("option",{key:e.id,value:e.id},e.description)})),s&&t.createElement("div",null,t.createElement("h3",null,s.description),t.createElement("video",{ref:o,controls:!0,muted:!0,style:{width:"100%",maxHeight:"500px",border:"1px solid #ccc"}})))}}];function lm(){var e=sm((0,t.useState)("main"),2),n=e[0],i=e[1],r=sm((0,t.useState)(!1),2),s=r[0],a=r[1],o=sm((0,t.useState)(null),2),l=o[0],u=o[1],c=(0,t.useRef)();(0,t.useEffect)(function(){function t(t){"RaiseAlert:Alarms"===t.data&&a(!0),"LowerAlert:Alarms"===t.data&&a(!1)}return window.addEventListener("message",t),function(){return window.removeEventListener("message",t)}},[]);var h=function(t){var e=t;e&&e.includes("/")&&(e=e.split("/").pop()),u(e),i("main")};return t.createElement("div",{className:"app-container"},t.createElement(P,null),t.createElement("div",{className:"tabs"},om.map(function(e){return t.createElement("button",{key:e.key,className:"tab-btn".concat(n===e.key?" active":""),onClick:function(){return i(e.key)},ref:"alarms"===e.key?c:void 0,style:"alarms"===e.key&&s?{background:"red",color:"white"}:{}},e.label)})),om.map(function(e){return t.createElement("div",{key:e.key,className:"tab-content",style:{display:n===e.key?"block":"none"}},"gis"===e.key?t.createElement(e.Component,{active:"gis"===n,onMarkerClick:h}):"image"===e.key?t.createElement(e.Component,{selectedSvgProp:l}):t.createElement(e.Component,null))}))}function um(t){var e=t.children;return E().isAuthenticated?e:(window.location.href="/scada/login",null)}function cm(){return"/scada/login"===sm((0,t.useState)(window.location.pathname),1)[0]?t.createElement(b,null,t.createElement(C,{redirectPath:"/scada"})):t.createElement(b,null,t.createElement(um,null,t.createElement(ia,null,t.createElement(lm,null),t.createElement(ra,null))))}(0,e.H)(document.getElementById("root")).render(t.createElement(cm,null))})()})();